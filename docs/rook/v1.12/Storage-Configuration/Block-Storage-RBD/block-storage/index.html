<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Rook Ceph Documentation"><meta name=author content="Rook Authors"><link href=https://rook.io/v1.12/Storage-Configuration/Block-Storage-RBD/block-storage/ rel=canonical><link rel=icon href=https://rook.io/images/favicon_192x192.png><meta name=generator content="mkdocs-1.5.2, mkdocs-material-8.5.10"><title>Block Storage Overview - Rook Ceph Documentation</title><link rel=stylesheet href=../../../assets/stylesheets/main.975780f9.min.css><link rel=stylesheet href=../../../assets/stylesheets/palette.2505c338.min.css><link rel=stylesheet href=../../../stylesheets/extra.css><script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=rook-blue data-md-color-accent=deep-orange> <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#prerequisites class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <div data-md-component=outdated hidden> <aside class="md-banner md-banner--warning"> <div class="md-banner__inner md-grid md-typeset"> This documentation is not for the latest stable version of Rook. <a href=../../../../latest-release/ > <strong>Click here for the latest release documentation.</strong> </a> </div> <script>var el=document.querySelector("[data-md-component=outdated]"),outdated=__md_get("__outdated",sessionStorage);!0===outdated&&el&&(el.hidden=!1)</script> </aside> </div> <header class="md-header md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../../.. title="Rook Ceph Documentation" class="md-header__button md-logo" aria-label="Rook Ceph Documentation" data-md-component=logo> <img src=https://rook.io/images/rook-logo.svg alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Rook Ceph Documentation </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Block Storage Overview </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=rook-blue data-md-color-accent=deep-orange aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=rook-blue data-md-color-accent=red aria-label="Switch to light mode" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/rook/rook title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../../Getting-Started/intro/ class=md-tabs__link> Getting Started </a> </li> <li class=md-tabs__item> <a href=../../../Helm-Charts/helm-charts/ class=md-tabs__link> Helm Charts </a> </li> <li class=md-tabs__item> <a href=./ class="md-tabs__link md-tabs__link--active"> Storage Configuration </a> </li> <li class=md-tabs__item> <a href=../../../CRDs/Cluster/ceph-cluster-crd/ class=md-tabs__link> Custom Resources </a> </li> <li class=md-tabs__item> <a href=../../../Troubleshooting/krew-plugin/ class=md-tabs__link> Troubleshooting </a> </li> <li class=md-tabs__item> <a href=../../../Upgrade/health-verification/ class=md-tabs__link> Upgrade </a> </li> <li class=md-tabs__item> <a href=../../../Contributing/development-flow/ class=md-tabs__link> Contributing </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../.. title="Rook Ceph Documentation" class="md-nav__button md-logo" aria-label="Rook Ceph Documentation" data-md-component=logo> <img src=https://rook.io/images/rook-logo.svg alt=logo> </a> Rook Ceph Documentation </label> <div class=md-nav__source> <a href=https://github.com/rook/rook title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle=__nav_1 type=checkbox id=__nav_1 checked> <label class=md-nav__link for=__nav_1> Getting Started <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Getting Started" data-md-level=1> <label class=md-nav__title for=__nav_1> <span class="md-nav__icon md-icon"></span> Getting Started </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Getting-Started/intro/ class=md-nav__link> Rook </a> </li> <li class=md-nav__item> <a href=../../../Getting-Started/glossary/ class=md-nav__link> Glossary </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle=__nav_1_3 type=checkbox id=__nav_1_3 checked> <label class=md-nav__link for=__nav_1_3> Prerequisites <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Prerequisites data-md-level=2> <label class=md-nav__title for=__nav_1_3> <span class="md-nav__icon md-icon"></span> Prerequisites </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Getting-Started/Prerequisites/prerequisites/ class=md-nav__link> Prerequisites </a> </li> <li class=md-nav__item> <a href=../../../Getting-Started/Prerequisites/authenticated-registry/ class=md-nav__link> Authenticated Container Registries </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../Getting-Started/quickstart/ class=md-nav__link> Quickstart </a> </li> <li class=md-nav__item> <a href=../../../Getting-Started/storage-architecture/ class=md-nav__link> Storage Architecture </a> </li> <li class=md-nav__item> <a href=../../../Getting-Started/example-configurations/ class=md-nav__link> Example Configurations </a> </li> <li class=md-nav__item> <a href=../../../Getting-Started/ceph-openshift/ class=md-nav__link> OpenShift </a> </li> <li class=md-nav__item> <a href=../../../Getting-Started/ceph-teardown/ class=md-nav__link> Cleanup </a> </li> <li class=md-nav__item> <a href=../../../Getting-Started/release-cycle/ class=md-nav__link> Release Cycle </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle=__nav_2 type=checkbox id=__nav_2 checked> <label class=md-nav__link for=__nav_2> Helm Charts <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Helm Charts" data-md-level=1> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Helm Charts </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Helm-Charts/helm-charts/ class=md-nav__link> Helm Charts Overview </a> </li> <li class=md-nav__item> <a href=../../../Helm-Charts/operator-chart/ class=md-nav__link> Ceph Operator Helm Chart </a> </li> <li class=md-nav__item> <a href=../../../Helm-Charts/ceph-cluster-chart/ class=md-nav__link> Ceph Cluster Helm Chart </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3 type=checkbox id=__nav_3 checked> <label class=md-nav__link for=__nav_3> Storage Configuration <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Storage Configuration" data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Storage Configuration </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_1 type=checkbox id=__nav_3_1 checked> <label class=md-nav__link for=__nav_3_1> Block Storage (RBD) <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Block Storage (RBD)" data-md-level=2> <label class=md-nav__title for=__nav_3_1> <span class="md-nav__icon md-icon"></span> Block Storage (RBD) </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Block Storage Overview <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> Block Storage Overview </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#prerequisites class=md-nav__link> Prerequisites </a> </li> <li class=md-nav__item> <a href=#provision-storage class=md-nav__link> Provision Storage </a> </li> <li class=md-nav__item> <a href=#consume-the-storage-wordpress-sample class=md-nav__link> Consume the storage: Wordpress sample </a> </li> <li class=md-nav__item> <a href=#consume-the-storage-toolbox class=md-nav__link> Consume the storage: Toolbox </a> </li> <li class=md-nav__item> <a href=#teardown class=md-nav__link> Teardown </a> </li> <li class=md-nav__item> <a href=#advanced-example-erasure-coded-block-storage class=md-nav__link> Advanced Example: Erasure Coded Block Storage </a> <nav class=md-nav aria-label="Advanced Example: Erasure Coded Block Storage"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#erasure-coded-csi-driver class=md-nav__link> Erasure Coded CSI Driver </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#node-loss class=md-nav__link> Node Loss </a> <nav class=md-nav aria-label="Node Loss"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#configure-csi-addons class=md-nav__link> Configure CSI-Addons </a> </li> <li class=md-nav__item> <a href=#handling-node-loss class=md-nav__link> Handling Node Loss </a> </li> <li class=md-nav__item> <a href=#node-recovery class=md-nav__link> Node Recovery </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../rbd-mirroring/ class=md-nav__link> RBD Mirroring </a> </li> <li class=md-nav__item> <a href=../rbd-async-disaster-recovery-failover-failback/ class=md-nav__link> RBD Asynchronous DR Failover and Failback </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle=__nav_3_2 type=checkbox id=__nav_3_2 checked> <label class=md-nav__link for=__nav_3_2> Shared Filesystem (CephFS) <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Shared Filesystem (CephFS)" data-md-level=2> <label class=md-nav__title for=__nav_3_2> <span class="md-nav__icon md-icon"></span> Shared Filesystem (CephFS) </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Shared-Filesystem-CephFS/filesystem-storage/ class=md-nav__link> Filesystem Storage Overview </a> </li> <li class=md-nav__item> <a href=../../Shared-Filesystem-CephFS/filesystem-mirroring/ class=md-nav__link> Filesystem Mirroring </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle=__nav_3_3 type=checkbox id=__nav_3_3 checked> <label class=md-nav__link for=__nav_3_3> Object Storage (RGW) <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Object Storage (RGW)" data-md-level=2> <label class=md-nav__title for=__nav_3_3> <span class="md-nav__icon md-icon"></span> Object Storage (RGW) </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Object-Storage-RGW/object-storage/ class=md-nav__link> Object Storage Overview </a> </li> <li class=md-nav__item> <a href=../../Object-Storage-RGW/ceph-object-bucket-claim/ class=md-nav__link> Bucket Claim </a> </li> <li class=md-nav__item> <a href=../../Object-Storage-RGW/ceph-object-bucket-notifications/ class=md-nav__link> Object Bucket Notifications </a> </li> <li class=md-nav__item> <a href=../../Object-Storage-RGW/ceph-object-multisite/ class=md-nav__link> Object Store Multisite </a> </li> <li class=md-nav__item> <a href=../../Object-Storage-RGW/cosi/ class=md-nav__link> Container Object Storage Interface (COSI) </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle=__nav_3_4 type=checkbox id=__nav_3_4 checked> <label class=md-nav__link for=__nav_3_4> NFS <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=NFS data-md-level=2> <label class=md-nav__title for=__nav_3_4> <span class="md-nav__icon md-icon"></span> NFS </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../NFS/nfs/ class=md-nav__link> NFS Storage Overview </a> </li> <li class=md-nav__item> <a href=../../NFS/nfs-csi-driver/ class=md-nav__link> CSI provisioner and driver </a> </li> <li class=md-nav__item> <a href=../../NFS/nfs-security/ class=md-nav__link> Security </a> </li> <li class=md-nav__item> <a href=../../NFS/nfs-advanced/ class=md-nav__link> Advanced configuration </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle=__nav_3_5 type=checkbox id=__nav_3_5 checked> <label class=md-nav__link for=__nav_3_5> Monitoring <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Monitoring data-md-level=2> <label class=md-nav__title for=__nav_3_5> <span class="md-nav__icon md-icon"></span> Monitoring </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Monitoring/ceph-dashboard/ class=md-nav__link> Ceph Dashboard </a> </li> <li class=md-nav__item> <a href=../../Monitoring/ceph-monitoring/ class=md-nav__link> Prometheus Monitoring </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle=__nav_3_6 type=checkbox id=__nav_3_6 checked> <label class=md-nav__link for=__nav_3_6> Ceph CSI <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Ceph CSI" data-md-level=2> <label class=md-nav__title for=__nav_3_6> <span class="md-nav__icon md-icon"></span> Ceph CSI </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Ceph-CSI/ceph-csi-drivers/ class=md-nav__link> Ceph CSI Drivers </a> </li> <li class=md-nav__item> <a href=../../Ceph-CSI/ceph-csi-snapshot/ class=md-nav__link> Snapshots </a> </li> <li class=md-nav__item> <a href=../../Ceph-CSI/ceph-csi-volume-clone/ class=md-nav__link> Volume clone </a> </li> <li class=md-nav__item> <a href=../../Ceph-CSI/custom-images/ class=md-nav__link> Custom Images </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../ceph-teardown/ class=md-nav__link> Cleanup </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle=__nav_3_8 type=checkbox id=__nav_3_8 checked> <label class=md-nav__link for=__nav_3_8> Advanced <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Advanced data-md-level=2> <label class=md-nav__title for=__nav_3_8> <span class="md-nav__icon md-icon"></span> Advanced </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Advanced/ceph-configuration/ class=md-nav__link> Ceph Configuration </a> </li> <li class=md-nav__item> <a href=../../Advanced/configuration/ class=md-nav__link> Configuration </a> </li> <li class=md-nav__item> <a href=../../Advanced/key-management-system/ class=md-nav__link> Key Management System </a> </li> <li class=md-nav__item> <a href=../../Advanced/ceph-osd-mgmt/ class=md-nav__link> Ceph OSD Management </a> </li> <li class=md-nav__item> <a href=../../Advanced/ceph-mon-health/ class=md-nav__link> Monitor Health </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle=__nav_4 type=checkbox id=__nav_4 checked> <label class=md-nav__link for=__nav_4> Custom Resources <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Custom Resources" data-md-level=1> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Custom Resources </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle=__nav_4_1 type=checkbox id=__nav_4_1 checked> <label class=md-nav__link for=__nav_4_1> Cluster Configuration <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Cluster Configuration" data-md-level=2> <label class=md-nav__title for=__nav_4_1> <span class="md-nav__icon md-icon"></span> Cluster Configuration </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../CRDs/Cluster/ceph-cluster-crd/ class=md-nav__link> CephCluster CRD </a> </li> <li class=md-nav__item> <a href=../../../CRDs/Cluster/host-cluster/ class=md-nav__link> Host Storage Cluster </a> </li> <li class=md-nav__item> <a href=../../../CRDs/Cluster/pvc-cluster/ class=md-nav__link> PVC Storage Cluster </a> </li> <li class=md-nav__item> <a href=../../../CRDs/Cluster/stretch-cluster/ class=md-nav__link> Stretch Storage Cluster </a> </li> <li class=md-nav__item> <a href=../../../CRDs/Cluster/external-cluster/ class=md-nav__link> External Storage Cluster </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle=__nav_4_2 type=checkbox id=__nav_4_2 checked> <label class=md-nav__link for=__nav_4_2> Block Storage <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Block Storage" data-md-level=2> <label class=md-nav__title for=__nav_4_2> <span class="md-nav__icon md-icon"></span> Block Storage </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../CRDs/Block-Storage/ceph-block-pool-crd/ class=md-nav__link> CephBlockPool CRD </a> </li> <li class=md-nav__item> <a href=../../../CRDs/Block-Storage/ceph-block-pool-rados-namespace-crd/ class=md-nav__link> CephBlockPoolRados Namespace CRD </a> </li> <li class=md-nav__item> <a href=../../../CRDs/Block-Storage/ceph-rbd-mirror-crd/ class=md-nav__link> CephRBDMirror CRD </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle=__nav_4_3 type=checkbox id=__nav_4_3 checked> <label class=md-nav__link for=__nav_4_3> Shared Filesystem <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Shared Filesystem" data-md-level=2> <label class=md-nav__title for=__nav_4_3> <span class="md-nav__icon md-icon"></span> Shared Filesystem </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../CRDs/Shared-Filesystem/ceph-filesystem-crd/ class=md-nav__link> CephFilesystem CRD </a> </li> <li class=md-nav__item> <a href=../../../CRDs/Shared-Filesystem/ceph-fs-mirror-crd/ class=md-nav__link> CephFilesystemMirror CRD </a> </li> <li class=md-nav__item> <a href=../../../CRDs/Shared-Filesystem/ceph-fs-subvolumegroup-crd/ class=md-nav__link> FilesystemSubVolumeGroup CRD </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle=__nav_4_4 type=checkbox id=__nav_4_4 checked> <label class=md-nav__link for=__nav_4_4> Object Storage <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Object Storage" data-md-level=2> <label class=md-nav__title for=__nav_4_4> <span class="md-nav__icon md-icon"></span> Object Storage </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../CRDs/Object-Storage/ceph-object-store-crd/ class=md-nav__link> CephObjectStore CRD </a> </li> <li class=md-nav__item> <a href=../../../CRDs/Object-Storage/ceph-object-store-user-crd/ class=md-nav__link> CephObjectStoreUser CRD </a> </li> <li class=md-nav__item> <a href=../../../CRDs/Object-Storage/ceph-object-realm-crd/ class=md-nav__link> CephObjectRealm CRD </a> </li> <li class=md-nav__item> <a href=../../../CRDs/Object-Storage/ceph-object-zonegroup-crd/ class=md-nav__link> CephObjectZoneGroup CRD </a> </li> <li class=md-nav__item> <a href=../../../CRDs/Object-Storage/ceph-object-zone-crd/ class=md-nav__link> CephObjectZone CRD </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../CRDs/ceph-client-crd/ class=md-nav__link> CephClient CRD </a> </li> <li class=md-nav__item> <a href=../../../CRDs/ceph-nfs-crd/ class=md-nav__link> CephNFS CRD </a> </li> <li class=md-nav__item> <a href=../../../CRDs/specification/ class=md-nav__link> Specification </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle=__nav_5 type=checkbox id=__nav_5 checked> <label class=md-nav__link for=__nav_5> Troubleshooting <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Troubleshooting data-md-level=1> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Troubleshooting </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Troubleshooting/krew-plugin/ class=md-nav__link> Krew Plugin </a> </li> <li class=md-nav__item> <a href=../../../Troubleshooting/ceph-toolbox/ class=md-nav__link> Toolbox </a> </li> <li class=md-nav__item> <a href=../../../Troubleshooting/common-issues/ class=md-nav__link> Common Issues </a> </li> <li class=md-nav__item> <a href=../../../Troubleshooting/ceph-common-issues/ class=md-nav__link> Ceph Common Issues </a> </li> <li class=md-nav__item> <a href=../../../Troubleshooting/ceph-csi-common-issues/ class=md-nav__link> CSI Common Issues </a> </li> <li class=md-nav__item> <a href=../../../Troubleshooting/openshift-common-issues/ class=md-nav__link> OpenShift Common Issues </a> </li> <li class=md-nav__item> <a href=../../../Troubleshooting/disaster-recovery/ class=md-nav__link> Disaster Recovery </a> </li> <li class=md-nav__item> <a href=../../../Troubleshooting/direct-tools/ class=md-nav__link> Direct Tools </a> </li> <li class=md-nav__item> <a href=../../../Troubleshooting/performance-profiling/ class=md-nav__link> Performance Profiling </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle=__nav_6 type=checkbox id=__nav_6 checked> <label class=md-nav__link for=__nav_6> Upgrade <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Upgrade data-md-level=1> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Upgrade </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Upgrade/health-verification/ class=md-nav__link> Health Verification </a> </li> <li class=md-nav__item> <a href=../../../Upgrade/rook-upgrade/ class=md-nav__link> Rook Upgrades </a> </li> <li class=md-nav__item> <a href=../../../Upgrade/ceph-upgrade/ class=md-nav__link> Ceph Upgrades </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle=__nav_7 type=checkbox id=__nav_7 checked> <label class=md-nav__link for=__nav_7> Contributing <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Contributing data-md-level=1> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> Contributing </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Contributing/development-flow/ class=md-nav__link> Development Flow </a> </li> <li class=md-nav__item> <a href=../../../Contributing/development-environment/ class=md-nav__link> Developer Environment </a> </li> <li class=md-nav__item> <a href=../../../Contributing/documentation/ class=md-nav__link> Documentation </a> </li> <li class=md-nav__item> <a href=../../../Contributing/ci-configuration/ class=md-nav__link> CI Configuration </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#prerequisites class=md-nav__link> Prerequisites </a> </li> <li class=md-nav__item> <a href=#provision-storage class=md-nav__link> Provision Storage </a> </li> <li class=md-nav__item> <a href=#consume-the-storage-wordpress-sample class=md-nav__link> Consume the storage: Wordpress sample </a> </li> <li class=md-nav__item> <a href=#consume-the-storage-toolbox class=md-nav__link> Consume the storage: Toolbox </a> </li> <li class=md-nav__item> <a href=#teardown class=md-nav__link> Teardown </a> </li> <li class=md-nav__item> <a href=#advanced-example-erasure-coded-block-storage class=md-nav__link> Advanced Example: Erasure Coded Block Storage </a> <nav class=md-nav aria-label="Advanced Example: Erasure Coded Block Storage"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#erasure-coded-csi-driver class=md-nav__link> Erasure Coded CSI Driver </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#node-loss class=md-nav__link> Node Loss </a> <nav class=md-nav aria-label="Node Loss"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#configure-csi-addons class=md-nav__link> Configure CSI-Addons </a> </li> <li class=md-nav__item> <a href=#handling-node-loss class=md-nav__link> Handling Node Loss </a> </li> <li class=md-nav__item> <a href=#node-recovery class=md-nav__link> Node Recovery </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/rook/rook/edit/master/Documentation/Storage-Configuration/Block-Storage-RBD/block-storage.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg> </a> <h1>Block Storage Overview</h1> <p>Block storage allows a single pod to mount storage. This guide shows how to create a simple, multi-tier web application on Kubernetes using persistent volumes enabled by Rook.</p> <h2 id=prerequisites>Prerequisites<a class=headerlink href=#prerequisites title="Permanent link">&para;</a></h2> <p>This guide assumes a Rook cluster as explained in the <a href=../../../Getting-Started/quickstart/ >Quickstart</a>.</p> <h2 id=provision-storage>Provision Storage<a class=headerlink href=#provision-storage title="Permanent link">&para;</a></h2> <p>Before Rook can provision storage, a <a href=https://kubernetes.io/docs/concepts/storage/storage-classes><code>StorageClass</code></a> and <a href=../../../CRDs/Block-Storage/ceph-block-pool-crd/ ><code>CephBlockPool</code> CR</a> need to be created. This will allow Kubernetes to interoperate with Rook when provisioning persistent volumes.</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>This sample requires <em>at least 1 OSD per node</em>, with each OSD located on <em>3 different nodes</em>.</p> </div> <p>Each OSD must be located on a different node, because the <a href=../../../CRDs/Block-Storage/ceph-block-pool-crd/#spec><code>failureDomain</code></a> is set to <code>host</code> and the <code>replicated.size</code> is set to <code>3</code>.</p> <p>Save this <code>StorageClass</code> definition as <code>storageclass.yaml</code>:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-1> 1</a></span>
<span class=normal><a href=#__codelineno-0-2> 2</a></span>
<span class=normal><a href=#__codelineno-0-3> 3</a></span>
<span class=normal><a href=#__codelineno-0-4> 4</a></span>
<span class=normal><a href=#__codelineno-0-5> 5</a></span>
<span class=normal><a href=#__codelineno-0-6> 6</a></span>
<span class=normal><a href=#__codelineno-0-7> 7</a></span>
<span class=normal><a href=#__codelineno-0-8> 8</a></span>
<span class=normal><a href=#__codelineno-0-9> 9</a></span>
<span class=normal><a href=#__codelineno-0-10>10</a></span>
<span class=normal><a href=#__codelineno-0-11>11</a></span>
<span class=normal><a href=#__codelineno-0-12>12</a></span>
<span class=normal><a href=#__codelineno-0-13>13</a></span>
<span class=normal><a href=#__codelineno-0-14>14</a></span>
<span class=normal><a href=#__codelineno-0-15>15</a></span>
<span class=normal><a href=#__codelineno-0-16>16</a></span>
<span class=normal><a href=#__codelineno-0-17>17</a></span>
<span class=normal><a href=#__codelineno-0-18>18</a></span>
<span class=normal><a href=#__codelineno-0-19>19</a></span>
<span class=normal><a href=#__codelineno-0-20>20</a></span>
<span class=normal><a href=#__codelineno-0-21>21</a></span>
<span class=normal><a href=#__codelineno-0-22>22</a></span>
<span class=normal><a href=#__codelineno-0-23>23</a></span>
<span class=normal><a href=#__codelineno-0-24>24</a></span>
<span class=normal><a href=#__codelineno-0-25>25</a></span>
<span class=normal><a href=#__codelineno-0-26>26</a></span>
<span class=normal><a href=#__codelineno-0-27>27</a></span>
<span class=normal><a href=#__codelineno-0-28>28</a></span>
<span class=normal><a href=#__codelineno-0-29>29</a></span>
<span class=normal><a href=#__codelineno-0-30>30</a></span>
<span class=normal><a href=#__codelineno-0-31>31</a></span>
<span class=normal><a href=#__codelineno-0-32>32</a></span>
<span class=normal><a href=#__codelineno-0-33>33</a></span>
<span class=normal><a href=#__codelineno-0-34>34</a></span>
<span class=normal><a href=#__codelineno-0-35>35</a></span>
<span class=normal><a href=#__codelineno-0-36>36</a></span>
<span class=normal><a href=#__codelineno-0-37>37</a></span>
<span class=normal><a href=#__codelineno-0-38>38</a></span>
<span class=normal><a href=#__codelineno-0-39>39</a></span>
<span class=normal><a href=#__codelineno-0-40>40</a></span>
<span class=normal><a href=#__codelineno-0-41>41</a></span>
<span class=normal><a href=#__codelineno-0-42>42</a></span>
<span class=normal><a href=#__codelineno-0-43>43</a></span>
<span class=normal><a href=#__codelineno-0-44>44</a></span>
<span class=normal><a href=#__codelineno-0-45>45</a></span>
<span class=normal><a href=#__codelineno-0-46>46</a></span>
<span class=normal><a href=#__codelineno-0-47>47</a></span>
<span class=normal><a href=#__codelineno-0-48>48</a></span>
<span class=normal><a href=#__codelineno-0-49>49</a></span>
<span class=normal><a href=#__codelineno-0-50>50</a></span>
<span class=normal><a href=#__codelineno-0-51>51</a></span>
<span class=normal><a href=#__codelineno-0-52>52</a></span>
<span class=normal><a href=#__codelineno-0-53>53</a></span>
<span class=normal><a href=#__codelineno-0-54>54</a></span>
<span class=normal><a href=#__codelineno-0-55>55</a></span>
<span class=normal><a href=#__codelineno-0-56>56</a></span>
<span class=normal><a href=#__codelineno-0-57>57</a></span>
<span class=normal><a href=#__codelineno-0-58>58</a></span>
<span class=normal><a href=#__codelineno-0-59>59</a></span>
<span class=normal><a href=#__codelineno-0-60>60</a></span>
<span class=normal><a href=#__codelineno-0-61>61</a></span>
<span class=normal><a href=#__codelineno-0-62>62</a></span>
<span class=normal><a href=#__codelineno-0-63>63</a></span>
<span class=normal><a href=#__codelineno-0-64>64</a></span>
<span class=normal><a href=#__codelineno-0-65>65</a></span>
<span class=normal><a href=#__codelineno-0-66>66</a></span>
<span class=normal><a href=#__codelineno-0-67>67</a></span>
<span class=normal><a href=#__codelineno-0-68>68</a></span>
<span class=normal><a href=#__codelineno-0-69>69</a></span>
<span class=normal><a href=#__codelineno-0-70>70</a></span>
<span class=normal><a href=#__codelineno-0-71>71</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-0-1 name=__codelineno-0-1></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ceph.rook.io/v1</span>
<a id=__codelineno-0-2 name=__codelineno-0-2></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">CephBlockPool</span>
<a id=__codelineno-0-3 name=__codelineno-0-3></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-0-4 name=__codelineno-0-4></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">replicapool</span>
<a id=__codelineno-0-5 name=__codelineno-0-5></a><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rook-ceph</span>
<a id=__codelineno-0-6 name=__codelineno-0-6></a><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-0-7 name=__codelineno-0-7></a><span class=w>  </span><span class=nt>failureDomain</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">host</span>
<a id=__codelineno-0-8 name=__codelineno-0-8></a><span class=w>  </span><span class=nt>replicated</span><span class=p>:</span>
<a id=__codelineno-0-9 name=__codelineno-0-9></a><span class=w>    </span><span class=nt>size</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
<a id=__codelineno-0-10 name=__codelineno-0-10></a><span class=nn>---</span>
<a id=__codelineno-0-11 name=__codelineno-0-11></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">storage.k8s.io/v1</span>
<a id=__codelineno-0-12 name=__codelineno-0-12></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">StorageClass</span>
<a id=__codelineno-0-13 name=__codelineno-0-13></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-0-14 name=__codelineno-0-14></a><span class=w>   </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rook-ceph-block</span>
<a id=__codelineno-0-15 name=__codelineno-0-15></a><span class=c1># Change &quot;rook-ceph&quot; provisioner prefix to match the operator namespace if needed</span>
<a id=__codelineno-0-16 name=__codelineno-0-16></a><span class=nt>provisioner</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rook-ceph.rbd.csi.ceph.com</span>
<a id=__codelineno-0-17 name=__codelineno-0-17></a><span class=nt>parameters</span><span class=p>:</span>
<a id=__codelineno-0-18 name=__codelineno-0-18></a><span class=w>    </span><span class=c1># clusterID is the namespace where the rook cluster is running</span>
<a id=__codelineno-0-19 name=__codelineno-0-19></a><span class=w>    </span><span class=nt>clusterID</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rook-ceph</span>
<a id=__codelineno-0-20 name=__codelineno-0-20></a><span class=w>    </span><span class=c1># Ceph pool into which the RBD image shall be created</span>
<a id=__codelineno-0-21 name=__codelineno-0-21></a><span class=w>    </span><span class=nt>pool</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">replicapool</span>
<a id=__codelineno-0-22 name=__codelineno-0-22></a>
<a id=__codelineno-0-23 name=__codelineno-0-23></a><span class=w>    </span><span class=c1># (optional) mapOptions is a comma-separated list of map options.</span>
<a id=__codelineno-0-24 name=__codelineno-0-24></a><span class=w>    </span><span class=c1># For krbd options refer</span>
<a id=__codelineno-0-25 name=__codelineno-0-25></a><span class=w>    </span><span class=c1># https://docs.ceph.com/docs/master/man/8/rbd/#kernel-rbd-krbd-options</span>
<a id=__codelineno-0-26 name=__codelineno-0-26></a><span class=w>    </span><span class=c1># For nbd options refer</span>
<a id=__codelineno-0-27 name=__codelineno-0-27></a><span class=w>    </span><span class=c1># https://docs.ceph.com/docs/master/man/8/rbd-nbd/#options</span>
<a id=__codelineno-0-28 name=__codelineno-0-28></a><span class=w>    </span><span class=c1># mapOptions: lock_on_read,queue_depth=1024</span>
<a id=__codelineno-0-29 name=__codelineno-0-29></a>
<a id=__codelineno-0-30 name=__codelineno-0-30></a><span class=w>    </span><span class=c1># (optional) unmapOptions is a comma-separated list of unmap options.</span>
<a id=__codelineno-0-31 name=__codelineno-0-31></a><span class=w>    </span><span class=c1># For krbd options refer</span>
<a id=__codelineno-0-32 name=__codelineno-0-32></a><span class=w>    </span><span class=c1># https://docs.ceph.com/docs/master/man/8/rbd/#kernel-rbd-krbd-options</span>
<a id=__codelineno-0-33 name=__codelineno-0-33></a><span class=w>    </span><span class=c1># For nbd options refer</span>
<a id=__codelineno-0-34 name=__codelineno-0-34></a><span class=w>    </span><span class=c1># https://docs.ceph.com/docs/master/man/8/rbd-nbd/#options</span>
<a id=__codelineno-0-35 name=__codelineno-0-35></a><span class=w>    </span><span class=c1># unmapOptions: force</span>
<a id=__codelineno-0-36 name=__codelineno-0-36></a>
<a id=__codelineno-0-37 name=__codelineno-0-37></a><span class=w>    </span><span class=c1># RBD image format. Defaults to &quot;2&quot;.</span>
<a id=__codelineno-0-38 name=__codelineno-0-38></a><span class=w>    </span><span class=nt>imageFormat</span><span class=p>:</span><span class=w> </span><span class=s>&quot;2&quot;</span>
<a id=__codelineno-0-39 name=__codelineno-0-39></a>
<a id=__codelineno-0-40 name=__codelineno-0-40></a><span class=w>    </span><span class=c1># RBD image features</span>
<a id=__codelineno-0-41 name=__codelineno-0-41></a><span class=w>    </span><span class=c1># Available for imageFormat: &quot;2&quot;. Older releases of CSI RBD</span>
<a id=__codelineno-0-42 name=__codelineno-0-42></a><span class=w>    </span><span class=c1># support only the `layering` feature. The Linux kernel (KRBD) supports the</span>
<a id=__codelineno-0-43 name=__codelineno-0-43></a><span class=w>    </span><span class=c1># full complement of features as of 5.4</span>
<a id=__codelineno-0-44 name=__codelineno-0-44></a><span class=w>    </span><span class=c1># `layering` alone corresponds to Ceph&#39;s bitfield value of &quot;2&quot; ;</span>
<a id=__codelineno-0-45 name=__codelineno-0-45></a><span class=w>    </span><span class=c1># `layering` + `fast-diff` + `object-map` + `deep-flatten` + `exclusive-lock` together</span>
<a id=__codelineno-0-46 name=__codelineno-0-46></a><span class=w>    </span><span class=c1># correspond to Ceph&#39;s OR&#39;d bitfield value of &quot;63&quot;. Here we use</span>
<a id=__codelineno-0-47 name=__codelineno-0-47></a><span class=w>    </span><span class=c1># a symbolic, comma-separated format:</span>
<a id=__codelineno-0-48 name=__codelineno-0-48></a><span class=w>    </span><span class=c1># For 5.4 or later kernels:</span>
<a id=__codelineno-0-49 name=__codelineno-0-49></a><span class=w>    </span><span class=c1>#imageFeatures: layering,fast-diff,object-map,deep-flatten,exclusive-lock</span>
<a id=__codelineno-0-50 name=__codelineno-0-50></a><span class=w>    </span><span class=c1># For 5.3 or earlier kernels:</span>
<a id=__codelineno-0-51 name=__codelineno-0-51></a><span class=w>    </span><span class=nt>imageFeatures</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">layering</span>
<a id=__codelineno-0-52 name=__codelineno-0-52></a>
<a id=__codelineno-0-53 name=__codelineno-0-53></a><span class=w>    </span><span class=c1># The secrets contain Ceph admin credentials.</span>
<a id=__codelineno-0-54 name=__codelineno-0-54></a><span class=w>    </span><span class=nt>csi.storage.k8s.io/provisioner-secret-name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rook-csi-rbd-provisioner</span>
<a id=__codelineno-0-55 name=__codelineno-0-55></a><span class=w>    </span><span class=nt>csi.storage.k8s.io/provisioner-secret-namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rook-ceph</span>
<a id=__codelineno-0-56 name=__codelineno-0-56></a><span class=w>    </span><span class=nt>csi.storage.k8s.io/controller-expand-secret-name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rook-csi-rbd-provisioner</span>
<a id=__codelineno-0-57 name=__codelineno-0-57></a><span class=w>    </span><span class=nt>csi.storage.k8s.io/controller-expand-secret-namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rook-ceph</span>
<a id=__codelineno-0-58 name=__codelineno-0-58></a><span class=w>    </span><span class=nt>csi.storage.k8s.io/node-stage-secret-name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rook-csi-rbd-node</span>
<a id=__codelineno-0-59 name=__codelineno-0-59></a><span class=w>    </span><span class=nt>csi.storage.k8s.io/node-stage-secret-namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rook-ceph</span>
<a id=__codelineno-0-60 name=__codelineno-0-60></a>
<a id=__codelineno-0-61 name=__codelineno-0-61></a><span class=w>    </span><span class=c1># Specify the filesystem type of the volume. If not specified, csi-provisioner</span>
<a id=__codelineno-0-62 name=__codelineno-0-62></a><span class=w>    </span><span class=c1># will set default as `ext4`. Note that `xfs` is not recommended due to potential deadlock</span>
<a id=__codelineno-0-63 name=__codelineno-0-63></a><span class=w>    </span><span class=c1># in hyperconverged settings where the volume is mounted on the same node as the osds.</span>
<a id=__codelineno-0-64 name=__codelineno-0-64></a><span class=w>    </span><span class=nt>csi.storage.k8s.io/fstype</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ext4</span>
<a id=__codelineno-0-65 name=__codelineno-0-65></a>
<a id=__codelineno-0-66 name=__codelineno-0-66></a><span class=c1># Delete the rbd volume when a PVC is deleted</span>
<a id=__codelineno-0-67 name=__codelineno-0-67></a><span class=nt>reclaimPolicy</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Delete</span>
<a id=__codelineno-0-68 name=__codelineno-0-68></a>
<a id=__codelineno-0-69 name=__codelineno-0-69></a><span class=c1># Optional, if you want to add dynamic resize for PVC.</span>
<a id=__codelineno-0-70 name=__codelineno-0-70></a><span class=c1># For now only ext3, ext4, xfs resize support provided, like in Kubernetes itself.</span>
<a id=__codelineno-0-71 name=__codelineno-0-71></a><span class=nt>allowVolumeExpansion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</code></pre></div></td></tr></table></div> <p>If you've deployed the Rook operator in a namespace other than "rook-ceph", change the prefix in the provisioner to match the namespace you used. For example, if the Rook operator is running in the namespace "my-namespace" the provisioner value should be "my-namespace.rbd.csi.ceph.com".</p> <p>Create the storage class.</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-1-1>1</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-1-1 name=__codelineno-1-1></a><span class=go>kubectl create -f deploy/examples/csi/rbd/storageclass.yaml</span>
</code></pre></div></td></tr></table></div> <div class="admonition note"> <p class=admonition-title>Note</p> <p>As <a href=https://kubernetes.io/docs/concepts/storage/persistent-volumes/#retain>specified by Kubernetes</a>, when using the <code>Retain</code> reclaim policy, any Ceph RBD image that is backed by a <code>PersistentVolume</code> will continue to exist even after the <code>PersistentVolume</code> has been deleted. These Ceph RBD images will need to be cleaned up manually using <code>rbd rm</code>.</p> </div> <h2 id=consume-the-storage-wordpress-sample>Consume the storage: Wordpress sample<a class=headerlink href=#consume-the-storage-wordpress-sample title="Permanent link">&para;</a></h2> <p>We create a sample app to consume the block storage provisioned by Rook with the classic wordpress and mysql apps. Both of these apps will make use of block volumes provisioned by Rook.</p> <p>Start mysql and wordpress from the <code>deploy/examples</code> folder:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-2-1>1</a></span>
<span class=normal><a href=#__codelineno-2-2>2</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-2-1 name=__codelineno-2-1></a><span class=go>kubectl create -f mysql.yaml</span>
<a id=__codelineno-2-2 name=__codelineno-2-2></a><span class=go>kubectl create -f wordpress.yaml</span>
</code></pre></div></td></tr></table></div> <p>Both of these apps create a block volume and mount it to their respective pod. You can see the Kubernetes volume claims by running the following:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-3-1>1</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-3-1 name=__codelineno-3-1></a><span class=go>kubectl get pvc</span>
</code></pre></div></td></tr></table></div> <div class="admonition example"> <p class=admonition-title>Example Output: <code>kubectl get pvc</code></p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-4-1>1</a></span>
<span class=normal><a href=#__codelineno-4-2>2</a></span>
<span class=normal><a href=#__codelineno-4-3>3</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-4-1 name=__codelineno-4-1></a><span class=go>NAME             STATUS    VOLUME                                     CAPACITY   ACCESSMODES   AGE</span>
<a id=__codelineno-4-2 name=__codelineno-4-2></a><span class=go>mysql-pv-claim   Bound     pvc-95402dbc-efc0-11e6-bc9a-0cc47a3459ee   20Gi       RWO           1m</span>
<a id=__codelineno-4-3 name=__codelineno-4-3></a><span class=go>wp-pv-claim      Bound     pvc-39e43169-efc1-11e6-bc9a-0cc47a3459ee   20Gi       RWO           1m</span>
</code></pre></div></td></tr></table></div> </div> <p>Once the wordpress and mysql pods are in the <code>Running</code> state, get the cluster IP of the wordpress app and enter it in your browser:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-5-1>1</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-5-1 name=__codelineno-5-1></a><span class=go>kubectl get svc wordpress</span>
</code></pre></div></td></tr></table></div> <div class="admonition example"> <p class=admonition-title>Example Output: <code>kubectl get svc wordpress</code></p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-6-1>1</a></span>
<span class=normal><a href=#__codelineno-6-2>2</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-6-1 name=__codelineno-6-1></a><span class=go>NAME        CLUSTER-IP   EXTERNAL-IP   PORT(S)        AGE</span>
<a id=__codelineno-6-2 name=__codelineno-6-2></a><span class=go>wordpress   10.3.0.155   &lt;pending&gt;     80:30841/TCP   2m</span>
</code></pre></div></td></tr></table></div> </div> <p>You should see the wordpress app running.</p> <p>If you are using Minikube, the Wordpress URL can be retrieved with this one-line command:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-7-1>1</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-7-1 name=__codelineno-7-1></a><span class=go>echo http://$(minikube ip):$(kubectl get service wordpress -o jsonpath=&#39;{.spec.ports[0].nodePort}&#39;)</span>
</code></pre></div></td></tr></table></div> <div class="admonition note"> <p class=admonition-title>Note</p> <p>When running in a vagrant environment, there will be no external IP address to reach wordpress with. You will only be able to reach wordpress via the <code>CLUSTER-IP</code> from inside the Kubernetes cluster.</p> </div> <h2 id=consume-the-storage-toolbox>Consume the storage: Toolbox<a class=headerlink href=#consume-the-storage-toolbox title="Permanent link">&para;</a></h2> <p>With the pool that was created above, we can also create a block image and mount it directly in a pod. See the <a href=../../../Troubleshooting/direct-tools/#block-storage-tools>Direct Block Tools</a> topic for more details.</p> <h2 id=teardown>Teardown<a class=headerlink href=#teardown title="Permanent link">&para;</a></h2> <p>To clean up all the artifacts created by the block demo:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-8-1>1</a></span>
<span class=normal><a href=#__codelineno-8-2>2</a></span>
<span class=normal><a href=#__codelineno-8-3>3</a></span>
<span class=normal><a href=#__codelineno-8-4>4</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-8-1 name=__codelineno-8-1></a><span class=go>kubectl delete -f wordpress.yaml</span>
<a id=__codelineno-8-2 name=__codelineno-8-2></a><span class=go>kubectl delete -f mysql.yaml</span>
<a id=__codelineno-8-3 name=__codelineno-8-3></a><span class=go>kubectl delete -n rook-ceph cephblockpools.ceph.rook.io replicapool</span>
<a id=__codelineno-8-4 name=__codelineno-8-4></a><span class=go>kubectl delete storageclass rook-ceph-block</span>
</code></pre></div></td></tr></table></div> <h2 id=advanced-example-erasure-coded-block-storage>Advanced Example: Erasure Coded Block Storage<a class=headerlink href=#advanced-example-erasure-coded-block-storage title="Permanent link">&para;</a></h2> <p>If you want to use erasure coded pool with RBD, your OSDs must use <code>bluestore</code> as their <code>storeType</code>. Additionally the nodes that are going to mount the erasure coded RBD block storage must have Linux kernel &gt;= <code>4.11</code>.</p> <div class="admonition attention"> <p class=admonition-title>Attention</p> <p>This example requires <em>at least 3 bluestore OSDs</em>, with each OSD located on a <em>different node</em>.</p> </div> <p>The OSDs must be located on different nodes, because the <a href=../../../CRDs/Block-Storage/ceph-block-pool-crd/#spec><code>failureDomain</code></a> is set to <code>host</code> and the <code>erasureCoded</code> chunk settings require at least 3 different OSDs (2 <code>dataChunks</code> + 1 <code>codingChunks</code>).</p> <p>To be able to use an erasure coded pool you need to create two pools (as seen below in the definitions): one erasure coded and one replicated.</p> <div class="admonition attention"> <p class=admonition-title>Attention</p> <p>This example requires <em>at least 3 bluestore OSDs</em>, with each OSD located on a <em>different node</em>.</p> </div> <p>The OSDs must be located on different nodes, because the <a href=../../../CRDs/Block-Storage/ceph-block-pool-crd/#spec><code>failureDomain</code></a> is set to <code>host</code> and the <code>erasureCoded</code> chunk settings require at least 3 different OSDs (2 <code>dataChunks</code> + 1 <code>codingChunks</code>).</p> <h3 id=erasure-coded-csi-driver>Erasure Coded CSI Driver<a class=headerlink href=#erasure-coded-csi-driver title="Permanent link">&para;</a></h3> <p>The erasure coded pool must be set as the <code>dataPool</code> parameter in <a href=https://github.com/rook/rook/blob/HEAD/deploy/examples/csi/rbd/storage-class-ec.yaml><code>storageclass-ec.yaml</code></a> It is used for the data of the RBD images.</p> <h2 id=node-loss>Node Loss<a class=headerlink href=#node-loss title="Permanent link">&para;</a></h2> <p>If a node goes down where a pod is running where a RBD RWO volume is mounted, the volume cannot automatically be mounted on another node. The node must be guaranteed to be offline before the volume can be mounted on another node.</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>These instructions are for clusters with Kubernetes version 1.26 or greater. For K8s 1.25 or older, see the <a href=../../../Troubleshooting/ceph-csi-common-issues/#node-loss>manual steps in the CSI troubleshooting guide</a> to recover from the node loss.</p> </div> <h3 id=configure-csi-addons>Configure CSI-Addons<a class=headerlink href=#configure-csi-addons title="Permanent link">&para;</a></h3> <p>Deploy the csi-addons manifests:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-9-1>1</a></span>
<span class=normal><a href=#__codelineno-9-2>2</a></span>
<span class=normal><a href=#__codelineno-9-3>3</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-9-1 name=__codelineno-9-1></a><span class=go>kubectl create -f https://raw.githubusercontent.com/csi-addons/kubernetes-csi-addons/v0.7.0/deploy/controller/crds.yaml</span>
<a id=__codelineno-9-2 name=__codelineno-9-2></a><span class=go>kubectl create -f https://raw.githubusercontent.com/csi-addons/kubernetes-csi-addons/v0.7.0/deploy/controller/rbac.yaml</span>
<a id=__codelineno-9-3 name=__codelineno-9-3></a><span class=go>kubectl create -f https://raw.githubusercontent.com/csi-addons/kubernetes-csi-addons/v0.7.0/deploy/controller/setup-controller.yaml</span>
</code></pre></div></td></tr></table></div> <p>Enable the <code>csi-addons</code> sidecar in the Rook operator configuration.</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-10-1>1</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-10-1 name=__codelineno-10-1></a><span class=go>kubectl patch cm rook-ceph-operator-config -n&lt;namespace&gt; -p $&#39;data:\n &quot;CSI_ENABLE_CSIADDONS&quot;: &quot;true&quot;&#39;</span>
</code></pre></div></td></tr></table></div> <h3 id=handling-node-loss>Handling Node Loss<a class=headerlink href=#handling-node-loss title="Permanent link">&para;</a></h3> <p>When a node is confirmed to be down, add the following taints to the node:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-11-1>1</a></span>
<span class=normal><a href=#__codelineno-11-2>2</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-11-1 name=__codelineno-11-1></a><span class=go>kubectl taint nodes &lt;node-name&gt; node.kubernetes.io/out-of-service=nodeshutdown:NoExecute</span>
<a id=__codelineno-11-2 name=__codelineno-11-2></a><span class=go>kubectl taint nodes &lt;node-name&gt; node.kubernetes.io/out-of-service=nodeshutdown:NoSchedule</span>
</code></pre></div></td></tr></table></div> <p>After the taint is added to the node, Rook will automatically blocklist the node to prevent connections to Ceph from the RBD volume on that node. To verify a node is blocklisted:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-12-1>1</a></span>
<span class=normal><a href=#__codelineno-12-2>2</a></span>
<span class=normal><a href=#__codelineno-12-3>3</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-12-1 name=__codelineno-12-1></a><span class=go>kubectl get networkfences.csiaddons.openshift.io</span>
<a id=__codelineno-12-2 name=__codelineno-12-2></a><span class=go>NAME           DRIVER                       CIDRS                     FENCESTATE   AGE   RESULT</span>
<a id=__codelineno-12-3 name=__codelineno-12-3></a><span class=go>minikube-m02   rook-ceph.rbd.csi.ceph.com   [&quot;192.168.39.187:0/32&quot;]   Fenced       20s   Succeeded</span>
</code></pre></div></td></tr></table></div> <p>The node is blocklisted if the state is <code>Fenced</code> and the result is <code>Succeeded</code> as seen above.</p> <h3 id=node-recovery>Node Recovery<a class=headerlink href=#node-recovery title="Permanent link">&para;</a></h3> <p>If the node comes back online, the network fence can be removed from the node by removing the node taints:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-13-1>1</a></span>
<span class=normal><a href=#__codelineno-13-2>2</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-13-1 name=__codelineno-13-1></a><span class=go>kubectl taint nodes &lt;node-name&gt; node.kubernetes.io/out-of-service=nodeshutdown:NoExecute-</span>
<a id=__codelineno-13-2 name=__codelineno-13-2></a><span class=go>kubectl taint nodes &lt;node-name&gt; node.kubernetes.io/out-of-service=nodeshutdown:NoSchedule-</span>
</code></pre></div></td></tr></table></div> </article> </div> <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script> </div> <a href=# class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg> Back to top </a> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../../../Helm-Charts/ceph-cluster-chart/ class="md-footer__link md-footer__link--prev" aria-label="Previous: Ceph Cluster Helm Chart" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Previous </span> Ceph Cluster Helm Chart </div> </div> </a> <a href=../rbd-mirroring/ class="md-footer__link md-footer__link--next" aria-label="Next: RBD Mirroring" rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Next </span> RBD Mirroring </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> <a href=/ class=logo> <img src=https://rook.io/images/rook-logo-small.svg alt="rook.io logo"> </a> <p> &#169; Rook Authors 2022. Documentation distributed under <a href=https://creativecommons.org/licenses/by/4.0>CC-BY-4.0</a>. </p> <p> &#169; 2022 The Linux Foundation. All rights reserved. The Linux Foundation has registered trademarks and uses trademarks. For a list of trademarks of The Linux Foundation, please see our <a href=https://www.linuxfoundation.org/trademark-usage/ >Trademark Usage</a> page. </p> </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://slack.rook.io/ target=_blank rel=noopener title=slack.rook.io class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M94.12 315.1c0 25.9-21.16 47.06-47.06 47.06S0 341 0 315.1c0-25.9 21.16-47.06 47.06-47.06h47.06v47.06zm23.72 0c0-25.9 21.16-47.06 47.06-47.06s47.06 21.16 47.06 47.06v117.84c0 25.9-21.16 47.06-47.06 47.06s-47.06-21.16-47.06-47.06V315.1zm47.06-188.98c-25.9 0-47.06-21.16-47.06-47.06S139 32 164.9 32s47.06 21.16 47.06 47.06v47.06H164.9zm0 23.72c25.9 0 47.06 21.16 47.06 47.06s-21.16 47.06-47.06 47.06H47.06C21.16 243.96 0 222.8 0 196.9s21.16-47.06 47.06-47.06H164.9zm188.98 47.06c0-25.9 21.16-47.06 47.06-47.06 25.9 0 47.06 21.16 47.06 47.06s-21.16 47.06-47.06 47.06h-47.06V196.9zm-23.72 0c0 25.9-21.16 47.06-47.06 47.06-25.9 0-47.06-21.16-47.06-47.06V79.06c0-25.9 21.16-47.06 47.06-47.06 25.9 0 47.06 21.16 47.06 47.06V196.9zM283.1 385.88c25.9 0 47.06 21.16 47.06 47.06 0 25.9-21.16 47.06-47.06 47.06-25.9 0-47.06-21.16-47.06-47.06v-47.06h47.06zm0-23.72c-25.9 0-47.06-21.16-47.06-47.06 0-25.9 21.16-47.06 47.06-47.06h117.84c25.9 0 47.06 21.16 47.06 47.06 0 25.9-21.16 47.06-47.06 47.06H283.1z"/></svg> </a> <a href=https://twitter.com/rook_io target=_blank rel=noopener title=twitter.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg> </a> <a href=https://groups.google.com/forum/#!forum/rook-dev target=_blank rel=noopener title=groups.google.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 576 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M96 0C78.3 0 64 14.3 64 32v192h96v-32c0-35.3 28.7-64 64-64h224V32c0-17.7-14.3-32-32-32H96zm128 160c-17.7 0-32 14.3-32 32v32h96c35.3 0 64 28.7 64 64v128h192c17.7 0 32-14.3 32-32V192c0-17.7-14.3-32-32-32H224zm240 64h32c8.8 0 16 7.2 16 16v32c0 8.8-7.2 16-16 16h-32c-8.8 0-16-7.2-16-16v-32c0-8.8 7.2-16 16-16zM32 256c-17.7 0-32 14.3-32 32v13l155.1 114.9c1.4 1 3.1 1.6 4.9 1.6s3.5-.6 4.9-1.6L320 301v-13c0-17.7-14.3-32-32-32H32zm288 84.8L184 441.6c-6.9 5.1-15.3 7.9-24 7.9s-17-2.8-24-7.9L0 340.8V480c0 17.7 14.3 32 32 32h256c17.7 0 32-14.3 32-32V340.8z"/></svg> </a> <a href=https://blog.rook.io/ target=_blank rel=noopener title=blog.rook.io class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 640 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M180.5 74.262C80.813 74.262 0 155.633 0 256s80.819 181.738 180.5 181.738S361 356.373 361 256 280.191 74.262 180.5 74.262Zm288.25 10.646c-49.845 0-90.245 76.619-90.245 171.095s40.406 171.1 90.251 171.1 90.251-76.619 90.251-171.1H559c0-94.503-40.4-171.095-90.248-171.095Zm139.506 17.821c-17.526 0-31.735 68.628-31.735 153.274s14.2 153.274 31.735 153.274S640 340.631 640 256c0-84.649-14.215-153.271-31.742-153.271Z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../../..", "features": ["content.tabs.link", "instant", "navigation.expand", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest", "tabs"], "search": "../../../assets/javascripts/workers/search.16e2a7d4.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "version": {"default": "latest-release", "provider": "mike"}}</script> <script src=../../../assets/javascripts/bundle.5a2dcb6a.min.js></script> </body> </html>