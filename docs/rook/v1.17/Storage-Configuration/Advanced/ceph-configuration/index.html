<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Rook Ceph Documentation"><meta name=author content="Rook Authors"><link href=https://rook.io/v1.17/Storage-Configuration/Advanced/ceph-configuration/ rel=canonical><link href=../../ceph-teardown/ rel=prev><link href=../configuration/ rel=next><link rel=icon href=https://rook.io/images/favicon_192x192.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.20"><title>Ceph Configuration - Rook Ceph Documentation</title><link rel=stylesheet href=../../../assets/stylesheets/main.e53b48f4.min.css><link rel=stylesheet href=../../../assets/stylesheets/palette.06af60db.min.css><link rel=stylesheet href=../../../stylesheets/extra.css><script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=rook-blue data-md-color-accent=deep-orange> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#prerequisites class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <div data-md-color-scheme=default data-md-component=outdated hidden> <aside class="md-banner md-banner--warning"> <div class="md-banner__inner md-grid md-typeset"> This documentation is not for the latest stable version of Rook. <a href=../../../../latest-release/ > <strong>Click here for the latest release documentation.</strong> </a> </div> <script>var el=document.querySelector("[data-md-component=outdated]"),base=new URL("../../.."),outdated=__md_get("__outdated",sessionStorage,base);!0===outdated&&el&&(el.hidden=!1)</script> </aside> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../../.. title="Rook Ceph Documentation" class="md-header__button md-logo" aria-label="Rook Ceph Documentation" data-md-component=logo> <img src=https://rook.io/images/rook-logo.svg alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Rook Ceph Documentation </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Ceph Configuration </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=rook-blue data-md-color-accent=deep-orange aria-label="Switch to dark mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=rook-blue data-md-color-accent=red aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/rook/rook title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../../Getting-Started/intro/ class=md-tabs__link> Getting Started </a> </li> <li class=md-tabs__item> <a href=../../../Helm-Charts/helm-charts/ class=md-tabs__link> Helm Charts </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../../Block-Storage-RBD/block-storage/ class=md-tabs__link> Storage Configuration </a> </li> <li class=md-tabs__item> <a href=../../../CRDs/Cluster/ceph-cluster-crd/ class=md-tabs__link> Custom Resources </a> </li> <li class=md-tabs__item> <a href=../../../Troubleshooting/kubectl-plugin/ class=md-tabs__link> Troubleshooting </a> </li> <li class=md-tabs__item> <a href=../../../Upgrade/health-verification/ class=md-tabs__link> Upgrade </a> </li> <li class=md-tabs__item> <a href=../../../Contributing/development-flow/ class=md-tabs__link> Contributing </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../.. title="Rook Ceph Documentation" class="md-nav__button md-logo" aria-label="Rook Ceph Documentation" data-md-component=logo> <img src=https://rook.io/images/rook-logo.svg alt=logo> </a> Rook Ceph Documentation </label> <div class=md-nav__source> <a href=https://github.com/rook/rook title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_1> <label class=md-nav__link for=__nav_1 id=__nav_1_label tabindex=0> <span class=md-ellipsis> Getting Started </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_1_label aria-expanded=false> <label class=md-nav__title for=__nav_1> <span class="md-nav__icon md-icon"></span> Getting Started </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Getting-Started/intro/ class=md-nav__link> <span class=md-ellipsis> Rook </span> </a> </li> <li class=md-nav__item> <a href=../../../Getting-Started/glossary/ class=md-nav__link> <span class=md-ellipsis> Glossary </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_1_3> <label class=md-nav__link for=__nav_1_3 id=__nav_1_3_label tabindex=0> <span class=md-ellipsis> Prerequisites </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_1_3_label aria-expanded=false> <label class=md-nav__title for=__nav_1_3> <span class="md-nav__icon md-icon"></span> Prerequisites </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Getting-Started/Prerequisites/prerequisites/ class=md-nav__link> <span class=md-ellipsis> Prerequisites </span> </a> </li> <li class=md-nav__item> <a href=../../../Getting-Started/Prerequisites/authenticated-registry/ class=md-nav__link> <span class=md-ellipsis> Authenticated Container Registries </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../Getting-Started/quickstart/ class=md-nav__link> <span class=md-ellipsis> Quickstart </span> </a> </li> <li class=md-nav__item> <a href=../../../Getting-Started/storage-architecture/ class=md-nav__link> <span class=md-ellipsis> Storage Architecture </span> </a> </li> <li class=md-nav__item> <a href=../../../Getting-Started/example-configurations/ class=md-nav__link> <span class=md-ellipsis> Example Configurations </span> </a> </li> <li class=md-nav__item> <a href=../../../Getting-Started/ceph-openshift/ class=md-nav__link> <span class=md-ellipsis> OpenShift </span> </a> </li> <li class=md-nav__item> <a href=../../../Getting-Started/ceph-teardown/ class=md-nav__link> <span class=md-ellipsis> Cleanup </span> </a> </li> <li class=md-nav__item> <a href=../../../Getting-Started/release-cycle/ class=md-nav__link> <span class=md-ellipsis> Release Cycle </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex=0> <span class=md-ellipsis> Helm Charts </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Helm Charts </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Helm-Charts/helm-charts/ class=md-nav__link> <span class=md-ellipsis> Helm Charts Overview </span> </a> </li> <li class=md-nav__item> <a href=../../../Helm-Charts/operator-chart/ class=md-nav__link> <span class=md-ellipsis> Ceph Operator Helm Chart </span> </a> </li> <li class=md-nav__item> <a href=../../../Helm-Charts/ceph-cluster-chart/ class=md-nav__link> <span class=md-ellipsis> Ceph Cluster Helm Chart </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3 checked> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex> <span class=md-ellipsis> Storage Configuration </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=true> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Storage Configuration </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3_1> <label class=md-nav__link for=__nav_3_1 id=__nav_3_1_label tabindex=0> <span class=md-ellipsis> Block Storage (RBD) </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_1_label aria-expanded=false> <label class=md-nav__title for=__nav_3_1> <span class="md-nav__icon md-icon"></span> Block Storage (RBD) </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Block-Storage-RBD/block-storage/ class=md-nav__link> <span class=md-ellipsis> Block Storage Overview </span> </a> </li> <li class=md-nav__item> <a href=../../Block-Storage-RBD/rbd-mirroring/ class=md-nav__link> <span class=md-ellipsis> RBD Mirroring </span> </a> </li> <li class=md-nav__item> <a href=../../Block-Storage-RBD/rbd-async-disaster-recovery-failover-failback/ class=md-nav__link> <span class=md-ellipsis> RBD Asynchronous DR Failover and Failback </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3_2> <label class=md-nav__link for=__nav_3_2 id=__nav_3_2_label tabindex=0> <span class=md-ellipsis> Shared Filesystem (CephFS) </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_2_label aria-expanded=false> <label class=md-nav__title for=__nav_3_2> <span class="md-nav__icon md-icon"></span> Shared Filesystem (CephFS) </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Shared-Filesystem-CephFS/filesystem-storage/ class=md-nav__link> <span class=md-ellipsis> Filesystem Storage Overview </span> </a> </li> <li class=md-nav__item> <a href=../../Shared-Filesystem-CephFS/filesystem-mirroring/ class=md-nav__link> <span class=md-ellipsis> Filesystem Mirroring </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3_3> <label class=md-nav__link for=__nav_3_3 id=__nav_3_3_label tabindex=0> <span class=md-ellipsis> Object Storage (RGW) </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3_3> <span class="md-nav__icon md-icon"></span> Object Storage (RGW) </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Object-Storage-RGW/object-storage/ class=md-nav__link> <span class=md-ellipsis> Object Storage Overview </span> </a> </li> <li class=md-nav__item> <a href=../../Object-Storage-RGW/ceph-object-bucket-claim/ class=md-nav__link> <span class=md-ellipsis> Bucket Claim </span> </a> </li> <li class=md-nav__item> <a href=../../Object-Storage-RGW/ceph-object-bucket-notifications/ class=md-nav__link> <span class=md-ellipsis> Object Bucket Notifications </span> </a> </li> <li class=md-nav__item> <a href=../../Object-Storage-RGW/ceph-object-multisite/ class=md-nav__link> <span class=md-ellipsis> Object Store Multisite </span> </a> </li> <li class=md-nav__item> <a href=../../Object-Storage-RGW/ceph-object-swift/ class=md-nav__link> <span class=md-ellipsis> Object Store with Keystone and Swift </span> </a> </li> <li class=md-nav__item> <a href=../../Object-Storage-RGW/cosi/ class=md-nav__link> <span class=md-ellipsis> Container Object Storage Interface (COSI) </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3_4> <label class=md-nav__link for=__nav_3_4 id=__nav_3_4_label tabindex=0> <span class=md-ellipsis> NFS </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_4_label aria-expanded=false> <label class=md-nav__title for=__nav_3_4> <span class="md-nav__icon md-icon"></span> NFS </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../NFS/nfs/ class=md-nav__link> <span class=md-ellipsis> NFS Storage Overview </span> </a> </li> <li class=md-nav__item> <a href=../../NFS/nfs-csi-driver/ class=md-nav__link> <span class=md-ellipsis> CSI provisioner and driver </span> </a> </li> <li class=md-nav__item> <a href=../../NFS/nfs-security/ class=md-nav__link> <span class=md-ellipsis> Security </span> </a> </li> <li class=md-nav__item> <a href=../../NFS/nfs-advanced/ class=md-nav__link> <span class=md-ellipsis> Advanced configuration </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3_5> <label class=md-nav__link for=__nav_3_5 id=__nav_3_5_label tabindex=0> <span class=md-ellipsis> Monitoring </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_5_label aria-expanded=false> <label class=md-nav__title for=__nav_3_5> <span class="md-nav__icon md-icon"></span> Monitoring </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Monitoring/ceph-dashboard/ class=md-nav__link> <span class=md-ellipsis> Ceph Dashboard </span> </a> </li> <li class=md-nav__item> <a href=../../Monitoring/ceph-monitoring/ class=md-nav__link> <span class=md-ellipsis> Prometheus Monitoring </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3_6> <label class=md-nav__link for=__nav_3_6 id=__nav_3_6_label tabindex=0> <span class=md-ellipsis> Ceph CSI </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_6_label aria-expanded=false> <label class=md-nav__title for=__nav_3_6> <span class="md-nav__icon md-icon"></span> Ceph CSI </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Ceph-CSI/ceph-csi-drivers/ class=md-nav__link> <span class=md-ellipsis> Ceph CSI Drivers </span> </a> </li> <li class=md-nav__item> <a href=../../Ceph-CSI/ceph-csi-snapshot/ class=md-nav__link> <span class=md-ellipsis> Snapshots </span> </a> </li> <li class=md-nav__item> <a href=../../Ceph-CSI/ceph-csi-volume-group-snapshot/ class=md-nav__link> <span class=md-ellipsis> Volume Group Snapshots </span> </a> </li> <li class=md-nav__item> <a href=../../Ceph-CSI/ceph-csi-volume-clone/ class=md-nav__link> <span class=md-ellipsis> Volume clone </span> </a> </li> <li class=md-nav__item> <a href=../../Ceph-CSI/custom-images/ class=md-nav__link> <span class=md-ellipsis> Custom Images </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../ceph-teardown/ class=md-nav__link> <span class=md-ellipsis> Cleanup </span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_8 checked> <label class=md-nav__link for=__nav_3_8 id=__nav_3_8_label tabindex=0> <span class=md-ellipsis> Advanced </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_8_label aria-expanded=true> <label class=md-nav__title for=__nav_3_8> <span class="md-nav__icon md-icon"></span> Advanced </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> Ceph Configuration </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Ceph Configuration </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#prerequisites class=md-nav__link> <span class=md-ellipsis> Prerequisites </span> </a> </li> <li class=md-nav__item> <a href=#using-alternate-namespaces class=md-nav__link> <span class=md-ellipsis> Using alternate namespaces </span> </a> </li> <li class=md-nav__item> <a href=#deploying-a-second-cluster class=md-nav__link> <span class=md-ellipsis> Deploying a second cluster </span> </a> </li> <li class=md-nav__item> <a href=#log-collection class=md-nav__link> <span class=md-ellipsis> Log Collection </span> </a> </li> <li class=md-nav__item> <a href=#osd-information class=md-nav__link> <span class=md-ellipsis> OSD Information </span> </a> <nav class=md-nav aria-label="OSD Information"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#kubernetes class=md-nav__link> <span class=md-ellipsis> Kubernetes </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#separate-storage-groups class=md-nav__link> <span class=md-ellipsis> Separate Storage Groups </span> </a> </li> <li class=md-nav__item> <a href=#configuring-pools class=md-nav__link> <span class=md-ellipsis> Configuring Pools </span> </a> <nav class=md-nav aria-label="Configuring Pools"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#placement-group-sizing class=md-nav__link> <span class=md-ellipsis> Placement Group Sizing </span> </a> </li> <li class=md-nav__item> <a href=#setting-pg-count class=md-nav__link> <span class=md-ellipsis> Setting PG Count </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#custom-cephconf-settings class=md-nav__link> <span class=md-ellipsis> Custom ceph.conf Settings </span> </a> <nav class=md-nav aria-label="Custom ceph.conf Settings"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#node-specific-osd-settings class=md-nav__link> <span class=md-ellipsis> Node-specific OSD settings </span> </a> </li> <li class=md-nav__item> <a href=#example class=md-nav__link> <span class=md-ellipsis> Example </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#custom-csi-cephconf-settings class=md-nav__link> <span class=md-ellipsis> Custom CSI ceph.conf Settings </span> </a> <nav class=md-nav aria-label="Custom CSI ceph.conf Settings"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#example-csi-cephconf-settings class=md-nav__link> <span class=md-ellipsis> Example CSI ceph.conf Settings </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#osd-crush-settings class=md-nav__link> <span class=md-ellipsis> OSD CRUSH Settings </span> </a> <nav class=md-nav aria-label="OSD CRUSH Settings"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#osd-weight class=md-nav__link> <span class=md-ellipsis> OSD Weight </span> </a> </li> <li class=md-nav__item> <a href=#osd-primary-affinity class=md-nav__link> <span class=md-ellipsis> OSD Primary Affinity </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#osd-dedicated-network class=md-nav__link> <span class=md-ellipsis> OSD Dedicated Network </span> </a> <nav class=md-nav aria-label="OSD Dedicated Network"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#use-hostnetwork-in-the-cluster-configuration class=md-nav__link> <span class=md-ellipsis> Use hostNetwork in the cluster configuration </span> </a> </li> <li class=md-nav__item> <a href=#define-the-subnets-to-use-for-public-and-private-osd-networks class=md-nav__link> <span class=md-ellipsis> Define the subnets to use for public and private OSD networks </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#phantom-osd-removal class=md-nav__link> <span class=md-ellipsis> Phantom OSD Removal </span> </a> </li> <li class=md-nav__item> <a href=#auto-expansion-of-osds class=md-nav__link> <span class=md-ellipsis> Auto Expansion of OSDs </span> </a> <nav class=md-nav aria-label="Auto Expansion of OSDs"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#prerequisites-for-auto-expansion-of-osds class=md-nav__link> <span class=md-ellipsis> Prerequisites for Auto Expansion of OSDs </span> </a> </li> <li class=md-nav__item> <a href=#to-scale-osds-vertically class=md-nav__link> <span class=md-ellipsis> To scale OSDs Vertically </span> </a> </li> <li class=md-nav__item> <a href=#to-scale-osds-horizontally class=md-nav__link> <span class=md-ellipsis> To scale OSDs Horizontally </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../configuration/ class=md-nav__link> <span class=md-ellipsis> Configuration </span> </a> </li> <li class=md-nav__item> <a href=../key-management-system/ class=md-nav__link> <span class=md-ellipsis> Key Management System </span> </a> </li> <li class=md-nav__item> <a href=../ceph-osd-mgmt/ class=md-nav__link> <span class=md-ellipsis> Ceph OSD Management </span> </a> </li> <li class=md-nav__item> <a href=../ceph-mon-health/ class=md-nav__link> <span class=md-ellipsis> Monitor Health </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex=0> <span class=md-ellipsis> Custom Resources </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Custom Resources </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_4_1> <label class=md-nav__link for=__nav_4_1 id=__nav_4_1_label tabindex=0> <span class=md-ellipsis> Cluster Configuration </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_1_label aria-expanded=false> <label class=md-nav__title for=__nav_4_1> <span class="md-nav__icon md-icon"></span> Cluster Configuration </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../CRDs/Cluster/ceph-cluster-crd/ class=md-nav__link> <span class=md-ellipsis> CephCluster CRD </span> </a> </li> <li class=md-nav__item> <a href=../../../CRDs/Cluster/host-cluster/ class=md-nav__link> <span class=md-ellipsis> Host Storage Cluster </span> </a> </li> <li class=md-nav__item> <a href=../../../CRDs/Cluster/pvc-cluster/ class=md-nav__link> <span class=md-ellipsis> PVC Storage Cluster </span> </a> </li> <li class=md-nav__item> <a href=../../../CRDs/Cluster/stretch-cluster/ class=md-nav__link> <span class=md-ellipsis> Stretch Storage Cluster </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_4_1_5> <label class=md-nav__link for=__nav_4_1_5 id=__nav_4_1_5_label tabindex=0> <span class=md-ellipsis> External cluster </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_4_1_5_label aria-expanded=false> <label class=md-nav__title for=__nav_4_1_5> <span class="md-nav__icon md-icon"></span> External cluster </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../CRDs/Cluster/external-cluster/external-cluster/ class=md-nav__link> <span class=md-ellipsis> External Storage Cluster </span> </a> </li> <li class=md-nav__item> <a href=../../../CRDs/Cluster/external-cluster/provider-export/ class=md-nav__link> <span class=md-ellipsis> Export config from the Ceph provider cluster </span> </a> </li> <li class=md-nav__item> <a href=../../../CRDs/Cluster/external-cluster/consumer-import/ class=md-nav__link> <span class=md-ellipsis> Import Ceph configuration to the Rook consumer cluster </span> </a> </li> <li class=md-nav__item> <a href=../../../CRDs/Cluster/external-cluster/upgrade-external/ class=md-nav__link> <span class=md-ellipsis> External Cluster Upgrades </span> </a> </li> <li class=md-nav__item> <a href=../../../CRDs/Cluster/external-cluster/advance-external/ class=md-nav__link> <span class=md-ellipsis> External Cluster Options </span> </a> </li> <li class=md-nav__item> <a href=../../../CRDs/Cluster/external-cluster/topology-for-external-mode/ class=md-nav__link> <span class=md-ellipsis> Topology-Based Provisioning </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../CRDs/Cluster/network-providers/ class=md-nav__link> <span class=md-ellipsis> Network Providers </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_4_2> <label class=md-nav__link for=__nav_4_2 id=__nav_4_2_label tabindex=0> <span class=md-ellipsis> Block Storage </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_2_label aria-expanded=false> <label class=md-nav__title for=__nav_4_2> <span class="md-nav__icon md-icon"></span> Block Storage </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../CRDs/Block-Storage/ceph-block-pool-crd/ class=md-nav__link> <span class=md-ellipsis> CephBlockPool CRD </span> </a> </li> <li class=md-nav__item> <a href=../../../CRDs/Block-Storage/ceph-block-pool-rados-namespace-crd/ class=md-nav__link> <span class=md-ellipsis> CephBlockPoolRados Namespace CRD </span> </a> </li> <li class=md-nav__item> <a href=../../../CRDs/Block-Storage/ceph-rbd-mirror-crd/ class=md-nav__link> <span class=md-ellipsis> CephRBDMirror CRD </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_4_3> <label class=md-nav__link for=__nav_4_3 id=__nav_4_3_label tabindex=0> <span class=md-ellipsis> Shared Filesystem </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_3_label aria-expanded=false> <label class=md-nav__title for=__nav_4_3> <span class="md-nav__icon md-icon"></span> Shared Filesystem </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../CRDs/Shared-Filesystem/ceph-filesystem-crd/ class=md-nav__link> <span class=md-ellipsis> CephFilesystem CRD </span> </a> </li> <li class=md-nav__item> <a href=../../../CRDs/Shared-Filesystem/ceph-fs-mirror-crd/ class=md-nav__link> <span class=md-ellipsis> CephFilesystemMirror CRD </span> </a> </li> <li class=md-nav__item> <a href=../../../CRDs/Shared-Filesystem/ceph-fs-subvolumegroup-crd/ class=md-nav__link> <span class=md-ellipsis> FilesystemSubVolumeGroup CRD </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_4_4> <label class=md-nav__link for=__nav_4_4 id=__nav_4_4_label tabindex=0> <span class=md-ellipsis> Object Storage </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4_4> <span class="md-nav__icon md-icon"></span> Object Storage </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../CRDs/Object-Storage/ceph-object-store-crd/ class=md-nav__link> <span class=md-ellipsis> CephObjectStore CRD </span> </a> </li> <li class=md-nav__item> <a href=../../../CRDs/Object-Storage/ceph-object-store-user-crd/ class=md-nav__link> <span class=md-ellipsis> CephObjectStoreUser CRD </span> </a> </li> <li class=md-nav__item> <a href=../../../CRDs/Object-Storage/ceph-object-realm-crd/ class=md-nav__link> <span class=md-ellipsis> CephObjectRealm CRD </span> </a> </li> <li class=md-nav__item> <a href=../../../CRDs/Object-Storage/ceph-object-zonegroup-crd/ class=md-nav__link> <span class=md-ellipsis> CephObjectZoneGroup CRD </span> </a> </li> <li class=md-nav__item> <a href=../../../CRDs/Object-Storage/ceph-object-zone-crd/ class=md-nav__link> <span class=md-ellipsis> CephObjectZone CRD </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../CRDs/ceph-client-crd/ class=md-nav__link> <span class=md-ellipsis> CephClient CRD </span> </a> </li> <li class=md-nav__item> <a href=../../../CRDs/ceph-nfs-crd/ class=md-nav__link> <span class=md-ellipsis> CephNFS CRD </span> </a> </li> <li class=md-nav__item> <a href=../../../CRDs/specification/ class=md-nav__link> <span class=md-ellipsis> Specification </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex=0> <span class=md-ellipsis> Troubleshooting </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Troubleshooting </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Troubleshooting/kubectl-plugin/ class=md-nav__link> <span class=md-ellipsis> kubectl Plugin </span> </a> </li> <li class=md-nav__item> <a href=../../../Troubleshooting/ceph-toolbox/ class=md-nav__link> <span class=md-ellipsis> Toolbox </span> </a> </li> <li class=md-nav__item> <a href=../../../Troubleshooting/common-issues/ class=md-nav__link> <span class=md-ellipsis> Common Issues </span> </a> </li> <li class=md-nav__item> <a href=../../../Troubleshooting/ceph-common-issues/ class=md-nav__link> <span class=md-ellipsis> Ceph Common Issues </span> </a> </li> <li class=md-nav__item> <a href=../../../Troubleshooting/ceph-csi-common-issues/ class=md-nav__link> <span class=md-ellipsis> CSI Common Issues </span> </a> </li> <li class=md-nav__item> <a href=../../../Troubleshooting/openshift-common-issues/ class=md-nav__link> <span class=md-ellipsis> OpenShift Common Issues </span> </a> </li> <li class=md-nav__item> <a href=../../../Troubleshooting/disaster-recovery/ class=md-nav__link> <span class=md-ellipsis> Disaster Recovery </span> </a> </li> <li class=md-nav__item> <a href=../../../Troubleshooting/direct-tools/ class=md-nav__link> <span class=md-ellipsis> Direct Tools </span> </a> </li> <li class=md-nav__item> <a href=../../../Troubleshooting/performance-profiling/ class=md-nav__link> <span class=md-ellipsis> Performance Profiling </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6 id=__nav_6_label tabindex=0> <span class=md-ellipsis> Upgrade </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=false> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Upgrade </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Upgrade/health-verification/ class=md-nav__link> <span class=md-ellipsis> Health Verification </span> </a> </li> <li class=md-nav__item> <a href=../../../Upgrade/rook-upgrade/ class=md-nav__link> <span class=md-ellipsis> Rook Upgrades </span> </a> </li> <li class=md-nav__item> <a href=../../../Upgrade/ceph-upgrade/ class=md-nav__link> <span class=md-ellipsis> Ceph Upgrades </span> </a> </li> <li class=md-nav__item> <a href=../../../Upgrade/node-maintenance/ class=md-nav__link> <span class=md-ellipsis> Node Maintenance </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_7> <label class=md-nav__link for=__nav_7 id=__nav_7_label tabindex=0> <span class=md-ellipsis> Contributing </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_7_label aria-expanded=false> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> Contributing </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Contributing/development-flow/ class=md-nav__link> <span class=md-ellipsis> Development Flow </span> </a> </li> <li class=md-nav__item> <a href=../../../Contributing/development-environment/ class=md-nav__link> <span class=md-ellipsis> Developer Environment </span> </a> </li> <li class=md-nav__item> <a href=../../../Contributing/documentation/ class=md-nav__link> <span class=md-ellipsis> Documentation </span> </a> </li> <li class=md-nav__item> <a href=../../../Contributing/ci-configuration/ class=md-nav__link> <span class=md-ellipsis> CI Configuration </span> </a> </li> <li class=md-nav__item> <a href=../../../Contributing/rook-test-framework/ class=md-nav__link> <span class=md-ellipsis> Rook Test Framework </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#prerequisites class=md-nav__link> <span class=md-ellipsis> Prerequisites </span> </a> </li> <li class=md-nav__item> <a href=#using-alternate-namespaces class=md-nav__link> <span class=md-ellipsis> Using alternate namespaces </span> </a> </li> <li class=md-nav__item> <a href=#deploying-a-second-cluster class=md-nav__link> <span class=md-ellipsis> Deploying a second cluster </span> </a> </li> <li class=md-nav__item> <a href=#log-collection class=md-nav__link> <span class=md-ellipsis> Log Collection </span> </a> </li> <li class=md-nav__item> <a href=#osd-information class=md-nav__link> <span class=md-ellipsis> OSD Information </span> </a> <nav class=md-nav aria-label="OSD Information"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#kubernetes class=md-nav__link> <span class=md-ellipsis> Kubernetes </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#separate-storage-groups class=md-nav__link> <span class=md-ellipsis> Separate Storage Groups </span> </a> </li> <li class=md-nav__item> <a href=#configuring-pools class=md-nav__link> <span class=md-ellipsis> Configuring Pools </span> </a> <nav class=md-nav aria-label="Configuring Pools"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#placement-group-sizing class=md-nav__link> <span class=md-ellipsis> Placement Group Sizing </span> </a> </li> <li class=md-nav__item> <a href=#setting-pg-count class=md-nav__link> <span class=md-ellipsis> Setting PG Count </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#custom-cephconf-settings class=md-nav__link> <span class=md-ellipsis> Custom ceph.conf Settings </span> </a> <nav class=md-nav aria-label="Custom ceph.conf Settings"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#node-specific-osd-settings class=md-nav__link> <span class=md-ellipsis> Node-specific OSD settings </span> </a> </li> <li class=md-nav__item> <a href=#example class=md-nav__link> <span class=md-ellipsis> Example </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#custom-csi-cephconf-settings class=md-nav__link> <span class=md-ellipsis> Custom CSI ceph.conf Settings </span> </a> <nav class=md-nav aria-label="Custom CSI ceph.conf Settings"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#example-csi-cephconf-settings class=md-nav__link> <span class=md-ellipsis> Example CSI ceph.conf Settings </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#osd-crush-settings class=md-nav__link> <span class=md-ellipsis> OSD CRUSH Settings </span> </a> <nav class=md-nav aria-label="OSD CRUSH Settings"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#osd-weight class=md-nav__link> <span class=md-ellipsis> OSD Weight </span> </a> </li> <li class=md-nav__item> <a href=#osd-primary-affinity class=md-nav__link> <span class=md-ellipsis> OSD Primary Affinity </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#osd-dedicated-network class=md-nav__link> <span class=md-ellipsis> OSD Dedicated Network </span> </a> <nav class=md-nav aria-label="OSD Dedicated Network"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#use-hostnetwork-in-the-cluster-configuration class=md-nav__link> <span class=md-ellipsis> Use hostNetwork in the cluster configuration </span> </a> </li> <li class=md-nav__item> <a href=#define-the-subnets-to-use-for-public-and-private-osd-networks class=md-nav__link> <span class=md-ellipsis> Define the subnets to use for public and private OSD networks </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#phantom-osd-removal class=md-nav__link> <span class=md-ellipsis> Phantom OSD Removal </span> </a> </li> <li class=md-nav__item> <a href=#auto-expansion-of-osds class=md-nav__link> <span class=md-ellipsis> Auto Expansion of OSDs </span> </a> <nav class=md-nav aria-label="Auto Expansion of OSDs"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#prerequisites-for-auto-expansion-of-osds class=md-nav__link> <span class=md-ellipsis> Prerequisites for Auto Expansion of OSDs </span> </a> </li> <li class=md-nav__item> <a href=#to-scale-osds-vertically class=md-nav__link> <span class=md-ellipsis> To scale OSDs Vertically </span> </a> </li> <li class=md-nav__item> <a href=#to-scale-osds-horizontally class=md-nav__link> <span class=md-ellipsis> To scale OSDs Horizontally </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1>Ceph Configuration</h1> <p>These examples show how to perform advanced configuration tasks on your Rook storage cluster.</p> <h2 id=prerequisites>Prerequisites<a class=headerlink href=#prerequisites title="Permanent link">&para;</a></h2> <p>Most of the examples make use of the <code>ceph</code> client command. A quick way to use the Ceph client suite is from a <a href=../../../Troubleshooting/ceph-toolbox/ >Rook Toolbox container</a>.</p> <p>The Kubernetes based examples assume Rook OSD pods are in the <code>rook-ceph</code> namespace. If you run them in a different namespace, modify <code>kubectl -n rook-ceph [...]</code> to fit your situation.</p> <h2 id=using-alternate-namespaces>Using alternate namespaces<a class=headerlink href=#using-alternate-namespaces title="Permanent link">&para;</a></h2> <p>If you wish to deploy the Rook Operator and/or Ceph clusters to namespaces other than the default <code>rook-ceph</code>, the manifests are commented to allow for easy <code>sed</code> replacements. Change <code>ROOK_CLUSTER_NAMESPACE</code> to tailor the manifests for additional Ceph clusters. You can choose to also change <code>ROOK_OPERATOR_NAMESPACE</code> to create a new Rook Operator for each Ceph cluster (don't forget to set <code>ROOK_CURRENT_NAMESPACE_ONLY</code>), or you can leave it at the same value for every Ceph cluster if you only wish to have one Operator manage all Ceph clusters.</p> <p>If the operator namespace is different from the cluster namespace, the operator namespace must be created before running the steps below. The cluster namespace does not need to be created first, as it will be created by <code>common.yaml</code> in the script below.</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-1>1</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-0-1 name=__codelineno-0-1></a><span class=go>kubectl create namespace $ROOK_OPERATOR_NAMESPACE</span>
</code></pre></div></td></tr></table></div> <p>This will help you manage namespaces more easily, but you should still make sure the resources are configured to your liking.</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-1-1> 1</a></span>
<span class=normal><a href=#__codelineno-1-2> 2</a></span>
<span class=normal><a href=#__codelineno-1-3> 3</a></span>
<span class=normal><a href=#__codelineno-1-4> 4</a></span>
<span class=normal><a href=#__codelineno-1-5> 5</a></span>
<span class=normal><a href=#__codelineno-1-6> 6</a></span>
<span class=normal><a href=#__codelineno-1-7> 7</a></span>
<span class=normal><a href=#__codelineno-1-8> 8</a></span>
<span class=normal><a href=#__codelineno-1-9> 9</a></span>
<span class=normal><a href=#__codelineno-1-10>10</a></span>
<span class=normal><a href=#__codelineno-1-11>11</a></span>
<span class=normal><a href=#__codelineno-1-12>12</a></span>
<span class=normal><a href=#__codelineno-1-13>13</a></span>
<span class=normal><a href=#__codelineno-1-14>14</a></span>
<span class=normal><a href=#__codelineno-1-15>15</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-1-1 name=__codelineno-1-1></a><span class=go>cd deploy/examples</span>
<a id=__codelineno-1-2 name=__codelineno-1-2></a>
<a id=__codelineno-1-3 name=__codelineno-1-3></a><span class=go>export ROOK_OPERATOR_NAMESPACE=&quot;rook-ceph&quot;</span>
<a id=__codelineno-1-4 name=__codelineno-1-4></a><span class=go>export ROOK_CLUSTER_NAMESPACE=&quot;rook-ceph&quot;</span>
<a id=__codelineno-1-5 name=__codelineno-1-5></a>
<a id=__codelineno-1-6 name=__codelineno-1-6></a><span class=go>sed -i.bak \</span>
<a id=__codelineno-1-7 name=__codelineno-1-7></a><span class=go>    -e &quot;s/\(.*\):.*# namespace:operator/\1: $ROOK_OPERATOR_NAMESPACE # namespace:operator/g&quot; \</span>
<a id=__codelineno-1-8 name=__codelineno-1-8></a><span class=go>    -e &quot;s/\(.*\):.*# namespace:cluster/\1: $ROOK_CLUSTER_NAMESPACE # namespace:cluster/g&quot; \</span>
<a id=__codelineno-1-9 name=__codelineno-1-9></a><span class=go>    -e &quot;s/\(.*serviceaccount\):.*:\(.*\) # serviceaccount:namespace:operator/\1:$ROOK_OPERATOR_NAMESPACE:\2 # serviceaccount:namespace:operator/g&quot; \</span>
<a id=__codelineno-1-10 name=__codelineno-1-10></a><span class=go>    -e &quot;s/\(.*serviceaccount\):.*:\(.*\) # serviceaccount:namespace:cluster/\1:$ROOK_CLUSTER_NAMESPACE:\2 # serviceaccount:namespace:cluster/g&quot; \</span>
<a id=__codelineno-1-11 name=__codelineno-1-11></a><span class=go>    -e &quot;s/\(.*\): [-_A-Za-z0-9]*\.\(.*\) # driver:namespace:cluster/\1: $ROOK_CLUSTER_NAMESPACE.\2 # driver:namespace:cluster/g&quot; \</span>
<a id=__codelineno-1-12 name=__codelineno-1-12></a><span class=go>  common.yaml operator.yaml cluster.yaml # add other files or change these as desired for your config</span>
<a id=__codelineno-1-13 name=__codelineno-1-13></a>
<a id=__codelineno-1-14 name=__codelineno-1-14></a><span class=gp># </span>You<span class=w> </span>need<span class=w> </span>to<span class=w> </span>use<span class=w> </span><span class=sb>`</span>apply<span class=sb>`</span><span class=w> </span><span class=k>for</span><span class=w> </span>all<span class=w> </span>Ceph<span class=w> </span>clusters<span class=w> </span>after<span class=w> </span>the<span class=w> </span>first<span class=w> </span><span class=k>if</span><span class=w> </span>you<span class=w> </span>have<span class=w> </span>only<span class=w> </span>one<span class=w> </span>Operator
<a id=__codelineno-1-15 name=__codelineno-1-15></a><span class=go>kubectl apply -f crds.yaml -f common.yaml -f operator.yaml -f cluster.yaml # add other files as desired for yourconfig</span>
</code></pre></div></td></tr></table></div> <p>Also see the CSI driver <a href=../../Ceph-CSI/ceph-csi-drivers/#Configure-CSI-Drivers-in-non-default-namespace>documentation</a> to update the csi provisioner names in the storageclass and volumesnapshotclass.</p> <h2 id=deploying-a-second-cluster>Deploying a second cluster<a class=headerlink href=#deploying-a-second-cluster title="Permanent link">&para;</a></h2> <p>If you wish to create a new CephCluster in a separate namespace, you can easily do so by modifying the <code>ROOK_OPERATOR_NAMESPACE</code> and <code>SECOND_ROOK_CLUSTER_NAMESPACE</code> values in the below instructions. The default configuration in <code>common-second-cluster.yaml</code> is already set up to utilize <code>rook-ceph</code> for the operator and <code>rook-ceph-secondary</code> for the cluster. There's no need to run the <code>sed</code> command if you prefer to use these default values.</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-2-1> 1</a></span>
<span class=normal><a href=#__codelineno-2-2> 2</a></span>
<span class=normal><a href=#__codelineno-2-3> 3</a></span>
<span class=normal><a href=#__codelineno-2-4> 4</a></span>
<span class=normal><a href=#__codelineno-2-5> 5</a></span>
<span class=normal><a href=#__codelineno-2-6> 6</a></span>
<span class=normal><a href=#__codelineno-2-7> 7</a></span>
<span class=normal><a href=#__codelineno-2-8> 8</a></span>
<span class=normal><a href=#__codelineno-2-9> 9</a></span>
<span class=normal><a href=#__codelineno-2-10>10</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-2-1 name=__codelineno-2-1></a><span class=go>cd deploy/examples</span>
<a id=__codelineno-2-2 name=__codelineno-2-2></a><span class=go>export ROOK_OPERATOR_NAMESPACE=&quot;rook-ceph&quot;</span>
<a id=__codelineno-2-3 name=__codelineno-2-3></a><span class=go>export SECOND_ROOK_CLUSTER_NAMESPACE=&quot;rook-ceph-secondary&quot;</span>
<a id=__codelineno-2-4 name=__codelineno-2-4></a>
<a id=__codelineno-2-5 name=__codelineno-2-5></a><span class=go>sed -i.bak \</span>
<a id=__codelineno-2-6 name=__codelineno-2-6></a><span class=go>    -e &quot;s/\(.*\):.*# namespace:operator/\1: $ROOK_OPERATOR_NAMESPACE # namespace:operator/g&quot; \</span>
<a id=__codelineno-2-7 name=__codelineno-2-7></a><span class=go>    -e &quot;s/\(.*\):.*# namespace:cluster/\1: $SECOND_ROOK_CLUSTER_NAMESPACE # namespace:cluster/g&quot; \</span>
<a id=__codelineno-2-8 name=__codelineno-2-8></a><span class=go>  common-second-cluster.yaml</span>
<a id=__codelineno-2-9 name=__codelineno-2-9></a>
<a id=__codelineno-2-10 name=__codelineno-2-10></a><span class=go>kubectl create -f common-second-cluster.yaml</span>
</code></pre></div></td></tr></table></div> <p>This will create all the necessary RBACs as well as the new namespace. The script assumes that <code>common.yaml</code> was already created. When you create the second CephCluster CR, use the same <code>NAMESPACE</code> and the operator will configure the second cluster.</p> <h2 id=log-collection>Log Collection<a class=headerlink href=#log-collection title="Permanent link">&para;</a></h2> <p>All Rook logs can be collected in a Kubernetes environment with the following command:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-3-1>1</a></span>
<span class=normal><a href=#__codelineno-3-2>2</a></span>
<span class=normal><a href=#__codelineno-3-3>3</a></span>
<span class=normal><a href=#__codelineno-3-4>4</a></span>
<span class=normal><a href=#__codelineno-3-5>5</a></span>
<span class=normal><a href=#__codelineno-3-6>6</a></span>
<span class=normal><a href=#__codelineno-3-7>7</a></span>
<span class=normal><a href=#__codelineno-3-8>8</a></span>
<span class=normal><a href=#__codelineno-3-9>9</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-3-1 name=__codelineno-3-1></a><span class=go>for p in $(kubectl -n rook-ceph get pods -o jsonpath=&#39;{.items[*].metadata.name}&#39;)</span>
<a id=__codelineno-3-2 name=__codelineno-3-2></a><span class=go>do</span>
<a id=__codelineno-3-3 name=__codelineno-3-3></a><span class=go>    for c in $(kubectl -n rook-ceph get pod ${p} -o jsonpath=&#39;{.spec.containers[*].name}&#39;)</span>
<a id=__codelineno-3-4 name=__codelineno-3-4></a><span class=go>    do</span>
<a id=__codelineno-3-5 name=__codelineno-3-5></a><span class=go>        echo &quot;BEGIN logs from pod: ${p} ${c}&quot;</span>
<a id=__codelineno-3-6 name=__codelineno-3-6></a><span class=go>        kubectl -n rook-ceph logs -c ${c} ${p}</span>
<a id=__codelineno-3-7 name=__codelineno-3-7></a><span class=go>        echo &quot;END logs from pod: ${p} ${c}&quot;</span>
<a id=__codelineno-3-8 name=__codelineno-3-8></a><span class=go>    done</span>
<a id=__codelineno-3-9 name=__codelineno-3-9></a><span class=go>done</span>
</code></pre></div></td></tr></table></div> <p>This gets the logs for every container in every Rook pod and then compresses them into a <code>.gz</code> archive for easy sharing. Note that instead of <code>gzip</code>, you could instead pipe to <code>less</code> or to a single text file.</p> <h2 id=osd-information>OSD Information<a class=headerlink href=#osd-information title="Permanent link">&para;</a></h2> <p>Keeping track of OSDs and their underlying storage devices can be difficult. The following scripts will clear things up quickly.</p> <h3 id=kubernetes>Kubernetes<a class=headerlink href=#kubernetes title="Permanent link">&para;</a></h3> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-4-1> 1</a></span>
<span class=normal><a href=#__codelineno-4-2> 2</a></span>
<span class=normal><a href=#__codelineno-4-3> 3</a></span>
<span class=normal><a href=#__codelineno-4-4> 4</a></span>
<span class=normal><a href=#__codelineno-4-5> 5</a></span>
<span class=normal><a href=#__codelineno-4-6> 6</a></span>
<span class=normal><a href=#__codelineno-4-7> 7</a></span>
<span class=normal><a href=#__codelineno-4-8> 8</a></span>
<span class=normal><a href=#__codelineno-4-9> 9</a></span>
<span class=normal><a href=#__codelineno-4-10>10</a></span>
<span class=normal><a href=#__codelineno-4-11>11</a></span>
<span class=normal><a href=#__codelineno-4-12>12</a></span>
<span class=normal><a href=#__codelineno-4-13>13</a></span>
<span class=normal><a href=#__codelineno-4-14>14</a></span>
<span class=normal><a href=#__codelineno-4-15>15</a></span>
<span class=normal><a href=#__codelineno-4-16>16</a></span>
<span class=normal><a href=#__codelineno-4-17>17</a></span>
<span class=normal><a href=#__codelineno-4-18>18</a></span>
<span class=normal><a href=#__codelineno-4-19>19</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-4-1 name=__codelineno-4-1></a><span class=gp># </span>Get<span class=w> </span>OSD<span class=w> </span>Pods
<a id=__codelineno-4-2 name=__codelineno-4-2></a><span class=gp># </span>This<span class=w> </span>uses<span class=w> </span>the<span class=w> </span>example/default<span class=w> </span>cluster<span class=w> </span>name<span class=w> </span><span class=s2>&quot;rook&quot;</span>
<a id=__codelineno-4-3 name=__codelineno-4-3></a><span class=go>OSD_PODS=$(kubectl get pods --all-namespaces -l \</span>
<a id=__codelineno-4-4 name=__codelineno-4-4></a><span class=go>  app=rook-ceph-osd,rook_cluster=rook-ceph -o jsonpath=&#39;{.items[*].metadata.name}&#39;)</span>
<a id=__codelineno-4-5 name=__codelineno-4-5></a>
<a id=__codelineno-4-6 name=__codelineno-4-6></a><span class=gp># </span>Find<span class=w> </span>node<span class=w> </span>and<span class=w> </span>drive<span class=w> </span>associations<span class=w> </span>from<span class=w> </span>OSD<span class=w> </span>pods
<a id=__codelineno-4-7 name=__codelineno-4-7></a><span class=go>for pod in $(echo ${OSD_PODS})</span>
<a id=__codelineno-4-8 name=__codelineno-4-8></a><span class=go>do</span>
<a id=__codelineno-4-9 name=__codelineno-4-9></a><span class=go> echo &quot;Pod:  ${pod}&quot;</span>
<a id=__codelineno-4-10 name=__codelineno-4-10></a><span class=go> echo &quot;Node: $(kubectl -n rook-ceph get pod ${pod} -o jsonpath=&#39;{.spec.nodeName}&#39;)&quot;</span>
<a id=__codelineno-4-11 name=__codelineno-4-11></a><span class=go> kubectl -n rook-ceph exec ${pod} -- sh -c &#39;\</span>
<a id=__codelineno-4-12 name=__codelineno-4-12></a><span class=go>  for i in /var/lib/ceph/osd/ceph-*; do</span>
<a id=__codelineno-4-13 name=__codelineno-4-13></a><span class=go>    [ -f ${i}/ready ] || continue</span>
<a id=__codelineno-4-14 name=__codelineno-4-14></a><span class=go>    echo -ne &quot;-$(basename ${i}) &quot;</span>
<a id=__codelineno-4-15 name=__codelineno-4-15></a><span class=go>    echo $(lsblk -n -o NAME,SIZE ${i}/block 2&gt; /dev/null || \</span>
<a id=__codelineno-4-16 name=__codelineno-4-16></a><span class=go>    findmnt -n -v -o SOURCE,SIZE -T ${i}) $(cat ${i}/type)</span>
<a id=__codelineno-4-17 name=__codelineno-4-17></a><span class=go>  done | sort -V</span>
<a id=__codelineno-4-18 name=__codelineno-4-18></a><span class=go>  echo&#39;</span>
<a id=__codelineno-4-19 name=__codelineno-4-19></a><span class=go>done</span>
</code></pre></div></td></tr></table></div> <p>The output should look something like this.</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-5-1> 1</a></span>
<span class=normal><a href=#__codelineno-5-2> 2</a></span>
<span class=normal><a href=#__codelineno-5-3> 3</a></span>
<span class=normal><a href=#__codelineno-5-4> 4</a></span>
<span class=normal><a href=#__codelineno-5-5> 5</a></span>
<span class=normal><a href=#__codelineno-5-6> 6</a></span>
<span class=normal><a href=#__codelineno-5-7> 7</a></span>
<span class=normal><a href=#__codelineno-5-8> 8</a></span>
<span class=normal><a href=#__codelineno-5-9> 9</a></span>
<span class=normal><a href=#__codelineno-5-10>10</a></span>
<span class=normal><a href=#__codelineno-5-11>11</a></span>
<span class=normal><a href=#__codelineno-5-12>12</a></span>
<span class=normal><a href=#__codelineno-5-13>13</a></span>
<span class=normal><a href=#__codelineno-5-14>14</a></span>
<span class=normal><a href=#__codelineno-5-15>15</a></span>
<span class=normal><a href=#__codelineno-5-16>16</a></span>
<span class=normal><a href=#__codelineno-5-17>17</a></span>
<span class=normal><a href=#__codelineno-5-18>18</a></span>
<span class=normal><a href=#__codelineno-5-19>19</a></span>
<span class=normal><a href=#__codelineno-5-20>20</a></span>
<span class=normal><a href=#__codelineno-5-21>21</a></span>
<span class=normal><a href=#__codelineno-5-22>22</a></span>
<span class=normal><a href=#__codelineno-5-23>23</a></span>
<span class=normal><a href=#__codelineno-5-24>24</a></span>
<span class=normal><a href=#__codelineno-5-25>25</a></span>
<span class=normal><a href=#__codelineno-5-26>26</a></span>
<span class=normal><a href=#__codelineno-5-27>27</a></span>
<span class=normal><a href=#__codelineno-5-28>28</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-5-1 name=__codelineno-5-1></a><span class=go>Pod:  osd-m2fz2</span>
<a id=__codelineno-5-2 name=__codelineno-5-2></a><span class=go>Node: node1.zbrbdl</span>
<a id=__codelineno-5-3 name=__codelineno-5-3></a><span class=go>-osd0  sda3  557.3G  bluestore</span>
<a id=__codelineno-5-4 name=__codelineno-5-4></a><span class=go>-osd1  sdf3  110.2G  bluestore</span>
<a id=__codelineno-5-5 name=__codelineno-5-5></a><span class=go>-osd2  sdd3  277.8G  bluestore</span>
<a id=__codelineno-5-6 name=__codelineno-5-6></a><span class=go>-osd3  sdb3  557.3G  bluestore</span>
<a id=__codelineno-5-7 name=__codelineno-5-7></a><span class=go>-osd4  sde3  464.2G  bluestore</span>
<a id=__codelineno-5-8 name=__codelineno-5-8></a><span class=go>-osd5  sdc3  557.3G  bluestore</span>
<a id=__codelineno-5-9 name=__codelineno-5-9></a>
<a id=__codelineno-5-10 name=__codelineno-5-10></a><span class=go>Pod:  osd-nxxnq</span>
<a id=__codelineno-5-11 name=__codelineno-5-11></a><span class=go>Node: node3.zbrbdl</span>
<a id=__codelineno-5-12 name=__codelineno-5-12></a><span class=go>-osd6   sda3  110.7G  bluestore</span>
<a id=__codelineno-5-13 name=__codelineno-5-13></a><span class=go>-osd17  sdd3  1.8T    bluestore</span>
<a id=__codelineno-5-14 name=__codelineno-5-14></a><span class=go>-osd18  sdb3  231.8G  bluestore</span>
<a id=__codelineno-5-15 name=__codelineno-5-15></a><span class=go>-osd19  sdc3  231.8G  bluestore</span>
<a id=__codelineno-5-16 name=__codelineno-5-16></a>
<a id=__codelineno-5-17 name=__codelineno-5-17></a><span class=go>Pod:  osd-tww1h</span>
<a id=__codelineno-5-18 name=__codelineno-5-18></a><span class=go>Node: node2.zbrbdl</span>
<a id=__codelineno-5-19 name=__codelineno-5-19></a><span class=go>-osd7   sdc3  464.2G  bluestore</span>
<a id=__codelineno-5-20 name=__codelineno-5-20></a><span class=go>-osd8   sdj3  557.3G  bluestore</span>
<a id=__codelineno-5-21 name=__codelineno-5-21></a><span class=go>-osd9   sdf3  66.7G   bluestore</span>
<a id=__codelineno-5-22 name=__codelineno-5-22></a><span class=go>-osd10  sdd3  464.2G  bluestore</span>
<a id=__codelineno-5-23 name=__codelineno-5-23></a><span class=go>-osd11  sdb3  147.4G  bluestore</span>
<a id=__codelineno-5-24 name=__codelineno-5-24></a><span class=go>-osd12  sdi3  557.3G  bluestore</span>
<a id=__codelineno-5-25 name=__codelineno-5-25></a><span class=go>-osd13  sdk3  557.3G  bluestore</span>
<a id=__codelineno-5-26 name=__codelineno-5-26></a><span class=go>-osd14  sde3  66.7G   bluestore</span>
<a id=__codelineno-5-27 name=__codelineno-5-27></a><span class=go>-osd15  sda3  110.2G  bluestore</span>
<a id=__codelineno-5-28 name=__codelineno-5-28></a><span class=go>-osd16  sdh3  135.1G  bluestore</span>
</code></pre></div></td></tr></table></div> <h2 id=separate-storage-groups>Separate Storage Groups<a class=headerlink href=#separate-storage-groups title="Permanent link">&para;</a></h2> <div class="admonition attention"> <p class=admonition-title>Attention</p> <p>It is <strong>deprecated to manually need to set this</strong>, the <code>deviceClass</code> property can be used on Pool structures in <code>CephBlockPool</code>, <code>CephFilesystem</code> and <code>CephObjectStore</code> CRD objects.</p> </div> <p>By default Rook/Ceph puts all storage under one replication rule in the CRUSH Map which provides the maximum amount of storage capacity for a cluster. If you would like to use different storage endpoints for different purposes, you'll have to create separate storage groups.</p> <p>In the following example we will separate SSD drives from spindle-based drives, a common practice for those looking to target certain workloads onto faster (database) or slower (file archive) storage.</p> <h2 id=configuring-pools>Configuring Pools<a class=headerlink href=#configuring-pools title="Permanent link">&para;</a></h2> <h3 id=placement-group-sizing>Placement Group Sizing<a class=headerlink href=#placement-group-sizing title="Permanent link">&para;</a></h3> <div class="admonition note"> <p class=admonition-title>Note</p> <p>Since Ceph Nautilus (v14.x), you can use the Ceph MGR <code>pg_autoscaler</code> module to auto scale the PGs as needed. It is highly advisable to configure default pg_num value on per-pool basis, If you want to enable this feature, please refer to <a href=../configuration/#default-pg-and-pgp-counts>Default PG and PGP counts</a>.</p> </div> <p>The general rules for deciding how many PGs your pool(s) should contain is:</p> <ul> <li>Fewer than 5 OSDs set <code>pg_num</code> to 128</li> <li>Between 5 and 10 OSDs set <code>pg_num</code> to 512</li> <li>Between 10 and 50 OSDs set <code>pg_num</code> to 1024</li> </ul> <p>If you have more than 50 OSDs, you need to understand the tradeoffs and how to calculate the pg_num value by yourself. For calculating pg_num yourself please make use of <a href=https://old.ceph.com/pgcalc/ >the pgcalc tool</a>.</p> <h3 id=setting-pg-count>Setting PG Count<a class=headerlink href=#setting-pg-count title="Permanent link">&para;</a></h3> <p>Be sure to read the <a href=#placement-group-sizing>placement group sizing</a> section before changing the number of PGs.</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-6-1>1</a></span>
<span class=normal><a href=#__codelineno-6-2>2</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-6-1 name=__codelineno-6-1></a><span class=gp># </span>Set<span class=w> </span>the<span class=w> </span>number<span class=w> </span>of<span class=w> </span>PGs<span class=w> </span><span class=k>in</span><span class=w> </span>the<span class=w> </span>rbd<span class=w> </span>pool<span class=w> </span>to<span class=w> </span><span class=m>512</span>
<a id=__codelineno-6-2 name=__codelineno-6-2></a><span class=go>ceph osd pool set rbd pg_num 512</span>
</code></pre></div></td></tr></table></div> <h2 id=custom-cephconf-settings>Custom <code>ceph.conf</code> Settings<a class=headerlink href=#custom-cephconf-settings title="Permanent link">&para;</a></h2> <div class="admonition info"> <p class=admonition-title>Info</p> <p>The advised method for controlling Ceph configuration is to use the <a href=../../../CRDs/Cluster/ceph-cluster-crd/#ceph-config><code>cephConfig</code></a> and <a href=../../../CRDs/Cluster/ceph-cluster-crd/#ceph-config-from-secret><code>cephConfigFromSecret</code></a> in the <code>CephCluster</code> CRD. <br><br>It is highly recommended that this only be used when absolutely necessary and that the <code>config</code> be reset to an empty string if/when the configurations are no longer necessary. Configurations in the config file will make the Ceph cluster less configurable from the CLI and dashboard and may make future tuning or debugging difficult.</p> </div> <p>Setting configs via Ceph's CLI requires that at least one mon be available for the configs to be set, and setting configs via dashboard requires at least one mgr to be available. Ceph also has a number of very advanced settings that cannot be modified easily via the CLI or dashboard. In order to set configurations before monitors are available or to set advanced configuration settings, the <code>rook-config-override</code> ConfigMap exists, and the <code>config</code> field can be set with the contents of a <code>ceph.conf</code> file. The contents will be propagated to all mon, mgr, OSD, MDS, and RGW daemons as an <code>/etc/ceph/ceph.conf</code> file.</p> <div class="admonition warning"> <p class=admonition-title>Warning</p> <p>Rook performs no validation on the config, so the validity of the settings is the user's responsibility.</p> </div> <p>If the <code>rook-config-override</code> ConfigMap is created before the cluster is started, the Ceph daemons will automatically pick up the settings. If you add the settings to the ConfigMap after the cluster has been initialized, each daemon will need to be restarted where you want the settings applied:</p> <ul> <li>mons: ensure all three mons are online and healthy before restarting each mon pod, one at a time.</li> <li>mgrs: the pods are stateless and can be restarted as needed, but note that this will disrupt the Ceph dashboard during restart.</li> <li>OSDs: restart your the pods by deleting them, one at a time, and running <code>ceph -s</code> between each restart to ensure the cluster goes back to "active/clean" state.</li> <li>RGW: the pods are stateless and can be restarted as needed.</li> <li>MDS: the pods are stateless and can be restarted as needed.</li> </ul> <p>After the pod restart, the new settings should be in effect. Note that if the ConfigMap in the Ceph cluster's namespace is created before the cluster is created, the daemons will pick up the settings at first launch.</p> <p>To automate the restart of the Ceph daemon pods, you will need to trigger an update to the pod specs. The simplest way to trigger the update is to add <a href=../../../CRDs/Cluster/ceph-cluster-crd/#annotations-and-labels>annotations or labels</a> to the CephCluster CR for the daemons you want to restart. The operator will then proceed with a rolling update, similar to any other update to the cluster.</p> <h3 id=node-specific-osd-settings>Node-specific OSD settings<a class=headerlink href=#node-specific-osd-settings title="Permanent link">&para;</a></h3> <p>The OSD ceph config settings can also be customized per-node. This may be helpful for some ceph.conf settings that need to be unique per node depending on the hardware. This can be configured by creating a node-specific configmap that will be loaded for all OSDs and OSD prepare jobs on that node, instead of the default settings that are loaded from the rook-config-override configmap.</p> <p>The node-specific configmaps must have the label:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-7-1>1</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-7-1 name=__codelineno-7-1></a><span class="l l-Scalar l-Scalar-Plain">node.config.rook.io/osd</span>
</code></pre></div></td></tr></table></div> <p>The configmaps must follow the naming convention:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-8-1>1</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-8-1 name=__codelineno-8-1></a><span class="l l-Scalar l-Scalar-Plain">rook-config-override-&lt;hostname&gt;</span>
</code></pre></div></td></tr></table></div> <h3 id=example>Example<a class=headerlink href=#example title="Permanent link">&para;</a></h3> <p>In this example we will set the default pool <code>size</code> to two, and tell OSD daemons not to change the weight of OSDs on startup.</p> <div class="admonition warning"> <p class=admonition-title>Warning</p> <p>Modify Ceph settings carefully. You are leaving the sandbox tested by Rook. Changing the settings could result in unhealthy daemons or even data loss if used incorrectly.</p> </div> <p>When the Rook Operator creates a cluster, a placeholder ConfigMap is created that will allow you to override Ceph configuration settings. When the daemon pods are started, the settings specified in this ConfigMap will be merged with the default settings generated by Rook.</p> <p>The default override settings are blank. Cutting out the extraneous properties, we would see the following defaults after creating a cluster:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-9-1>1</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-9-1 name=__codelineno-9-1></a><span class=go>kubectl -n rook-ceph get ConfigMap rook-config-override -o yaml</span>
</code></pre></div></td></tr></table></div> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-10-1>1</a></span>
<span class=normal><a href=#__codelineno-10-2>2</a></span>
<span class=normal><a href=#__codelineno-10-3>3</a></span>
<span class=normal><a href=#__codelineno-10-4>4</a></span>
<span class=normal><a href=#__codelineno-10-5>5</a></span>
<span class=normal><a href=#__codelineno-10-6>6</a></span>
<span class=normal><a href=#__codelineno-10-7>7</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-10-1 name=__codelineno-10-1></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ConfigMap</span>
<a id=__codelineno-10-2 name=__codelineno-10-2></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<a id=__codelineno-10-3 name=__codelineno-10-3></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-10-4 name=__codelineno-10-4></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rook-config-override</span>
<a id=__codelineno-10-5 name=__codelineno-10-5></a><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rook-ceph</span>
<a id=__codelineno-10-6 name=__codelineno-10-6></a><span class=nt>data</span><span class=p>:</span>
<a id=__codelineno-10-7 name=__codelineno-10-7></a><span class=w>  </span><span class=nt>config</span><span class=p>:</span><span class=w> </span><span class=s>&quot;&quot;</span>
</code></pre></div></td></tr></table></div> <p>To apply your desired configuration, you will need to update this ConfigMap. The next time the daemon pod(s) start, they will use the updated configs.</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-11-1>1</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-11-1 name=__codelineno-11-1></a><span class=go>kubectl -n rook-ceph edit configmap rook-config-override</span>
</code></pre></div></td></tr></table></div> <p>Modify the settings and save. Each line you add should be indented from the <code>config</code> property as such:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-12-1> 1</a></span>
<span class=normal><a href=#__codelineno-12-2> 2</a></span>
<span class=normal><a href=#__codelineno-12-3> 3</a></span>
<span class=normal><a href=#__codelineno-12-4> 4</a></span>
<span class=normal><a href=#__codelineno-12-5> 5</a></span>
<span class=normal><a href=#__codelineno-12-6> 6</a></span>
<span class=normal><a href=#__codelineno-12-7> 7</a></span>
<span class=normal><a href=#__codelineno-12-8> 8</a></span>
<span class=normal><a href=#__codelineno-12-9> 9</a></span>
<span class=normal><a href=#__codelineno-12-10>10</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-12-1 name=__codelineno-12-1></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<a id=__codelineno-12-2 name=__codelineno-12-2></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ConfigMap</span>
<a id=__codelineno-12-3 name=__codelineno-12-3></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-12-4 name=__codelineno-12-4></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rook-config-override</span>
<a id=__codelineno-12-5 name=__codelineno-12-5></a><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rook-ceph</span>
<a id=__codelineno-12-6 name=__codelineno-12-6></a><span class=nt>data</span><span class=p>:</span>
<a id=__codelineno-12-7 name=__codelineno-12-7></a><span class=w>  </span><span class=nt>config</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span>
<a id=__codelineno-12-8 name=__codelineno-12-8></a><span class=w>    </span><span class=no>[global]</span>
<a id=__codelineno-12-9 name=__codelineno-12-9></a><span class=w>    </span><span class=no>osd crush update on start = false</span>
<a id=__codelineno-12-10 name=__codelineno-12-10></a><span class=w>    </span><span class=no>osd pool default size = 2</span>
</code></pre></div></td></tr></table></div> <h2 id=custom-csi-cephconf-settings>Custom CSI <code>ceph.conf</code> Settings<a class=headerlink href=#custom-csi-cephconf-settings title="Permanent link">&para;</a></h2> <div class="admonition warning"> <p class=admonition-title>Warning</p> <p>It is highly recommended to use the default setting that comes with CephCSI and this can only be used when absolutely necessary. The <code>ceph.conf</code> should be reset back to default values if/when the configurations are no longer necessary.</p> </div> <p>If the <code>csi-ceph-conf-override</code> ConfigMap is created before the cluster is started, the CephCSI pods will automatically pick up the settings. If you add the settings to the ConfigMap after the cluster has been initialized, you can restart the Rook operator pod and wait for Rook to recreate CSI pods to take immediate effect.</p> <p>After the CSI pods are restarted, the new settings should be in effect.</p> <h3 id=example-csi-cephconf-settings>Example CSI <code>ceph.conf</code> Settings<a class=headerlink href=#example-csi-cephconf-settings title="Permanent link">&para;</a></h3> <p>In this <a href=https://github.com/rook/rook/tree/release-1.17/deploy/examples/csi-ceph-conf-override.yaml>Example</a> we will set the <code>rbd_validate_pool</code> to <code>false</code> to skip rbd pool validation.</p> <div class="admonition warning"> <p class=admonition-title>Warning</p> <p>Modify Ceph settings carefully to avoid modifying the default configuration. Changing the settings could result in unexpected results if used incorrectly.</p> </div> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-13-1>1</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-13-1 name=__codelineno-13-1></a><span class=go>kubectl create -f csi-ceph-conf-override.yaml</span>
</code></pre></div></td></tr></table></div> <p>Restart the Rook operator pod and wait for CSI pods to be recreated.</p> <h2 id=osd-crush-settings>OSD CRUSH Settings<a class=headerlink href=#osd-crush-settings title="Permanent link">&para;</a></h2> <p>A useful view of the <a href=http://docs.ceph.com/docs/master/rados/operations/crush-map/ >CRUSH Map</a> is generated with the following command:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-14-1>1</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-14-1 name=__codelineno-14-1></a><span class=go>ceph osd tree</span>
</code></pre></div></td></tr></table></div> <p>In this section we will be tweaking some of the values seen in the output.</p> <h3 id=osd-weight>OSD Weight<a class=headerlink href=#osd-weight title="Permanent link">&para;</a></h3> <p>The CRUSH weight controls the ratio of data that should be distributed to each OSD. This also means a higher or lower amount of disk I/O operations for an OSD with higher/lower weight, respectively.</p> <p>By default OSDs get a weight relative to their storage capacity, which maximizes overall cluster capacity by filling all drives at the same rate, even if drive sizes vary. This should work for most use-cases, but the following situations could warrant weight changes:</p> <ul> <li>Your cluster has some relatively slow OSDs or nodes. Lowering their weight can reduce the impact of this bottleneck.</li> <li>You're using bluestore drives provisioned with Rook v0.3.1 or older. In this case you may notice OSD weights did not get set relative to their storage capacity. Changing the weight can fix this and maximize cluster capacity.</li> </ul> <p>This example sets the weight of osd.0 which is 600GiB</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-15-1>1</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-15-1 name=__codelineno-15-1></a><span class=go>ceph osd crush reweight osd.0 .600</span>
</code></pre></div></td></tr></table></div> <h3 id=osd-primary-affinity>OSD Primary Affinity<a class=headerlink href=#osd-primary-affinity title="Permanent link">&para;</a></h3> <p>When pools are set with a size setting greater than one, data is replicated between nodes and OSDs. For every chunk of data a Primary OSD is selected to be used for reading that data to be sent to clients. You can control how likely it is for an OSD to become a Primary using the Primary Affinity setting. This is similar to the OSD weight setting, except it only affects reads on the storage device, not capacity or writes.</p> <p>In this example we will ensure that <code>osd.0</code> is only selected as Primary if all other OSDs holding data replicas are unavailable:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-16-1>1</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-16-1 name=__codelineno-16-1></a><span class=go>ceph osd primary-affinity osd.0 0</span>
</code></pre></div></td></tr></table></div> <h2 id=osd-dedicated-network>OSD Dedicated Network<a class=headerlink href=#osd-dedicated-network title="Permanent link">&para;</a></h2> <div class="admonition tip"> <p class=admonition-title>Tip</p> <p>This documentation is left for historical purposes. It is still valid, but Rook offers native support for this feature via the <a href=../../../CRDs/Cluster/ceph-cluster-crd/#ceph-public-and-cluster-networks>CephCluster network configuration</a>.</p> </div> <p>It is possible to configure ceph to leverage a dedicated network for the OSDs to communicate across. A useful overview is the <a href=http://docs.ceph.com/docs/master/rados/configuration/network-config-ref/#ceph-networks>Ceph Networks</a> section of the Ceph documentation. If you declare a cluster network, OSDs will route heartbeat, object replication, and recovery traffic over the cluster network. This may improve performance compared to using a single network, especially when slower network technologies are used. The tradeoff is additional expense and subtle failure modes.</p> <p>Two changes are necessary to the configuration to enable this capability:</p> <h3 id=use-hostnetwork-in-the-cluster-configuration>Use hostNetwork in the cluster configuration<a class=headerlink href=#use-hostnetwork-in-the-cluster-configuration title="Permanent link">&para;</a></h3> <p>Enable the <code>hostNetwork</code> setting in the <a href=../../../CRDs/Cluster/ceph-cluster-crd/#samples>Ceph Cluster CRD configuration</a>. For example,</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-17-1>1</a></span>
<span class=normal><a href=#__codelineno-17-2>2</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-17-1 name=__codelineno-17-1></a><span class=w>  </span><span class=nt>network</span><span class=p>:</span>
<a id=__codelineno-17-2 name=__codelineno-17-2></a><span class=w>    </span><span class=nt>provider</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">host</span>
</code></pre></div></td></tr></table></div> <div class="admonition important"> <p class=admonition-title>Important</p> <p>Changing this setting is not supported in a running Rook cluster. Host networking should be configured when the cluster is first created.</p> </div> <h3 id=define-the-subnets-to-use-for-public-and-private-osd-networks>Define the subnets to use for public and private OSD networks<a class=headerlink href=#define-the-subnets-to-use-for-public-and-private-osd-networks title="Permanent link">&para;</a></h3> <p>Edit the <code>rook-config-override</code> configmap to define the custom network configuration:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-18-1>1</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-18-1 name=__codelineno-18-1></a><span class=go>kubectl -n rook-ceph edit configmap rook-config-override</span>
</code></pre></div></td></tr></table></div> <p>In the editor, add a custom configuration to instruct ceph which subnet is the public network and which subnet is the private network. For example:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-19-1>1</a></span>
<span class=normal><a href=#__codelineno-19-2>2</a></span>
<span class=normal><a href=#__codelineno-19-3>3</a></span>
<span class=normal><a href=#__codelineno-19-4>4</a></span>
<span class=normal><a href=#__codelineno-19-5>5</a></span>
<span class=normal><a href=#__codelineno-19-6>6</a></span>
<span class=normal><a href=#__codelineno-19-7>7</a></span>
<span class=normal><a href=#__codelineno-19-8>8</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-19-1 name=__codelineno-19-1></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<a id=__codelineno-19-2 name=__codelineno-19-2></a><span class=nt>data</span><span class=p>:</span>
<a id=__codelineno-19-3 name=__codelineno-19-3></a><span class=w>  </span><span class=nt>config</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span>
<a id=__codelineno-19-4 name=__codelineno-19-4></a><span class=w>    </span><span class=no>[global]</span>
<a id=__codelineno-19-5 name=__codelineno-19-5></a><span class=w>    </span><span class=no>public network = 10.0.7.0/24</span>
<a id=__codelineno-19-6 name=__codelineno-19-6></a><span class=w>    </span><span class=no>cluster network = 10.0.10.0/24</span>
<a id=__codelineno-19-7 name=__codelineno-19-7></a><span class=w>    </span><span class=no>public addr = &quot;&quot;</span>
<a id=__codelineno-19-8 name=__codelineno-19-8></a><span class=w>    </span><span class=no>cluster addr = &quot;&quot;</span>
</code></pre></div></td></tr></table></div> <p>After applying the updated rook-config-override configmap, it will be necessary to restart the OSDs by deleting the OSD pods in order to apply the change. Restart the OSD pods by deleting them, one at a time, and running ceph -s between each restart to ensure the cluster goes back to "active/clean" state.</p> <h2 id=phantom-osd-removal>Phantom OSD Removal<a class=headerlink href=#phantom-osd-removal title="Permanent link">&para;</a></h2> <p>If you have OSDs in which are not showing any disks, you can remove those "Phantom OSDs" by following the instructions below. To check for "Phantom OSDs", you can run (example output):</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-20-1>1</a></span>
<span class=normal><a href=#__codelineno-20-2>2</a></span>
<span class=normal><a href=#__codelineno-20-3>3</a></span>
<span class=normal><a href=#__codelineno-20-4>4</a></span>
<span class=normal><a href=#__codelineno-20-5>5</a></span>
<span class=normal><a href=#__codelineno-20-6>6</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-20-1 name=__codelineno-20-1></a><span class=gp>$ </span>ceph<span class=w> </span>osd<span class=w> </span>tree
<a id=__codelineno-20-2 name=__codelineno-20-2></a><span class=go>ID  CLASS WEIGHT  TYPE NAME STATUS REWEIGHT PRI-AFF</span>
<a id=__codelineno-20-3 name=__codelineno-20-3></a><span class=go>-1       57.38062 root default</span>
<a id=__codelineno-20-4 name=__codelineno-20-4></a><span class=go>-13        7.17258     host node1.example.com</span>
<a id=__codelineno-20-5 name=__codelineno-20-5></a><span class=go>2   hdd  3.61859         osd.2                up  1.00000 1.00000</span>
<a id=__codelineno-20-6 name=__codelineno-20-6></a><span class=go>-7              0     host node2.example.com   down    0    1.00000</span>
</code></pre></div></td></tr></table></div> <p>The host <code>node2.example.com</code> in the output has no disks, so it is most likely a "Phantom OSD".</p> <p>Now to remove it, use the ID in the first column of the output and replace <code>&lt;ID&gt;</code> with it. In the example output above the ID would be <code>-7</code>. The commands are:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-21-1>1</a></span>
<span class=normal><a href=#__codelineno-21-2>2</a></span>
<span class=normal><a href=#__codelineno-21-3>3</a></span>
<span class=normal><a href=#__codelineno-21-4>4</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-21-1 name=__codelineno-21-1></a><span class=go>ceph osd out &lt;ID&gt;</span>
<a id=__codelineno-21-2 name=__codelineno-21-2></a><span class=go>ceph osd crush remove osd.&lt;ID&gt;</span>
<a id=__codelineno-21-3 name=__codelineno-21-3></a><span class=go>ceph auth del osd.&lt;ID&gt;</span>
<a id=__codelineno-21-4 name=__codelineno-21-4></a><span class=go>ceph osd rm &lt;ID&gt;</span>
</code></pre></div></td></tr></table></div> <p>To recheck that the Phantom OSD was removed, re-run the following command and check if the OSD with the ID doesn't show up anymore:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-22-1>1</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-22-1 name=__codelineno-22-1></a><span class=go>ceph osd tree</span>
</code></pre></div></td></tr></table></div> <h2 id=auto-expansion-of-osds>Auto Expansion of OSDs<a class=headerlink href=#auto-expansion-of-osds title="Permanent link">&para;</a></h2> <h3 id=prerequisites-for-auto-expansion-of-osds>Prerequisites for Auto Expansion of OSDs<a class=headerlink href=#prerequisites-for-auto-expansion-of-osds title="Permanent link">&para;</a></h3> <p>1) A <a href=../../../CRDs/Cluster/ceph-cluster-crd/#pvc-based-cluster>PVC-based cluster</a> deployed in dynamic provisioning environment with a <code>storageClassDeviceSet</code>.</p> <p>2) Create the Rook <a href=../../../Troubleshooting/ceph-toolbox/ >Toolbox</a>.</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p><a href=../../Monitoring/ceph-monitoring/#prometheus-operator>Prometheus Operator</a> and [Prometheus ../Monitoring/ceph-monitoring.mdnitoring.md#prometheus-instances) are Prerequisites that are created by the auto-grow-storage script.</p> </div> <h3 id=to-scale-osds-vertically>To scale OSDs Vertically<a class=headerlink href=#to-scale-osds-vertically title="Permanent link">&para;</a></h3> <p>Run the following script to auto-grow the size of OSDs on a PVC-based Rook cluster whenever the OSDs have reached the storage near-full threshold.</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-23-1>1</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-23-1 name=__codelineno-23-1></a><span class=go>tests/scripts/auto-grow-storage.sh size  --max maxSize --growth-rate percent</span>
</code></pre></div></td></tr></table></div> <p><code>growth-rate</code> percentage represents the percent increase you want in the OSD capacity and maxSize represent the maximum disk size.</p> <p>For example, if you need to increase the size of OSD by 30% and max disk size is 1Ti</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-24-1>1</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-24-1 name=__codelineno-24-1></a><span class=go>./auto-grow-storage.sh size  --max 1Ti --growth-rate 30</span>
</code></pre></div></td></tr></table></div> <h3 id=to-scale-osds-horizontally>To scale OSDs Horizontally<a class=headerlink href=#to-scale-osds-horizontally title="Permanent link">&para;</a></h3> <p>Run the following script to auto-grow the number of OSDs on a PVC-based Rook cluster whenever the OSDs have reached the storage near-full threshold.</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-25-1>1</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-25-1 name=__codelineno-25-1></a><span class=go>tests/scripts/auto-grow-storage.sh count --max maxCount --count rate</span>
</code></pre></div></td></tr></table></div> <p>Count of OSD represents the number of OSDs you need to add and maxCount represents the number of disks a storage cluster will support.</p> <p>For example, if you need to increase the number of OSDs by 3 and maxCount is 10</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-26-1>1</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-26-1 name=__codelineno-26-1></a><span class=go>./auto-grow-storage.sh count --max 10 --count 3</span>
</code></pre></div></td></tr></table></div> </article> </div> <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> <a href=/ class=logo> <img src=https://rook.io/images/rook-logo-small.svg alt="rook.io logo"> </a> <p> &#169; Rook Authors 2022. Documentation distributed under <a href=https://creativecommons.org/licenses/by/4.0>CC-BY-4.0</a>. </p> <p> &#169; 2022 The Linux Foundation. All rights reserved. The Linux Foundation has registered trademarks and uses trademarks. For a list of trademarks of The Linux Foundation, please see our <a href=https://www.linuxfoundation.org/trademark-usage/ >Trademark Usage</a> page. </p> </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://slack.rook.io/ target=_blank rel=noopener title=slack.rook.io class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M94.1 315.1c0 25.9-21.2 47.1-47.1 47.1S0 341 0 315.1 21.2 268 47.1 268h47.1v47.1zm23.7 0c0-25.9 21.2-47.1 47.1-47.1s47.1 21.2 47.1 47.1v117.8c0 25.9-21.2 47.1-47.1 47.1s-47.1-21.2-47.1-47.1zm47.1-189c-25.9 0-47.1-21.2-47.1-47.1s21.2-47 47.1-47S212 53.2 212 79.1v47.1h-47.1zm0 23.7c25.9 0 47.1 21.2 47.1 47.1S190.8 244 164.9 244H47.1C21.2 244 0 222.8 0 196.9s21.2-47.1 47.1-47.1zm189 47.1c0-25.9 21.2-47.1 47.1-47.1s47 21.2 47 47.1-21.2 47.1-47.1 47.1h-47.1v-47.1zm-23.7 0c0 25.9-21.2 47.1-47.1 47.1S236 222.8 236 196.9V79.1c0-25.9 21.2-47.1 47.1-47.1s47.1 21.2 47.1 47.1zm-47.1 189c25.9 0 47.1 21.2 47.1 47.1s-21.2 47-47.1 47-47.1-21.2-47.1-47.1v-47.1h47.1zm0-23.7c-25.9 0-47.1-21.2-47.1-47.1s21.2-47.1 47.1-47.1h117.8c25.9 0 47.1 21.2 47.1 47.1s-21.2 47.1-47.1 47.1z"/></svg> </a> <a href=https://twitter.com/rook_io target=_blank rel=noopener title=twitter.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M459.4 151.7c.3 4.5.3 9.1.3 13.6 0 138.7-105.6 298.6-298.6 298.6-59.5 0-114.7-17.2-161.1-47.1 8.4 1 16.6 1.3 25.3 1.3 49.1 0 94.2-16.6 130.3-44.8-46.1-1-84.8-31.2-98.1-72.8 6.5 1 13 1.6 19.8 1.6 9.4 0 18.8-1.3 27.6-3.6-48.1-9.7-84.1-52-84.1-103v-1.3c14 7.8 30.2 12.7 47.4 13.3-28.3-18.8-46.8-51-46.8-87.4 0-19.5 5.2-37.4 14.3-53C87.4 130.8 165 172.4 252.1 176.9c-1.6-7.8-2.6-15.9-2.6-24C249.5 95.1 296.3 48 354.4 48c30.2 0 57.5 12.7 76.7 33.1 23.7-4.5 46.5-13.3 66.6-25.3-7.8 24.4-24.4 44.8-46.1 57.8 21.1-2.3 41.6-8.1 60.4-16.2-14.3 20.8-32.2 39.3-52.6 54.3"/></svg> </a> <a href=https://groups.google.com/forum/#!forum/rook-dev target=_blank rel=noopener title=groups.google.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 576 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M112 0C85.5 0 64 21.5 64 48v160h80v-32c0-53 43-96 96-96h208V48c0-26.5-21.5-48-48-48zm128 128c-26.5 0-48 21.5-48 48v32h80c53 0 96 43 96 96v112h160c26.5 0 48-21.5 48-48V176c0-26.5-21.5-48-48-48zm200 64h48c13.3 0 24 10.7 24 24v48c0 13.3-10.7 24-24 24h-48c-13.3 0-24-10.7-24-24v-48c0-13.3 10.7-24 24-24M48 256c-26.5 0-48 21.5-48 48v10.4l156.6 86.2c1.1.6 2.2.9 3.4.9s2.4-.3 3.4-.9L320 314.4V304c0-26.5-21.5-48-48-48zm272 113.2-133.4 73.4c-8.1 4.5-17.3 6.8-26.6 6.8s-18.4-2.4-26.6-6.8L0 369.2V464c0 26.5 21.5 48 48 48h224c26.5 0 48-21.5 48-48z"/></svg> </a> <a href=https://blog.rook.io/ target=_blank rel=noopener title=blog.rook.io class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M369.4 32c43.4 0 78.6 35.2 78.6 78.6v83.8c-1.9-.1-3.8-.2-5.7-.2h-.4c-10 0-22.3 2.4-31.1 6.8-10 4.6-18.7 11.5-26 20.6-11.8 14.6-18.9 34.3-20.6 56.4-.1.7-.1 1.3-.2 2s-.1 1.2-.1 1.9c-.1 1.2-.1 2.4-.1 3.6 0 1.9-.1 3.8 0 5.8 1.2 50.1 28.2 90.2 76.3 90.2 2.7 0 5.3-.1 7.9-.4v20.4c0 43.4-35.2 78.6-78.6 78.6L78.6 480C35.2 480 0 444.8 0 401.4V110.6C0 67.2 35.2 32 78.6 32zM82.3 138.9l.3.1c13.2 3 19.8 7.4 19.8 23.4v187.2c0 16-6.7 20.4-19.9 23.4l-.3.1v2.8H135v-2.8l-.3-.1c-13.2-3-19.9-7.4-19.9-23.4V173.3l86.1 202.5h4.9l88.6-208.2v186.6c-1.1 12.6-7.8 16.5-19.7 19.2l-.3.1v2.7h91.9v-2.7l-.3-.1c-11.9-2.7-18.7-6.6-19.9-19.2l-.1-191.8h.1c0-16 6.7-20.4 19.9-23.4l.3-.1v-2.7h-72.2l-67 157.4-67-157.4H82.3zM448 340.3c-25.1-7.4-43-35.1-41.2-67.8h41.1v67.8zm-6.4-135.6c2.3 0 4.4.3 6.4.9V263h-40.2c1.5-33.6 13.6-57.9 33.8-58.3"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../../..", "features": ["content.tabs.link", "instant", "navigation.expand", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest", "tabs"], "search": "../../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"default": "latest-release", "provider": "mike"}}</script> <script src=../../../assets/javascripts/bundle.f55a23d4.min.js></script> </body> </html>