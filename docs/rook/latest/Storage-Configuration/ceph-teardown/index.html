<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Rook Ceph Documentation"><meta name=author content="Rook Authors"><link href=https://rook.io/latest/Storage-Configuration/ceph-teardown/ rel=canonical><link rel=icon href=https://rook.io/images/favicon_192x192.png><meta name=generator content="mkdocs-1.3.0, mkdocs-material-8.2.15"><title>Cleanup - Rook Ceph Documentation</title><link rel=stylesheet href=../../assets/stylesheets/main.c382b1dc.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.cc9b2e1e.min.css><link rel=stylesheet href=../../stylesheets/extra.css><script>__md_scope=new URL("../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=rook-blue data-md-color-accent=deep-orange> <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#cleaning-up-a-cluster class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <div data-md-component=outdated hidden> <aside class="md-banner md-banner--warning"> <div class="md-banner__inner md-grid md-typeset"> This document is for a development version of Rook. <a href=../latest-release/../..> <strong>Click here to go to latest release documentation.</strong> </a> </div> <script>var el=document.querySelector("[data-md-component=outdated]"),outdated=__md_get("__outdated",sessionStorage);!0===outdated&&el&&(el.hidden=!1)</script> </aside> </div> <header class="md-header md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title="Rook Ceph Documentation" class="md-header__button md-logo" aria-label="Rook Ceph Documentation" data-md-component=logo> <img src=https://rook.io/images/rook-logo.svg alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Rook Ceph Documentation </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Cleanup </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=rook-blue data-md-color-accent=deep-orange aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=rook-blue data-md-color-accent=red aria-label="Switch to light mode" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg> </a> <button type=reset class="md-search__icon md-icon" aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/rook/rook title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../Getting-Started/intro/ class=md-tabs__link> Getting Started </a> </li> <li class=md-tabs__item> <a href=../../Helm-Charts/helm-charts/ class=md-tabs__link> Helm Charts </a> </li> <li class=md-tabs__item> <a href=../Block-Storage-RBD/block-storage/ class="md-tabs__link md-tabs__link--active"> Storage Configuration </a> </li> <li class=md-tabs__item> <a href=../../CRDs/ceph-cluster-crd/ class=md-tabs__link> Custom Resources </a> </li> <li class=md-tabs__item> <a href=../../Troubleshooting/ceph-toolbox/ class=md-tabs__link> Troubleshooting </a> </li> <li class=md-tabs__item> <a href=../../Upgrade/health-verification/ class=md-tabs__link> Upgrade </a> </li> <li class=md-tabs__item> <a href=../../Contributing/development-flow/ class=md-tabs__link> Contributing </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="Rook Ceph Documentation" class="md-nav__button md-logo" aria-label="Rook Ceph Documentation" data-md-component=logo> <img src=https://rook.io/images/rook-logo.svg alt=logo> </a> Rook Ceph Documentation </label> <div class=md-nav__source> <a href=https://github.com/rook/rook title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_1 data-md-state=indeterminate type=checkbox id=__nav_1 checked> <label class=md-nav__link for=__nav_1> Getting Started <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Getting Started" data-md-level=1> <label class=md-nav__title for=__nav_1> <span class="md-nav__icon md-icon"></span> Getting Started </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Getting-Started/intro/ class=md-nav__link> Rook </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_1_2 data-md-state=indeterminate type=checkbox id=__nav_1_2 checked> <label class=md-nav__link for=__nav_1_2> Prerequisites <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Prerequisites data-md-level=2> <label class=md-nav__title for=__nav_1_2> <span class="md-nav__icon md-icon"></span> Prerequisites </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Getting-Started/Prerequisites/prerequisites/ class=md-nav__link> Prerequisites </a> </li> <li class=md-nav__item> <a href=../../Getting-Started/Prerequisites/authenticated-registry/ class=md-nav__link> Authenticated Container Registries </a> </li> <li class=md-nav__item> <a href=../../Getting-Started/Prerequisites/pod-security-policies/ class=md-nav__link> Pod Security Policies </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../Getting-Started/quickstart/ class=md-nav__link> Quickstart </a> </li> <li class=md-nav__item> <a href=../../Getting-Started/storage-architecture/ class=md-nav__link> Storage Architecture </a> </li> <li class=md-nav__item> <a href=../../Getting-Started/example-configurations/ class=md-nav__link> Example Configurations </a> </li> <li class=md-nav__item> <a href=../../Getting-Started/ceph-openshift/ class=md-nav__link> OpenShift </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2 data-md-state=indeterminate type=checkbox id=__nav_2 checked> <label class=md-nav__link for=__nav_2> Helm Charts <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Helm Charts" data-md-level=1> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Helm Charts </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Helm-Charts/helm-charts/ class=md-nav__link> Helm Charts Overview </a> </li> <li class=md-nav__item> <a href=../../Helm-Charts/operator-chart/ class=md-nav__link> Ceph Operator Helm Chart </a> </li> <li class=md-nav__item> <a href=../../Helm-Charts/ceph-cluster-chart/ class=md-nav__link> Ceph Cluster Helm Chart </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3 type=checkbox id=__nav_3 checked> <label class=md-nav__link for=__nav_3> Storage Configuration <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Storage Configuration" data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Storage Configuration </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_1 data-md-state=indeterminate type=checkbox id=__nav_3_1 checked> <label class=md-nav__link for=__nav_3_1> Block Storage (RBD) <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Block Storage (RBD)" data-md-level=2> <label class=md-nav__title for=__nav_3_1> <span class="md-nav__icon md-icon"></span> Block Storage (RBD) </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Block-Storage-RBD/block-storage/ class=md-nav__link> Block Storage Overview </a> </li> <li class=md-nav__item> <a href=../Block-Storage-RBD/rbd-mirroring/ class=md-nav__link> RBD Mirroring </a> </li> <li class=md-nav__item> <a href=../Block-Storage-RBD/rbd-async-disaster-recovery-failover-failback/ class=md-nav__link> RBD Asynchronous DR Failover and Failback </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_2 data-md-state=indeterminate type=checkbox id=__nav_3_2 checked> <label class=md-nav__link for=__nav_3_2> Shared Filesystem (CephFS) <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Shared Filesystem (CephFS)" data-md-level=2> <label class=md-nav__title for=__nav_3_2> <span class="md-nav__icon md-icon"></span> Shared Filesystem (CephFS) </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Shared-Filesystem-CephFS/filesystem-storage/ class=md-nav__link> Filesystem Storage Overview </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_3 data-md-state=indeterminate type=checkbox id=__nav_3_3 checked> <label class=md-nav__link for=__nav_3_3> Object Storage (RGW) <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Object Storage (RGW)" data-md-level=2> <label class=md-nav__title for=__nav_3_3> <span class="md-nav__icon md-icon"></span> Object Storage (RGW) </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Object-Storage-RGW/object-storage/ class=md-nav__link> Object Storage Overview </a> </li> <li class=md-nav__item> <a href=../Object-Storage-RGW/ceph-object-bucket-claim/ class=md-nav__link> Bucket Claim </a> </li> <li class=md-nav__item> <a href=../Object-Storage-RGW/ceph-object-bucket-notifications/ class=md-nav__link> Object Bucket Notifications </a> </li> <li class=md-nav__item> <a href=../Object-Storage-RGW/ceph-object-multisite/ class=md-nav__link> Object Store Multisite </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_4 data-md-state=indeterminate type=checkbox id=__nav_3_4 checked> <label class=md-nav__link for=__nav_3_4> Monitoring <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Monitoring data-md-level=2> <label class=md-nav__title for=__nav_3_4> <span class="md-nav__icon md-icon"></span> Monitoring </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Monitoring/ceph-dashboard/ class=md-nav__link> Ceph Dashboard </a> </li> <li class=md-nav__item> <a href=../Monitoring/ceph-monitoring/ class=md-nav__link> Prometheus Monitoring </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_5 data-md-state=indeterminate type=checkbox id=__nav_3_5 checked> <label class=md-nav__link for=__nav_3_5> Ceph CSI <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Ceph CSI" data-md-level=2> <label class=md-nav__title for=__nav_3_5> <span class="md-nav__icon md-icon"></span> Ceph CSI </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Ceph-CSI/ceph-csi-drivers/ class=md-nav__link> Ceph CSI Drivers </a> </li> <li class=md-nav__item> <a href=../Ceph-CSI/ceph-csi-snapshot/ class=md-nav__link> Snapshots </a> </li> <li class=md-nav__item> <a href=../Ceph-CSI/ceph-csi-volume-clone/ class=md-nav__link> Volume clone </a> </li> <li class=md-nav__item> <a href=../Ceph-CSI/custom-images/ class=md-nav__link> Custom Images </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Cleanup <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> Cleanup </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#cleaning-up-a-cluster class=md-nav__link> Cleaning up a Cluster </a> <nav class=md-nav aria-label="Cleaning up a Cluster"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#delete-the-block-and-file-artifacts class=md-nav__link> Delete the Block and File artifacts </a> </li> <li class=md-nav__item> <a href=#delete-the-cephcluster-crd class=md-nav__link> Delete the CephCluster CRD </a> </li> <li class=md-nav__item> <a href=#delete-the-operator-and-related-resources class=md-nav__link> Delete the Operator and related Resources </a> </li> <li class=md-nav__item> <a href=#delete-the-data-on-hosts class=md-nav__link> Delete the data on hosts </a> <nav class=md-nav aria-label="Delete the data on hosts"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#zapping-devices class=md-nav__link> Zapping Devices </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#troubleshooting class=md-nav__link> Troubleshooting </a> <nav class=md-nav aria-label=Troubleshooting> <ul class=md-nav__list> <li class=md-nav__item> <a href=#removing-the-cluster-crd-finalizer class=md-nav__link> Removing the Cluster CRD Finalizer </a> </li> <li class=md-nav__item> <a href=#remove-critical-resource-finalizers class=md-nav__link> Remove critical resource finalizers </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_7 data-md-state=indeterminate type=checkbox id=__nav_3_7 checked> <label class=md-nav__link for=__nav_3_7> Advanced <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Advanced data-md-level=2> <label class=md-nav__title for=__nav_3_7> <span class="md-nav__icon md-icon"></span> Advanced </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Advanced/ceph-configuration/ class=md-nav__link> Ceph Configuration </a> </li> <li class=md-nav__item> <a href=../Advanced/configuration/ class=md-nav__link> Configuration </a> </li> <li class=md-nav__item> <a href=../Advanced/key-management-system/ class=md-nav__link> Key Management System </a> </li> <li class=md-nav__item> <a href=../Advanced/ceph-osd-mgmt/ class=md-nav__link> Ceph OSD Management </a> </li> <li class=md-nav__item> <a href=../Advanced/ceph-mon-health/ class=md-nav__link> Monitor Health </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4 data-md-state=indeterminate type=checkbox id=__nav_4 checked> <label class=md-nav__link for=__nav_4> Custom Resources <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Custom Resources" data-md-level=1> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Custom Resources </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../CRDs/ceph-cluster-crd/ class=md-nav__link> Cluster CRD </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_2 data-md-state=indeterminate type=checkbox id=__nav_4_2 checked> <label class=md-nav__link for=__nav_4_2> Block Storage <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Block Storage" data-md-level=2> <label class=md-nav__title for=__nav_4_2> <span class="md-nav__icon md-icon"></span> Block Storage </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../CRDs/Block-Storage/ceph-block-pool-crd/ class=md-nav__link> Block Pool CRD </a> </li> <li class=md-nav__item> <a href=../../CRDs/Block-Storage/ceph-block-pool-rados-namespace-crd/ class=md-nav__link> Block Pool RADOS Namespace CRD </a> </li> <li class=md-nav__item> <a href=../../CRDs/Block-Storage/ceph-rbd-mirror-crd/ class=md-nav__link> RBD Mirror CRD </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_3 data-md-state=indeterminate type=checkbox id=__nav_4_3 checked> <label class=md-nav__link for=__nav_4_3> Shared Filesystem <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Shared Filesystem" data-md-level=2> <label class=md-nav__title for=__nav_4_3> <span class="md-nav__icon md-icon"></span> Shared Filesystem </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../CRDs/Shared-Filesystem/ceph-filesystem-crd/ class=md-nav__link> Filesystem CRD </a> </li> <li class=md-nav__item> <a href=../../CRDs/Shared-Filesystem/ceph-fs-mirror-crd/ class=md-nav__link> Filesystem Mirror CRD </a> </li> <li class=md-nav__item> <a href=../../CRDs/Shared-Filesystem/ceph-fs-subvolumegroup-crd/ class=md-nav__link> Filesystem SubVolume Group CRD </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_4 data-md-state=indeterminate type=checkbox id=__nav_4_4 checked> <label class=md-nav__link for=__nav_4_4> Object Storage <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Object Storage" data-md-level=2> <label class=md-nav__title for=__nav_4_4> <span class="md-nav__icon md-icon"></span> Object Storage </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../CRDs/Object-Storage/ceph-object-store-crd/ class=md-nav__link> Object Store CRD </a> </li> <li class=md-nav__item> <a href=../../CRDs/Object-Storage/ceph-object-store-user-crd/ class=md-nav__link> Object Store User CRD </a> </li> <li class=md-nav__item> <a href=../../CRDs/Object-Storage/ceph-object-multisite-crd/ class=md-nav__link> Object Multisite CRDs </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../CRDs/ceph-client-crd/ class=md-nav__link> Client CRD </a> </li> <li class=md-nav__item> <a href=../../CRDs/ceph-nfs-crd/ class=md-nav__link> NFS Server CRD </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_5 data-md-state=indeterminate type=checkbox id=__nav_5 checked> <label class=md-nav__link for=__nav_5> Troubleshooting <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Troubleshooting data-md-level=1> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Troubleshooting </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Troubleshooting/ceph-toolbox/ class=md-nav__link> Toolbox </a> </li> <li class=md-nav__item> <a href=../../Troubleshooting/common-issues/ class=md-nav__link> Common Issues </a> </li> <li class=md-nav__item> <a href=../../Troubleshooting/ceph-common-issues/ class=md-nav__link> Ceph Common Issues </a> </li> <li class=md-nav__item> <a href=../../Troubleshooting/ceph-csi-common-issues/ class=md-nav__link> CSI Common Issues </a> </li> <li class=md-nav__item> <a href=../../Troubleshooting/openshift-common-issues/ class=md-nav__link> OpenShift Common Issues </a> </li> <li class=md-nav__item> <a href=../../Troubleshooting/disaster-recovery/ class=md-nav__link> Disaster Recovery </a> </li> <li class=md-nav__item> <a href=../../Troubleshooting/direct-tools/ class=md-nav__link> Direct Tools </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_6 data-md-state=indeterminate type=checkbox id=__nav_6 checked> <label class=md-nav__link for=__nav_6> Upgrade <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Upgrade data-md-level=1> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Upgrade </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Upgrade/health-verification/ class=md-nav__link> Health Verification </a> </li> <li class=md-nav__item> <a href=../../Upgrade/rook-upgrade/ class=md-nav__link> Rook Upgrades </a> </li> <li class=md-nav__item> <a href=../../Upgrade/ceph-upgrade/ class=md-nav__link> Ceph Upgrades </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_7 data-md-state=indeterminate type=checkbox id=__nav_7 checked> <label class=md-nav__link for=__nav_7> Contributing <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Contributing data-md-level=1> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> Contributing </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Contributing/development-flow/ class=md-nav__link> Development Flow </a> </li> <li class=md-nav__item> <a href=../../Contributing/development-environment/ class=md-nav__link> Developer Environment </a> </li> <li class=md-nav__item> <a href=../../Contributing/documentation/ class=md-nav__link> Documentation </a> </li> <li class=md-nav__item> <a href=../../Contributing/storage-providers/ class=md-nav__link> Storage Providers </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#cleaning-up-a-cluster class=md-nav__link> Cleaning up a Cluster </a> <nav class=md-nav aria-label="Cleaning up a Cluster"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#delete-the-block-and-file-artifacts class=md-nav__link> Delete the Block and File artifacts </a> </li> <li class=md-nav__item> <a href=#delete-the-cephcluster-crd class=md-nav__link> Delete the CephCluster CRD </a> </li> <li class=md-nav__item> <a href=#delete-the-operator-and-related-resources class=md-nav__link> Delete the Operator and related Resources </a> </li> <li class=md-nav__item> <a href=#delete-the-data-on-hosts class=md-nav__link> Delete the data on hosts </a> <nav class=md-nav aria-label="Delete the data on hosts"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#zapping-devices class=md-nav__link> Zapping Devices </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#troubleshooting class=md-nav__link> Troubleshooting </a> <nav class=md-nav aria-label=Troubleshooting> <ul class=md-nav__list> <li class=md-nav__item> <a href=#removing-the-cluster-crd-finalizer class=md-nav__link> Removing the Cluster CRD Finalizer </a> </li> <li class=md-nav__item> <a href=#remove-critical-resource-finalizers class=md-nav__link> Remove critical resource finalizers </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/rook/rook/edit/master/Documentation/Storage-Configuration/ceph-teardown.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg> </a> <h1>Cleanup</h1> <h2 id=cleaning-up-a-cluster>Cleaning up a Cluster<a class=headerlink href=#cleaning-up-a-cluster title="Permanent link">&para;</a></h2> <p>If you want to tear down the cluster and bring up a new one, be aware of the following resources that will need to be cleaned up:</p> <ul> <li><code>rook-ceph</code> namespace: The Rook operator and cluster created by <code>operator.yaml</code> and <code>cluster.yaml</code> (the cluster CRD)</li> <li><code>/var/lib/rook</code>: Path on each host in the cluster where configuration is cached by the ceph mons and osds</li> </ul> <p>Note that if you changed the default namespaces or paths such as <code>dataDirHostPath</code> in the sample yaml files, you will need to adjust these namespaces and paths throughout these instructions.</p> <p>If you see issues tearing down the cluster, see the <a href=#troubleshooting>Troubleshooting</a> section below.</p> <p>If you are tearing down a cluster frequently for development purposes, it is instead recommended to use an environment such as Minikube that can easily be reset without worrying about any of these steps.</p> <h3 id=delete-the-block-and-file-artifacts>Delete the Block and File artifacts<a class=headerlink href=#delete-the-block-and-file-artifacts title="Permanent link">&para;</a></h3> <p>First you will need to clean up the resources created on top of the Rook cluster.</p> <p>These commands will clean up the resources from the <a href=../Block-Storage-RBD/block-storage/#teardown>block</a> and <a href=../Shared-Filesystem-CephFS/filesystem-storage/#teardown>file</a> walkthroughs (unmount volumes, delete volume claims, etc). If you did not complete those parts of the walkthrough, you can skip these instructions:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-1>1</a></span>
<span class=normal><a href=#__codelineno-0-2>2</a></span>
<span class=normal><a href=#__codelineno-0-3>3</a></span>
<span class=normal><a href=#__codelineno-0-4>4</a></span>
<span class=normal><a href=#__codelineno-0-5>5</a></span>
<span class=normal><a href=#__codelineno-0-6>6</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-0-1 name=__codelineno-0-1></a><span class=go>kubectl delete -f ../wordpress.yaml</span>
<a id=__codelineno-0-2 name=__codelineno-0-2></a><span class=go>kubectl delete -f ../mysql.yaml</span>
<a id=__codelineno-0-3 name=__codelineno-0-3></a><span class=go>kubectl delete -n rook-ceph cephblockpool replicapool</span>
<a id=__codelineno-0-4 name=__codelineno-0-4></a><span class=go>kubectl delete storageclass rook-ceph-block</span>
<a id=__codelineno-0-5 name=__codelineno-0-5></a><span class=go>kubectl delete -f csi/cephfs/kube-registry.yaml</span>
<a id=__codelineno-0-6 name=__codelineno-0-6></a><span class=go>kubectl delete storageclass csi-cephfs</span>
</code></pre></div></td></tr></table></div> <p>After those block and file resources have been cleaned up, you can then delete your Rook cluster. This is important to delete <strong>before removing the Rook operator and agent or else resources may not be cleaned up properly</strong>.</p> <h3 id=delete-the-cephcluster-crd>Delete the CephCluster CRD<a class=headerlink href=#delete-the-cephcluster-crd title="Permanent link">&para;</a></h3> <p>Edit the <code>CephCluster</code> and add the <code>cleanupPolicy</code></p> <p>WARNING: DATA WILL BE PERMANENTLY DELETED AFTER DELETING THE <code>CephCluster</code> CR WITH <code>cleanupPolicy</code>.</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-1-1>1</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-1-1 name=__codelineno-1-1></a><span class=go>kubectl -n rook-ceph patch cephcluster rook-ceph --type merge -p &#39;{&quot;spec&quot;:{&quot;cleanupPolicy&quot;:{&quot;confirmation&quot;:&quot;yes-really-destroy-data&quot;}}}&#39;</span>
</code></pre></div></td></tr></table></div> <p>Once the cleanup policy is enabled, any new configuration changes in the CephCluster will be blocked. Nothing will happen until the deletion of the CR is requested, so this <code>cleanupPolicy</code> change can still be reverted if needed.</p> <p>Checkout more details about the <code>cleanupPolicy</code> <a href=../../CRDs/ceph-cluster-crd/#cleanup-policy>here</a></p> <p>Delete the <code>CephCluster</code> CR.</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-2-1>1</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-2-1 name=__codelineno-2-1></a><span class=go>kubectl -n rook-ceph delete cephcluster rook-ceph</span>
</code></pre></div></td></tr></table></div> <p>Verify that the cluster CR has been deleted before continuing to the next step.</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-3-1>1</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-3-1 name=__codelineno-3-1></a><span class=go>kubectl -n rook-ceph get cephcluster</span>
</code></pre></div></td></tr></table></div> <p>If the <code>cleanupPolicy</code> was applied, then wait for the <code>rook-ceph-cleanup</code> jobs to be completed on all the nodes. These jobs will perform the following operations:</p> <ul> <li>Delete the directory <code>/var/lib/rook</code> (or the path specified by the <code>dataDirHostPath</code>) on all the nodes</li> <li>Wipe the data on the drives on all the nodes where OSDs were running in this cluster</li> </ul> <p>Note: The cleanup jobs might not start if the resources created on top of Rook Cluster are not deleted completely. <a href=#delete-the-block-and-file-artifacts>See</a></p> <h3 id=delete-the-operator-and-related-resources>Delete the Operator and related Resources<a class=headerlink href=#delete-the-operator-and-related-resources title="Permanent link">&para;</a></h3> <p>This will begin the process of the Rook Ceph operator and all other resources being cleaned up. This includes related resources such as the agent and discover daemonsets with the following commands:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-4-1>1</a></span>
<span class=normal><a href=#__codelineno-4-2>2</a></span>
<span class=normal><a href=#__codelineno-4-3>3</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-4-1 name=__codelineno-4-1></a><span class=go>kubectl delete -f operator.yaml</span>
<a id=__codelineno-4-2 name=__codelineno-4-2></a><span class=go>kubectl delete -f common.yaml</span>
<a id=__codelineno-4-3 name=__codelineno-4-3></a><span class=go>kubectl delete -f crds.yaml</span>
</code></pre></div></td></tr></table></div> <p>If the <code>cleanupPolicy</code> was applied and the cleanup jobs have completed on all the nodes, then the cluster tear down has been successful. If you skipped adding the <code>cleanupPolicy</code> then follow the manual steps mentioned below to tear down the cluster.</p> <h3 id=delete-the-data-on-hosts>Delete the data on hosts<a class=headerlink href=#delete-the-data-on-hosts title="Permanent link">&para;</a></h3> <div class="admonition attention"> <p class=admonition-title>Attention</p> <p>The final cleanup step requires deleting files on each host in the cluster. All files under the <code>dataDirHostPath</code> property specified in the cluster CRD will need to be deleted. Otherwise, inconsistent state will remain when a new cluster is started.</p> </div> <p>Connect to each machine and delete <code>/var/lib/rook</code>, or the path specified by the <code>dataDirHostPath</code>.</p> <p>In the future this step will not be necessary when we build on the K8s local storage feature.</p> <p>If you modified the demo settings, additional cleanup is up to you for devices, host paths, etc.</p> <h4 id=zapping-devices>Zapping Devices<a class=headerlink href=#zapping-devices title="Permanent link">&para;</a></h4> <p>Disks on nodes used by Rook for osds can be reset to a usable state with methods suggested below. Note that these scripts are not one-size-fits-all. Please use them with discretion to ensure you are not removing data unrelated to Rook and/or Ceph.</p> <p>Disks can be zapped fairly easily. A single disk can usually be cleared with some or all of the steps below.</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-5-1> 1</a></span>
<span class=normal><a href=#__codelineno-5-2> 2</a></span>
<span class=normal><a href=#__codelineno-5-3> 3</a></span>
<span class=normal><a href=#__codelineno-5-4> 4</a></span>
<span class=normal><a href=#__codelineno-5-5> 5</a></span>
<span class=normal><a href=#__codelineno-5-6> 6</a></span>
<span class=normal><a href=#__codelineno-5-7> 7</a></span>
<span class=normal><a href=#__codelineno-5-8> 8</a></span>
<span class=normal><a href=#__codelineno-5-9> 9</a></span>
<span class=normal><a href=#__codelineno-5-10>10</a></span>
<span class=normal><a href=#__codelineno-5-11>11</a></span>
<span class=normal><a href=#__codelineno-5-12>12</a></span>
<span class=normal><a href=#__codelineno-5-13>13</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-5-1 name=__codelineno-5-1></a><span class=go>DISK=&quot;/dev/sdX&quot;</span>
<a id=__codelineno-5-2 name=__codelineno-5-2></a>
<a id=__codelineno-5-3 name=__codelineno-5-3></a><span class=gp># </span>Zap the disk to a fresh, usable state <span class=o>(</span>zap-all is important, b/c MBR has to be clean<span class=o>)</span>
<a id=__codelineno-5-4 name=__codelineno-5-4></a><span class=go>sgdisk --zap-all $DISK</span>
<a id=__codelineno-5-5 name=__codelineno-5-5></a>
<a id=__codelineno-5-6 name=__codelineno-5-6></a><span class=gp># </span>Wipe a large portion of the beginning of the disk to remove more LVM metadata that may be present
<a id=__codelineno-5-7 name=__codelineno-5-7></a><span class=go>dd if=/dev/zero of=&quot;$DISK&quot; bs=1M count=100 oflag=direct,dsync</span>
<a id=__codelineno-5-8 name=__codelineno-5-8></a>
<a id=__codelineno-5-9 name=__codelineno-5-9></a><span class=gp># </span>SSDs may be better cleaned with blkdiscard instead of dd
<a id=__codelineno-5-10 name=__codelineno-5-10></a><span class=go>blkdiscard $DISK</span>
<a id=__codelineno-5-11 name=__codelineno-5-11></a>
<a id=__codelineno-5-12 name=__codelineno-5-12></a><span class=gp># </span>Inform the OS of partition table changes
<a id=__codelineno-5-13 name=__codelineno-5-13></a><span class=go>partprobe $DISK</span>
</code></pre></div></td></tr></table></div> <p>Ceph can leave LVM and device mapper data that can lock the disks, preventing the disks from being used again. These steps can help to free up old Ceph disks for re-use. Note that this only needs to be run once on each node and assumes that <strong>all</strong> Ceph disks are being wiped. If only some disks are being wiped, you will have to manually determine which disks map to which device mapper devices.</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-6-1>1</a></span>
<span class=normal><a href=#__codelineno-6-2>2</a></span>
<span class=normal><a href=#__codelineno-6-3>3</a></span>
<span class=normal><a href=#__codelineno-6-4>4</a></span>
<span class=normal><a href=#__codelineno-6-5>5</a></span>
<span class=normal><a href=#__codelineno-6-6>6</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-6-1 name=__codelineno-6-1></a><span class=gp># </span>This <span class=nb>command</span> hangs on some systems: with caution, <span class=s1>&#39;dmsetup remove_all --force&#39;</span> can be used
<a id=__codelineno-6-2 name=__codelineno-6-2></a><span class=go>ls /dev/mapper/ceph-* | xargs -I% -- dmsetup remove %</span>
<a id=__codelineno-6-3 name=__codelineno-6-3></a>
<a id=__codelineno-6-4 name=__codelineno-6-4></a><span class=gp># </span>ceph-volume setup can leave ceph-&lt;UUID&gt; directories <span class=k>in</span> /dev and /dev/mapper <span class=o>(</span>unnecessary clutter<span class=o>)</span>
<a id=__codelineno-6-5 name=__codelineno-6-5></a><span class=go>rm -rf /dev/ceph-*</span>
<a id=__codelineno-6-6 name=__codelineno-6-6></a><span class=go>rm -rf /dev/mapper/ceph--*</span>
</code></pre></div></td></tr></table></div> <p>If disks are still reported locked, rebooting the node often helps clear LVM-related holds on disks.</p> <h3 id=troubleshooting>Troubleshooting<a class=headerlink href=#troubleshooting title="Permanent link">&para;</a></h3> <p>If the cleanup instructions are not executed in the order above, or you otherwise have difficulty cleaning up the cluster, here are a few things to try.</p> <p>The most common issue cleaning up the cluster is that the <code>rook-ceph</code> namespace or the cluster CRD remain indefinitely in the <code>terminating</code> state. A namespace cannot be removed until all of its resources are removed, so look at which resources are pending termination.</p> <p>Look at the pods:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-7-1>1</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-7-1 name=__codelineno-7-1></a><span class=go>kubectl -n rook-ceph get pod</span>
</code></pre></div></td></tr></table></div> <p>If a pod is still terminating, you will need to wait or else attempt to forcefully terminate it (<code>kubectl delete pod &lt;name&gt;</code>).</p> <p>Now look at the cluster CRD:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-8-1>1</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-8-1 name=__codelineno-8-1></a><span class=go>kubectl -n rook-ceph get cephcluster</span>
</code></pre></div></td></tr></table></div> <p>If the cluster CRD still exists even though you have executed the delete command earlier, see the next section on removing the finalizer.</p> <h4 id=removing-the-cluster-crd-finalizer>Removing the Cluster CRD Finalizer<a class=headerlink href=#removing-the-cluster-crd-finalizer title="Permanent link">&para;</a></h4> <p>When a Cluster CRD is created, a <a href=https://kubernetes.io/docs/tasks/access-kubernetes-api/extend-api-custom-resource-definitions/#finalizers>finalizer</a> is added automatically by the Rook operator. The finalizer will allow the operator to ensure that before the cluster CRD is deleted, all block and file mounts will be cleaned up. Without proper cleanup, pods consuming the storage will be hung indefinitely until a system reboot.</p> <p>The operator is responsible for removing the finalizer after the mounts have been cleaned up. If for some reason the operator is not able to remove the finalizer (i.e., the operator is not running anymore), you can delete the finalizer manually with the following command:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-9-1>1</a></span>
<span class=normal><a href=#__codelineno-9-2>2</a></span>
<span class=normal><a href=#__codelineno-9-3>3</a></span>
<span class=normal><a href=#__codelineno-9-4>4</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-9-1 name=__codelineno-9-1></a><span class=go>for CRD in $(kubectl get crd -n rook-ceph | awk &#39;/ceph.rook.io/ {print $1}&#39;); do</span>
<a id=__codelineno-9-2 name=__codelineno-9-2></a><span class=go>    kubectl get -n rook-ceph &quot;$CRD&quot; -o name | \</span>
<a id=__codelineno-9-3 name=__codelineno-9-3></a><span class=go>    xargs -I {} kubectl patch -n rook-ceph {} --type merge -p &#39;{&quot;metadata&quot;:{&quot;finalizers&quot;: [null]}}&#39;</span>
<a id=__codelineno-9-4 name=__codelineno-9-4></a><span class=go>done</span>
</code></pre></div></td></tr></table></div> <p>This command will patch the following CRDs on v1.3:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-10-1>1</a></span>
<span class=normal><a href=#__codelineno-10-2>2</a></span>
<span class=normal><a href=#__codelineno-10-3>3</a></span>
<span class=normal><a href=#__codelineno-10-4>4</a></span>
<span class=normal><a href=#__codelineno-10-5>5</a></span>
<span class=normal><a href=#__codelineno-10-6>6</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-10-1 name=__codelineno-10-1></a><span class=go>cephblockpools.ceph.rook.io</span>
<a id=__codelineno-10-2 name=__codelineno-10-2></a><span class=go>cephclients.ceph.rook.io</span>
<a id=__codelineno-10-3 name=__codelineno-10-3></a><span class=go>cephfilesystems.ceph.rook.io</span>
<a id=__codelineno-10-4 name=__codelineno-10-4></a><span class=go>cephnfses.ceph.rook.io</span>
<a id=__codelineno-10-5 name=__codelineno-10-5></a><span class=go>cephobjectstores.ceph.rook.io</span>
<a id=__codelineno-10-6 name=__codelineno-10-6></a><span class=go>cephobjectstoreusers.ceph.rook.io</span>
</code></pre></div></td></tr></table></div> <p>Within a few seconds you should see that the cluster CRD has been deleted and will no longer block other cleanup such as deleting the <code>rook-ceph</code> namespace.</p> <p>If the namespace is still stuck in Terminating state, you can check which resources are holding up the deletion and remove the finalizers and delete those</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-11-1>1</a></span>
<span class=normal><a href=#__codelineno-11-2>2</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-11-1 name=__codelineno-11-1></a><span class=go>kubectl api-resources --verbs=list --namespaced -o name \</span>
<a id=__codelineno-11-2 name=__codelineno-11-2></a><span class=go>  | xargs -n 1 kubectl get --show-kind --ignore-not-found -n rook-ceph</span>
</code></pre></div></td></tr></table></div> <h4 id=remove-critical-resource-finalizers>Remove critical resource finalizers<a class=headerlink href=#remove-critical-resource-finalizers title="Permanent link">&para;</a></h4> <p>Rook adds a finalizer <code>ceph.rook.io/disaster-protection</code> to resources critical to the Ceph cluster so that the resources will not be accidentally deleted.</p> <p>The operator is responsible for removing the finalizers when a CephCluster is deleted. If for some reason the operator is not able to remove the finalizers (i.e., the operator is not running anymore), you can remove the finalizers manually with the following commands:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-12-1>1</a></span>
<span class=normal><a href=#__codelineno-12-2>2</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-12-1 name=__codelineno-12-1></a><span class=go>kubectl -n rook-ceph patch configmap rook-ceph-mon-endpoints --type merge -p &#39;{&quot;metadata&quot;:{&quot;finalizers&quot;: [null]}}&#39;</span>
<a id=__codelineno-12-2 name=__codelineno-12-2></a><span class=go>kubectl -n rook-ceph patch secrets rook-ceph-mon --type merge -p &#39;{&quot;metadata&quot;:{&quot;finalizers&quot;: [null]}}&#39;</span>
</code></pre></div></td></tr></table></div> </article> </div> </div> <a href=# class="md-top md-icon" data-md-component=top data-md-state=hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg> Back to top </a> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../Ceph-CSI/custom-images/ class="md-footer__link md-footer__link--prev" aria-label="Previous: Custom Images" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Previous </span> Custom Images </div> </div> </a> <a href=../Advanced/ceph-configuration/ class="md-footer__link md-footer__link--next" aria-label="Next: Ceph Configuration" rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Next </span> Ceph Configuration </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> <a href=/ class=logo> <img src=https://rook.io/images/rook-logo-small.svg alt="rook.io logo"> </a> <p> &#169; Rook Authors 2022. Documentation distributed under <a href=https://creativecommons.org/licenses/by/4.0>CC-BY-4.0</a>. </p> <p> &#169; 2022 The Linux Foundation. All rights reserved. The Linux Foundation has registered trademarks and uses trademarks. For a list of trademarks of The Linux Foundation, please see our <a href=https://www.linuxfoundation.org/trademark-usage/ >Trademark Usage</a> page. </p> </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://slack.rook.io/ target=_blank rel=noopener title=slack.rook.io class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M94.12 315.1c0 25.9-21.16 47.06-47.06 47.06S0 341 0 315.1c0-25.9 21.16-47.06 47.06-47.06h47.06v47.06zm23.72 0c0-25.9 21.16-47.06 47.06-47.06s47.06 21.16 47.06 47.06v117.84c0 25.9-21.16 47.06-47.06 47.06s-47.06-21.16-47.06-47.06V315.1zm47.06-188.98c-25.9 0-47.06-21.16-47.06-47.06S139 32 164.9 32s47.06 21.16 47.06 47.06v47.06H164.9zm0 23.72c25.9 0 47.06 21.16 47.06 47.06s-21.16 47.06-47.06 47.06H47.06C21.16 243.96 0 222.8 0 196.9s21.16-47.06 47.06-47.06H164.9zm188.98 47.06c0-25.9 21.16-47.06 47.06-47.06 25.9 0 47.06 21.16 47.06 47.06s-21.16 47.06-47.06 47.06h-47.06V196.9zm-23.72 0c0 25.9-21.16 47.06-47.06 47.06-25.9 0-47.06-21.16-47.06-47.06V79.06c0-25.9 21.16-47.06 47.06-47.06 25.9 0 47.06 21.16 47.06 47.06V196.9zM283.1 385.88c25.9 0 47.06 21.16 47.06 47.06 0 25.9-21.16 47.06-47.06 47.06-25.9 0-47.06-21.16-47.06-47.06v-47.06h47.06zm0-23.72c-25.9 0-47.06-21.16-47.06-47.06 0-25.9 21.16-47.06 47.06-47.06h117.84c25.9 0 47.06 21.16 47.06 47.06 0 25.9-21.16 47.06-47.06 47.06H283.1z"/></svg> </a> <a href=https://twitter.com/rook_io target=_blank rel=noopener title=twitter.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg> </a> <a href=https://groups.google.com/forum/#!forum/rook-dev target=_blank rel=noopener title=groups.google.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 640 512"><!-- Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M191.9 448.6a47.726 47.726 0 0 1-27.78-8.891L32 340.2V480c0 17.62 14.38 32 32 32h256c17.62 0 32-14.38 32-32V340.2l-131.8 99.3a48.4 48.4 0 0 1-28.3 9.1zM192 192c0-35.25 28.75-64 64-64h224V32c0-17.62-14.38-32-32-32H128c-17.6 0-32 14.38-32 32v192h96v-32zm128 64H64c-17.62 0-32 14.4-32 32v12.18l151 113.8c5.25 3.719 12.7 3.734 18.27-.25L352 300.2V288c0-17.6-14.4-32-32-32zm256-96H256c-17.6 0-32 14.4-32 32v32h96c33.25 0 60.63 25.38 63.75 57.88L384 416h192c17.62 0 32-14.38 32-32V192c0-17.6-14.4-32-32-32zm-32 128h-64v-64h64v64z"/></svg> </a> <a href=https://blog.rook.io/ target=_blank rel=noopener title=blog.rook.io class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 640 512"><!-- Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M180.5 74.262C80.813 74.262 0 155.633 0 256s80.819 181.738 180.5 181.738S361 356.373 361 256 280.191 74.262 180.5 74.262Zm288.25 10.646c-49.845 0-90.245 76.619-90.245 171.095s40.406 171.1 90.251 171.1 90.251-76.619 90.251-171.1H559c0-94.503-40.4-171.095-90.248-171.095Zm139.506 17.821c-17.526 0-31.735 68.628-31.735 153.274s14.2 153.274 31.735 153.274S640 340.631 640 256c0-84.649-14.215-153.271-31.742-153.271Z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["content.tabs.link", "instant", "navigation.expand", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest", "tabs"], "search": "../../assets/javascripts/workers/search.2a1c317c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "version": {"default": "latest-release", "provider": "mike"}}</script> <script src=../../assets/javascripts/bundle.a6c66575.min.js></script> </body> </html>