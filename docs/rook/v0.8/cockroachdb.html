












































<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />

    
    <meta name="robots" content="noindex">
    

    <title>Ceph Docs</title>

    <link rel="canonical" href="https://rook.io/docs/rook/v0.8/cockroachdb.html">

    <link rel="icon" href="/favicon.ico" />
<link rel="icon" type="image/png" href="/images/favicon_16x16.png" sizes="16x16" />
<link rel="icon" type="image/png" href="/images/favicon_32x32.png" sizes="32x32" />
<link rel="icon" type="image/png" href="/images/favicon_48x48.png" sizes="48x48" />
<link rel="icon" type="image/png" href="/images/favicon_192x192.png" sizes="192x192" />


    <link href="//fonts.googleapis.com/css?family=Montserrat:500|Open+Sans:300,400,600" rel="stylesheet">
    
    <link rel="stylesheet" href="/css/main.css">
    
      <link rel="stylesheet" href="/css/docs.css" />
    
  </head>
  <body>
    <nav id="navigation" aria-label="Navigation">
  <div>
    <div class="logo">
      <a href="/"><img src="/images/rook-logo.svg"/></a>
    </div>
    <div
      class="hamburger-controls"
      onclick="if (document.body.classList.contains('menu-open')) { document.body.classList.remove('menu-open') } else { document.body.classList.add('menu-open') }; return false;">
      <span></span> <span></span> <span></span>
    </div>
    <ul class="links">
      <li class="dropdown">
        <a role="button" href="javascript:void(0)">Documentation</a>
        <div class="dropdown-content">
          <a href="/docs/rook/v1.9/">Ceph</a>
          <a href="/docs/cassandra/v1.7/">Cassandra</a>
          <a href="/docs/nfs/v1.7/">NFS</a>
        </div>
      <li class="dropdown">
        <a role="button" href="javascript:void(0)">Community</a>
        <div class="dropdown-content">
          <a href="//github.com/rook/rook">GitHub</a>
          <a href="//slack.rook.io/">Slack</a>
          <a href="//groups.google.com/forum/#!forum/rook-dev">Forum</a>
          <a href="//twitter.com/rook_io">Twitter</a>
        </div>
      </li>
      <li><a href="//blog.rook.io/">Blog</a></li>
      <li><a class="button small" href="/docs/rook/v1.9/quickstart.html">Get Started</a></li>
    </ul>
  </div>
</nav>

    <main id="content" aria-label="Content"><div>



















<section class="docs-header">
  <h1>Ceph</h1>
  <div class="versions">
    <a role="button" href="javascript:void(0)">Rook Ceph v0.8</a>
    <div class="versions-dropdown-content">
      
        <a href="/docs/rook/v1.9/cockroachdb.html">Rook Ceph v1.9</a>
      
        <a href="/docs/rook/v1.8/cockroachdb.html">Rook Ceph v1.8</a>
      
        <a href="/docs/rook/v1.7/cockroachdb.html">Rook Ceph v1.7</a>
      
        <a href="/docs/rook/v1.6/cockroachdb.html">Rook Ceph v1.6</a>
      
        <a href="/docs/rook/v1.5/cockroachdb.html">Rook Ceph v1.5</a>
      
        <a href="/docs/rook/v1.4/cockroachdb.html">Rook Ceph v1.4</a>
      
        <a href="/docs/rook/v1.3/cockroachdb.html">Rook Ceph v1.3</a>
      
        <a href="/docs/rook/v1.2/cockroachdb.html">Rook Ceph v1.2</a>
      
        <a href="/docs/rook/v1.1/cockroachdb.html">Rook Ceph v1.1</a>
      
        <a href="/docs/rook/v1.0/cockroachdb.html">Rook Ceph v1.0</a>
      
        <a href="/docs/rook/v0.9/cockroachdb.html">Rook Ceph v0.9</a>
      
        <a href="/docs/rook/v0.8/cockroachdb.html" class="active">Rook Ceph v0.8</a>
      
        <a href="/docs/rook/v0.7/cockroachdb.html">Rook Ceph v0.7</a>
      
        <a href="/docs/rook/v0.6/cockroachdb.html">Rook Ceph v0.6</a>
      
        <a href="/docs/rook/v0.5/cockroachdb.html">Rook Ceph v0.5</a>
      
        <a href="/docs/rook/latest/cockroachdb.html">Rook Ceph latest</a>
      
    </div>
    <img src="/images/arrow.svg" />
  </div>
</section>
<div class="page">
  <div class="docs-menu">
      <ul id="docs-ul"></ul>
  </div>
  <div class="docs-content">
    <div class="docs-actions">
      <a id="edit" href="https://github.com/rook/rook/blob/master/Documentation/cockroachdb.md">Edit on GitHub</a>
    </div>
    
      <div class="alert old">
        <p><b>PLEASE NOTE</b>: This document applies to v0.8 version and not to the latest <strong>stable</strong> release v1.9</p>
      </div>
    
    <div class="docs-text">
      <h1 id="cockroachdb-quickstart">CockroachDB Quickstart</h1>

<p>CockroachDB is a cloud-native SQL database for building global, scalable cloud services that survive disasters.
Rook provides an operator to deploy and manage CockroachDB clusters.</p>

<h2 id="prerequisites">Prerequisites</h2>

<p>A Kubernetes cluster is necessary to run the Rook CockroachDB operator.
To make sure you have a Kubernetes cluster that is ready for <code class="language-plaintext highlighter-rouge">Rook</code>, you can <a href="/docs/rook/v0.8/k8s-pre-reqs.html">follow these instructions</a>.</p>

<h2 id="deploy-cockroachdb-operator">Deploy CockroachDB Operator</h2>

<p>First deploy the Rook CockroachDB operator using the following commands:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">cd cluster/examples/kubernetes/cockroachdb
kubectl create -f operator.yaml
</span></code></pre></div></div>

<p>You can check if the operator is up and running with:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go"> kubectl -n rook-cockroachdb-system get pod
</span></code></pre></div></div>

<h2 id="create-and-initialize-cockroachdb-cluster">Create and Initialize CockroachDB Cluster</h2>

<p>Now that the operator is running, we can create an instance of a CockroachDB cluster by creating an instance of the <code class="language-plaintext highlighter-rouge">cluster.cockroachdb.rook.io</code> resource.
Some of that resource’s values are configurable, so feel free to browse <code class="language-plaintext highlighter-rouge">cluster.yaml</code> and tweak the settings to your liking.
Full details for all the configuration options can be found in the <a href="/docs/rook/v0.8/cockroachdb-cluster-crd.html">CockroachDB Cluster CRD documentation</a>.</p>

<p>When you are ready to create a CockroachDB cluster, simply run:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">kubectl create -f cluster.yaml
</span></code></pre></div></div>

<p>We can verify that a Kubernetes object has been created that represents our new CockroachDB cluster with the command below.
This is important because it shows that Rook has successfully extended Kubernetes to make CockroachDB clusters a first class citizen in the Kubernetes cloud-native environment.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">kubectl -n rook-cockroachdb get clusters.cockroachdb.rook.io
</span></code></pre></div></div>

<p>To check if all the desired replicas are running, you should see the same number of entries from the following command as the replica count that was specified in <code class="language-plaintext highlighter-rouge">cluster.yaml</code>:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">kubectl -n rook-cockroachdb get pod -l app=rook-cockroachdb
</span></code></pre></div></div>

<h2 id="accessing-the-database">Accessing the Database</h2>

<p>To use the <code class="language-plaintext highlighter-rouge">cockroach sql</code> client to connect to the database cluster, run the following command in its entirety:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">kubectl -n rook-cockroachdb-system exec -it $</span><span class="o">(</span>kubectl <span class="nt">-n</span> rook-cockroachdb-system get pod <span class="nt">-l</span> <span class="nv">app</span><span class="o">=</span>rook-cockroachdb-operator <span class="nt">-o</span> <span class="nv">jsonpath</span><span class="o">=</span><span class="s1">'{.items[0].metadata.name}'</span><span class="o">)</span> <span class="nt">--</span> /cockroach/cockroach sql <span class="nt">--insecure</span> <span class="nt">--host</span><span class="o">=</span>cockroachdb-public.rook-cockroachdb
</code></pre></div></div>

<p>This will land you in a prompt where you can begin to run SQL commands directly on the database cluster.
For example:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">root@cockroachdb-public.rook-cockroachdb:26257/&gt;</span><span class="w"> </span>show databases<span class="p">;</span>
<span class="go">+----------+
| Database |
+----------+
| system   |
| test     |
+----------+
(2 rows)

Time: 2.105065ms
</span></code></pre></div></div>

<h2 id="example-app">Example App</h2>

<p>If you want to run an example application to exercise your new CockroachDB cluster, there is a load generator application in the same directory as the operator and cluster resource files.
The load generator will start writing random key-value pairs to the database cluster, verifying that the cluster is functional and can handle reads and writes.</p>

<p>The rate at which the load generator writes data is configurable, so feel free to tweak the values in <code class="language-plaintext highlighter-rouge">loadgen-kv.yaml</code>.
Setting <code class="language-plaintext highlighter-rouge">--max-rate=0</code> will enable the load generator to go as fast as it can, putting a large amount of load onto your database cluster.</p>

<p>To run the load generator example app, simply run:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">kubectl create -f loadgen-kv.yaml
</span></code></pre></div></div>

<p>You can check on the progress and statistics of the load generator by running:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go"> kubectl -n rook-cockroachdb logs -l app=loadgen
</span></code></pre></div></div>

<p>To connect to the database and view the data that the load generator has written, run the following command:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">kubectl -n rook-cockroachdb-system exec -it $</span><span class="o">(</span>kubectl <span class="nt">-n</span> rook-cockroachdb-system get pod <span class="nt">-l</span> <span class="nv">app</span><span class="o">=</span>rook-cockroachdb-operator <span class="nt">-o</span> <span class="nv">jsonpath</span><span class="o">=</span><span class="s1">'{.items[0].metadata.name}'</span><span class="o">)</span> <span class="nt">--</span> /cockroach/cockroach sql <span class="nt">--insecure</span> <span class="nt">--host</span><span class="o">=</span>cockroachdb-public.rook-cockroachdb <span class="nt">-d</span> <span class="nb">test</span> <span class="nt">-e</span> <span class="s1">'select * from kv'</span>
</code></pre></div></div>

<h2 id="clean-up">Clean up</h2>

<p>To clean up all resources associated with this walk-through, you can run the commands below.</p>

<p><strong>NOTE:</strong> that this will destroy your database and delete all of its associated data.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">kubectl delete -f loadgen-kv.yaml
kubectl delete -f cluster.yaml
kubectl delete -f operator.yaml
</span></code></pre></div></div>

<h2 id="troubleshooting">Troubleshooting</h2>

<p>If the cluster does not come up, the first step would be to examine the operator’s logs:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">kubectl -n rook-cockroachdb-system logs -l app=rook-cockroachdb-operator
</span></code></pre></div></div>

<p>If everything looks OK in the operator logs, you can also look in the logs for one of the CockroachDB instances:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">kubectl -n rook-cockroachdb logs rook-cockroachdb-0
</span></code></pre></div></div>

    </div>
  </div>
</div>

<script>
  var menu = [];
  var BASE_PATH = "";

  function add(name, url, isChild, current) {
    var item = { name: name, url: url, current: current };
    var container = menu;
    if (isChild && menu.length > 0) {
      menu[menu.length-1].children = menu[menu.length-1].children || [];
      container = menu[menu.length-1].children;
      if (current) {
        menu[menu.length-1].childCurrent = true;
      }
    }
    container.push(item);
  }

  
    add(
      "Rook",
      "/docs/rook/v0.8/",
      false,
      false
    );
  
    add(
      "Quickstart",
      "/docs/rook/v0.8/quickstart-toc.html",
      false,
      false
    );
  
    add(
      "Ceph Storage",
      "/docs/rook/v0.8/ceph-quickstart.html",
      true,
      false
    );
  
    add(
      "Ceph Cleanup",
      "/docs/rook/v0.8/ceph-teardown.html",
      true,
      false
    );
  
    add(
      "CockroachDB",
      "/docs/rook/v0.8/cockroachdb.html",
      true,
      true
    );
  
    add(
      "Minio Object Store",
      "/docs/rook/v0.8/minio-object-store.html",
      true,
      false
    );
  
    add(
      "Prerequisites",
      "/docs/rook/v0.8/k8s-pre-reqs.html",
      false,
      false
    );
  
    add(
      "FlexVolume Configuration",
      "/docs/rook/v0.8/flexvolume.html",
      true,
      false
    );
  
    add(
      "RBAC Security",
      "/docs/rook/v0.8/rbac.html",
      true,
      false
    );
  
    add(
      "Tectonic Bare Metal",
      "/docs/rook/v0.8/tectonic.html",
      true,
      false
    );
  
    add(
      "OpenShift",
      "/docs/rook/v0.8/openshift.html",
      true,
      false
    );
  
    add(
      "Ceph Storage",
      "/docs/rook/v0.8/storage.html",
      false,
      false
    );
  
    add(
      "Block Storage",
      "/docs/rook/v0.8/block.html",
      true,
      false
    );
  
    add(
      "Object Storage",
      "/docs/rook/v0.8/object.html",
      true,
      false
    );
  
    add(
      "Shared File System",
      "/docs/rook/v0.8/filesystem.html",
      true,
      false
    );
  
    add(
      "Custom Resources",
      "/docs/rook/v0.8/crds.html",
      false,
      false
    );
  
    add(
      "Ceph Cluster",
      "/docs/rook/v0.8/ceph-cluster-crd.html",
      true,
      false
    );
  
    add(
      "Ceph Pool",
      "/docs/rook/v0.8/ceph-pool-crd.html",
      true,
      false
    );
  
    add(
      "Ceph Object Store",
      "/docs/rook/v0.8/ceph-object-store-crd.html",
      true,
      false
    );
  
    add(
      "Ceph Shared File System",
      "/docs/rook/v0.8/ceph-filesystem-crd.html",
      true,
      false
    );
  
    add(
      "CockroachDB Cluster",
      "/docs/rook/v0.8/cockroachdb-cluster-crd.html",
      true,
      false
    );
  
    add(
      "Minio Object Store CRD",
      "/docs/rook/v0.8/minio-object-store-crd.html",
      true,
      false
    );
  
    add(
      "Monitoring",
      "/docs/rook/v0.8/monitoring.html",
      false,
      false
    );
  
    add(
      "Ceph Dashboard",
      "/docs/rook/v0.8/ceph-dashboard.html",
      true,
      false
    );
  
    add(
      "Helm Charts",
      "/docs/rook/v0.8/helm.html",
      false,
      false
    );
  
    add(
      "Ceph Operator",
      "/docs/rook/v0.8/helm-operator.html",
      true,
      false
    );
  
    add(
      "Upgrades",
      "/docs/rook/v0.8/upgrade.html",
      false,
      false
    );
  
    add(
      "Patch Upgrades",
      "/docs/rook/v0.8/upgrade-patch.html",
      true,
      false
    );
  
    add(
      "Tools",
      "/docs/rook/v0.8/tools.html",
      false,
      false
    );
  
    add(
      "Toolbox",
      "/docs/rook/v0.8/toolbox.html",
      true,
      false
    );
  
    add(
      "Direct Tools",
      "/docs/rook/v0.8/direct-tools.html",
      true,
      false
    );
  
    add(
      "Advanced Configuration",
      "/docs/rook/v0.8/advanced-configuration.html",
      true,
      false
    );
  
    add(
      "Common Issues",
      "/docs/rook/v0.8/common-issues.html",
      true,
      false
    );
  
    add(
      "Container Linux",
      "/docs/rook/v0.8/container-linux.html",
      true,
      false
    );
  
    add(
      "Disaster Recovery",
      "/docs/rook/v0.8/disaster-recovery.html",
      true,
      false
    );
  
    add(
      "Contributing",
      "/docs/rook/v0.8/development-flow.html",
      false,
      false
    );
  
    add(
      "Multi-Node Test Environment",
      "/docs/rook/v0.8/development-environment.html",
      true,
      false
    );
  

  function getEntry(item) {
    var itemDom = document.createElement('li');

    if (item.current) {
      itemDom.innerHTML = item.name;
      itemDom.classList.add('current');
    } else {
      itemDom.innerHTML = '<a href="' + item.url + '">' + item.name + '</a>';
    }

    return itemDom;
  }

  // Flush css changes as explained in: https://stackoverflow.com/a/34726346
  // and more completely: https://stackoverflow.com/a/6956049
  function flushCss(element) {
    element.offsetHeight;
  }

  function addArrow(itemDom) {
    var MAIN_ITEM_HEIGHT = 24;
    var BOTTOM_PADDING = 20;
    var arrowDom = document.createElement('a');
    arrowDom.classList.add('arrow');
    arrowDom.innerHTML = '<img src="' + BASE_PATH + '/images/arrow.svg" />';
    arrowDom.onclick = function(itemDom) {
      return function () {
        // Calculated full height of the opened list
        var fullHeight = MAIN_ITEM_HEIGHT + BOTTOM_PADDING + itemDom.lastChild.clientHeight + 'px';

        itemDom.classList.toggle('open');

        if (itemDom.classList.contains('open')) {
          itemDom.style.height = fullHeight;
        } else {
          // If the list height is auto we have to set it to fullHeight
          // without tranistion before we shrink it to collapsed height
          if (itemDom.style.height === 'auto') {
            itemDom.style.transition = 'none';
            itemDom.style.height = fullHeight;
            flushCss(itemDom);
            itemDom.style.transition = '';
          }
          itemDom.style.height = MAIN_ITEM_HEIGHT + 'px';
        }

        return false;
      };
    }(itemDom);
    itemDom.appendChild(arrowDom);

    if ((item.current && item.children) || item.childCurrent) {
      itemDom.classList.add('open');
      itemDom.style.height = 'auto';
    } else {
      itemDom.style.height = MAIN_ITEM_HEIGHT + 'px';
    }
  }

  var menuDom = document.getElementById('docs-ul');
  for (var i = 0; i < menu.length; i++) {
    var item = menu[i];
    var itemDom = getEntry(item);

    if (item.childCurrent) {
      itemDom.classList.add('childCurrent');
    }

    if (item.children) {
      addArrow(itemDom);
      itemDom.classList.add('children');
      var children = document.createElement('ul');
      for (var j = 0; j < item.children.length; j++) {
        children.appendChild(getEntry(item.children[j]));
      }
      itemDom.appendChild(children);
    }
    menuDom.appendChild(itemDom);
  }
</script>
</div></main>
    <footer id="footer" aria-label="Footer">
  <div class="top">
    <a href="//www.cncf.io">
      <img
        class="cncf"
        src="/images/cncf.png"
        srcset="/images/cncf@2x.png 2x, /images/cncf@3x.png 3x" />
    </a>
    <p>We are a Cloud Native Computing Foundation graduated project.</p>
  </div>
  <div class="middle">
    <div class="grid-center">
      <div class="col_sm-12">
        <span>Getting Started</span>
        <a href="//github.com/rook/rook">GitHub</a>
        <a href="/docs/rook/v1.9/">Documentation</a>
        <a href="//github.com/rook/rook/blob/master/CONTRIBUTING.md#how-to-contribute">How to Contribute</a>
      </div>
      <div class="col_sm-12">
        <span>Community</span>
        <a href="//slack.rook.io/">Slack</a>
        <a href="//twitter.com/rook_io">Twitter</a>
        <a href="//groups.google.com/forum/#!forum/rook-dev">Forum</a>
        <a href="//blog.rook.io/">Blog</a>
      </div>
      <div class="col_sm-12">
        <span>Contact</span>
        <a href="mailto:cncf-rook-info@lists.cncf.io">Email</a>
        <a href="//github.com/rook/rook/issues">Feature request</a>
      </div>
      <div class="col_sm-12">
        <span>Top Contributors</span>
        <a href="//cloudical.io/">Cloudical</a>
        <a href="//cybozu.com">Cybozu, Inc</a>
        <a href="//www.redhat.com">Red Hat</a>
        <a href="//www.suse.com/">SUSE</a>
        <a href="//upbound.io">Upbound</a>
      </div>
    </div>
  </div>
  <div class="bottom">
    <div class="grid-center">
      <div class="col-8">
        <a class="logo" href="/">
          <img src="/images/rook-logo-small.svg" alt="rook.io" />
        </a>
        <p>
          &#169; Rook Authors 2022. Documentation distributed under
          <a href="https://creativecommons.org/licenses/by/4.0">CC-BY-4.0</a>.
        </p>
        <p>
          &#169; 2022 The Linux Foundation. All rights reserved. The Linux Foundation has
          registered trademarks and uses trademarks. For a list of trademarks of The Linux Foundation, please see our
          <a href="https://www.linuxfoundation.org/trademark-usage/">Trademark Usage</a> page.
        </p>
      </div>
    </div>
  </div>
</footer>


  <script src="/js/anchor.js"></script>
  <script>
    anchors.options = {
      placement: 'right',
      icon: '#',
    }

    document.addEventListener('DOMContentLoaded', function(event) {
      anchors.add('.docs-text h1, .docs-text h2, .docs-text h3, .docs-text h4, .docs-text h5, .docs-text h6');
    });
  </script>




    
  </body>
</html>
