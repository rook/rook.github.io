<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Rook Ceph Documentation"><meta name=author content="Rook Authors"><link href=https://rook.io/v1.13/CRDs/Cluster/ceph-cluster-crd/ rel=canonical><link href=../../../Storage-Configuration/Advanced/ceph-mon-health/ rel=prev><link href=../host-cluster/ rel=next><link rel=icon href=https://rook.io/images/favicon_192x192.png><meta name=generator content="mkdocs-1.5.3, mkdocs-material-9.5.11"><title>CephCluster CRD - Rook Ceph Documentation</title><link rel=stylesheet href=../../../assets/stylesheets/main.7e359304.min.css><link rel=stylesheet href=../../../assets/stylesheets/palette.06af60db.min.css><link rel=stylesheet href=../../../stylesheets/extra.css><script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=rook-blue data-md-color-accent=deep-orange> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#settings class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <div data-md-color-scheme=default data-md-component=outdated hidden> <aside class="md-banner md-banner--warning"> <div class="md-banner__inner md-grid md-typeset"> This documentation is not for the latest stable version of Rook. <a href=../../../../latest-release/ > <strong>Click here for the latest release documentation.</strong> </a> </div> <script>var el=document.querySelector("[data-md-component=outdated]"),outdated=__md_get("__outdated",sessionStorage);!0===outdated&&el&&(el.hidden=!1)</script> </aside> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../../.. title="Rook Ceph Documentation" class="md-header__button md-logo" aria-label="Rook Ceph Documentation" data-md-component=logo> <img src=https://rook.io/images/rook-logo.svg alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Rook Ceph Documentation </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> CephCluster CRD </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=rook-blue data-md-color-accent=deep-orange aria-label="Switch to dark mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=rook-blue data-md-color-accent=red aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg> </label> </form> <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/rook/rook title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../../Getting-Started/intro/ class=md-tabs__link> Getting Started </a> </li> <li class=md-tabs__item> <a href=../../../Helm-Charts/helm-charts/ class=md-tabs__link> Helm Charts </a> </li> <li class=md-tabs__item> <a href=../../../Storage-Configuration/Block-Storage-RBD/block-storage/ class=md-tabs__link> Storage Configuration </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=./ class=md-tabs__link> Custom Resources </a> </li> <li class=md-tabs__item> <a href=../../../Troubleshooting/kubectl-plugin/ class=md-tabs__link> Troubleshooting </a> </li> <li class=md-tabs__item> <a href=../../../Upgrade/health-verification/ class=md-tabs__link> Upgrade </a> </li> <li class=md-tabs__item> <a href=../../../Contributing/development-flow/ class=md-tabs__link> Contributing </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../.. title="Rook Ceph Documentation" class="md-nav__button md-logo" aria-label="Rook Ceph Documentation" data-md-component=logo> <img src=https://rook.io/images/rook-logo.svg alt=logo> </a> Rook Ceph Documentation </label> <div class=md-nav__source> <a href=https://github.com/rook/rook title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_1> <label class=md-nav__link for=__nav_1 id=__nav_1_label tabindex=0> <span class=md-ellipsis> Getting Started </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_1_label aria-expanded=false> <label class=md-nav__title for=__nav_1> <span class="md-nav__icon md-icon"></span> Getting Started </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Getting-Started/intro/ class=md-nav__link> <span class=md-ellipsis> Rook </span> </a> </li> <li class=md-nav__item> <a href=../../../Getting-Started/glossary/ class=md-nav__link> <span class=md-ellipsis> Glossary </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_1_3> <label class=md-nav__link for=__nav_1_3 id=__nav_1_3_label tabindex=0> <span class=md-ellipsis> Prerequisites </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_1_3_label aria-expanded=false> <label class=md-nav__title for=__nav_1_3> <span class="md-nav__icon md-icon"></span> Prerequisites </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Getting-Started/Prerequisites/prerequisites/ class=md-nav__link> <span class=md-ellipsis> Prerequisites </span> </a> </li> <li class=md-nav__item> <a href=../../../Getting-Started/Prerequisites/authenticated-registry/ class=md-nav__link> <span class=md-ellipsis> Authenticated Container Registries </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../Getting-Started/quickstart/ class=md-nav__link> <span class=md-ellipsis> Quickstart </span> </a> </li> <li class=md-nav__item> <a href=../../../Getting-Started/storage-architecture/ class=md-nav__link> <span class=md-ellipsis> Storage Architecture </span> </a> </li> <li class=md-nav__item> <a href=../../../Getting-Started/example-configurations/ class=md-nav__link> <span class=md-ellipsis> Example Configurations </span> </a> </li> <li class=md-nav__item> <a href=../../../Getting-Started/ceph-openshift/ class=md-nav__link> <span class=md-ellipsis> OpenShift </span> </a> </li> <li class=md-nav__item> <a href=../../../Getting-Started/ceph-teardown/ class=md-nav__link> <span class=md-ellipsis> Cleanup </span> </a> </li> <li class=md-nav__item> <a href=../../../Getting-Started/release-cycle/ class=md-nav__link> <span class=md-ellipsis> Release Cycle </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex=0> <span class=md-ellipsis> Helm Charts </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Helm Charts </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Helm-Charts/helm-charts/ class=md-nav__link> <span class=md-ellipsis> Helm Charts Overview </span> </a> </li> <li class=md-nav__item> <a href=../../../Helm-Charts/operator-chart/ class=md-nav__link> <span class=md-ellipsis> Ceph Operator Helm Chart </span> </a> </li> <li class=md-nav__item> <a href=../../../Helm-Charts/ceph-cluster-chart/ class=md-nav__link> <span class=md-ellipsis> Ceph Cluster Helm Chart </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex=0> <span class=md-ellipsis> Storage Configuration </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Storage Configuration </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3_1> <label class=md-nav__link for=__nav_3_1 id=__nav_3_1_label tabindex=0> <span class=md-ellipsis> Block Storage (RBD) </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_1_label aria-expanded=false> <label class=md-nav__title for=__nav_3_1> <span class="md-nav__icon md-icon"></span> Block Storage (RBD) </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Storage-Configuration/Block-Storage-RBD/block-storage/ class=md-nav__link> <span class=md-ellipsis> Block Storage Overview </span> </a> </li> <li class=md-nav__item> <a href=../../../Storage-Configuration/Block-Storage-RBD/rbd-mirroring/ class=md-nav__link> <span class=md-ellipsis> RBD Mirroring </span> </a> </li> <li class=md-nav__item> <a href=../../../Storage-Configuration/Block-Storage-RBD/rbd-async-disaster-recovery-failover-failback/ class=md-nav__link> <span class=md-ellipsis> RBD Asynchronous DR Failover and Failback </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3_2> <label class=md-nav__link for=__nav_3_2 id=__nav_3_2_label tabindex=0> <span class=md-ellipsis> Shared Filesystem (CephFS) </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_2_label aria-expanded=false> <label class=md-nav__title for=__nav_3_2> <span class="md-nav__icon md-icon"></span> Shared Filesystem (CephFS) </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Storage-Configuration/Shared-Filesystem-CephFS/filesystem-storage/ class=md-nav__link> <span class=md-ellipsis> Filesystem Storage Overview </span> </a> </li> <li class=md-nav__item> <a href=../../../Storage-Configuration/Shared-Filesystem-CephFS/filesystem-mirroring/ class=md-nav__link> <span class=md-ellipsis> Filesystem Mirroring </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3_3> <label class=md-nav__link for=__nav_3_3 id=__nav_3_3_label tabindex=0> <span class=md-ellipsis> Object Storage (RGW) </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3_3> <span class="md-nav__icon md-icon"></span> Object Storage (RGW) </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Storage-Configuration/Object-Storage-RGW/object-storage/ class=md-nav__link> <span class=md-ellipsis> Object Storage Overview </span> </a> </li> <li class=md-nav__item> <a href=../../../Storage-Configuration/Object-Storage-RGW/ceph-object-bucket-claim/ class=md-nav__link> <span class=md-ellipsis> Bucket Claim </span> </a> </li> <li class=md-nav__item> <a href=../../../Storage-Configuration/Object-Storage-RGW/ceph-object-bucket-notifications/ class=md-nav__link> <span class=md-ellipsis> Object Bucket Notifications </span> </a> </li> <li class=md-nav__item> <a href=../../../Storage-Configuration/Object-Storage-RGW/ceph-object-multisite/ class=md-nav__link> <span class=md-ellipsis> Object Store Multisite </span> </a> </li> <li class=md-nav__item> <a href=../../../Storage-Configuration/Object-Storage-RGW/cosi/ class=md-nav__link> <span class=md-ellipsis> Container Object Storage Interface (COSI) </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3_4> <label class=md-nav__link for=__nav_3_4 id=__nav_3_4_label tabindex=0> <span class=md-ellipsis> NFS </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_4_label aria-expanded=false> <label class=md-nav__title for=__nav_3_4> <span class="md-nav__icon md-icon"></span> NFS </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Storage-Configuration/NFS/nfs/ class=md-nav__link> <span class=md-ellipsis> NFS Storage Overview </span> </a> </li> <li class=md-nav__item> <a href=../../../Storage-Configuration/NFS/nfs-csi-driver/ class=md-nav__link> <span class=md-ellipsis> CSI provisioner and driver </span> </a> </li> <li class=md-nav__item> <a href=../../../Storage-Configuration/NFS/nfs-security/ class=md-nav__link> <span class=md-ellipsis> Security </span> </a> </li> <li class=md-nav__item> <a href=../../../Storage-Configuration/NFS/nfs-advanced/ class=md-nav__link> <span class=md-ellipsis> Advanced configuration </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3_5> <label class=md-nav__link for=__nav_3_5 id=__nav_3_5_label tabindex=0> <span class=md-ellipsis> Monitoring </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_5_label aria-expanded=false> <label class=md-nav__title for=__nav_3_5> <span class="md-nav__icon md-icon"></span> Monitoring </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Storage-Configuration/Monitoring/ceph-dashboard/ class=md-nav__link> <span class=md-ellipsis> Ceph Dashboard </span> </a> </li> <li class=md-nav__item> <a href=../../../Storage-Configuration/Monitoring/ceph-monitoring/ class=md-nav__link> <span class=md-ellipsis> Prometheus Monitoring </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3_6> <label class=md-nav__link for=__nav_3_6 id=__nav_3_6_label tabindex=0> <span class=md-ellipsis> Ceph CSI </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_6_label aria-expanded=false> <label class=md-nav__title for=__nav_3_6> <span class="md-nav__icon md-icon"></span> Ceph CSI </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Storage-Configuration/Ceph-CSI/ceph-csi-drivers/ class=md-nav__link> <span class=md-ellipsis> Ceph CSI Drivers </span> </a> </li> <li class=md-nav__item> <a href=../../../Storage-Configuration/Ceph-CSI/ceph-csi-snapshot/ class=md-nav__link> <span class=md-ellipsis> Snapshots </span> </a> </li> <li class=md-nav__item> <a href=../../../Storage-Configuration/Ceph-CSI/ceph-csi-volume-clone/ class=md-nav__link> <span class=md-ellipsis> Volume clone </span> </a> </li> <li class=md-nav__item> <a href=../../../Storage-Configuration/Ceph-CSI/custom-images/ class=md-nav__link> <span class=md-ellipsis> Custom Images </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../Storage-Configuration/ceph-teardown/ class=md-nav__link> <span class=md-ellipsis> Cleanup </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3_8> <label class=md-nav__link for=__nav_3_8 id=__nav_3_8_label tabindex=0> <span class=md-ellipsis> Advanced </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_8_label aria-expanded=false> <label class=md-nav__title for=__nav_3_8> <span class="md-nav__icon md-icon"></span> Advanced </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Storage-Configuration/Advanced/ceph-configuration/ class=md-nav__link> <span class=md-ellipsis> Ceph Configuration </span> </a> </li> <li class=md-nav__item> <a href=../../../Storage-Configuration/Advanced/configuration/ class=md-nav__link> <span class=md-ellipsis> Configuration </span> </a> </li> <li class=md-nav__item> <a href=../../../Storage-Configuration/Advanced/key-management-system/ class=md-nav__link> <span class=md-ellipsis> Key Management System </span> </a> </li> <li class=md-nav__item> <a href=../../../Storage-Configuration/Advanced/ceph-osd-mgmt/ class=md-nav__link> <span class=md-ellipsis> Ceph OSD Management </span> </a> </li> <li class=md-nav__item> <a href=../../../Storage-Configuration/Advanced/ceph-mon-health/ class=md-nav__link> <span class=md-ellipsis> Monitor Health </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4 checked> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex> <span class=md-ellipsis> Custom Resources </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=true> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Custom Resources </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_1 checked> <label class=md-nav__link for=__nav_4_1 id=__nav_4_1_label tabindex=0> <span class=md-ellipsis> Cluster Configuration </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_1_label aria-expanded=true> <label class=md-nav__title for=__nav_4_1> <span class="md-nav__icon md-icon"></span> Cluster Configuration </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> CephCluster CRD </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> CephCluster CRD </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#settings class=md-nav__link> <span class=md-ellipsis> Settings </span> </a> <nav class=md-nav aria-label=Settings> <ul class=md-nav__list> <li class=md-nav__item> <a href=#cluster-metadata class=md-nav__link> <span class=md-ellipsis> Cluster metadata </span> </a> </li> <li class=md-nav__item> <a href=#cluster-settings class=md-nav__link> <span class=md-ellipsis> Cluster Settings </span> </a> </li> <li class=md-nav__item> <a href=#ceph-container-images class=md-nav__link> <span class=md-ellipsis> Ceph container images </span> </a> </li> <li class=md-nav__item> <a href=#mon-settings class=md-nav__link> <span class=md-ellipsis> Mon Settings </span> </a> </li> <li class=md-nav__item> <a href=#mgr-settings class=md-nav__link> <span class=md-ellipsis> Mgr Settings </span> </a> </li> <li class=md-nav__item> <a href=#network-configuration-settings class=md-nav__link> <span class=md-ellipsis> Network Configuration Settings </span> </a> <nav class=md-nav aria-label="Network Configuration Settings"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#ceph-public-and-cluster-networks class=md-nav__link> <span class=md-ellipsis> Ceph public and cluster networks </span> </a> </li> <li class=md-nav__item> <a href=#host-networking class=md-nav__link> <span class=md-ellipsis> Host Networking </span> </a> </li> <li class=md-nav__item> <a href=#multus class=md-nav__link> <span class=md-ellipsis> Multus </span> </a> <nav class=md-nav aria-label=Multus> <ul class=md-nav__list> <li class=md-nav__item> <a href=#validating-multus-configuration class=md-nav__link> <span class=md-ellipsis> Validating Multus configuration </span> </a> </li> <li class=md-nav__item> <a href=#known-limitations-with-multus class=md-nav__link> <span class=md-ellipsis> Known limitations with Multus </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#ipfamily class=md-nav__link> <span class=md-ellipsis> IPFamily </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#node-settings class=md-nav__link> <span class=md-ellipsis> Node Settings </span> </a> <nav class=md-nav aria-label="Node Settings"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#node-updates class=md-nav__link> <span class=md-ellipsis> Node Updates </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#storage-selection-settings class=md-nav__link> <span class=md-ellipsis> Storage Selection Settings </span> </a> </li> <li class=md-nav__item> <a href=#storage-class-device-sets class=md-nav__link> <span class=md-ellipsis> Storage Class Device Sets </span> </a> </li> <li class=md-nav__item> <a href=#osd-configuration-settings class=md-nav__link> <span class=md-ellipsis> OSD Configuration Settings </span> </a> <nav class=md-nav aria-label="OSD Configuration Settings"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#limitations-of-metadata-device class=md-nav__link> <span class=md-ellipsis> Limitations of metadata device </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#annotations-and-labels class=md-nav__link> <span class=md-ellipsis> Annotations and Labels </span> </a> </li> <li class=md-nav__item> <a href=#placement-configuration-settings class=md-nav__link> <span class=md-ellipsis> Placement Configuration Settings </span> </a> <nav class=md-nav aria-label="Placement Configuration Settings"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#placement-example class=md-nav__link> <span class=md-ellipsis> Placement Example </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#cluster-wide-resources-configuration-settings class=md-nav__link> <span class=md-ellipsis> Cluster-wide Resources Configuration Settings </span> </a> </li> <li class=md-nav__item> <a href=#resource-requirementslimits class=md-nav__link> <span class=md-ellipsis> Resource Requirements/Limits </span> </a> <nav class=md-nav aria-label="Resource Requirements/Limits"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#node-specific-resources-for-osds class=md-nav__link> <span class=md-ellipsis> Node Specific Resources for OSDs </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#priority-class-names class=md-nav__link> <span class=md-ellipsis> Priority Class Names </span> </a> </li> <li class=md-nav__item> <a href=#health-settings class=md-nav__link> <span class=md-ellipsis> Health settings </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#status class=md-nav__link> <span class=md-ellipsis> Status </span> </a> <nav class=md-nav aria-label=Status> <ul class=md-nav__list> <li class=md-nav__item> <a href=#ceph-status class=md-nav__link> <span class=md-ellipsis> Ceph Status </span> </a> </li> <li class=md-nav__item> <a href=#conditions class=md-nav__link> <span class=md-ellipsis> Conditions </span> </a> </li> <li class=md-nav__item> <a href=#other-status class=md-nav__link> <span class=md-ellipsis> Other Status </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#osd-topology class=md-nav__link> <span class=md-ellipsis> OSD Topology </span> </a> </li> <li class=md-nav__item> <a href=#deleting-a-cephcluster class=md-nav__link> <span class=md-ellipsis> Deleting a CephCluster </span> </a> </li> <li class=md-nav__item> <a href=#cleanup-policy class=md-nav__link> <span class=md-ellipsis> Cleanup policy </span> </a> </li> <li class=md-nav__item> <a href=#ceph-config class=md-nav__link> <span class=md-ellipsis> Ceph Config </span> </a> </li> <li class=md-nav__item> <a href=#csi-driver-options class=md-nav__link> <span class=md-ellipsis> CSI Driver Options </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../host-cluster/ class=md-nav__link> <span class=md-ellipsis> Host Storage Cluster </span> </a> </li> <li class=md-nav__item> <a href=../pvc-cluster/ class=md-nav__link> <span class=md-ellipsis> PVC Storage Cluster </span> </a> </li> <li class=md-nav__item> <a href=../stretch-cluster/ class=md-nav__link> <span class=md-ellipsis> Stretch Storage Cluster </span> </a> </li> <li class=md-nav__item> <a href=../external-cluster/ class=md-nav__link> <span class=md-ellipsis> External Storage Cluster </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_4_2> <label class=md-nav__link for=__nav_4_2 id=__nav_4_2_label tabindex=0> <span class=md-ellipsis> Block Storage </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_2_label aria-expanded=false> <label class=md-nav__title for=__nav_4_2> <span class="md-nav__icon md-icon"></span> Block Storage </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Block-Storage/ceph-block-pool-crd/ class=md-nav__link> <span class=md-ellipsis> CephBlockPool CRD </span> </a> </li> <li class=md-nav__item> <a href=../../Block-Storage/ceph-block-pool-rados-namespace-crd/ class=md-nav__link> <span class=md-ellipsis> CephBlockPoolRados Namespace CRD </span> </a> </li> <li class=md-nav__item> <a href=../../Block-Storage/ceph-rbd-mirror-crd/ class=md-nav__link> <span class=md-ellipsis> CephRBDMirror CRD </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_4_3> <label class=md-nav__link for=__nav_4_3 id=__nav_4_3_label tabindex=0> <span class=md-ellipsis> Shared Filesystem </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_3_label aria-expanded=false> <label class=md-nav__title for=__nav_4_3> <span class="md-nav__icon md-icon"></span> Shared Filesystem </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Shared-Filesystem/ceph-filesystem-crd/ class=md-nav__link> <span class=md-ellipsis> CephFilesystem CRD </span> </a> </li> <li class=md-nav__item> <a href=../../Shared-Filesystem/ceph-fs-mirror-crd/ class=md-nav__link> <span class=md-ellipsis> CephFilesystemMirror CRD </span> </a> </li> <li class=md-nav__item> <a href=../../Shared-Filesystem/ceph-fs-subvolumegroup-crd/ class=md-nav__link> <span class=md-ellipsis> FilesystemSubVolumeGroup CRD </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_4_4> <label class=md-nav__link for=__nav_4_4 id=__nav_4_4_label tabindex=0> <span class=md-ellipsis> Object Storage </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4_4> <span class="md-nav__icon md-icon"></span> Object Storage </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Object-Storage/ceph-object-store-crd/ class=md-nav__link> <span class=md-ellipsis> CephObjectStore CRD </span> </a> </li> <li class=md-nav__item> <a href=../../Object-Storage/ceph-object-store-user-crd/ class=md-nav__link> <span class=md-ellipsis> CephObjectStoreUser CRD </span> </a> </li> <li class=md-nav__item> <a href=../../Object-Storage/ceph-object-realm-crd/ class=md-nav__link> <span class=md-ellipsis> CephObjectRealm CRD </span> </a> </li> <li class=md-nav__item> <a href=../../Object-Storage/ceph-object-zonegroup-crd/ class=md-nav__link> <span class=md-ellipsis> CephObjectZoneGroup CRD </span> </a> </li> <li class=md-nav__item> <a href=../../Object-Storage/ceph-object-zone-crd/ class=md-nav__link> <span class=md-ellipsis> CephObjectZone CRD </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../ceph-client-crd/ class=md-nav__link> <span class=md-ellipsis> CephClient CRD </span> </a> </li> <li class=md-nav__item> <a href=../../ceph-nfs-crd/ class=md-nav__link> <span class=md-ellipsis> CephNFS CRD </span> </a> </li> <li class=md-nav__item> <a href=../../specification/ class=md-nav__link> <span class=md-ellipsis> Specification </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex=0> <span class=md-ellipsis> Troubleshooting </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Troubleshooting </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Troubleshooting/kubectl-plugin/ class=md-nav__link> <span class=md-ellipsis> kubectl Plugin </span> </a> </li> <li class=md-nav__item> <a href=../../../Troubleshooting/ceph-toolbox/ class=md-nav__link> <span class=md-ellipsis> Toolbox </span> </a> </li> <li class=md-nav__item> <a href=../../../Troubleshooting/common-issues/ class=md-nav__link> <span class=md-ellipsis> Common Issues </span> </a> </li> <li class=md-nav__item> <a href=../../../Troubleshooting/ceph-common-issues/ class=md-nav__link> <span class=md-ellipsis> Ceph Common Issues </span> </a> </li> <li class=md-nav__item> <a href=../../../Troubleshooting/ceph-csi-common-issues/ class=md-nav__link> <span class=md-ellipsis> CSI Common Issues </span> </a> </li> <li class=md-nav__item> <a href=../../../Troubleshooting/openshift-common-issues/ class=md-nav__link> <span class=md-ellipsis> OpenShift Common Issues </span> </a> </li> <li class=md-nav__item> <a href=../../../Troubleshooting/disaster-recovery/ class=md-nav__link> <span class=md-ellipsis> Disaster Recovery </span> </a> </li> <li class=md-nav__item> <a href=../../../Troubleshooting/direct-tools/ class=md-nav__link> <span class=md-ellipsis> Direct Tools </span> </a> </li> <li class=md-nav__item> <a href=../../../Troubleshooting/performance-profiling/ class=md-nav__link> <span class=md-ellipsis> Performance Profiling </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6 id=__nav_6_label tabindex=0> <span class=md-ellipsis> Upgrade </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=false> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Upgrade </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Upgrade/health-verification/ class=md-nav__link> <span class=md-ellipsis> Health Verification </span> </a> </li> <li class=md-nav__item> <a href=../../../Upgrade/rook-upgrade/ class=md-nav__link> <span class=md-ellipsis> Rook Upgrades </span> </a> </li> <li class=md-nav__item> <a href=../../../Upgrade/ceph-upgrade/ class=md-nav__link> <span class=md-ellipsis> Ceph Upgrades </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_7> <label class=md-nav__link for=__nav_7 id=__nav_7_label tabindex=0> <span class=md-ellipsis> Contributing </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_7_label aria-expanded=false> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> Contributing </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Contributing/development-flow/ class=md-nav__link> <span class=md-ellipsis> Development Flow </span> </a> </li> <li class=md-nav__item> <a href=../../../Contributing/development-environment/ class=md-nav__link> <span class=md-ellipsis> Developer Environment </span> </a> </li> <li class=md-nav__item> <a href=../../../Contributing/documentation/ class=md-nav__link> <span class=md-ellipsis> Documentation </span> </a> </li> <li class=md-nav__item> <a href=../../../Contributing/ci-configuration/ class=md-nav__link> <span class=md-ellipsis> CI Configuration </span> </a> </li> <li class=md-nav__item> <a href=../../../Contributing/rook-test-framework/ class=md-nav__link> <span class=md-ellipsis> Rook Test Framework </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#settings class=md-nav__link> <span class=md-ellipsis> Settings </span> </a> <nav class=md-nav aria-label=Settings> <ul class=md-nav__list> <li class=md-nav__item> <a href=#cluster-metadata class=md-nav__link> <span class=md-ellipsis> Cluster metadata </span> </a> </li> <li class=md-nav__item> <a href=#cluster-settings class=md-nav__link> <span class=md-ellipsis> Cluster Settings </span> </a> </li> <li class=md-nav__item> <a href=#ceph-container-images class=md-nav__link> <span class=md-ellipsis> Ceph container images </span> </a> </li> <li class=md-nav__item> <a href=#mon-settings class=md-nav__link> <span class=md-ellipsis> Mon Settings </span> </a> </li> <li class=md-nav__item> <a href=#mgr-settings class=md-nav__link> <span class=md-ellipsis> Mgr Settings </span> </a> </li> <li class=md-nav__item> <a href=#network-configuration-settings class=md-nav__link> <span class=md-ellipsis> Network Configuration Settings </span> </a> <nav class=md-nav aria-label="Network Configuration Settings"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#ceph-public-and-cluster-networks class=md-nav__link> <span class=md-ellipsis> Ceph public and cluster networks </span> </a> </li> <li class=md-nav__item> <a href=#host-networking class=md-nav__link> <span class=md-ellipsis> Host Networking </span> </a> </li> <li class=md-nav__item> <a href=#multus class=md-nav__link> <span class=md-ellipsis> Multus </span> </a> <nav class=md-nav aria-label=Multus> <ul class=md-nav__list> <li class=md-nav__item> <a href=#validating-multus-configuration class=md-nav__link> <span class=md-ellipsis> Validating Multus configuration </span> </a> </li> <li class=md-nav__item> <a href=#known-limitations-with-multus class=md-nav__link> <span class=md-ellipsis> Known limitations with Multus </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#ipfamily class=md-nav__link> <span class=md-ellipsis> IPFamily </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#node-settings class=md-nav__link> <span class=md-ellipsis> Node Settings </span> </a> <nav class=md-nav aria-label="Node Settings"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#node-updates class=md-nav__link> <span class=md-ellipsis> Node Updates </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#storage-selection-settings class=md-nav__link> <span class=md-ellipsis> Storage Selection Settings </span> </a> </li> <li class=md-nav__item> <a href=#storage-class-device-sets class=md-nav__link> <span class=md-ellipsis> Storage Class Device Sets </span> </a> </li> <li class=md-nav__item> <a href=#osd-configuration-settings class=md-nav__link> <span class=md-ellipsis> OSD Configuration Settings </span> </a> <nav class=md-nav aria-label="OSD Configuration Settings"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#limitations-of-metadata-device class=md-nav__link> <span class=md-ellipsis> Limitations of metadata device </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#annotations-and-labels class=md-nav__link> <span class=md-ellipsis> Annotations and Labels </span> </a> </li> <li class=md-nav__item> <a href=#placement-configuration-settings class=md-nav__link> <span class=md-ellipsis> Placement Configuration Settings </span> </a> <nav class=md-nav aria-label="Placement Configuration Settings"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#placement-example class=md-nav__link> <span class=md-ellipsis> Placement Example </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#cluster-wide-resources-configuration-settings class=md-nav__link> <span class=md-ellipsis> Cluster-wide Resources Configuration Settings </span> </a> </li> <li class=md-nav__item> <a href=#resource-requirementslimits class=md-nav__link> <span class=md-ellipsis> Resource Requirements/Limits </span> </a> <nav class=md-nav aria-label="Resource Requirements/Limits"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#node-specific-resources-for-osds class=md-nav__link> <span class=md-ellipsis> Node Specific Resources for OSDs </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#priority-class-names class=md-nav__link> <span class=md-ellipsis> Priority Class Names </span> </a> </li> <li class=md-nav__item> <a href=#health-settings class=md-nav__link> <span class=md-ellipsis> Health settings </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#status class=md-nav__link> <span class=md-ellipsis> Status </span> </a> <nav class=md-nav aria-label=Status> <ul class=md-nav__list> <li class=md-nav__item> <a href=#ceph-status class=md-nav__link> <span class=md-ellipsis> Ceph Status </span> </a> </li> <li class=md-nav__item> <a href=#conditions class=md-nav__link> <span class=md-ellipsis> Conditions </span> </a> </li> <li class=md-nav__item> <a href=#other-status class=md-nav__link> <span class=md-ellipsis> Other Status </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#osd-topology class=md-nav__link> <span class=md-ellipsis> OSD Topology </span> </a> </li> <li class=md-nav__item> <a href=#deleting-a-cephcluster class=md-nav__link> <span class=md-ellipsis> Deleting a CephCluster </span> </a> </li> <li class=md-nav__item> <a href=#cleanup-policy class=md-nav__link> <span class=md-ellipsis> Cleanup policy </span> </a> </li> <li class=md-nav__item> <a href=#ceph-config class=md-nav__link> <span class=md-ellipsis> Ceph Config </span> </a> </li> <li class=md-nav__item> <a href=#csi-driver-options class=md-nav__link> <span class=md-ellipsis> CSI Driver Options </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1>CephCluster CRD</h1> <p>Rook allows creation and customization of storage clusters through the custom resource definitions (CRDs). There are primarily four different modes in which to create your cluster.</p> <ol> <li><a href=../host-cluster/ >Host Storage Cluster</a>: Consume storage from host paths and raw devices</li> <li><a href=../pvc-cluster/ >PVC Storage Cluster</a>: Dynamically provision storage underneath Rook by specifying the storage class Rook should use to consume storage (via PVCs)</li> <li><a href=../stretch-cluster/ >Stretched Storage Cluster</a>: Distribute Ceph mons across three zones, while storage (OSDs) is only configured in two zones</li> <li><a href=../external-cluster/ >External Ceph Cluster</a>: Connect your K8s applications to an external Ceph cluster</li> </ol> <p>See the separate topics for a description and examples of each of these scenarios.</p> <h2 id=settings>Settings<a class=headerlink href=#settings title="Permanent link">&para;</a></h2> <p>Settings can be specified at the global level to apply to the cluster as a whole, while other settings can be specified at more fine-grained levels. If any setting is unspecified, a suitable default will be used automatically.</p> <h3 id=cluster-metadata>Cluster metadata<a class=headerlink href=#cluster-metadata title="Permanent link">&para;</a></h3> <ul> <li><code>name</code>: The name that will be used internally for the Ceph cluster. Most commonly the name is the same as the namespace since multiple clusters are not supported in the same namespace.</li> <li><code>namespace</code>: The Kubernetes namespace that will be created for the Rook cluster. The services, pods, and other resources created by the operator will be added to this namespace. The common scenario is to create a single Rook cluster. If multiple clusters are created, they must not have conflicting devices or host paths.</li> </ul> <h3 id=cluster-settings>Cluster Settings<a class=headerlink href=#cluster-settings title="Permanent link">&para;</a></h3> <ul> <li><code>external</code>:<ul> <li><code>enable</code>: if <code>true</code>, the cluster will not be managed by Rook but via an external entity. This mode is intended to connect to an existing cluster. In this case, Rook will only consume the external cluster. However, Rook will be able to deploy various daemons in Kubernetes such as object gateways, mds and nfs if an image is provided and will refuse otherwise. If this setting is enabled <strong>all</strong> the other options will be ignored except <code>cephVersion.image</code> and <code>dataDirHostPath</code>. See <a href=../external-cluster/ >external cluster configuration</a>. If <code>cephVersion.image</code> is left blank, Rook will refuse the creation of extra CRs like object, file and nfs.</li> </ul> </li> <li><code>cephVersion</code>: The version information for launching the ceph daemons.<ul> <li><code>image</code>: The image used for running the ceph daemons. For example, <code>quay.io/ceph/ceph:v18.2.1</code>. For more details read the <a href=#ceph-container-images>container images section</a>. For the latest ceph images, see the <a href=https://hub.docker.com/r/ceph/ceph/tags/ >Ceph DockerHub</a>. To ensure a consistent version of the image is running across all nodes in the cluster, it is recommended to use a very specific image version. Tags also exist that would give the latest version, but they are only recommended for test environments. For example, the tag <code>v17</code> will be updated each time a new Quincy build is released. Using the <code>v17</code> tag is not recommended in production because it may lead to inconsistent versions of the image running across different nodes in the cluster.</li> <li><code>allowUnsupported</code>: If <code>true</code>, allow an unsupported major version of the Ceph release. Currently <code>quincy</code> and <code>reef</code> are supported. Future versions such as <code>squid</code> (v19) would require this to be set to <code>true</code>. Should be set to <code>false</code> in production.</li> <li><code>imagePullPolicy</code>: The image pull policy for the ceph daemon pods. Possible values are <code>Always</code>, <code>IfNotPresent</code>, and <code>Never</code>. The default is <code>IfNotPresent</code>.</li> </ul> </li> <li><code>dataDirHostPath</code>: The path on the host (<a href=https://kubernetes.io/docs/concepts/storage/volumes/#hostpath>hostPath</a>) where config and data should be stored for each of the services. If the directory does not exist, it will be created. Because this directory persists on the host, it will remain after pods are deleted. Following paths and any of their subpaths <strong>must not be used</strong>: <code>/etc/ceph</code>, <code>/rook</code> or <code>/var/log/ceph</code>.<ul> <li><strong>WARNING</strong>: For test scenarios, if you delete a cluster and start a new cluster on the same hosts, the path used by <code>dataDirHostPath</code> must be deleted. Otherwise, stale keys and other config will remain from the previous cluster and the new mons will fail to start. If this value is empty, each pod will get an ephemeral directory to store their config files that is tied to the lifetime of the pod running on that node. More details can be found in the Kubernetes <a href=https://kubernetes.io/docs/concepts/storage/volumes/#emptydir>empty dir docs</a>.</li> </ul> </li> <li><code>skipUpgradeChecks</code>: if set to true Rook won't perform any upgrade checks on Ceph daemons during an upgrade. Use this at <strong>YOUR OWN RISK</strong>, only if you know what you're doing. To understand Rook's upgrade process of Ceph, read the <a href=../../../Upgrade/rook-upgrade/#ceph-version-upgrades>upgrade doc</a>.</li> <li><code>continueUpgradeAfterChecksEvenIfNotHealthy</code>: if set to true Rook will continue the OSD daemon upgrade process even if the PGs are not clean, or continue with the MDS upgrade even the file system is not healthy.</li> <li><code>dashboard</code>: Settings for the Ceph dashboard. To view the dashboard in your browser see the <a href=../../../Storage-Configuration/Monitoring/ceph-dashboard/ >dashboard guide</a>.<ul> <li><code>enabled</code>: Whether to enable the dashboard to view cluster status</li> <li><code>urlPrefix</code>: Allows to serve the dashboard under a subpath (useful when you are accessing the dashboard via a reverse proxy)</li> <li><code>port</code>: Allows to change the default port where the dashboard is served</li> <li><code>ssl</code>: Whether to serve the dashboard via SSL, ignored on Ceph versions older than <code>13.2.2</code></li> </ul> </li> <li><code>monitoring</code>: Settings for monitoring Ceph using Prometheus. To enable monitoring on your cluster see the <a href=../../../Storage-Configuration/Monitoring/ceph-monitoring/#prometheus-alerts>monitoring guide</a>.<ul> <li><code>enabled</code>: Whether to enable the prometheus service monitor for an internal cluster. For an external cluster, whether to create an endpoint port for the metrics. Default is false.</li> <li><code>metricsDisabled</code>: Whether to disable the metrics reported by Ceph. If false, the prometheus mgr module and Ceph exporter are enabled. If true, the prometheus mgr module and Ceph exporter are both disabled. Default is false.</li> <li><code>externalMgrEndpoints</code>: external cluster manager endpoints</li> <li><code>externalMgrPrometheusPort</code>: external prometheus manager module port. See <a href=#external-cluster>external cluster configuration</a> for more details.</li> <li><code>port</code>: The internal prometheus manager module port where the prometheus mgr module listens. The port may need to be configured when host networking is enabled.</li> <li><code>interval</code>: The interval for the prometheus module to to scrape targets.</li> </ul> </li> <li><code>network</code>: For the network settings for the cluster, refer to the <a href=#network-configuration-settings>network configuration settings</a></li> <li><code>mon</code>: contains mon related options <a href=#mon-settings>mon settings</a> For more details on the mons and when to choose a number other than <code>3</code>, see the <a href=../../../Storage-Configuration/Advanced/ceph-mon-health/ >mon health doc</a>.</li> <li><code>mgr</code>: manager top level section<ul> <li><code>count</code>: set number of ceph managers between <code>1</code> to <code>2</code>. The default value is 2. If there are two managers, it is important for all mgr services point to the active mgr and not the standby mgr. Rook automatically updates the label <code>mgr_role</code> on the mgr pods to be either <code>active</code> or <code>standby</code>. Therefore, services need just to add the label <code>mgr_role=active</code> to their selector to point to the active mgr. This applies to all services that rely on the ceph mgr such as the dashboard or the prometheus metrics collector.</li> <li><code>modules</code>: A list of Ceph manager modules to enable or disable. Note the "dashboard" and "monitoring" modules are already configured by other settings.</li> </ul> </li> <li><code>crashCollector</code>: The settings for crash collector daemon(s).<ul> <li><code>disable</code>: is set to <code>true</code>, the crash collector will not run on any node where a Ceph daemon runs</li> <li><code>daysToRetain</code>: specifies the number of days to keep crash entries in the Ceph cluster. By default the entries are kept indefinitely.</li> </ul> </li> <li><code>logCollector</code>: The settings for log collector daemon.<ul> <li><code>enabled</code>: if set to <code>true</code>, the log collector will run as a side-car next to each Ceph daemon. The Ceph configuration option <code>log_to_file</code> will be turned on, meaning Ceph daemons will log on files in addition to still logging to container's stdout. These logs will be rotated. In case a daemon terminates with a segfault, the coredump files will be commonly be generated in <code>/var/lib/systemd/coredump</code> directory on the host, depending on the underlying OS location. (default: <code>true</code>)</li> <li><code>periodicity</code>: how often to rotate daemon's log. (default: 24h). Specified with a time suffix which may be <code>h</code> for hours or <code>d</code> for days. <strong>Rotating too often will slightly impact the daemon's performance since the signal briefly interrupts the program.</strong></li> </ul> </li> <li><code>annotations</code>: <a href=#annotations-and-labels>annotations configuration settings</a></li> <li><code>labels</code>: <a href=#annotations-and-labels>labels configuration settings</a></li> <li><code>placement</code>: <a href=#placement-configuration-settings>placement configuration settings</a></li> <li><code>resources</code>: <a href=#cluster-wide-resources-configuration-settings>resources configuration settings</a></li> <li><code>priorityClassNames</code>: <a href=#priority-class-names>priority class names configuration settings</a></li> <li><code>storage</code>: Storage selection and configuration that will be used across the cluster. Note that these settings can be overridden for specific nodes.<ul> <li><code>useAllNodes</code>: <code>true</code> or <code>false</code>, indicating if all nodes in the cluster should be used for storage according to the cluster level storage selection and configuration values. If individual nodes are specified under the <code>nodes</code> field, then <code>useAllNodes</code> must be set to <code>false</code>.</li> <li><code>nodes</code>: Names of individual nodes in the cluster that should have their storage included in accordance with either the cluster level configuration specified above or any node specific overrides described in the next section below. <code>useAllNodes</code> must be set to <code>false</code> to use specific nodes and their config. See <a href=#node-settings>node settings</a> below.</li> <li><code>config</code>: Config settings applied to all OSDs on the node unless overridden by <code>devices</code>. See the <a href=#osd-configuration-settings>config settings</a> below.</li> <li><a href=#storage-selection-settings>storage selection settings</a></li> <li><a href=#storage-class-device-sets>Storage Class Device Sets</a></li> <li><code>onlyApplyOSDPlacement</code>: Whether the placement specific for OSDs is merged with the <code>all</code> placement. If <code>false</code>, the OSD placement will be merged with the <code>all</code> placement. If true, the <code>OSD placement will be applied</code> and the <code>all</code> placement will be ignored. The placement for OSDs is computed from several different places depending on the type of OSD:<ul> <li>For non-PVCs: <code>placement.all</code> and <code>placement.osd</code></li> <li>For PVCs: <code>placement.all</code> and inside the storageClassDeviceSets from the <code>placement</code> or <code>preparePlacement</code></li> </ul> </li> <li><code>flappingRestartIntervalHours</code>: Defines the time for which an OSD pod will sleep before restarting, if it stopped due to flapping. Flapping occurs where OSDs are marked <code>down</code> by Ceph more than 5 times in 600 seconds. The OSDs will stay down when flapping since they likely have a bad disk or other issue that needs investigation. If the issue with the OSD is fixed manually, the OSD pod can be manually restarted. The sleep is disabled if this interval is set to 0.</li> </ul> </li> <li><code>disruptionManagement</code>: The section for configuring management of daemon disruptions<ul> <li><code>managePodBudgets</code>: if <code>true</code>, the operator will create and manage PodDisruptionBudgets for OSD, Mon, RGW, and MDS daemons. OSD PDBs are managed dynamically via the strategy outlined in the <a href=https://github.com/rook/rook/blob/release-1.13/design/ceph/ceph-managed-disruptionbudgets.md>design</a>. The operator will block eviction of OSDs by default and unblock them safely when drains are detected.</li> <li><code>osdMaintenanceTimeout</code>: is a duration in minutes that determines how long an entire failureDomain like <code>region/zone/host</code> will be held in <code>noout</code> (in addition to the default DOWN/OUT interval) when it is draining. The default value is <code>30</code> minutes.</li> <li><code>pgHealthCheckTimeout</code>: A duration in minutes that the operator will wait for the placement groups to become healthy (see <code>pgHealthyRegex</code>) after a drain was completed and OSDs came back up. Operator will continue with the next drain if the timeout exceeds. No values or <code>0</code> means that the operator will wait until the placement groups are healthy before unblocking the next drain.</li> <li><code>pgHealthyRegex</code>: The regular expression that is used to determine which PG states should be considered healthy. The default is <code>^(active\+clean|active\+clean\+scrubbing|active\+clean\+scrubbing\+deep)$</code>.</li> </ul> </li> <li><code>removeOSDsIfOutAndSafeToRemove</code>: If <code>true</code> the operator will remove the OSDs that are down and whose data has been restored to other OSDs. In Ceph terms, the OSDs are <code>out</code> and <code>safe-to-destroy</code> when they are removed.</li> <li><code>cleanupPolicy</code>: <a href=#cleanup-policy>cleanup policy settings</a></li> <li><code>security</code>: <a href=../../../Storage-Configuration/Advanced/key-management-system/ >security page for key management configuration</a></li> <li><code>cephConfig</code>: <a href=#ceph-config>Set Ceph config options using the Ceph Mon config store</a></li> <li><code>csi</code>: <a href=#csi-driver-options>Set CSI Driver options</a></li> </ul> <h3 id=ceph-container-images>Ceph container images<a class=headerlink href=#ceph-container-images title="Permanent link">&para;</a></h3> <p>Official releases of Ceph Container images are available from <a href=https://hub.docker.com/r/ceph>Docker Hub</a>.</p> <p>These are general purpose Ceph container with all necessary daemons and dependencies installed.</p> <table> <thead> <tr> <th>TAG</th> <th>MEANING</th> </tr> </thead> <tbody> <tr> <td>vRELNUM</td> <td>Latest release in this series (e.g., <em>v17</em> = Quincy)</td> </tr> <tr> <td>vRELNUM.Y</td> <td>Latest stable release in this stable series (e.g., v17.2)</td> </tr> <tr> <td>vRELNUM.Y.Z</td> <td>A specific release (e.g., v18.2.1)</td> </tr> <tr> <td>vRELNUM.Y.Z-YYYYMMDD</td> <td>A specific build (e.g., v18.2.1-20240103)</td> </tr> </tbody> </table> <p>A specific will contain a specific release of Ceph as well as security fixes from the Operating System.</p> <h3 id=mon-settings>Mon Settings<a class=headerlink href=#mon-settings title="Permanent link">&para;</a></h3> <ul> <li><code>count</code>: Set the number of mons to be started. The number must be between <code>1</code> and <code>9</code>. The recommended value is most commonly <code>3</code>. For highest availability, an odd number of mons should be specified. For higher durability in case of mon loss, an even number can be specified although availability may be lower. To maintain quorum a majority of mons must be up. For example, if there are three mons, two must be up. If there are four mons, three must be up. If there are two mons, both must be up. If quorum is lost, see the <a href=../../../Troubleshooting/disaster-recovery/#restoring-mon-quorum>disaster recovery guide</a> to restore quorum from a single mon.</li> <li><code>allowMultiplePerNode</code>: Whether to allow the placement of multiple mons on a single node. Default is <code>false</code> for production. Should only be set to <code>true</code> in test environments.</li> <li><code>volumeClaimTemplate</code>: A <code>PersistentVolumeSpec</code> used by Rook to create PVCs for monitor storage. This field is optional, and when not provided, HostPath volume mounts are used. The current set of fields from template that are used are <code>storageClassName</code> and the <code>storage</code> resource request and limit. The default storage size request for new PVCs is <code>10Gi</code>. Ensure that associated storage class is configured to use <code>volumeBindingMode: WaitForFirstConsumer</code>. This setting only applies to new monitors that are created when the requested number of monitors increases, or when a monitor fails and is recreated. An <a href=#using-pvc-storage-for-monitors>example CRD configuration is provided below</a>.</li> <li><code>failureDomainLabel</code>: The label that is expected on each node where the mons are expected to be deployed. The labels must be found in the list of well-known <a href=#osd-topology>topology labels</a>.</li> <li><code>zones</code>: The failure domain names where the Mons are expected to be deployed. There must be <strong>at least three zones</strong> specified in the list. Each zone can be backed by a different storage class by specifying the <code>volumeClaimTemplate</code>.</li> <li><code>name</code>: The name of the zone, which is the value of the domain label.</li> <li> <p><code>volumeClaimTemplate</code>: A <code>PersistentVolumeSpec</code> used by Rook to create PVCs for monitor storage. This field is optional, and when not provided, HostPath volume mounts are used. The current set of fields from template that are used are <code>storageClassName</code> and the <code>storage</code> resource request and limit. The default storage size request for new PVCs is <code>10Gi</code>. Ensure that associated storage class is configured to use <code>volumeBindingMode: WaitForFirstConsumer</code>. This setting only applies to new monitors that are created when the requested number of monitors increases, or when a monitor fails and is recreated. An <a href=#using-pvc-storage-for-monitors>example CRD configuration is provided below</a>.</p> </li> <li> <p><code>stretchCluster</code>: The stretch cluster settings that define the zones (or other failure domain labels) across which to configure the cluster.</p> <ul> <li><code>failureDomainLabel</code>: The label that is expected on each node where the cluster is expected to be deployed. The labels must be found in the list of well-known <a href=#osd-topology>topology labels</a>.</li> <li><code>subFailureDomain</code>: With a zone, the data replicas must be spread across OSDs in the subFailureDomain. The default is <code>host</code>.</li> <li><code>zones</code>: The failure domain names where the Mons and OSDs are expected to be deployed. There must be <strong>three zones</strong> specified in the list. This element is always named <code>zone</code> even if a non-default <code>failureDomainLabel</code> is specified. The elements have two values:<ul> <li><code>name</code>: The name of the zone, which is the value of the domain label.</li> <li><code>arbiter</code>: Whether the zone is expected to be the arbiter zone which only runs a single mon. Exactly one zone must be labeled <code>true</code>.</li> <li><code>volumeClaimTemplate</code>: A <code>PersistentVolumeSpec</code> used by Rook to create PVCs for monitor storage. This field is optional, and when not provided, HostPath volume mounts are used. The current set of fields from template that are used are <code>storageClassName</code> and the <code>storage</code> resource request and limit. The default storage size request for new PVCs is <code>10Gi</code>. Ensure that associated storage class is configured to use <code>volumeBindingMode: WaitForFirstConsumer</code>. This setting only applies to new monitors that are created when the requested number of monitors increases, or when a monitor fails and is recreated. An <a href=#using-pvc-storage-for-monitors>example CRD configuration is provided below</a>. The two zones that are not the arbiter zone are expected to have OSDs deployed.</li> </ul> </li> </ul> </li> </ul> <p>If these settings are changed in the CRD the operator will update the number of mons during a periodic check of the mon health, which by default is every 45 seconds.</p> <p>To change the defaults that the operator uses to determine the mon health and whether to failover a mon, refer to the <a href=#health-settings>health settings</a>. The intervals should be small enough that you have confidence the mons will maintain quorum, while also being long enough to ignore network blips where mons are failed over too often.</p> <h3 id=mgr-settings>Mgr Settings<a class=headerlink href=#mgr-settings title="Permanent link">&para;</a></h3> <p>You can use the cluster CR to enable or disable any manager module. This can be configured like so:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-0-1>1</a></span>
<span class=normal><a href=#__codelineno-0-2>2</a></span>
<span class=normal><a href=#__codelineno-0-3>3</a></span>
<span class=normal><a href=#__codelineno-0-4>4</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-0-1 name=__codelineno-0-1></a><span class=nt>mgr</span><span class=p>:</span>
<a id=__codelineno-0-2 name=__codelineno-0-2></a><span class=w>  </span><span class=nt>modules</span><span class=p>:</span>
<a id=__codelineno-0-3 name=__codelineno-0-3></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">&lt;name of the module&gt;</span>
<a id=__codelineno-0-4 name=__codelineno-0-4></a><span class=w>    </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</code></pre></div></td></tr></table></div> <p>Some modules will have special configuration to ensure the module is fully functional after being enabled. Specifically:</p> <ul> <li><code>pg_autoscaler</code>: Rook will configure all new pools with PG autoscaling by setting: <code>osd_pool_default_pg_autoscale_mode = on</code></li> </ul> <h3 id=network-configuration-settings>Network Configuration Settings<a class=headerlink href=#network-configuration-settings title="Permanent link">&para;</a></h3> <p>If not specified, the default SDN will be used. Configure the network that will be enabled for the cluster and services.</p> <ul> <li><code>provider</code>: Specifies the network provider that will be used to connect the network interface. You can choose between <code>host</code>, and <code>multus</code>.</li> <li><code>selectors</code>: Used for <code>multus</code> provider only. Select NetworkAttachmentDefinitions to use for Ceph networks.</li> <li><code>public</code>: Select the NetworkAttachmentDefinition to use for the public network.</li> <li><code>cluster</code>: Select the NetworkAttachmentDefinition to use for the cluster network.</li> <li><code>addressRanges</code>: Used for <code>host</code> or <code>multus</code> providers only. Allows overriding the address ranges (CIDRs) that Ceph will listen on.</li> <li><code>public</code>: A list of individual network ranges in CIDR format to use for Ceph's public network.</li> <li><code>cluster</code>: A list of individual network ranges in CIDR format to use for Ceph's cluster network.</li> <li><code>ipFamily</code>: Specifies the network stack Ceph daemons should listen on.</li> <li><code>dualStack</code>: Specifies that Ceph daemon should listen on both IPv4 and IPv6 network stacks.</li> <li><code>connections</code>: Settings for network connections using Ceph's msgr2 protocol<ul> <li><code>requireMsgr2</code>: Whether to require communication over msgr2. If true, the msgr v1 port (6789) will be disabled and clients will be required to connect to the Ceph cluster with the v2 port (3300). Requires a kernel that supports msgr2 (kernel 5.11 or CentOS 8.4 or newer). Default is false.</li> <li><code>encryption</code>: Settings for encryption on the wire to Ceph daemons<ul> <li><code>enabled</code>: Whether to encrypt the data in transit across the wire to prevent eavesdropping the data on the network. The default is false. When encryption is enabled, all communication between clients and Ceph daemons, or between Ceph daemons will be encrypted. When encryption is not enabled, clients still establish a strong initial authentication and data integrity is still validated with a crc check. <strong>IMPORTANT</strong>: Encryption requires the 5.11 kernel for the latest nbd and cephfs drivers. Alternatively for testing only, set "mounter: rbd-nbd" in the rbd storage class, or "mounter: fuse" in the cephfs storage class. The nbd and fuse drivers are <em>not</em> recommended in production since restarting the csi driver pod will disconnect the volumes. If this setting is enabled, CephFS volumes also require setting <code>CSI_CEPHFS_KERNEL_MOUNT_OPTIONS</code> to <code>"ms_mode=secure"</code> in operator.yaml.</li> </ul> </li> <li><code>compression</code>:<ul> <li><code>enabled</code>: Whether to compress the data in transit across the wire. The default is false. See the kernel requirements above for encryption.</li> </ul> </li> </ul> </li> </ul> <div class="admonition caution"> <p class=admonition-title>Caution</p> <p>Changing networking configuration after a Ceph cluster has been deployed is NOT supported and will result in a non-functioning cluster.</p> </div> <h4 id=ceph-public-and-cluster-networks>Ceph public and cluster networks<a class=headerlink href=#ceph-public-and-cluster-networks title="Permanent link">&para;</a></h4> <p>Ceph daemons can operate on up to two distinct networks: public, and cluster.</p> <p>Ceph daemons always use the public network, which is the Kubernetes pod network by default. The public network is used for client communications with the Ceph cluster (reads/writes).</p> <p>If specified, the cluster network is used to isolate internal Ceph replication traffic. This includes additional copies of data replicated between OSDs during client reads/writes. This also includes OSD data recovery (re-replication) when OSDs or nodes go offline. If the cluster network is unspecified, the public network is used for this traffic instead.</p> <p>Some Rook network providers allow manually specifying the public and network interfaces that Ceph will use for data traffic. Use <code>addressRanges</code> to specify this. For example:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-1-1>1</a></span>
<span class=normal><a href=#__codelineno-1-2>2</a></span>
<span class=normal><a href=#__codelineno-1-3>3</a></span>
<span class=normal><a href=#__codelineno-1-4>4</a></span>
<span class=normal><a href=#__codelineno-1-5>5</a></span>
<span class=normal><a href=#__codelineno-1-6>6</a></span>
<span class=normal><a href=#__codelineno-1-7>7</a></span>
<span class=normal><a href=#__codelineno-1-8>8</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-1-1 name=__codelineno-1-1></a><span class=w>  </span><span class=nt>network</span><span class=p>:</span>
<a id=__codelineno-1-2 name=__codelineno-1-2></a><span class=w>    </span><span class=nt>provider</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">host</span>
<a id=__codelineno-1-3 name=__codelineno-1-3></a><span class=w>    </span><span class=nt>addressRanges</span><span class=p>:</span>
<a id=__codelineno-1-4 name=__codelineno-1-4></a><span class=w>      </span><span class=nt>public</span><span class=p>:</span>
<a id=__codelineno-1-5 name=__codelineno-1-5></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;192.168.100.0/24&quot;</span>
<a id=__codelineno-1-6 name=__codelineno-1-6></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;192.168.101.0/24&quot;</span>
<a id=__codelineno-1-7 name=__codelineno-1-7></a><span class=w>      </span><span class=nt>cluster</span><span class=p>:</span>
<a id=__codelineno-1-8 name=__codelineno-1-8></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;192.168.200.0/24&quot;</span>
</code></pre></div></td></tr></table></div> <p>This spec translates directly to Ceph's <code>public_network</code> and <code>host_network</code> configurations. Refer to <a href=https://docs.ceph.com/docs/master/rados/configuration/network-config-ref/ >Ceph networking documentation</a> for more details.</p> <p>The default, unspecified network provider cannot make use of these configurations.</p> <p>Ceph public and cluster network configurations are allowed to change, but this should be done with great care. When updating underlying networks or Ceph network settings, Rook assumes that the current network configuration used by Ceph daemons will continue to operate as intended. Network changes are not applied to Ceph daemon pods (like OSDs and MDSes) until the pod is restarted. When making network changes, ensure that restarted pods will not lose connectivity to existing pods, and vice versa.</p> <h4 id=host-networking>Host Networking<a class=headerlink href=#host-networking title="Permanent link">&para;</a></h4> <p>To use host networking, set <code>provider: host</code>.</p> <p>To instruct Ceph to operate on specific host interfaces or networks, use <code>addressRanges</code> to select the network CIDRs Ceph will bind to on the host.</p> <p>If the host networking setting is changed in a cluster where mons are already running, the existing mons will remain running with the same network settings with which they were created. To complete the conversion to or from host networking after you update this setting, you will need to <a href=../../../Storage-Configuration/Advanced/ceph-mon-health/#failing-over-a-monitor>failover the mons</a> in order to have mons on the desired network configuration.</p> <h4 id=multus>Multus<a class=headerlink href=#multus title="Permanent link">&para;</a></h4> <p>Rook supports using Multus NetworkAttachmentDefinitions for Ceph public and cluster networks.</p> <p>Refer to <a href=https://github.com/k8snetworkplumbingwg/multus-cni/blob/master/docs/how-to-use.md>Multus documentation</a> for details about how to set up and select Multus networks.</p> <p>Rook will attempt to auto-discover the network CIDRs for selected public and/or cluster networks. This process is not guaranteed to succeed. Furthermore, this process will get a new network lease for each CephCluster reconcile. Specify <code>addressRanges</code> manually if the auto-detection process fails or if the selected network configuration cannot automatically recycle released network leases.</p> <p>Only OSD pods will have both public and cluster networks attached (if specified). The rest of the Ceph component pods and CSI pods will only have the public network attached. The Rook operator will not have any networks attached; it proxies Ceph commands via a sidecar container in the mgr pod.</p> <p>A NetworkAttachmentDefinition must exist before it can be used by Multus for a Ceph network. A recommended definition will look like the following:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-2-1> 1</a></span>
<span class=normal><a href=#__codelineno-2-2> 2</a></span>
<span class=normal><a href=#__codelineno-2-3> 3</a></span>
<span class=normal><a href=#__codelineno-2-4> 4</a></span>
<span class=normal><a href=#__codelineno-2-5> 5</a></span>
<span class=normal><a href=#__codelineno-2-6> 6</a></span>
<span class=normal><a href=#__codelineno-2-7> 7</a></span>
<span class=normal><a href=#__codelineno-2-8> 8</a></span>
<span class=normal><a href=#__codelineno-2-9> 9</a></span>
<span class=normal><a href=#__codelineno-2-10>10</a></span>
<span class=normal><a href=#__codelineno-2-11>11</a></span>
<span class=normal><a href=#__codelineno-2-12>12</a></span>
<span class=normal><a href=#__codelineno-2-13>13</a></span>
<span class=normal><a href=#__codelineno-2-14>14</a></span>
<span class=normal><a href=#__codelineno-2-15>15</a></span>
<span class=normal><a href=#__codelineno-2-16>16</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-2-1 name=__codelineno-2-1></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=s>&quot;k8s.cni.cncf.io/v1&quot;</span>
<a id=__codelineno-2-2 name=__codelineno-2-2></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">NetworkAttachmentDefinition</span>
<a id=__codelineno-2-3 name=__codelineno-2-3></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-2-4 name=__codelineno-2-4></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ceph-multus-net</span>
<a id=__codelineno-2-5 name=__codelineno-2-5></a><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rook-ceph</span>
<a id=__codelineno-2-6 name=__codelineno-2-6></a><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-2-7 name=__codelineno-2-7></a><span class=w>  </span><span class=nt>config</span><span class=p>:</span><span class=w> </span><span class=s>&#39;{</span>
<a id=__codelineno-2-8 name=__codelineno-2-8></a><span class=w>      </span><span class=s>&quot;cniVersion&quot;:</span><span class=nv> </span><span class=s>&quot;0.3.0&quot;,</span>
<a id=__codelineno-2-9 name=__codelineno-2-9></a><span class=w>      </span><span class=s>&quot;type&quot;:</span><span class=nv> </span><span class=s>&quot;macvlan&quot;,</span>
<a id=__codelineno-2-10 name=__codelineno-2-10></a><span class=w>      </span><span class=s>&quot;master&quot;:</span><span class=nv> </span><span class=s>&quot;eth0&quot;,</span>
<a id=__codelineno-2-11 name=__codelineno-2-11></a><span class=w>      </span><span class=s>&quot;mode&quot;:</span><span class=nv> </span><span class=s>&quot;bridge&quot;,</span>
<a id=__codelineno-2-12 name=__codelineno-2-12></a><span class=w>      </span><span class=s>&quot;ipam&quot;:</span><span class=nv> </span><span class=s>{</span>
<a id=__codelineno-2-13 name=__codelineno-2-13></a><span class=w>        </span><span class=s>&quot;type&quot;:</span><span class=nv> </span><span class=s>&quot;whereabouts&quot;,</span>
<a id=__codelineno-2-14 name=__codelineno-2-14></a><span class=w>        </span><span class=s>&quot;range&quot;:</span><span class=nv> </span><span class=s>&quot;192.168.200.0/24&quot;</span>
<a id=__codelineno-2-15 name=__codelineno-2-15></a><span class=w>      </span><span class=s>}</span>
<a id=__codelineno-2-16 name=__codelineno-2-16></a><span class=w>    </span><span class=s>}&#39;</span>
</code></pre></div></td></tr></table></div> <ul> <li>Ensure that <code>master</code> matches the network interface on hosts that you want to use. It must be the same across all hosts.</li> <li>CNI type <code>macvlan</code> is highly recommended. It has less CPU and memory overhead compared to traditional Linux <code>bridge</code> configurations.</li> <li>IPAM type <code>whereabouts</code> is recommended because it ensures each pod gets an IP address unique within the Kubernetes cluster. No DHCP server is required. If a DHCP server is present on the network, ensure the IP range does not overlap with the DHCP server's range.</li> </ul> <p>NetworkAttachmentDefinitions are selected for the desired Ceph network using <code>selectors</code>. Selector values should include the namespace in which the NAD is present. <code>public</code> and <code>cluster</code> may be selected independently. If <code>public</code> is left unspecified, Rook will configure Ceph to use the Kubernetes pod network for Ceph client traffic.</p> <p>Consider the example below which selects a hypothetical Kubernetes-wide Multus network in the default namespace for Ceph's public network and selects a Ceph-specific network in the <code>rook-ceph</code> namespace for Ceph's cluster network. The commented-out portion shows an example of how address ranges could be manually specified for the networks if needed.</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-3-1> 1</a></span>
<span class=normal><a href=#__codelineno-3-2> 2</a></span>
<span class=normal><a href=#__codelineno-3-3> 3</a></span>
<span class=normal><a href=#__codelineno-3-4> 4</a></span>
<span class=normal><a href=#__codelineno-3-5> 5</a></span>
<span class=normal><a href=#__codelineno-3-6> 6</a></span>
<span class=normal><a href=#__codelineno-3-7> 7</a></span>
<span class=normal><a href=#__codelineno-3-8> 8</a></span>
<span class=normal><a href=#__codelineno-3-9> 9</a></span>
<span class=normal><a href=#__codelineno-3-10>10</a></span>
<span class=normal><a href=#__codelineno-3-11>11</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-3-1 name=__codelineno-3-1></a><span class=w>  </span><span class=nt>network</span><span class=p>:</span>
<a id=__codelineno-3-2 name=__codelineno-3-2></a><span class=w>    </span><span class=nt>provider</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">multus</span>
<a id=__codelineno-3-3 name=__codelineno-3-3></a><span class=w>    </span><span class=nt>selectors</span><span class=p>:</span>
<a id=__codelineno-3-4 name=__codelineno-3-4></a><span class=w>      </span><span class=nt>public</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">default/kube-multus-net</span>
<a id=__codelineno-3-5 name=__codelineno-3-5></a><span class=w>      </span><span class=nt>cluster</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rook-ceph/ceph-multus-net</span>
<a id=__codelineno-3-6 name=__codelineno-3-6></a><span class=w>    </span><span class=c1># addressRanges:</span>
<a id=__codelineno-3-7 name=__codelineno-3-7></a><span class=w>    </span><span class=c1>#   public:</span>
<a id=__codelineno-3-8 name=__codelineno-3-8></a><span class=w>    </span><span class=c1>#     - &quot;192.168.100.0/24&quot;</span>
<a id=__codelineno-3-9 name=__codelineno-3-9></a><span class=w>    </span><span class=c1>#     - &quot;192.168.101.0/24&quot;</span>
<a id=__codelineno-3-10 name=__codelineno-3-10></a><span class=w>    </span><span class=c1>#   cluster:</span>
<a id=__codelineno-3-11 name=__codelineno-3-11></a><span class=w>    </span><span class=c1>#     - &quot;192.168.200.0/24&quot;</span>
</code></pre></div></td></tr></table></div> <h5 id=validating-multus-configuration>Validating Multus configuration<a class=headerlink href=#validating-multus-configuration title="Permanent link">&para;</a></h5> <p>We <strong>highly</strong> recommend validating your Multus configuration before you install Rook. A tool exists to facilitate validating the Multus configuration. After installing the Rook operator and before installing any Custom Resources, run the tool from the operator pod.</p> <p>The tool's CLI is designed to be as helpful as possible. Get help text for the multus validation tool like so: <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-4-1>1</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-4-1 name=__codelineno-4-1></a><span class=go>kubectl --namespace rook-ceph exec -it deploy/rook-ceph-operator -- rook multus validation run --help</span>
</code></pre></div></td></tr></table></div></p> <p>Then, update the args in the <a href=https://github.com/rook/rook/blob/release-1.13/deploy/examples/multus-validation.yaml>multus-validation</a> job template. Minimally, add the NAD names(s) for public and/or cluster as needed and and then, create the job to validate the Multus configuration.</p> <p>If the tool fails, it will suggest what things may be preventing Multus networks from working properly, and it will request the logs and outputs that will help debug issues.</p> <p>Check the logs of the pod created by the job to know the status of the validation test.</p> <h5 id=known-limitations-with-multus>Known limitations with Multus<a class=headerlink href=#known-limitations-with-multus title="Permanent link">&para;</a></h5> <p>Daemons leveraging Kubernetes service IPs (Monitors, Managers, Rados Gateways) are not listening on the NAD specified in the <code>selectors</code>. Instead the daemon listens on the default network, however the NAD is attached to the container, allowing the daemon to communicate with the rest of the cluster. There is work in progress to fix this issue in the <a href=https://github.com/k8snetworkplumbingwg/multus-service>multus-service</a> repository. At the time of writing it's unclear when this will be supported.</p> <h4 id=ipfamily>IPFamily<a class=headerlink href=#ipfamily title="Permanent link">&para;</a></h4> <p>Provide single-stack IPv4 or IPv6 protocol to assign corresponding addresses to pods and services. This field is optional. Possible inputs are IPv6 and IPv4. Empty value will be treated as IPv4. To enable dual stack see the <a href=#network-configuration-settings>network configuration section</a>.</p> <h3 id=node-settings>Node Settings<a class=headerlink href=#node-settings title="Permanent link">&para;</a></h3> <p>In addition to the cluster level settings specified above, each individual node can also specify configuration to override the cluster level settings and defaults. If a node does not specify any configuration then it will inherit the cluster level settings.</p> <ul> <li><code>name</code>: The name of the node, which should match its <code>kubernetes.io/hostname</code> label.</li> <li><code>config</code>: Config settings applied to all OSDs on the node unless overridden by <code>devices</code>. See the <a href=#osd-configuration-settings>config settings</a> below.</li> <li><a href=#storage-selection-settings>storage selection settings</a></li> </ul> <p>When <code>useAllNodes</code> is set to <code>true</code>, Rook attempts to make Ceph cluster management as hands-off as possible while still maintaining reasonable data safety. If a usable node comes online, Rook will begin to use it automatically. To maintain a balance between hands-off usability and data safety, Nodes are removed from Ceph as OSD hosts only (1) if the node is deleted from Kubernetes itself or (2) if the node has its taints or affinities modified in such a way that the node is no longer usable by Rook. Any changes to taints or affinities, intentional or unintentional, may affect the data reliability of the Ceph cluster. In order to help protect against this somewhat, deletion of nodes by taint or affinity modifications must be "confirmed" by deleting the Rook Ceph operator pod and allowing the operator deployment to restart the pod.</p> <p>For production clusters, we recommend that <code>useAllNodes</code> is set to <code>false</code> to prevent the Ceph cluster from suffering reduced data reliability unintentionally due to a user mistake. When <code>useAllNodes</code> is set to <code>false</code>, Rook relies on the user to be explicit about when nodes are added to or removed from the Ceph cluster. Nodes are only added to the Ceph cluster if the node is added to the Ceph cluster resource. Similarly, nodes are only removed if the node is removed from the Ceph cluster resource.</p> <h4 id=node-updates>Node Updates<a class=headerlink href=#node-updates title="Permanent link">&para;</a></h4> <p>Nodes can be added and removed over time by updating the Cluster CRD, for example with <code>kubectl -n rook-ceph edit cephcluster rook-ceph</code>. This will bring up your default text editor and allow you to add and remove storage nodes from the cluster. This feature is only available when <code>useAllNodes</code> has been set to <code>false</code>.</p> <h3 id=storage-selection-settings>Storage Selection Settings<a class=headerlink href=#storage-selection-settings title="Permanent link">&para;</a></h3> <p>Below are the settings for host-based cluster. This type of cluster can specify devices for OSDs, both at the cluster and individual node level, for selecting which storage resources will be included in the cluster.</p> <ul> <li><code>useAllDevices</code>: <code>true</code> or <code>false</code>, indicating whether all devices found on nodes in the cluster should be automatically consumed by OSDs. <strong>Not recommended</strong> unless you have a very controlled environment where you will not risk formatting of devices with existing data. When <code>true</code>, all devices and partitions will be used. Is overridden by <code>deviceFilter</code> if specified. LVM logical volumes are not picked by <code>useAllDevices</code>.</li> <li><code>deviceFilter</code>: A regular expression for short kernel names of devices (e.g. <code>sda</code>) that allows selection of devices and partitions to be consumed by OSDs. LVM logical volumes are not picked by <code>deviceFilter</code>.If individual devices have been specified for a node then this filter will be ignored. This field uses <a href=https://golang.org/pkg/regexp/syntax/ >golang regular expression syntax</a>. For example:<ul> <li><code>sdb</code>: Only selects the <code>sdb</code> device if found</li> <li><code>^sd.</code>: Selects all devices starting with <code>sd</code></li> <li><code>^sd[a-d]</code>: Selects devices starting with <code>sda</code>, <code>sdb</code>, <code>sdc</code>, and <code>sdd</code> if found</li> <li><code>^s</code>: Selects all devices that start with <code>s</code></li> <li><code>^[^r]</code>: Selects all devices that do <em>not</em> start with <code>r</code></li> </ul> </li> <li><code>devicePathFilter</code>: A regular expression for device paths (e.g. <code>/dev/disk/by-path/pci-0:1:2:3-scsi-1</code>) that allows selection of devices and partitions to be consumed by OSDs. LVM logical volumes are not picked by <code>devicePathFilter</code>.If individual devices or <code>deviceFilter</code> have been specified for a node then this filter will be ignored. This field uses <a href=https://golang.org/pkg/regexp/syntax/ >golang regular expression syntax</a>. For example:<ul> <li><code>^/dev/sd.</code>: Selects all devices starting with <code>sd</code></li> <li><code>^/dev/disk/by-path/pci-.*</code>: Selects all devices which are connected to PCI bus</li> </ul> </li> <li><code>devices</code>: A list of individual device names belonging to this node to include in the storage cluster.<ul> <li><code>name</code>: The name of the devices and partitions (e.g., <code>sda</code>). The full udev path can also be specified for devices, partitions, and logical volumes (e.g. <code>/dev/disk/by-id/ata-ST4000DM004-XXXX</code> - this will not change after reboots).</li> <li><code>config</code>: Device-specific config settings. See the <a href=#osd-configuration-settings>config settings</a> below</li> </ul> </li> </ul> <p>Host-based cluster supports raw devices, partitions, logical volumes, encrypted devices, and multipath devices. Be sure to see the <a href=../../../Getting-Started/quickstart/#prerequisites>quickstart doc prerequisites</a> for additional considerations.</p> <p>Below are the settings for a PVC-based cluster.</p> <ul> <li><code>storageClassDeviceSets</code>: Explained in <a href=#storage-class-device-sets>Storage Class Device Sets</a></li> </ul> <h3 id=storage-class-device-sets>Storage Class Device Sets<a class=headerlink href=#storage-class-device-sets title="Permanent link">&para;</a></h3> <p>The following are the settings for Storage Class Device Sets which can be configured to create OSDs that are backed by block mode PVs.</p> <ul> <li><code>name</code>: A name for the set.</li> <li><code>count</code>: The number of devices in the set.</li> <li><code>resources</code>: The CPU and RAM requests/limits for the devices. (Optional)</li> <li><code>placement</code>: The placement criteria for the devices. (Optional) Default is no placement criteria.</li> </ul> <p>The syntax is the same as for <a href=#placement-configuration-settings>other placement configuration</a>. It supports <code>nodeAffinity</code>, <code>podAffinity</code>, <code>podAntiAffinity</code> and <code>tolerations</code> keys.</p> <p>It is recommended to configure the placement such that the OSDs will be as evenly spread across nodes as possible. At a minimum, anti-affinity should be added so at least one OSD will be placed on each available nodes.</p> <p>However, if there are more OSDs than nodes, this anti-affinity will not be effective. Another placement scheme to consider is to add labels to the nodes in such a way that the OSDs can be grouped on those nodes, create multiple storageClassDeviceSets, and add node affinity to each of the device sets that will place the OSDs in those sets of nodes.</p> <p>Rook will automatically add required nodeAffinity to the OSD daemons to match the topology labels that are found on the nodes where the OSD prepare jobs ran. To ensure data durability, the OSDs are required to run in the same topology that the Ceph CRUSH map expects. For example, if the nodes are labeled with rack topology labels, the OSDs will be constrained to a certain rack. Without the topology labels, Rook will not constrain the OSDs beyond what is required by the PVs, for example to run in the zone where provisioned. See the <a href=#osd-topology>OSD Topology</a> section for the related labels.</p> <ul> <li><code>preparePlacement</code>: The placement criteria for the preparation of the OSD devices. Creating OSDs is a two-step process and the prepare job may require different placement than the OSD daemons. If the <code>preparePlacement</code> is not specified, the <code>placement</code> will instead be applied for consistent placement for the OSD prepare jobs and OSD deployments. The <code>preparePlacement</code> is only useful for <code>portable</code> OSDs in the device sets. OSDs that are not portable will be tied to the host where the OSD prepare job initially runs.<ul> <li>For example, provisioning may require topology spread constraints across zones, but the OSD daemons may require constraints across hosts within the zones.</li> </ul> </li> <li><code>portable</code>: If <code>true</code>, the OSDs will be allowed to move between nodes during failover. This requires a storage class that supports portability (e.g. <code>aws-ebs</code>, but not the local storage provisioner). If <code>false</code>, the OSDs will be assigned to a node permanently. Rook will configure Ceph's CRUSH map to support the portability.</li> <li><code>tuneDeviceClass</code>: For example, Ceph cannot detect AWS volumes as HDDs from the storage class "gp2", so you can improve Ceph performance by setting this to true.</li> <li><code>tuneFastDeviceClass</code>: For example, Ceph cannot detect Azure disks as SSDs from the storage class "managed-premium", so you can improve Ceph performance by setting this to true..</li> <li><code>volumeClaimTemplates</code>: A list of PVC templates to use for provisioning the underlying storage devices.</li> <li> <p><code>metadata.name</code>: "data", "metadata", or "wal". If a single template is provided, the name must be "data". If the name is "metadata" or "wal", the devices are used to store the Ceph metadata or WAL respectively. In both cases, the devices must be raw devices or LVM logical volumes.</p> <ul> <li><code>resources.requests.storage</code>: The desired capacity for the underlying storage devices.</li> <li><code>storageClassName</code>: The StorageClass to provision PVCs from. Default would be to use the cluster-default StorageClass.</li> <li><code>volumeMode</code>: The volume mode to be set for the PVC. Which should be Block</li> <li><code>accessModes</code>: The access mode for the PVC to be bound by OSD.</li> <li><code>schedulerName</code>: Scheduler name for OSD pod placement. (Optional)</li> <li><code>encrypted</code>: whether to encrypt all the OSDs in a given storageClassDeviceSet</li> </ul> </li> </ul> <p>See the table in <a href=#osd-configuration-settings>OSD Configuration Settings</a> to know the allowed configurations.</p> <h3 id=osd-configuration-settings>OSD Configuration Settings<a class=headerlink href=#osd-configuration-settings title="Permanent link">&para;</a></h3> <p>The following storage selection settings are specific to Ceph and do not apply to other backends. All variables are key-value pairs represented as strings.</p> <ul> <li><code>metadataDevice</code>: Name of a device, <a href=#limitations-of-metadata-device>partition</a> or lvm to use for the metadata of OSDs on each node. Performance can be improved by using a low latency device (such as SSD or NVMe) as the metadata device, while other spinning platter (HDD) devices on a node are used to store data. Provisioning will fail if the user specifies a <code>metadataDevice</code> but that device is not used as a metadata device by Ceph. Notably, <code>ceph-volume</code> will not use a device of the same device class (HDD, SSD, NVMe) as OSD devices for metadata, resulting in this failure.</li> <li><code>databaseSizeMB</code>: The size in MB of a bluestore database. Include quotes around the size.</li> <li><code>walSizeMB</code>: The size in MB of a bluestore write ahead log (WAL). Include quotes around the size.</li> <li><code>deviceClass</code>: The <a href=https://ceph.io/community/new-luminous-crush-device-classes/ >CRUSH device class</a> to use for this selection of storage devices. (By default, if a device's class has not already been set, OSDs will automatically set a device's class to either <code>hdd</code>, <code>ssd</code>, or <code>nvme</code> based on the hardware properties exposed by the Linux kernel.) These storage classes can then be used to select the devices backing a storage pool by specifying them as the value of <a href=../../Block-Storage/ceph-block-pool-crd/#spec>the pool spec's <code>deviceClass</code> field</a>.</li> <li><code>initialWeight</code>: The initial OSD weight in TiB units. By default, this value is derived from OSD's capacity.</li> <li><code>primaryAffinity</code>: The <a href=https://docs.ceph.com/en/latest/rados/operations/crush-map/#primary-affinity>primary-affinity</a> value of an OSD, within range <code>[0, 1]</code> (default: <code>1</code>).</li> <li><code>osdsPerDevice</code>**: The number of OSDs to create on each device. High performance devices such as NVMe can handle running multiple OSDs. If desired, this can be overridden for each node and each device.</li> <li><code>encryptedDevice</code>**: Encrypt OSD volumes using dmcrypt ("true" or "false"). By default this option is disabled. See <a href=http://docs.ceph.com/docs/master/ceph-volume/lvm/encryption/ >encryption</a> for more information on encryption in Ceph. (Resizing is not supported for host-based clusters.)</li> <li><code>crushRoot</code>: The value of the <code>root</code> CRUSH map label. The default is <code>default</code>. Generally, you should not need to change this. However, if any of your topology labels may have the value <code>default</code>, you need to change <code>crushRoot</code> to avoid conflicts, since CRUSH map values need to be unique.</li> </ul> <p>Allowed configurations are:</p> <table> <thead> <tr> <th style="text-align: left;">block device type</th> <th style="text-align: left;">host-based cluster</th> <th style="text-align: left;">PVC-based cluster</th> </tr> </thead> <tbody> <tr> <td style="text-align: left;">disk</td> <td style="text-align: left;"></td> <td style="text-align: left;"></td> </tr> <tr> <td style="text-align: left;">part</td> <td style="text-align: left;"><code>encryptedDevice</code> must be <code>false</code></td> <td style="text-align: left;"><code>encrypted</code> must be <code>false</code></td> </tr> <tr> <td style="text-align: left;">lvm</td> <td style="text-align: left;"><code>metadataDevice</code> must be <code>""</code>, <code>osdsPerDevice</code> must be <code>1</code>, and <code>encryptedDevice</code> must be <code>false</code></td> <td style="text-align: left;"><code>metadata.name</code> must not be <code>metadata</code> or <code>wal</code> and <code>encrypted</code> must be <code>false</code></td> </tr> <tr> <td style="text-align: left;">crypt</td> <td style="text-align: left;"></td> <td style="text-align: left;"></td> </tr> <tr> <td style="text-align: left;">mpath</td> <td style="text-align: left;"></td> <td style="text-align: left;"></td> </tr> </tbody> </table> <h4 id=limitations-of-metadata-device>Limitations of metadata device<a class=headerlink href=#limitations-of-metadata-device title="Permanent link">&para;</a></h4> <ul> <li>If <code>metadataDevice</code> is specified in the global OSD configuration or in the node level OSD configuration, the metadata device will be shared between all OSDs on the same node. In other words, OSDs will be initialized by <code>lvm batch</code>. In this case, we can't use partition device.</li> <li>If <code>metadataDevice</code> is specified in the device local configuration, we can use partition as metadata device. In other words, OSDs are initialized by <code>lvm prepare</code>.</li> </ul> <h3 id=annotations-and-labels>Annotations and Labels<a class=headerlink href=#annotations-and-labels title="Permanent link">&para;</a></h3> <p>Annotations and Labels can be specified so that the Rook components will have those annotations / labels added to them.</p> <p>You can set annotations / labels for Rook components for the list of key value pairs:</p> <ul> <li><code>all</code>: Set annotations / labels for all components except <code>clusterMetadata</code>.</li> <li><code>mgr</code>: Set annotations / labels for MGRs</li> <li><code>mon</code>: Set annotations / labels for mons</li> <li><code>osd</code>: Set annotations / labels for OSDs</li> <li><code>prepareosd</code>: Set annotations / labels for OSD Prepare Jobs</li> <li><code>monitoring</code>: Set annotations / labels for service monitor</li> <li><code>crashcollector</code>: Set annotations / labels for crash collectors</li> <li><code>clusterMetadata</code>: Set annotations only to <code>rook-ceph-mon-endpoints</code> configmap and the <code>rook-ceph-mon</code> and <code>rook-ceph-admin-keyring</code> secrets. These annotations will not be merged with the <code>all</code> annotations. The common usage is for backing up these critical resources with <code>kubed</code>. Note the clusterMetadata annotation will not be merged with the <code>all</code> annotation. When other keys are set, <code>all</code> will be merged together with the specific component.</li> </ul> <h3 id=placement-configuration-settings>Placement Configuration Settings<a class=headerlink href=#placement-configuration-settings title="Permanent link">&para;</a></h3> <p>Placement configuration for the cluster services. It includes the following keys: <code>mgr</code>, <code>mon</code>, <code>arbiter</code>, <code>osd</code>, <code>prepareosd</code>, <code>cleanup</code>, and <code>all</code>. Each service will have its placement configuration generated by merging the generic configuration under <code>all</code> with the most specific one (which will override any attributes).</p> <p>In stretch clusters, if the <code>arbiter</code> placement is specified, that placement will only be applied to the arbiter. Neither will the <code>arbiter</code> placement be merged with the <code>all</code> placement to allow the arbiter to be fully independent of other daemon placement. The remaining mons will still use the <code>mon</code> and/or <code>all</code> sections.</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>Placement of OSD pods is controlled using the <a href=#storage-class-device-sets>Storage Class Device Set</a>, not the general <code>placement</code> configuration.</p> </div> <p>A Placement configuration is specified (according to the kubernetes PodSpec) as:</p> <ul> <li><code>nodeAffinity</code>: kubernetes <a href=https://kubernetes.io/docs/concepts/configuration/assign-pod-node/#node-affinity-beta-feature>NodeAffinity</a></li> <li><code>podAffinity</code>: kubernetes <a href=https://kubernetes.io/docs/concepts/configuration/assign-pod-node/#inter-pod-affinity-and-anti-affinity-beta-feature>PodAffinity</a></li> <li><code>podAntiAffinity</code>: kubernetes <a href=https://kubernetes.io/docs/concepts/configuration/assign-pod-node/#inter-pod-affinity-and-anti-affinity-beta-feature>PodAntiAffinity</a></li> <li><code>tolerations</code>: list of kubernetes <a href=https://kubernetes.io/docs/concepts/configuration/taint-and-toleration/ >Toleration</a></li> <li><code>topologySpreadConstraints</code>: kubernetes <a href=https://kubernetes.io/docs/concepts/workloads/pods/pod-topology-spread-constraints/ >TopologySpreadConstraints</a></li> </ul> <p>If you use <code>labelSelector</code> for <code>osd</code> pods, you must write two rules both for <code>rook-ceph-osd</code> and <code>rook-ceph-osd-prepare</code> like <a href=https://github.com/rook/rook/blob/master/deploy/examples/cluster-on-pvc.yaml#L68>the example configuration</a>. It comes from the design that there are these two pods for an OSD. For more detail, see the <a href=https://github.com/rook/rook/blob/release-1.13/design/ceph/dedicated-osd-pod.md>osd design doc</a> and <a href=https://github.com/rook/rook/issues/4582>the related issue</a>.</p> <p>The Rook Ceph operator creates a Job called <code>rook-ceph-detect-version</code> to detect the full Ceph version used by the given <code>cephVersion.image</code>. The placement from the <code>mon</code> section is used for the Job except for the <code>PodAntiAffinity</code> field.</p> <h4 id=placement-example>Placement Example<a class=headerlink href=#placement-example title="Permanent link">&para;</a></h4> <p>To control where various services will be scheduled by kubernetes, use the placement configuration sections below. The example under 'all' would have all services scheduled on kubernetes nodes labeled with 'role=storage-node<code>. Specific node affinity and tolerations that only apply to the</code>mon<code>daemons in this example require the label</code>role=storage-mon-node` and also tolerate the control plane taint.</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-5-1> 1</a></span>
<span class=normal><a href=#__codelineno-5-2> 2</a></span>
<span class=normal><a href=#__codelineno-5-3> 3</a></span>
<span class=normal><a href=#__codelineno-5-4> 4</a></span>
<span class=normal><a href=#__codelineno-5-5> 5</a></span>
<span class=normal><a href=#__codelineno-5-6> 6</a></span>
<span class=normal><a href=#__codelineno-5-7> 7</a></span>
<span class=normal><a href=#__codelineno-5-8> 8</a></span>
<span class=normal><a href=#__codelineno-5-9> 9</a></span>
<span class=normal><a href=#__codelineno-5-10>10</a></span>
<span class=normal><a href=#__codelineno-5-11>11</a></span>
<span class=normal><a href=#__codelineno-5-12>12</a></span>
<span class=normal><a href=#__codelineno-5-13>13</a></span>
<span class=normal><a href=#__codelineno-5-14>14</a></span>
<span class=normal><a href=#__codelineno-5-15>15</a></span>
<span class=normal><a href=#__codelineno-5-16>16</a></span>
<span class=normal><a href=#__codelineno-5-17>17</a></span>
<span class=normal><a href=#__codelineno-5-18>18</a></span>
<span class=normal><a href=#__codelineno-5-19>19</a></span>
<span class=normal><a href=#__codelineno-5-20>20</a></span>
<span class=normal><a href=#__codelineno-5-21>21</a></span>
<span class=normal><a href=#__codelineno-5-22>22</a></span>
<span class=normal><a href=#__codelineno-5-23>23</a></span>
<span class=normal><a href=#__codelineno-5-24>24</a></span>
<span class=normal><a href=#__codelineno-5-25>25</a></span>
<span class=normal><a href=#__codelineno-5-26>26</a></span>
<span class=normal><a href=#__codelineno-5-27>27</a></span>
<span class=normal><a href=#__codelineno-5-28>28</a></span>
<span class=normal><a href=#__codelineno-5-29>29</a></span>
<span class=normal><a href=#__codelineno-5-30>30</a></span>
<span class=normal><a href=#__codelineno-5-31>31</a></span>
<span class=normal><a href=#__codelineno-5-32>32</a></span>
<span class=normal><a href=#__codelineno-5-33>33</a></span>
<span class=normal><a href=#__codelineno-5-34>34</a></span>
<span class=normal><a href=#__codelineno-5-35>35</a></span>
<span class=normal><a href=#__codelineno-5-36>36</a></span>
<span class=normal><a href=#__codelineno-5-37>37</a></span>
<span class=normal><a href=#__codelineno-5-38>38</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-5-1 name=__codelineno-5-1></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ceph.rook.io/v1</span>
<a id=__codelineno-5-2 name=__codelineno-5-2></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">CephCluster</span>
<a id=__codelineno-5-3 name=__codelineno-5-3></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-5-4 name=__codelineno-5-4></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rook-ceph</span>
<a id=__codelineno-5-5 name=__codelineno-5-5></a><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rook-ceph</span>
<a id=__codelineno-5-6 name=__codelineno-5-6></a><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-5-7 name=__codelineno-5-7></a><span class=w>  </span><span class=nt>cephVersion</span><span class=p>:</span>
<a id=__codelineno-5-8 name=__codelineno-5-8></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">quay.io/ceph/ceph:v18.2.1</span>
<a id=__codelineno-5-9 name=__codelineno-5-9></a><span class=w>  </span><span class=nt>dataDirHostPath</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/var/lib/rook</span>
<a id=__codelineno-5-10 name=__codelineno-5-10></a><span class=w>  </span><span class=nt>mon</span><span class=p>:</span>
<a id=__codelineno-5-11 name=__codelineno-5-11></a><span class=w>    </span><span class=nt>count</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
<a id=__codelineno-5-12 name=__codelineno-5-12></a><span class=w>    </span><span class=nt>allowMultiplePerNode</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<a id=__codelineno-5-13 name=__codelineno-5-13></a><span class=w>  </span><span class=c1># enable the ceph dashboard for viewing cluster status</span>
<a id=__codelineno-5-14 name=__codelineno-5-14></a><span class=w>  </span><span class=nt>dashboard</span><span class=p>:</span>
<a id=__codelineno-5-15 name=__codelineno-5-15></a><span class=w>    </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<a id=__codelineno-5-16 name=__codelineno-5-16></a><span class=w>  </span><span class=nt>placement</span><span class=p>:</span>
<a id=__codelineno-5-17 name=__codelineno-5-17></a><span class=w>    </span><span class=nt>all</span><span class=p>:</span>
<a id=__codelineno-5-18 name=__codelineno-5-18></a><span class=w>      </span><span class=nt>nodeAffinity</span><span class=p>:</span>
<a id=__codelineno-5-19 name=__codelineno-5-19></a><span class=w>        </span><span class=nt>requiredDuringSchedulingIgnoredDuringExecution</span><span class=p>:</span>
<a id=__codelineno-5-20 name=__codelineno-5-20></a><span class=w>          </span><span class=nt>nodeSelectorTerms</span><span class=p>:</span>
<a id=__codelineno-5-21 name=__codelineno-5-21></a><span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>matchExpressions</span><span class=p>:</span>
<a id=__codelineno-5-22 name=__codelineno-5-22></a><span class=w>            </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">role</span>
<a id=__codelineno-5-23 name=__codelineno-5-23></a><span class=w>              </span><span class=nt>operator</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">In</span>
<a id=__codelineno-5-24 name=__codelineno-5-24></a><span class=w>              </span><span class=nt>values</span><span class=p>:</span>
<a id=__codelineno-5-25 name=__codelineno-5-25></a><span class=w>              </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">storage-node</span>
<a id=__codelineno-5-26 name=__codelineno-5-26></a><span class=w>    </span><span class=nt>mon</span><span class=p>:</span>
<a id=__codelineno-5-27 name=__codelineno-5-27></a><span class=w>      </span><span class=nt>nodeAffinity</span><span class=p>:</span>
<a id=__codelineno-5-28 name=__codelineno-5-28></a><span class=w>        </span><span class=nt>requiredDuringSchedulingIgnoredDuringExecution</span><span class=p>:</span>
<a id=__codelineno-5-29 name=__codelineno-5-29></a><span class=w>          </span><span class=nt>nodeSelectorTerms</span><span class=p>:</span>
<a id=__codelineno-5-30 name=__codelineno-5-30></a><span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>matchExpressions</span><span class=p>:</span>
<a id=__codelineno-5-31 name=__codelineno-5-31></a><span class=w>            </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">role</span>
<a id=__codelineno-5-32 name=__codelineno-5-32></a><span class=w>              </span><span class=nt>operator</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">In</span>
<a id=__codelineno-5-33 name=__codelineno-5-33></a><span class=w>              </span><span class=nt>values</span><span class=p>:</span>
<a id=__codelineno-5-34 name=__codelineno-5-34></a><span class=w>              </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">storage-mon-node</span>
<a id=__codelineno-5-35 name=__codelineno-5-35></a><span class=w>      </span><span class=nt>tolerations</span><span class=p>:</span>
<a id=__codelineno-5-36 name=__codelineno-5-36></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>effect</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">NoSchedule</span>
<a id=__codelineno-5-37 name=__codelineno-5-37></a><span class=w>        </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">node-role.kubernetes.io/control-plane</span>
<a id=__codelineno-5-38 name=__codelineno-5-38></a><span class=w>        </span><span class=nt>operator</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Exists</span>
</code></pre></div></td></tr></table></div> <h3 id=cluster-wide-resources-configuration-settings>Cluster-wide Resources Configuration Settings<a class=headerlink href=#cluster-wide-resources-configuration-settings title="Permanent link">&para;</a></h3> <p>Resources should be specified so that the Rook components are handled after <a href=https://kubernetes.io/docs/tasks/configure-pod-container/quality-service-pod/ >Kubernetes Pod Quality of Service classes</a>. This allows to keep Rook components running when for example a node runs out of memory and the Rook components are not killed depending on their Quality of Service class.</p> <p>You can set resource requests/limits for Rook components through the <a href=#resource-requirementslimits>Resource Requirements/Limits</a> structure in the following keys:</p> <ul> <li><code>mon</code>: Set resource requests/limits for mons</li> <li><code>osd</code>: Set resource requests/limits for OSDs. This key applies for all OSDs regardless of their device classes. In case of need to apply resource requests/limits for OSDs with particular device class use specific osd keys below. If the memory resource is declared Rook will automatically set the OSD configuration <code>osd_memory_target</code> to the same value. This aims to ensure that the actual OSD memory consumption is consistent with the OSD pods' resource declaration.</li> <li><code>osd-&lt;deviceClass&gt;</code>: Set resource requests/limits for OSDs on a specific device class. Rook will automatically detect <code>hdd</code>, <code>ssd</code>, or <code>nvme</code> device classes. Custom device classes can also be set.</li> <li><code>mgr</code>: Set resource requests/limits for MGRs</li> <li><code>mgr-sidecar</code>: Set resource requests/limits for the MGR sidecar, which is only created when <code>mgr.count: 2</code>. The sidecar requires very few resources since it only executes every 15 seconds to query Ceph for the active mgr and update the mgr services if the active mgr changed.</li> <li><code>prepareosd</code>: Set resource requests/limits for OSD prepare job</li> <li><code>crashcollector</code>: Set resource requests/limits for crash. This pod runs wherever there is a Ceph pod running. It scrapes for Ceph daemon core dumps and sends them to the Ceph manager crash module so that core dumps are centralized and can be easily listed/accessed. You can read more about the <a href=https://docs.ceph.com/docs/master/mgr/crash/ >Ceph Crash module</a>.</li> <li><code>logcollector</code>: Set resource requests/limits for the log collector. When enabled, this container runs as side-car to each Ceph daemons.</li> <li><code>cleanup</code>: Set resource requests/limits for cleanup job, responsible for wiping cluster's data after uninstall</li> <li><code>exporter</code>: Set resource requests/limits for Ceph exporter.</li> </ul> <p>In order to provide the best possible experience running Ceph in containers, Rook internally recommends minimum memory limits if resource limits are passed. If a user configures a limit or request value that is too low, Rook will still run the pod(s) and print a warning to the operator log.</p> <ul> <li><code>mon</code>: 1024MB</li> <li><code>mgr</code>: 512MB</li> <li><code>osd</code>: 2048MB</li> <li><code>crashcollector</code>: 60MB</li> <li><code>mgr-sidecar</code>: 100MB limit, 40MB requests</li> <li><code>prepareosd</code>: no limits (see the note)</li> <li><code>exporter</code>: 128MB limit, 50MB requests</li> </ul> <div class="admonition note"> <p class=admonition-title>Note</p> <p>We recommend not setting memory limits on the OSD prepare job to prevent OSD provisioning failure due to memory constraints. The OSD prepare job bursts memory usage during the OSD provisioning depending on the size of the device, typically 1-2Gi for large disks. The OSD prepare job only bursts a single time per OSD. All future runs of the OSD prepare job will detect the OSD is already provisioned and skip the provisioning.</p> </div> <div class="admonition hint"> <p class=admonition-title>Hint</p> <p>The resources for MDS daemons are not configured in the Cluster. Refer to the <a href=../../Shared-Filesystem/ceph-filesystem-crd/ >Ceph Filesystem CRD</a> instead.</p> </div> <h3 id=resource-requirementslimits>Resource Requirements/Limits<a class=headerlink href=#resource-requirementslimits title="Permanent link">&para;</a></h3> <p>For more information on resource requests/limits see the official Kubernetes documentation: <a href=https://kubernetes.io/docs/concepts/configuration/manage-compute-resources-container/#resource-requests-and-limits-of-pod-and-container>Kubernetes - Managing Compute Resources for Containers</a></p> <ul> <li><code>requests</code>: Requests for cpu or memory.<ul> <li><code>cpu</code>: Request for CPU (example: one CPU core <code>1</code>, 50% of one CPU core <code>500m</code>).</li> <li><code>memory</code>: Limit for Memory (example: one gigabyte of memory <code>1Gi</code>, half a gigabyte of memory <code>512Mi</code>).</li> </ul> </li> <li><code>limits</code>: Limits for cpu or memory.<ul> <li><code>cpu</code>: Limit for CPU (example: one CPU core <code>1</code>, 50% of one CPU core <code>500m</code>).</li> <li><code>memory</code>: Limit for Memory (example: one gigabyte of memory <code>1Gi</code>, half a gigabyte of memory <code>512Mi</code>).</li> </ul> </li> </ul> <div class="admonition warning"> <p class=admonition-title>Warning</p> <p>Before setting resource requests/limits, please take a look at the Ceph documentation for recommendations for each component: <a href=http://docs.ceph.com/docs/master/start/hardware-recommendations/ >Ceph - Hardware Recommendations</a>.</p> </div> <h4 id=node-specific-resources-for-osds>Node Specific Resources for OSDs<a class=headerlink href=#node-specific-resources-for-osds title="Permanent link">&para;</a></h4> <p>This example shows that you can override these requests/limits for OSDs per node when using <code>useAllNodes: false</code> in the <code>node</code> item in the <code>nodes</code> list.</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-6-1> 1</a></span>
<span class=normal><a href=#__codelineno-6-2> 2</a></span>
<span class=normal><a href=#__codelineno-6-3> 3</a></span>
<span class=normal><a href=#__codelineno-6-4> 4</a></span>
<span class=normal><a href=#__codelineno-6-5> 5</a></span>
<span class=normal><a href=#__codelineno-6-6> 6</a></span>
<span class=normal><a href=#__codelineno-6-7> 7</a></span>
<span class=normal><a href=#__codelineno-6-8> 8</a></span>
<span class=normal><a href=#__codelineno-6-9> 9</a></span>
<span class=normal><a href=#__codelineno-6-10>10</a></span>
<span class=normal><a href=#__codelineno-6-11>11</a></span>
<span class=normal><a href=#__codelineno-6-12>12</a></span>
<span class=normal><a href=#__codelineno-6-13>13</a></span>
<span class=normal><a href=#__codelineno-6-14>14</a></span>
<span class=normal><a href=#__codelineno-6-15>15</a></span>
<span class=normal><a href=#__codelineno-6-16>16</a></span>
<span class=normal><a href=#__codelineno-6-17>17</a></span>
<span class=normal><a href=#__codelineno-6-18>18</a></span>
<span class=normal><a href=#__codelineno-6-19>19</a></span>
<span class=normal><a href=#__codelineno-6-20>20</a></span>
<span class=normal><a href=#__codelineno-6-21>21</a></span>
<span class=normal><a href=#__codelineno-6-22>22</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-6-1 name=__codelineno-6-1></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ceph.rook.io/v1</span>
<a id=__codelineno-6-2 name=__codelineno-6-2></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">CephCluster</span>
<a id=__codelineno-6-3 name=__codelineno-6-3></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-6-4 name=__codelineno-6-4></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rook-ceph</span>
<a id=__codelineno-6-5 name=__codelineno-6-5></a><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rook-ceph</span>
<a id=__codelineno-6-6 name=__codelineno-6-6></a><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-6-7 name=__codelineno-6-7></a><span class=w>  </span><span class=nt>cephVersion</span><span class=p>:</span>
<a id=__codelineno-6-8 name=__codelineno-6-8></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">quay.io/ceph/ceph:v18.2.1</span>
<a id=__codelineno-6-9 name=__codelineno-6-9></a><span class=w>  </span><span class=nt>dataDirHostPath</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/var/lib/rook</span>
<a id=__codelineno-6-10 name=__codelineno-6-10></a><span class=w>  </span><span class=nt>mon</span><span class=p>:</span>
<a id=__codelineno-6-11 name=__codelineno-6-11></a><span class=w>    </span><span class=nt>count</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
<a id=__codelineno-6-12 name=__codelineno-6-12></a><span class=w>    </span><span class=nt>allowMultiplePerNode</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<a id=__codelineno-6-13 name=__codelineno-6-13></a><span class=w>  </span><span class=nt>storage</span><span class=p>:</span>
<a id=__codelineno-6-14 name=__codelineno-6-14></a><span class=w>    </span><span class=nt>useAllNodes</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<a id=__codelineno-6-15 name=__codelineno-6-15></a><span class=w>    </span><span class=nt>nodes</span><span class=p>:</span>
<a id=__codelineno-6-16 name=__codelineno-6-16></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;172.17.4.201&quot;</span>
<a id=__codelineno-6-17 name=__codelineno-6-17></a><span class=w>      </span><span class=nt>resources</span><span class=p>:</span>
<a id=__codelineno-6-18 name=__codelineno-6-18></a><span class=w>        </span><span class=nt>limits</span><span class=p>:</span>
<a id=__codelineno-6-19 name=__codelineno-6-19></a><span class=w>          </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=s>&quot;4096Mi&quot;</span>
<a id=__codelineno-6-20 name=__codelineno-6-20></a><span class=w>        </span><span class=nt>requests</span><span class=p>:</span>
<a id=__codelineno-6-21 name=__codelineno-6-21></a><span class=w>          </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class=s>&quot;2&quot;</span>
<a id=__codelineno-6-22 name=__codelineno-6-22></a><span class=w>          </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=s>&quot;4096Mi&quot;</span>
</code></pre></div></td></tr></table></div> <h3 id=priority-class-names>Priority Class Names<a class=headerlink href=#priority-class-names title="Permanent link">&para;</a></h3> <p>Priority class names can be specified so that the Rook components will have those priority class names added to them.</p> <p>You can set priority class names for Rook components for the list of key value pairs:</p> <ul> <li><code>all</code>: Set priority class names for MGRs, Mons, OSDs, and crashcollectors.</li> <li><code>mgr</code>: Set priority class names for MGRs. Examples default to system-cluster-critical.</li> <li><code>mon</code>: Set priority class names for Mons. Examples default to system-node-critical.</li> <li><code>osd</code>: Set priority class names for OSDs. Examples default to system-node-critical.</li> <li><code>crashcollector</code>: Set priority class names for crashcollectors.</li> </ul> <p>The specific component keys will act as overrides to <code>all</code>.</p> <h3 id=health-settings>Health settings<a class=headerlink href=#health-settings title="Permanent link">&para;</a></h3> <p>The Rook Ceph operator will monitor the state of the CephCluster on various components by default. The following CRD settings are available:</p> <ul> <li><code>healthCheck</code>: main ceph cluster health monitoring section</li> </ul> <p>Currently three health checks are implemented:</p> <ul> <li><code>mon</code>: health check on the ceph monitors, basically check whether monitors are members of the quorum. If after a certain timeout a given monitor has not joined the quorum back it will be failed over and replace by a new monitor.</li> <li><code>osd</code>: health check on the ceph osds</li> <li><code>status</code>: ceph health status check, periodically check the Ceph health state and reflects it in the CephCluster CR status field.</li> </ul> <p>The liveness probe and startup probe of each daemon can also be controlled via <code>livenessProbe</code> and <code>startupProbe</code> respectively. The settings are valid for <code>mon</code>, <code>mgr</code> and <code>osd</code>. Here is a complete example for both <code>daemonHealth</code>, <code>livenessProbe</code>, and <code>startupProbe</code>:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-7-1> 1</a></span>
<span class=normal><a href=#__codelineno-7-2> 2</a></span>
<span class=normal><a href=#__codelineno-7-3> 3</a></span>
<span class=normal><a href=#__codelineno-7-4> 4</a></span>
<span class=normal><a href=#__codelineno-7-5> 5</a></span>
<span class=normal><a href=#__codelineno-7-6> 6</a></span>
<span class=normal><a href=#__codelineno-7-7> 7</a></span>
<span class=normal><a href=#__codelineno-7-8> 8</a></span>
<span class=normal><a href=#__codelineno-7-9> 9</a></span>
<span class=normal><a href=#__codelineno-7-10>10</a></span>
<span class=normal><a href=#__codelineno-7-11>11</a></span>
<span class=normal><a href=#__codelineno-7-12>12</a></span>
<span class=normal><a href=#__codelineno-7-13>13</a></span>
<span class=normal><a href=#__codelineno-7-14>14</a></span>
<span class=normal><a href=#__codelineno-7-15>15</a></span>
<span class=normal><a href=#__codelineno-7-16>16</a></span>
<span class=normal><a href=#__codelineno-7-17>17</a></span>
<span class=normal><a href=#__codelineno-7-18>18</a></span>
<span class=normal><a href=#__codelineno-7-19>19</a></span>
<span class=normal><a href=#__codelineno-7-20>20</a></span>
<span class=normal><a href=#__codelineno-7-21>21</a></span>
<span class=normal><a href=#__codelineno-7-22>22</a></span>
<span class=normal><a href=#__codelineno-7-23>23</a></span>
<span class=normal><a href=#__codelineno-7-24>24</a></span>
<span class=normal><a href=#__codelineno-7-25>25</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-7-1 name=__codelineno-7-1></a><span class=nt>healthCheck</span><span class=p>:</span>
<a id=__codelineno-7-2 name=__codelineno-7-2></a><span class=w>  </span><span class=nt>daemonHealth</span><span class=p>:</span>
<a id=__codelineno-7-3 name=__codelineno-7-3></a><span class=w>    </span><span class=nt>mon</span><span class=p>:</span>
<a id=__codelineno-7-4 name=__codelineno-7-4></a><span class=w>      </span><span class=nt>disabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<a id=__codelineno-7-5 name=__codelineno-7-5></a><span class=w>      </span><span class=nt>interval</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">45s</span>
<a id=__codelineno-7-6 name=__codelineno-7-6></a><span class=w>      </span><span class=nt>timeout</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">600s</span>
<a id=__codelineno-7-7 name=__codelineno-7-7></a><span class=w>    </span><span class=nt>osd</span><span class=p>:</span>
<a id=__codelineno-7-8 name=__codelineno-7-8></a><span class=w>      </span><span class=nt>disabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<a id=__codelineno-7-9 name=__codelineno-7-9></a><span class=w>      </span><span class=nt>interval</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">60s</span>
<a id=__codelineno-7-10 name=__codelineno-7-10></a><span class=w>    </span><span class=nt>status</span><span class=p>:</span>
<a id=__codelineno-7-11 name=__codelineno-7-11></a><span class=w>      </span><span class=nt>disabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<a id=__codelineno-7-12 name=__codelineno-7-12></a><span class=w>  </span><span class=nt>livenessProbe</span><span class=p>:</span>
<a id=__codelineno-7-13 name=__codelineno-7-13></a><span class=w>    </span><span class=nt>mon</span><span class=p>:</span>
<a id=__codelineno-7-14 name=__codelineno-7-14></a><span class=w>      </span><span class=nt>disabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<a id=__codelineno-7-15 name=__codelineno-7-15></a><span class=w>    </span><span class=nt>mgr</span><span class=p>:</span>
<a id=__codelineno-7-16 name=__codelineno-7-16></a><span class=w>      </span><span class=nt>disabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<a id=__codelineno-7-17 name=__codelineno-7-17></a><span class=w>    </span><span class=nt>osd</span><span class=p>:</span>
<a id=__codelineno-7-18 name=__codelineno-7-18></a><span class=w>      </span><span class=nt>disabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<a id=__codelineno-7-19 name=__codelineno-7-19></a><span class=w>  </span><span class=nt>startupProbe</span><span class=p>:</span>
<a id=__codelineno-7-20 name=__codelineno-7-20></a><span class=w>    </span><span class=nt>mon</span><span class=p>:</span>
<a id=__codelineno-7-21 name=__codelineno-7-21></a><span class=w>      </span><span class=nt>disabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<a id=__codelineno-7-22 name=__codelineno-7-22></a><span class=w>    </span><span class=nt>mgr</span><span class=p>:</span>
<a id=__codelineno-7-23 name=__codelineno-7-23></a><span class=w>      </span><span class=nt>disabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<a id=__codelineno-7-24 name=__codelineno-7-24></a><span class=w>    </span><span class=nt>osd</span><span class=p>:</span>
<a id=__codelineno-7-25 name=__codelineno-7-25></a><span class=w>      </span><span class=nt>disabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
</code></pre></div></td></tr></table></div> <p>The probe's timing values and thresholds (but not the probe itself) can also be overridden. For more info, refer to the <a href=https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/#define-a-liveness-command>Kubernetes documentation</a>.</p> <p>For example, you could change the <code>mgr</code> probe by applying:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-8-1> 1</a></span>
<span class=normal><a href=#__codelineno-8-2> 2</a></span>
<span class=normal><a href=#__codelineno-8-3> 3</a></span>
<span class=normal><a href=#__codelineno-8-4> 4</a></span>
<span class=normal><a href=#__codelineno-8-5> 5</a></span>
<span class=normal><a href=#__codelineno-8-6> 6</a></span>
<span class=normal><a href=#__codelineno-8-7> 7</a></span>
<span class=normal><a href=#__codelineno-8-8> 8</a></span>
<span class=normal><a href=#__codelineno-8-9> 9</a></span>
<span class=normal><a href=#__codelineno-8-10>10</a></span>
<span class=normal><a href=#__codelineno-8-11>11</a></span>
<span class=normal><a href=#__codelineno-8-12>12</a></span>
<span class=normal><a href=#__codelineno-8-13>13</a></span>
<span class=normal><a href=#__codelineno-8-14>14</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-8-1 name=__codelineno-8-1></a><span class=nt>healthCheck</span><span class=p>:</span>
<a id=__codelineno-8-2 name=__codelineno-8-2></a><span class=w>  </span><span class=nt>startupProbe</span><span class=p>:</span>
<a id=__codelineno-8-3 name=__codelineno-8-3></a><span class=w>    </span><span class=nt>mgr</span><span class=p>:</span>
<a id=__codelineno-8-4 name=__codelineno-8-4></a><span class=w>      </span><span class=nt>disabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<a id=__codelineno-8-5 name=__codelineno-8-5></a><span class=w>      </span><span class=nt>probe</span><span class=p>:</span>
<a id=__codelineno-8-6 name=__codelineno-8-6></a><span class=w>        </span><span class=nt>initialDelaySeconds</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
<a id=__codelineno-8-7 name=__codelineno-8-7></a><span class=w>        </span><span class=nt>periodSeconds</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
<a id=__codelineno-8-8 name=__codelineno-8-8></a><span class=w>        </span><span class=nt>failureThreshold</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">30</span>
<a id=__codelineno-8-9 name=__codelineno-8-9></a><span class=w>  </span><span class=nt>livenessProbe</span><span class=p>:</span>
<a id=__codelineno-8-10 name=__codelineno-8-10></a><span class=w>    </span><span class=nt>mgr</span><span class=p>:</span>
<a id=__codelineno-8-11 name=__codelineno-8-11></a><span class=w>      </span><span class=nt>disabled</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<a id=__codelineno-8-12 name=__codelineno-8-12></a><span class=w>      </span><span class=nt>probe</span><span class=p>:</span>
<a id=__codelineno-8-13 name=__codelineno-8-13></a><span class=w>        </span><span class=nt>initialDelaySeconds</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
<a id=__codelineno-8-14 name=__codelineno-8-14></a><span class=w>        </span><span class=nt>periodSeconds</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
</code></pre></div></td></tr></table></div> <p>Changing the liveness probe is an advanced operation and should rarely be necessary. If you want to change these settings then modify the desired settings.</p> <h2 id=status>Status<a class=headerlink href=#status title="Permanent link">&para;</a></h2> <p>The operator is regularly configuring and checking the health of the cluster. The results of the configuration and health checks can be seen in the <code>status</code> section of the CephCluster CR.</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-9-1>1</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-9-1 name=__codelineno-9-1></a><span class=go>kubectl -n rook-ceph get CephCluster -o yaml</span>
</code></pre></div></td></tr></table></div> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-10-1> 1</a></span>
<span class=normal><a href=#__codelineno-10-2> 2</a></span>
<span class=normal><a href=#__codelineno-10-3> 3</a></span>
<span class=normal><a href=#__codelineno-10-4> 4</a></span>
<span class=normal><a href=#__codelineno-10-5> 5</a></span>
<span class=normal><a href=#__codelineno-10-6> 6</a></span>
<span class=normal><a href=#__codelineno-10-7> 7</a></span>
<span class=normal><a href=#__codelineno-10-8> 8</a></span>
<span class=normal><a href=#__codelineno-10-9> 9</a></span>
<span class=normal><a href=#__codelineno-10-10>10</a></span>
<span class=normal><a href=#__codelineno-10-11>11</a></span>
<span class=normal><a href=#__codelineno-10-12>12</a></span>
<span class=normal><a href=#__codelineno-10-13>13</a></span>
<span class=normal><a href=#__codelineno-10-14>14</a></span>
<span class=normal><a href=#__codelineno-10-15>15</a></span>
<span class=normal><a href=#__codelineno-10-16>16</a></span>
<span class=normal><a href=#__codelineno-10-17>17</a></span>
<span class=normal><a href=#__codelineno-10-18>18</a></span>
<span class=normal><a href=#__codelineno-10-19>19</a></span>
<span class=normal><a href=#__codelineno-10-20>20</a></span>
<span class=normal><a href=#__codelineno-10-21>21</a></span>
<span class=normal><a href=#__codelineno-10-22>22</a></span>
<span class=normal><a href=#__codelineno-10-23>23</a></span>
<span class=normal><a href=#__codelineno-10-24>24</a></span>
<span class=normal><a href=#__codelineno-10-25>25</a></span>
<span class=normal><a href=#__codelineno-10-26>26</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-10-1 name=__codelineno-10-1></a><span class="p p-Indicator">[</span><span class=nv>...</span><span class="p p-Indicator">]</span>
<a id=__codelineno-10-2 name=__codelineno-10-2></a><span class=w>  </span><span class=nt>status</span><span class=p>:</span>
<a id=__codelineno-10-3 name=__codelineno-10-3></a><span class=w>    </span><span class=nt>ceph</span><span class=p>:</span>
<a id=__codelineno-10-4 name=__codelineno-10-4></a><span class=w>      </span><span class=nt>health</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">HEALTH_OK</span>
<a id=__codelineno-10-5 name=__codelineno-10-5></a><span class=w>      </span><span class=nt>lastChecked</span><span class=p>:</span><span class=w> </span><span class=s>&quot;2021-03-02T21:22:11Z&quot;</span>
<a id=__codelineno-10-6 name=__codelineno-10-6></a><span class=w>      </span><span class=nt>capacity</span><span class=p>:</span>
<a id=__codelineno-10-7 name=__codelineno-10-7></a><span class=w>        </span><span class=nt>bytesAvailable</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">22530293760</span>
<a id=__codelineno-10-8 name=__codelineno-10-8></a><span class=w>        </span><span class=nt>bytesTotal</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">25757220864</span>
<a id=__codelineno-10-9 name=__codelineno-10-9></a><span class=w>        </span><span class=nt>bytesUsed</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">3226927104</span>
<a id=__codelineno-10-10 name=__codelineno-10-10></a><span class=w>        </span><span class=nt>lastUpdated</span><span class=p>:</span><span class=w> </span><span class=s>&quot;2021-03-02T21:22:11Z&quot;</span>
<a id=__codelineno-10-11 name=__codelineno-10-11></a><span class=w>    </span><span class=nt>message</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Cluster created successfully</span>
<a id=__codelineno-10-12 name=__codelineno-10-12></a><span class=w>    </span><span class=nt>phase</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Ready</span>
<a id=__codelineno-10-13 name=__codelineno-10-13></a><span class=w>    </span><span class=nt>state</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Created</span>
<a id=__codelineno-10-14 name=__codelineno-10-14></a><span class=w>    </span><span class=nt>storage</span><span class=p>:</span>
<a id=__codelineno-10-15 name=__codelineno-10-15></a><span class=w>      </span><span class=nt>deviceClasses</span><span class=p>:</span>
<a id=__codelineno-10-16 name=__codelineno-10-16></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">hdd</span>
<a id=__codelineno-10-17 name=__codelineno-10-17></a><span class=w>    </span><span class=nt>version</span><span class=p>:</span>
<a id=__codelineno-10-18 name=__codelineno-10-18></a><span class=w>      </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">quay.io/ceph/ceph:v18.2.1</span>
<a id=__codelineno-10-19 name=__codelineno-10-19></a><span class=w>      </span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">16.2.6-0</span>
<a id=__codelineno-10-20 name=__codelineno-10-20></a><span class=w>    </span><span class=nt>conditions</span><span class=p>:</span>
<a id=__codelineno-10-21 name=__codelineno-10-21></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>lastHeartbeatTime</span><span class=p>:</span><span class=w> </span><span class=s>&quot;2021-03-02T21:22:11Z&quot;</span>
<a id=__codelineno-10-22 name=__codelineno-10-22></a><span class=w>      </span><span class=nt>lastTransitionTime</span><span class=p>:</span><span class=w> </span><span class=s>&quot;2021-03-02T21:21:09Z&quot;</span>
<a id=__codelineno-10-23 name=__codelineno-10-23></a><span class=w>      </span><span class=nt>message</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Cluster created successfully</span>
<a id=__codelineno-10-24 name=__codelineno-10-24></a><span class=w>      </span><span class=nt>reason</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ClusterCreated</span>
<a id=__codelineno-10-25 name=__codelineno-10-25></a><span class=w>      </span><span class=nt>status</span><span class=p>:</span><span class=w> </span><span class=s>&quot;True&quot;</span>
<a id=__codelineno-10-26 name=__codelineno-10-26></a><span class=w>      </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Ready</span>
</code></pre></div></td></tr></table></div> <h3 id=ceph-status>Ceph Status<a class=headerlink href=#ceph-status title="Permanent link">&para;</a></h3> <p>Ceph is constantly monitoring the health of the data plane and reporting back if there are any warnings or errors. If everything is healthy from Ceph's perspective, you will see <code>HEALTH_OK</code>.</p> <p>If Ceph reports any warnings or errors, the details will be printed to the status. If further troubleshooting is needed to resolve these issues, the toolbox will likely be needed where you can run <code>ceph</code> commands to find more details.</p> <p>The <code>capacity</code> of the cluster is reported, including bytes available, total, and used. The available space will be less that you may expect due to overhead in the OSDs.</p> <h3 id=conditions>Conditions<a class=headerlink href=#conditions title="Permanent link">&para;</a></h3> <p>The <code>conditions</code> represent the status of the Rook operator.</p> <ul> <li>If the cluster is fully configured and the operator is stable, the <code>Ready</code> condition is raised with <code>ClusterCreated</code> reason and no other conditions. The cluster will remain in the <code>Ready</code> condition after the first successful configuration since it is expected the storage is consumable from this point on. If there are issues preventing the storage layer from working, they are expected to show as Ceph health errors.</li> <li>If the cluster is externally connected successfully, the <code>Ready</code> condition will have the reason <code>ClusterConnected</code>.</li> <li>If the operator is currently being configured or the operator is checking for update, there will be a <code>Progressing</code> condition.</li> <li>If there was a failure, the condition(s) status will be <code>false</code> and the <code>message</code> will give a summary of the error. See the operator log for more details.</li> </ul> <h3 id=other-status>Other Status<a class=headerlink href=#other-status title="Permanent link">&para;</a></h3> <p>There are several other properties for the overall status including:</p> <ul> <li><code>message</code>, <code>phase</code>, and <code>state</code>: A summary of the overall current state of the cluster, which is somewhat duplicated from the conditions for backward compatibility.</li> <li><code>storage.deviceClasses</code>: The names of the types of storage devices that Ceph discovered in the cluster. These types will be <code>ssd</code> or <code>hdd</code> unless they have been overridden with the <code>crushDeviceClass</code> in the <code>storageClassDeviceSets</code>.</li> <li><code>version</code>: The version of the Ceph image currently deployed.</li> </ul> <h2 id=osd-topology>OSD Topology<a class=headerlink href=#osd-topology title="Permanent link">&para;</a></h2> <p>The topology of the cluster is important in production environments where you want your data spread across failure domains. The topology can be controlled by adding labels to the nodes. When the labels are found on a node at first OSD deployment, Rook will add them to the desired level in the <a href=https://docs.ceph.com/en/latest/rados/operations/crush-map/ >CRUSH map</a>.</p> <p>The complete list of labels in hierarchy order from highest to lowest is:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-11-1>1</a></span>
<span class=normal><a href=#__codelineno-11-2>2</a></span>
<span class=normal><a href=#__codelineno-11-3>3</a></span>
<span class=normal><a href=#__codelineno-11-4>4</a></span>
<span class=normal><a href=#__codelineno-11-5>5</a></span>
<span class=normal><a href=#__codelineno-11-6>6</a></span>
<span class=normal><a href=#__codelineno-11-7>7</a></span>
<span class=normal><a href=#__codelineno-11-8>8</a></span>
<span class=normal><a href=#__codelineno-11-9>9</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-11-1 name=__codelineno-11-1></a>topology.kubernetes.io/region
<a id=__codelineno-11-2 name=__codelineno-11-2></a>topology.kubernetes.io/zone
<a id=__codelineno-11-3 name=__codelineno-11-3></a>topology.rook.io/datacenter
<a id=__codelineno-11-4 name=__codelineno-11-4></a>topology.rook.io/room
<a id=__codelineno-11-5 name=__codelineno-11-5></a>topology.rook.io/pod
<a id=__codelineno-11-6 name=__codelineno-11-6></a>topology.rook.io/pdu
<a id=__codelineno-11-7 name=__codelineno-11-7></a>topology.rook.io/row
<a id=__codelineno-11-8 name=__codelineno-11-8></a>topology.rook.io/rack
<a id=__codelineno-11-9 name=__codelineno-11-9></a>topology.rook.io/chassis
</code></pre></div></td></tr></table></div> <p>For example, if the following labels were added to a node:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-12-1>1</a></span>
<span class=normal><a href=#__codelineno-12-2>2</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-12-1 name=__codelineno-12-1></a><span class=go>kubectl label node mynode topology.kubernetes.io/zone=zone1</span>
<a id=__codelineno-12-2 name=__codelineno-12-2></a><span class=go>kubectl label node mynode topology.rook.io/rack=zone1-rack1</span>
</code></pre></div></td></tr></table></div> <p>These labels would result in the following hierarchy for OSDs on that node (this command can be run in the Rook toolbox):</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-13-1>1</a></span>
<span class=normal><a href=#__codelineno-13-2>2</a></span>
<span class=normal><a href=#__codelineno-13-3>3</a></span>
<span class=normal><a href=#__codelineno-13-4>4</a></span>
<span class=normal><a href=#__codelineno-13-5>5</a></span>
<span class=normal><a href=#__codelineno-13-6>6</a></span>
<span class=normal><a href=#__codelineno-13-7>7</a></span>
<span class=normal><a href=#__codelineno-13-8>8</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-13-1 name=__codelineno-13-1></a><span class=gp>$ </span>ceph<span class=w> </span>osd<span class=w> </span>tree
<a id=__codelineno-13-2 name=__codelineno-13-2></a><span class=go>ID CLASS WEIGHT  TYPE NAME                 STATUS REWEIGHT PRI-AFF</span>
<a id=__codelineno-13-3 name=__codelineno-13-3></a><span class=go>-1       0.01358 root default</span>
<a id=__codelineno-13-4 name=__codelineno-13-4></a><span class=go>-5       0.01358     zone zone1</span>
<a id=__codelineno-13-5 name=__codelineno-13-5></a><span class=go>-4       0.01358         rack rack1</span>
<a id=__codelineno-13-6 name=__codelineno-13-6></a><span class=go>-3       0.01358             host mynode</span>
<a id=__codelineno-13-7 name=__codelineno-13-7></a><span class=go>0   hdd 0.00679                 osd.0         up  1.00000 1.00000</span>
<a id=__codelineno-13-8 name=__codelineno-13-8></a><span class=go>1   hdd 0.00679                 osd.1         up  1.00000 1.00000</span>
</code></pre></div></td></tr></table></div> <p>Ceph requires unique names at every level in the hierarchy (CRUSH map). For example, you cannot have two racks with the same name that are in different zones. Racks in different zones must be named uniquely.</p> <p>Note that the <code>host</code> is added automatically to the hierarchy by Rook. The host cannot be specified with a topology label. All topology labels are optional.</p> <div class="admonition hint"> <p class=admonition-title>Hint</p> <p>When setting the node labels prior to <code>CephCluster</code> creation, these settings take immediate effect. However, applying this to an already deployed <code>CephCluster</code> requires removing each node from the cluster first and then re-adding it with new configuration to take effect. Do this node by node to keep your data safe! Check the result with <code>ceph osd tree</code> from the <a href=../../../Troubleshooting/ceph-toolbox/ >Rook Toolbox</a>. The OSD tree should display the hierarchy for the nodes that already have been re-added.</p> </div> <p>To utilize the <code>failureDomain</code> based on the node labels, specify the corresponding option in the <a href=../../Block-Storage/ceph-block-pool-crd/ >CephBlockPool</a></p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-14-1>1</a></span>
<span class=normal><a href=#__codelineno-14-2>2</a></span>
<span class=normal><a href=#__codelineno-14-3>3</a></span>
<span class=normal><a href=#__codelineno-14-4>4</a></span>
<span class=normal><a href=#__codelineno-14-5>5</a></span>
<span class=normal><a href=#__codelineno-14-6>6</a></span>
<span class=normal><a href=#__codelineno-14-7>7</a></span>
<span class=normal><a href=#__codelineno-14-8>8</a></span>
<span class=normal><a href=#__codelineno-14-9>9</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-14-1 name=__codelineno-14-1></a><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ceph.rook.io/v1</span>
<a id=__codelineno-14-2 name=__codelineno-14-2></a><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">CephBlockPool</span>
<a id=__codelineno-14-3 name=__codelineno-14-3></a><span class=nt>metadata</span><span class=p>:</span>
<a id=__codelineno-14-4 name=__codelineno-14-4></a><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">replicapool</span>
<a id=__codelineno-14-5 name=__codelineno-14-5></a><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rook-ceph</span>
<a id=__codelineno-14-6 name=__codelineno-14-6></a><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-14-7 name=__codelineno-14-7></a><span class=w>  </span><span class=nt>failureDomain</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rack</span><span class=w>  </span><span class=c1># this matches the topology labels on nodes</span>
<a id=__codelineno-14-8 name=__codelineno-14-8></a><span class=w>  </span><span class=nt>replicated</span><span class=p>:</span>
<a id=__codelineno-14-9 name=__codelineno-14-9></a><span class=w>    </span><span class=nt>size</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
</code></pre></div></td></tr></table></div> <p>This configuration will split the replication of volumes across unique racks in the data center setup.</p> <h2 id=deleting-a-cephcluster>Deleting a CephCluster<a class=headerlink href=#deleting-a-cephcluster title="Permanent link">&para;</a></h2> <p>During deletion of a CephCluster resource, Rook protects against accidental or premature destruction of user data by blocking deletion if there are any other Rook Ceph Custom Resources that reference the CephCluster being deleted. Rook will warn about which other resources are blocking deletion in three ways until all blocking resources are deleted:</p> <ol> <li>An event will be registered on the CephCluster resource</li> <li>A status condition will be added to the CephCluster resource</li> <li>An error will be added to the Rook Ceph operator log</li> </ol> <h2 id=cleanup-policy>Cleanup policy<a class=headerlink href=#cleanup-policy title="Permanent link">&para;</a></h2> <p>Rook has the ability to cleanup resources and data that were deployed when a CephCluster is removed. The policy settings indicate which data should be forcibly deleted and in what way the data should be wiped. The <code>cleanupPolicy</code> has several fields:</p> <ul> <li><code>confirmation</code>: Only an empty string and <code>yes-really-destroy-data</code> are valid values for this field. If this setting is empty, the <code>cleanupPolicy</code> settings will be ignored and Rook will not cleanup any resources during cluster removal. To reinstall the cluster, the admin would then be required to follow the <a href=../../../Storage-Configuration/ceph-teardown/ >cleanup guide</a> to delete the data on hosts. If this setting is <code>yes-really-destroy-data</code>, the operator will automatically delete the data on hosts. Because this cleanup policy is destructive, after the confirmation is set to <code>yes-really-destroy-data</code> Rook will stop configuring the cluster as if the cluster is about to be destroyed.</li> <li><code>sanitizeDisks</code>: sanitizeDisks represents advanced settings that can be used to delete data on drives.<ul> <li><code>method</code>: indicates if the entire disk should be sanitized or simply ceph's metadata. Possible choices are <code>quick</code> (default) or <code>complete</code></li> <li><code>dataSource</code>: indicate where to get random bytes from to write on the disk. Possible choices are <code>zero</code> (default) or <code>random</code>. Using random sources will consume entropy from the system and will take much more time then the zero source</li> <li><code>iteration</code>: overwrite N times instead of the default (1). Takes an integer value</li> </ul> </li> <li><code>allowUninstallWithVolumes</code>: If set to true, then the cephCluster deletion doesn't wait for the PVCs to be deleted. Default is <code>false</code>.</li> </ul> <p>To automate activation of the cleanup, you can use the following command. <strong>WARNING: DATA WILL BE PERMANENTLY DELETED</strong>:</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-15-1>1</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-15-1 name=__codelineno-15-1></a><span class=go>kubectl -n rook-ceph patch cephcluster rook-ceph --type merge -p &#39;{&quot;spec&quot;:{&quot;cleanupPolicy&quot;:{&quot;confirmation&quot;:&quot;yes-really-destroy-data&quot;}}}&#39;</span>
</code></pre></div></td></tr></table></div> <p>Nothing will happen until the deletion of the CR is requested, so this can still be reverted. However, all new configuration by the operator will be blocked with this cleanup policy enabled.</p> <p>Rook waits for the deletion of PVs provisioned using the cephCluster before proceeding to delete the cephCluster. To force deletion of the cephCluster without waiting for the PVs to be deleted, you can set the <code>allowUninstallWithVolumes</code> to true under <code>spec.CleanupPolicy</code>.</p> <h2 id=ceph-config>Ceph Config<a class=headerlink href=#ceph-config title="Permanent link">&para;</a></h2> <div class="admonition attention"> <p class=admonition-title>Attention</p> <p>This feature is experimental.</p> </div> <p>The Ceph config options are applied after the MONs are all in quorum and running. To set Ceph config options, you can add them to your <code>CephCluster</code> spec as shown below. See the <a href=https://docs.ceph.com/en/latest/rados/configuration/general-config-ref/ >Ceph config reference</a> for detailed information about how to configure Ceph.</p> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal><a href=#__codelineno-16-1> 1</a></span>
<span class=normal><a href=#__codelineno-16-2> 2</a></span>
<span class=normal><a href=#__codelineno-16-3> 3</a></span>
<span class=normal><a href=#__codelineno-16-4> 4</a></span>
<span class=normal><a href=#__codelineno-16-5> 5</a></span>
<span class=normal><a href=#__codelineno-16-6> 6</a></span>
<span class=normal><a href=#__codelineno-16-7> 7</a></span>
<span class=normal><a href=#__codelineno-16-8> 8</a></span>
<span class=normal><a href=#__codelineno-16-9> 9</a></span>
<span class=normal><a href=#__codelineno-16-10>10</a></span>
<span class=normal><a href=#__codelineno-16-11>11</a></span>
<span class=normal><a href=#__codelineno-16-12>12</a></span></pre></div></td><td class=code><div><pre><span></span><code><a id=__codelineno-16-1 name=__codelineno-16-1></a><span class=nt>spec</span><span class=p>:</span>
<a id=__codelineno-16-2 name=__codelineno-16-2></a><span class=w>  </span><span class=c1># [...]</span>
<a id=__codelineno-16-3 name=__codelineno-16-3></a><span class=w>  </span><span class=nt>cephConfig</span><span class=p>:</span>
<a id=__codelineno-16-4 name=__codelineno-16-4></a><span class=w>    </span><span class=c1># Who&#39;s the target for these config options?</span>
<a id=__codelineno-16-5 name=__codelineno-16-5></a><span class=w>    </span><span class=nt>global</span><span class=p>:</span>
<a id=__codelineno-16-6 name=__codelineno-16-6></a><span class=w>      </span><span class=c1># All values must be quoted so they are considered a string in YAML</span>
<a id=__codelineno-16-7 name=__codelineno-16-7></a><span class=w>      </span><span class=nt>osd_pool_default_size</span><span class=p>:</span><span class=w> </span><span class=s>&quot;3&quot;</span>
<a id=__codelineno-16-8 name=__codelineno-16-8></a><span class=w>      </span><span class=nt>mon_warn_on_pool_no_redundancy</span><span class=p>:</span><span class=w> </span><span class=s>&quot;false&quot;</span>
<a id=__codelineno-16-9 name=__codelineno-16-9></a><span class=w>      </span><span class=nt>osd_crush_update_on_start</span><span class=p>:</span><span class=w> </span><span class=s>&quot;false&quot;</span>
<a id=__codelineno-16-10 name=__codelineno-16-10></a><span class=w>    </span><span class=c1># Make sure to quote special characters</span>
<a id=__codelineno-16-11 name=__codelineno-16-11></a><span class=w>    </span><span class=s>&quot;osd.*&quot;</span><span class="p p-Indicator">:</span>
<a id=__codelineno-16-12 name=__codelineno-16-12></a><span class=w>      </span><span class=nt>osd_max_scrubs</span><span class=p>:</span><span class=w> </span><span class=s>&quot;10&quot;</span>
</code></pre></div></td></tr></table></div> <div class="admonition warning"> <p class=admonition-title>Warning</p> <p>Rook performs no direct validation on these config options, so the validity of the settings is the user's responsibility.</p> </div> <p>The operator does not unset any removed config options, it is the user's responsibility to unset or set the default value for each removed option manually using the Ceph CLI.</p> <h2 id=csi-driver-options>CSI Driver Options<a class=headerlink href=#csi-driver-options title="Permanent link">&para;</a></h2> <p>The CSI driver options mentioned here are applied per Ceph cluster. The following options are available:</p> <ul> <li><code>readAffinity</code>: RBD and CephFS volumes allow serving reads from an OSD in proximity to the client. Refer to the read affinity section in the <a href=../../../Storage-Configuration/Ceph-CSI/ceph-csi-drivers/#enable-read-affinity-for-rbd-and-cephfs-volumes>Ceph CSI Drivers</a> for more details.<ul> <li><code>enabled</code>: Whether to enable read affinity for the CSI driver. Default is <code>false</code>.</li> <li><code>crushLocationLabels</code>: Node labels to use as CRUSH location, corresponding to the values set in the CRUSH map. Defaults to the labels mentioned in the <a href=#osd-topology>OSD topology</a> topic.</li> </ul> </li> <li><code>cephfs</code>:<ul> <li><code>kernelMountOptions</code>: Mount options for kernel mounter. Refer to the <a href=https://docs.ceph.com/en/latest/man/8/mount.ceph/#options>kernel mount options</a> for more details.</li> <li><code>fuseMountOptions</code>: Mount options for fuse mounter. Refer to the <a href=https://docs.ceph.com/en/latest/man/8/ceph-fuse/#options>fuse mount options</a> for more details.</li> </ul> </li> </ul> </article> </div> <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg> Back to top </button> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> <a href=/ class=logo> <img src=https://rook.io/images/rook-logo-small.svg alt="rook.io logo"> </a> <p> &#169; Rook Authors 2022. Documentation distributed under <a href=https://creativecommons.org/licenses/by/4.0>CC-BY-4.0</a>. </p> <p> &#169; 2022 The Linux Foundation. All rights reserved. The Linux Foundation has registered trademarks and uses trademarks. For a list of trademarks of The Linux Foundation, please see our <a href=https://www.linuxfoundation.org/trademark-usage/ >Trademark Usage</a> page. </p> </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://slack.rook.io/ target=_blank rel=noopener title=slack.rook.io class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M94.12 315.1c0 25.9-21.16 47.06-47.06 47.06S0 341 0 315.1c0-25.9 21.16-47.06 47.06-47.06h47.06v47.06zm23.72 0c0-25.9 21.16-47.06 47.06-47.06s47.06 21.16 47.06 47.06v117.84c0 25.9-21.16 47.06-47.06 47.06s-47.06-21.16-47.06-47.06V315.1zm47.06-188.98c-25.9 0-47.06-21.16-47.06-47.06S139 32 164.9 32s47.06 21.16 47.06 47.06v47.06H164.9zm0 23.72c25.9 0 47.06 21.16 47.06 47.06s-21.16 47.06-47.06 47.06H47.06C21.16 243.96 0 222.8 0 196.9s21.16-47.06 47.06-47.06H164.9zm188.98 47.06c0-25.9 21.16-47.06 47.06-47.06 25.9 0 47.06 21.16 47.06 47.06s-21.16 47.06-47.06 47.06h-47.06V196.9zm-23.72 0c0 25.9-21.16 47.06-47.06 47.06-25.9 0-47.06-21.16-47.06-47.06V79.06c0-25.9 21.16-47.06 47.06-47.06 25.9 0 47.06 21.16 47.06 47.06V196.9zM283.1 385.88c25.9 0 47.06 21.16 47.06 47.06 0 25.9-21.16 47.06-47.06 47.06-25.9 0-47.06-21.16-47.06-47.06v-47.06h47.06zm0-23.72c-25.9 0-47.06-21.16-47.06-47.06 0-25.9 21.16-47.06 47.06-47.06h117.84c25.9 0 47.06 21.16 47.06 47.06 0 25.9-21.16 47.06-47.06 47.06H283.1z"/></svg> </a> <a href=https://twitter.com/rook_io target=_blank rel=noopener title=twitter.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg> </a> <a href=https://groups.google.com/forum/#!forum/rook-dev target=_blank rel=noopener title=groups.google.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 640 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M128 0c-17.7 0-32 14.3-32 32v192h96v-32c0-35.3 28.7-64 64-64h224V32c0-17.7-14.3-32-32-32H128zm128 160c-17.7 0-32 14.3-32 32v32h96c35.3 0 64 28.7 64 64v128h192c17.7 0 32-14.3 32-32V192c0-17.7-14.3-32-32-32H256zm240 64h32c8.8 0 16 7.2 16 16v32c0 8.8-7.2 16-16 16h-32c-8.8 0-16-7.2-16-16v-32c0-8.8 7.2-16 16-16zM64 256c-17.7 0-32 14.3-32 32v13l155.1 114.9c1.4 1 3.1 1.6 4.9 1.6s3.5-.6 4.9-1.6L352 301v-13c0-17.7-14.3-32-32-32H64zm288 84.8L216 441.6c-6.9 5.1-15.3 7.9-24 7.9s-17-2.8-24-7.9L32 340.8V480c0 17.7 14.3 32 32 32h256c17.7 0 32-14.3 32-32V340.8z"/></svg> </a> <a href=https://blog.rook.io/ target=_blank rel=noopener title=blog.rook.io class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 640 512"><!-- Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M180.5 74.262C80.813 74.262 0 155.633 0 256s80.819 181.738 180.5 181.738S361 356.373 361 256 280.191 74.262 180.5 74.262Zm288.25 10.646c-49.845 0-90.245 76.619-90.245 171.095s40.406 171.1 90.251 171.1 90.251-76.619 90.251-171.1H559c0-94.503-40.4-171.095-90.248-171.095Zm139.506 17.821c-17.526 0-31.735 68.628-31.735 153.274s14.2 153.274 31.735 153.274S640 340.631 640 256c0-84.649-14.215-153.271-31.742-153.271Z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../../..", "features": ["content.tabs.link", "instant", "navigation.expand", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest", "tabs"], "search": "../../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"default": "latest-release", "provider": "mike"}}</script> <script src=../../../assets/javascripts/bundle.8fd75fb4.min.js></script> </body> </html>