<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Rook Ceph Documentation"><meta name=author content="Rook Authors"><link href=https://rook.io/master/Upgrade-Guide/ceph-upgrade/ rel=canonical><link rel=icon href=https://rook.io/images/favicon_192x192.png><meta name=generator content="mkdocs-1.3.0, mkdocs-material-8.2.5+insiders-4.11.0"><title>Upgrades - Rook Ceph Documentation</title><link rel=stylesheet href=../../assets/stylesheets/main.589a02ac.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.e6a45f82.min.css><link rel=stylesheet href=../../stylesheets/extra.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=rook-blue data-md-color-accent=deep-orange> <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#rook-ceph-upgrades class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <div data-md-component=outdated hidden> <aside class="md-banner md-banner--warning"> <div class="md-banner__inner md-grid md-typeset"> You're not viewing the latest version. <a href=../../..> <strong>Click here to go to latest.</strong> </a> </div> <script>var el=document.querySelector("[data-md-component=outdated]"),outdated=__md_get("__outdated",sessionStorage);!0===outdated&&el&&(el.hidden=!1)</script> </aside> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title="Rook Ceph Documentation" class="md-header__button md-logo" aria-label="Rook Ceph Documentation" data-md-component=logo> <img src=https://rook.io/images/rook-logo.svg alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Rook Ceph Documentation </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Upgrades </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=rook-blue data-md-color-accent=deep-orange aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=rook-blue data-md-color-accent=red aria-label="Switch to light mode" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3z"/></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08z"/></svg> </a> <button type=reset class="md-search__icon md-icon" aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/rook/rook title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> Rook </a> </li> <li class=md-tabs__item> <a href=../../ceph-configuration/ class=md-tabs__link> Configuration </a> </li> <li class=md-tabs__item> <a href=../../CRDs/ceph-client-crd/ class=md-tabs__link> CRDs </a> </li> <li class=md-tabs__item> <a href=../../Common%20Issues/ceph-common-issues/ class=md-tabs__link> Common Issues </a> </li> <li class=md-tabs__item> <a href=../../Contributing/development-environment/ class=md-tabs__link> Contributing </a> </li> <li class=md-tabs__item> <a href=../../Getting%20Started/ceph-openshift/ class=md-tabs__link> Getting Started </a> </li> <li class=md-tabs__item> <a href=../../Helm%20Charts/helm-ceph-cluster/ class=md-tabs__link> Helm Charts </a> </li> <li class=md-tabs__item> <a href=../../Prerequisites/authenticated-registry/ class=md-tabs__link> Prerequisites </a> </li> <li class=md-tabs__item> <a href=./ class="md-tabs__link md-tabs__link--active"> Upgrade Guide </a> </li> <li class=md-tabs__item> <a href=../../Usages-and-Examples/ceph-advanced-configuration/ class=md-tabs__link> Usages and Examples </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="Rook Ceph Documentation" class="md-nav__button md-logo" aria-label="Rook Ceph Documentation" data-md-component=logo> <img src=https://rook.io/images/rook-logo.svg alt=logo> </a> Rook Ceph Documentation </label> <div class=md-nav__source> <a href=https://github.com/rook/rook title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> <span class=md-ellipsis> Rook </span> </a> </li> <li class=md-nav__item> <a href=../../ceph-configuration/ class=md-nav__link> <span class=md-ellipsis> Configuration </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3 type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3> <span class=md-ellipsis> CRDs </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=CRDs data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> CRDs </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../CRDs/ceph-client-crd/ class=md-nav__link> <span class=md-ellipsis> Client CRD </span> </a> </li> <li class=md-nav__item> <a href=../../CRDs/ceph-cluster-crd/ class=md-nav__link> <span class=md-ellipsis> Cluster CRD </span> </a> </li> <li class=md-nav__item> <a href=../../CRDs/ceph-filesystem-crd/ class=md-nav__link> <span class=md-ellipsis> Shared Filesystem CRD </span> </a> </li> <li class=md-nav__item> <a href=../../CRDs/ceph-fs-mirror-crd/ class=md-nav__link> <span class=md-ellipsis> Filesystem Mirror CRD </span> </a> </li> <li class=md-nav__item> <a href=../../CRDs/ceph-fs-subvolumegroup/ class=md-nav__link> <span class=md-ellipsis> SubVolume Group CRD </span> </a> </li> <li class=md-nav__item> <a href=../../CRDs/ceph-nfs-crd/ class=md-nav__link> <span class=md-ellipsis> NFS CRD </span> </a> </li> <li class=md-nav__item> <a href=../../CRDs/ceph-object-multisite-crd/ class=md-nav__link> <span class=md-ellipsis> Object Multisite CRDs </span> </a> </li> <li class=md-nav__item> <a href=../../CRDs/ceph-object-store-crd/ class=md-nav__link> <span class=md-ellipsis> Object Store CRD </span> </a> </li> <li class=md-nav__item> <a href=../../CRDs/ceph-object-store-user-crd/ class=md-nav__link> <span class=md-ellipsis> Object Store User CRD </span> </a> </li> <li class=md-nav__item> <a href=../../CRDs/ceph-pool-crd/ class=md-nav__link> <span class=md-ellipsis> Block Pool CRD </span> </a> </li> <li class=md-nav__item> <a href=../../CRDs/ceph-pool-radosnamespace-crd/ class=md-nav__link> <span class=md-ellipsis> RADOS Namespace CRD </span> </a> </li> <li class=md-nav__item> <a href=../../CRDs/ceph-rbd-mirror-crd/ class=md-nav__link> <span class=md-ellipsis> RBD Mirror CRD </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4 type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4> <span class=md-ellipsis> Common Issues </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Common Issues" data-md-level=1> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Common Issues </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Common%20Issues/ceph-common-issues/ class=md-nav__link> <span class=md-ellipsis> Common Issues </span> </a> </li> <li class=md-nav__item> <a href=../../Common%20Issues/ceph-disaster-recovery/ class=md-nav__link> <span class=md-ellipsis> Disaster Recovery </span> </a> </li> <li class=md-nav__item> <a href=../../Common%20Issues/ceph-mon-health/ class=md-nav__link> <span class=md-ellipsis> Monitor Health </span> </a> </li> <li class=md-nav__item> <a href=../../Common%20Issues/ceph-openshift-issues/ class=md-nav__link> <span class=md-ellipsis> OpenShift Common Issues </span> </a> </li> <li class=md-nav__item> <a href=../../Common%20Issues/ceph-osd-mgmt/ class=md-nav__link> <span class=md-ellipsis> OSD Management </span> </a> </li> <li class=md-nav__item> <a href=../../Common%20Issues/common-issues/ class=md-nav__link> <span class=md-ellipsis> Common Issues </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_5 type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5> <span class=md-ellipsis> Contributing </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Contributing data-md-level=1> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Contributing </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Contributing/development-environment/ class=md-nav__link> <span class=md-ellipsis> Developer Environment </span> </a> </li> <li class=md-nav__item> <a href=../../Contributing/development-flow/ class=md-nav__link> <span class=md-ellipsis> Contributing </span> </a> </li> <li class=md-nav__item> <a href=../../Contributing/storage-providers/ class=md-nav__link> <span class=md-ellipsis> Storage Providers </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_6 type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6> <span class=md-ellipsis> Getting Started </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Getting Started" data-md-level=1> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Getting Started </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Getting%20Started/ceph-openshift/ class=md-nav__link> <span class=md-ellipsis> OpenShift </span> </a> </li> <li class=md-nav__item> <a href=../../Getting%20Started/ceph-storage/ class=md-nav__link> <span class=md-ellipsis> Ceph Storage </span> </a> </li> <li class=md-nav__item> <a href=../../Getting%20Started/quickstart/ class=md-nav__link> <span class=md-ellipsis> Quickstart </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_7 type=checkbox id=__nav_7> <label class=md-nav__link for=__nav_7> <span class=md-ellipsis> Helm Charts </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Helm Charts" data-md-level=1> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> Helm Charts </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Helm%20Charts/helm-ceph-cluster/ class=md-nav__link> <span class=md-ellipsis> Ceph Cluster </span> </a> </li> <li class=md-nav__item> <a href=../../Helm%20Charts/helm-operator/ class=md-nav__link> <span class=md-ellipsis> Ceph Operator </span> </a> </li> <li class=md-nav__item> <a href=../../Helm%20Charts/helm/ class=md-nav__link> <span class=md-ellipsis> Helm Charts </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_8 type=checkbox id=__nav_8> <label class=md-nav__link for=__nav_8> <span class=md-ellipsis> Prerequisites </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Prerequisites data-md-level=1> <label class=md-nav__title for=__nav_8> <span class="md-nav__icon md-icon"></span> Prerequisites </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Prerequisites/authenticated-registry/ class=md-nav__link> <span class=md-ellipsis> Authenticated Registries </span> </a> </li> <li class=md-nav__item> <a href=../../Prerequisites/pod-security-policies/ class=md-nav__link> <span class=md-ellipsis> Pod Security Policies </span> </a> </li> <li class=md-nav__item> <a href=../../Prerequisites/prerequisites/ class=md-nav__link> <span class=md-ellipsis> Prerequisites </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_9 type=checkbox id=__nav_9 checked> <label class=md-nav__link for=__nav_9> <span class=md-ellipsis> Upgrade Guide </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Upgrade Guide" data-md-level=1> <label class=md-nav__title for=__nav_9> <span class="md-nav__icon md-icon"></span> Upgrade Guide </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> Upgrades </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Upgrades </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#supported-versions class=md-nav__link> Supported Versions </a> </li> <li class=md-nav__item> <a href=#breaking-changes-in-this-release class=md-nav__link> Breaking changes in this release </a> </li> <li class=md-nav__item> <a href=#considerations class=md-nav__link> Considerations </a> </li> <li class=md-nav__item> <a href=#patch-release-upgrades class=md-nav__link> Patch Release Upgrades </a> </li> <li class=md-nav__item> <a href=#helm class=md-nav__link> Helm </a> </li> <li class=md-nav__item> <a href=#upgrading-from-v18-to-v19 class=md-nav__link> Upgrading from v1.8 to v1.9 </a> <nav class=md-nav aria-label="Upgrading from v1.8 to v1.9"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#prerequisites class=md-nav__link> Prerequisites </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#health-verification class=md-nav__link> Health Verification </a> <nav class=md-nav aria-label="Health Verification"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#pods-all-running class=md-nav__link> Pods all Running </a> </li> <li class=md-nav__item> <a href=#status-output class=md-nav__link> Status Output </a> </li> <li class=md-nav__item> <a href=#container-versions class=md-nav__link> Container Versions </a> </li> <li class=md-nav__item> <a href=#rook-volume-health class=md-nav__link> Rook Volume Health </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#rook-operator-upgrade-process class=md-nav__link> Rook Operator Upgrade Process </a> <nav class=md-nav aria-label="Rook Operator Upgrade Process"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1-update-common-resources-and-crds class=md-nav__link> 1. Update common resources and CRDs </a> <nav class=md-nav aria-label="1. Update common resources and CRDs"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#updates-for-optional-resources class=md-nav__link> Updates for optional resources </a> </li> <li class=md-nav__item> <a href=#prometheus class=md-nav__link> Prometheus </a> </li> <li class=md-nav__item> <a href=#mds-liveness-and-startup-probes class=md-nav__link> MDS liveness and startup probes </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2-update-ceph-csi-versions class=md-nav__link> 2. Update Ceph CSI versions </a> </li> <li class=md-nav__item> <a href=#3-update-the-rook-operator class=md-nav__link> 3. Update the Rook Operator </a> </li> <li class=md-nav__item> <a href=#4-wait-for-the-upgrade-to-complete class=md-nav__link> 4. Wait for the upgrade to complete </a> </li> <li class=md-nav__item> <a href=#5-verify-the-updated-cluster class=md-nav__link> 5. Verify the updated cluster </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#ceph-version-upgrades class=md-nav__link> Ceph Version Upgrades </a> <nav class=md-nav aria-label="Ceph Version Upgrades"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#rename-cephblockpool-device_health_metrics-pool-when-upgrading-to-quincy-v17 class=md-nav__link> Rename CephBlockPool device_health_metrics pool when upgrading to Quincy v17 </a> </li> <li class=md-nav__item> <a href=#important-consideration-for-cephnfs-users class=md-nav__link> Important consideration for CephNFS users </a> </li> <li class=md-nav__item> <a href=#ceph-images class=md-nav__link> Ceph images </a> </li> <li class=md-nav__item> <a href=#example-upgrade-to-ceph-pacific class=md-nav__link> Example upgrade to Ceph Pacific </a> <nav class=md-nav aria-label="Example upgrade to Ceph Pacific"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1-update-the-main-ceph-daemons class=md-nav__link> 1. Update the main Ceph daemons </a> </li> <li class=md-nav__item> <a href=#2-wait-for-the-daemon-pod-updates-to-complete class=md-nav__link> 2. Wait for the daemon pod updates to complete </a> </li> <li class=md-nav__item> <a href=#3-verify-the-updated-cluster class=md-nav__link> 3. Verify the updated cluster </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#csi-version class=md-nav__link> CSI Version </a> <nav class=md-nav aria-label="CSI Version"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#use-default-images class=md-nav__link> Use default images </a> </li> <li class=md-nav__item> <a href=#verifying-updates class=md-nav__link> Verifying updates </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_10 type=checkbox id=__nav_10> <label class=md-nav__link for=__nav_10> <span class=md-ellipsis> Usages and Examples </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Usages and Examples" data-md-level=1> <label class=md-nav__title for=__nav_10> <span class="md-nav__icon md-icon"></span> Usages and Examples </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Usages-and-Examples/ceph-advanced-configuration/ class=md-nav__link> <span class=md-ellipsis> Advanced Configuration </span> </a> </li> <li class=md-nav__item> <a href=../../Usages-and-Examples/ceph-dashboard/ class=md-nav__link> <span class=md-ellipsis> Ceph Dashboard </span> </a> </li> <li class=md-nav__item> <a href=../../Usages-and-Examples/ceph-examples/ class=md-nav__link> <span class=md-ellipsis> Examples </span> </a> </li> <li class=md-nav__item> <a href=../../Usages-and-Examples/ceph-monitoring/ class=md-nav__link> <span class=md-ellipsis> Prometheus Monitoring </span> </a> </li> <li class=md-nav__item> <a href=../../Usages-and-Examples/ceph-teardown/ class=md-nav__link> <span class=md-ellipsis> Cleanup </span> </a> </li> <li class=md-nav__item> <a href=../../Usages-and-Examples/ceph-toolbox/ class=md-nav__link> <span class=md-ellipsis> Toolbox </span> </a> </li> <li class=md-nav__item> <a href=../../Usages-and-Examples/ceph-tools/ class=md-nav__link> <span class=md-ellipsis> Ceph Tools </span> </a> </li> <li class=md-nav__item> <a href=../../Usages-and-Examples/direct-tools/ class=md-nav__link> <span class=md-ellipsis> Direct Tools </span> </a> </li> <li class=md-nav__item> <a href=../../Usages-and-Examples/key-management-system/ class=md-nav__link> <span class=md-ellipsis> Key Management System </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_10_10 type=checkbox id=__nav_10_10> <label class=md-nav__link for=__nav_10_10> <span class=md-ellipsis> Ceph CSI </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Ceph CSI" data-md-level=2> <label class=md-nav__title for=__nav_10_10> <span class="md-nav__icon md-icon"></span> Ceph CSI </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Usages-and-Examples/Ceph-CSI/ceph-csi-drivers/ class=md-nav__link> <span class=md-ellipsis> Ceph CSI </span> </a> </li> <li class=md-nav__item> <a href=../../Usages-and-Examples/Ceph-CSI/ceph-csi-snapshot/ class=md-nav__link> <span class=md-ellipsis> Snapshots </span> </a> </li> <li class=md-nav__item> <a href=../../Usages-and-Examples/Ceph-CSI/ceph-csi-troubleshooting/ class=md-nav__link> <span class=md-ellipsis> CSI Common Issues </span> </a> </li> <li class=md-nav__item> <a href=../../Usages-and-Examples/Ceph-CSI/ceph-csi-volume-clone/ class=md-nav__link> <span class=md-ellipsis> Volume clone </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_10_11 type=checkbox id=__nav_10_11> <label class=md-nav__link for=__nav_10_11> <span class=md-ellipsis> CephFS Filesystem Storage </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="CephFS Filesystem Storage" data-md-level=2> <label class=md-nav__title for=__nav_10_11> <span class="md-nav__icon md-icon"></span> CephFS Filesystem Storage </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Usages-and-Examples/CephFS-Filesystem-Storage/ceph-filesystem/ class=md-nav__link> <span class=md-ellipsis> Shared Filesystem </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_10_12 type=checkbox id=__nav_10_12> <label class=md-nav__link for=__nav_10_12> <span class=md-ellipsis> Object Storage </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Object Storage" data-md-level=2> <label class=md-nav__title for=__nav_10_12> <span class="md-nav__icon md-icon"></span> Object Storage </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Usages-and-Examples/Object-Storage/ceph-object-bucket-claim/ class=md-nav__link> <span class=md-ellipsis> Object Bucket Claim </span> </a> </li> <li class=md-nav__item> <a href=../../Usages-and-Examples/Object-Storage/ceph-object-bucket-notifications/ class=md-nav__link> <span class=md-ellipsis> Bucket Notifications </span> </a> </li> <li class=md-nav__item> <a href=../../Usages-and-Examples/Object-Storage/ceph-object-multisite/ class=md-nav__link> <span class=md-ellipsis> Object Multisite </span> </a> </li> <li class=md-nav__item> <a href=../../Usages-and-Examples/Object-Storage/ceph-object/ class=md-nav__link> <span class=md-ellipsis> Object Storage </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_10_13 type=checkbox id=__nav_10_13> <label class=md-nav__link for=__nav_10_13> <span class=md-ellipsis> RBD Block Storage </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="RBD Block Storage" data-md-level=2> <label class=md-nav__title for=__nav_10_13> <span class="md-nav__icon md-icon"></span> RBD Block Storage </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../Usages-and-Examples/RBD-Block-Storage/async-disaster-recovery/ class=md-nav__link> <span class=md-ellipsis> Failover and Failback </span> </a> </li> <li class=md-nav__item> <a href=../../Usages-and-Examples/RBD-Block-Storage/ceph-block/ class=md-nav__link> <span class=md-ellipsis> Block Storage </span> </a> </li> <li class=md-nav__item> <a href=../../Usages-and-Examples/RBD-Block-Storage/rbd-mirroring/ class=md-nav__link> <span class=md-ellipsis> RBD Mirroring </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#supported-versions class=md-nav__link> Supported Versions </a> </li> <li class=md-nav__item> <a href=#breaking-changes-in-this-release class=md-nav__link> Breaking changes in this release </a> </li> <li class=md-nav__item> <a href=#considerations class=md-nav__link> Considerations </a> </li> <li class=md-nav__item> <a href=#patch-release-upgrades class=md-nav__link> Patch Release Upgrades </a> </li> <li class=md-nav__item> <a href=#helm class=md-nav__link> Helm </a> </li> <li class=md-nav__item> <a href=#upgrading-from-v18-to-v19 class=md-nav__link> Upgrading from v1.8 to v1.9 </a> <nav class=md-nav aria-label="Upgrading from v1.8 to v1.9"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#prerequisites class=md-nav__link> Prerequisites </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#health-verification class=md-nav__link> Health Verification </a> <nav class=md-nav aria-label="Health Verification"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#pods-all-running class=md-nav__link> Pods all Running </a> </li> <li class=md-nav__item> <a href=#status-output class=md-nav__link> Status Output </a> </li> <li class=md-nav__item> <a href=#container-versions class=md-nav__link> Container Versions </a> </li> <li class=md-nav__item> <a href=#rook-volume-health class=md-nav__link> Rook Volume Health </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#rook-operator-upgrade-process class=md-nav__link> Rook Operator Upgrade Process </a> <nav class=md-nav aria-label="Rook Operator Upgrade Process"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1-update-common-resources-and-crds class=md-nav__link> 1. Update common resources and CRDs </a> <nav class=md-nav aria-label="1. Update common resources and CRDs"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#updates-for-optional-resources class=md-nav__link> Updates for optional resources </a> </li> <li class=md-nav__item> <a href=#prometheus class=md-nav__link> Prometheus </a> </li> <li class=md-nav__item> <a href=#mds-liveness-and-startup-probes class=md-nav__link> MDS liveness and startup probes </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2-update-ceph-csi-versions class=md-nav__link> 2. Update Ceph CSI versions </a> </li> <li class=md-nav__item> <a href=#3-update-the-rook-operator class=md-nav__link> 3. Update the Rook Operator </a> </li> <li class=md-nav__item> <a href=#4-wait-for-the-upgrade-to-complete class=md-nav__link> 4. Wait for the upgrade to complete </a> </li> <li class=md-nav__item> <a href=#5-verify-the-updated-cluster class=md-nav__link> 5. Verify the updated cluster </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#ceph-version-upgrades class=md-nav__link> Ceph Version Upgrades </a> <nav class=md-nav aria-label="Ceph Version Upgrades"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#rename-cephblockpool-device_health_metrics-pool-when-upgrading-to-quincy-v17 class=md-nav__link> Rename CephBlockPool device_health_metrics pool when upgrading to Quincy v17 </a> </li> <li class=md-nav__item> <a href=#important-consideration-for-cephnfs-users class=md-nav__link> Important consideration for CephNFS users </a> </li> <li class=md-nav__item> <a href=#ceph-images class=md-nav__link> Ceph images </a> </li> <li class=md-nav__item> <a href=#example-upgrade-to-ceph-pacific class=md-nav__link> Example upgrade to Ceph Pacific </a> <nav class=md-nav aria-label="Example upgrade to Ceph Pacific"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1-update-the-main-ceph-daemons class=md-nav__link> 1. Update the main Ceph daemons </a> </li> <li class=md-nav__item> <a href=#2-wait-for-the-daemon-pod-updates-to-complete class=md-nav__link> 2. Wait for the daemon pod updates to complete </a> </li> <li class=md-nav__item> <a href=#3-verify-the-updated-cluster class=md-nav__link> 3. Verify the updated cluster </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#csi-version class=md-nav__link> CSI Version </a> <nav class=md-nav aria-label="CSI Version"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#use-default-images class=md-nav__link> Use default images </a> </li> <li class=md-nav__item> <a href=#verifying-updates class=md-nav__link> Verifying updates </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/rook/rook/edit/master/Documentation/Upgrade-Guide/ceph-upgrade.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg> </a> <h1 id=rook-ceph-upgrades>Rook-Ceph Upgrades<a class=headerlink href=#rook-ceph-upgrades title="Permanent link">&para;</a></h1> <p>This guide will walk you through the steps to upgrade the software in a Rook-Ceph cluster from one<br> version to the next. This includes both the Rook-Ceph operator software itself as well as the Ceph<br> cluster software.</p> <p>Upgrades for both the operator and for Ceph are nearly entirely automated save for where Rook's<br> permissions need to be explicitly updated by an admin or when incompatibilities need to be addressed<br> manually due to customizations.</p> <p>We welcome feedback and opening issues!</p> <h2 id=supported-versions>Supported Versions<a class=headerlink href=#supported-versions title="Permanent link">&para;</a></h2> <p>This guide is for upgrading from <strong>Rook v1.8.x to Rook v1.9.x</strong>.</p> <p>Please refer to the upgrade guides from previous releases for supported upgrade paths.<br> Rook upgrades are only supported between official releases. Upgrades to and from <code>master</code> are not<br> supported.</p> <p>For a guide to upgrade previous versions of Rook, please refer to the version of documentation for<br> those releases.</p> <ul> <li><a href=https://rook.io/docs/rook/v1.8/ceph-upgrade.html>Upgrade 1.7 to 1.8</a></li> <li><a href=https://rook.io/docs/rook/v1.7/ceph-upgrade.html>Upgrade 1.6 to 1.7</a></li> <li><a href=https://rook.io/docs/rook/v1.6/ceph-upgrade.html>Upgrade 1.5 to 1.6</a></li> <li><a href=https://rook.io/docs/rook/v1.5/ceph-upgrade.html>Upgrade 1.4 to 1.5</a></li> <li><a href=https://rook.io/docs/rook/v1.4/ceph-upgrade.html>Upgrade 1.3 to 1.4</a></li> <li><a href=https://rook.io/docs/rook/v1.3/ceph-upgrade.html>Upgrade 1.2 to 1.3</a></li> <li><a href=https://rook.io/docs/rook/v1.2/ceph-upgrade.html>Upgrade 1.1 to 1.2</a></li> <li><a href=https://rook.io/docs/rook/v1.1/ceph-upgrade.html>Upgrade 1.0 to 1.1</a></li> <li><a href=https://rook.io/docs/rook/v1.0/ceph-upgrade.html>Upgrade 0.9 to 1.0</a></li> <li><a href=https://rook.io/docs/rook/v0.9/ceph-upgrade.html>Upgrade 0.8 to 0.9</a></li> <li><a href=https://rook.io/docs/rook/v0.8/upgrade.html>Upgrade 0.7 to 0.8</a></li> <li><a href=https://rook.io/docs/rook/v0.7/upgrade.html>Upgrade 0.6 to 0.7</a></li> <li><a href=https://rook.io/docs/rook/v0.6/upgrade.html>Upgrade 0.5 to 0.6</a></li> </ul> <h2 id=breaking-changes-in-this-release>Breaking changes in this release<a class=headerlink href=#breaking-changes-in-this-release title="Permanent link">&para;</a></h2> <ul> <li> <p>Helm charts now define default resource requests and limits for Rook-Ceph Pods. If you use Helm,<br> ensure you have defined an override for these in your <code>values.yaml</code> if you don't wish to use the<br> recommended defaults. Setting resource requests and limits could mean that Kubernetes will not<br> allow Pods to be scheduled in some cases. If sufficient resources are not available, you can<br> reduce or remove the requests and limits.</p> </li> <li> <p>MDS liveness and startup probes are now configured by the CephFilesystem resource instead of<br> CephCluster. Upgrade instructions are <a href=#mds-liveness-and-startup-probes>below</a>.</p> </li> <li> <p>Rook no longer deploys Prometheus rules from the operator. If you have been relying on Rook to<br> deploy prometheus rules in the past, please follow the upgrade instructions <a href=#prometheus>below</a>.</p> </li> <li> <p>Due to a number of Ceph issues and changes, Rook officially only supports Ceph<br> v16.2.7 or higher for CephNFS. If you are using an earlier version, upgrade your Ceph version<br> following the advice given in Rook's<br> <a href=https://rook.github.io/docs/rook/v1.8/ceph-nfs-crd.html>v1.8 NFS docs</a>.</p> </li> </ul> <h2 id=considerations>Considerations<a class=headerlink href=#considerations title="Permanent link">&para;</a></h2> <p>With this upgrade guide, there are a few notes to consider:</p> <ul> <li><strong>WARNING</strong>: Upgrading a Rook cluster is not without risk. There may be unexpected issues or<br> obstacles that damage the integrity and health of your storage cluster, including data loss.</li> <li>The Rook cluster's storage may be unavailable for short periods during the upgrade process for<br> both Rook operator updates and for Ceph version updates.</li> <li>We recommend that you read this document in full before you undertake a Rook cluster upgrade.</li> </ul> <h2 id=patch-release-upgrades>Patch Release Upgrades<a class=headerlink href=#patch-release-upgrades title="Permanent link">&para;</a></h2> <p>Unless otherwise noted due to extenuating requirements, upgrades from one patch release of Rook to<br> another are as simple as updating the common resources and the image of the Rook operator. For<br> example, when Rook v1.9.1 is released, the process of updating from v1.9.0 is as simple as running<br> the following:</p> <p>First get the latest common resources manifests that contain the latest changes for Rook v1.9.<br> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code>git clone --single-branch --depth<span class=o>=</span><span class=m>1</span> --branch v1.9.1 https://github.com/rook/rook.git
<span class=nb>cd</span> rook/deploy/examples
</code></pre></div> </td></tr></table></p> <p>If you have deployed the Rook Operator or the Ceph cluster into a different namespace than<br> <code>rook-ceph</code>, see the <a href=#1-update-common-resources-and-crds>Update common resources and CRDs</a><br> section for instructions on how to change the default namespaces in <code>common.yaml</code>.</p> <p>Then apply the latest changes from v1.9 and update the Rook Operator image.<br> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code><span class=go>kubectl apply -f common.yaml -f crds.yaml</span>
<span class=go>kubectl -n rook-ceph set image deploy/rook-ceph-operator rook-ceph-operator=rook/ceph:v1.9.1</span>
</code></pre></div> </td></tr></table></p> <p>As exemplified above, it is a good practice to update Rook-Ceph common resources from the example<br> manifests before any update. The common resources and CRDs might not be updated with every<br> release, but K8s will only apply updates to the ones that changed.</p> <p>Also update optional resources like Prometheus monitoring noted more fully in the<br> <a href=#updates-for-optional-resources>upgrade section below</a>.</p> <h2 id=helm>Helm<a class=headerlink href=#helm title="Permanent link">&para;</a></h2> <ul> <li>The minimum supported Helm version is <strong>v3.2.0</strong></li> </ul> <p>If you have installed Rook via the Helm chart, Helm will handle some details of the upgrade for you.<br> The upgrade steps in this guide will clarify if Helm manages the step for you.</p> <p>The <code>rook-ceph</code> helm chart upgrade performs the Rook upgrade.<br> The <code>rook-ceph-cluster</code> helm chart upgrade performs a <a href=#ceph-version-upgrades>Ceph upgrade</a> if the Ceph image is updated.</p> <h2 id=upgrading-from-v18-to-v19>Upgrading from v1.8 to v1.9<a class=headerlink href=#upgrading-from-v18-to-v19 title="Permanent link">&para;</a></h2> <p><strong>Rook releases from master are expressly unsupported.</strong> It is strongly recommended that you use<br> <a href=https://github.com/rook/rook/releases>official releases</a> of Rook. Unreleased versions from the<br> master branch are subject to changes and incompatibilities that will not be supported in the<br> official releases. Builds from the master branch can have functionality changed or removed at any<br> time without compatibility support and without prior notice.</p> <h3 id=prerequisites><strong>Prerequisites</strong><a class=headerlink href=#prerequisites title="Permanent link">&para;</a></h3> <p>We will do all our work in the Ceph example manifests directory.</p> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code>$ <span class=nb>cd</span> <span class=nv>$YOUR_ROOK_REPO</span>/deploy/examples/
</code></pre></div> </td></tr></table> <p>Unless your Rook cluster was created with customized namespaces, namespaces for Rook clusters are<br> likely to be:</p> <ul> <li>Clusters created by v0.7 or earlier: <code>rook-system</code> and <code>rook</code></li> <li>Clusters created in v0.8 or v0.9: <code>rook-ceph-system</code> and <code>rook-ceph</code></li> <li>Clusters created in v1.0 or newer: only <code>rook-ceph</code></li> </ul> <p>With this guide, we do our best not to assume the namespaces in your cluster. To make things as easy<br> as possible, modify and use the below snippet to configure your environment. We will use these<br> environment variables throughout this document.</p> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code><span class=c1># Parameterize the environment</span>
<span class=nb>export</span> <span class=nv>ROOK_OPERATOR_NAMESPACE</span><span class=o>=</span><span class=s2>&quot;rook-ceph&quot;</span>
<span class=nb>export</span> <span class=nv>ROOK_CLUSTER_NAMESPACE</span><span class=o>=</span><span class=s2>&quot;rook-ceph&quot;</span>
</code></pre></div> </td></tr></table> <p>In order to successfully upgrade a Rook cluster, the following prerequisites must be met:</p> <ul> <li>The cluster should be in a healthy state with full functionality. Review the<br> <a href=#health-verification>health verification section</a> in order to verify your cluster is in a good<br> starting state.</li> <li>All pods consuming Rook storage should be created, running, and in a steady state. No Rook<br> persistent volumes should be in the act of being created or deleted.</li> </ul> <h2 id=health-verification>Health Verification<a class=headerlink href=#health-verification title="Permanent link">&para;</a></h2> <p>Before we begin the upgrade process, let's first review some ways that you can verify the health of<br> your cluster, ensuring that the upgrade is going smoothly after each step. Most of the health<br> verification checks for your cluster during the upgrade process can be performed with the Rook<br> toolbox. For more information about how to run the toolbox, please visit the<br> <a href=./ceph-toolbox.md>Rook toolbox readme</a>.</p> <p>See the common issues pages for troubleshooting and correcting health issues:</p> <ul> <li><a href=./common-issues.md>General troubleshooting</a></li> <li><a href=./ceph-common-issues.md>Ceph troubleshooting</a></li> </ul> <h3 id=pods-all-running><strong>Pods all Running</strong><a class=headerlink href=#pods-all-running title="Permanent link">&para;</a></h3> <p>In a healthy Rook cluster, the operator, the agents and all Rook namespace pods should be in the<br> <code>Running</code> state and have few, if any, pod restarts. To verify this, run the following commands:</p> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code>kubectl -n <span class=nv>$ROOK_CLUSTER_NAMESPACE</span> get pods
</code></pre></div> </td></tr></table> <h3 id=status-output><strong>Status Output</strong><a class=headerlink href=#status-output title="Permanent link">&para;</a></h3> <p>The Rook toolbox contains the Ceph tools that can give you status details of the cluster with the<br> <code>ceph status</code> command. Let's look at an output sample and review some of the details:</p> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code><span class=nv>TOOLS_POD</span><span class=o>=</span><span class=k>$(</span>kubectl -n <span class=nv>$ROOK_CLUSTER_NAMESPACE</span> get pod -l <span class=s2>&quot;app=rook-ceph-tools&quot;</span> -o <span class=nv>jsonpath</span><span class=o>=</span><span class=s1>&#39;{.items[*].metadata.name}&#39;</span><span class=k>)</span>
kubectl -n <span class=nv>$ROOK_CLUSTER_NAMESPACE</span> <span class=nb>exec</span> -it <span class=nv>$TOOLS_POD</span> -- ceph status
</code></pre></div> </td></tr></table> <blockquote> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code>  cluster:
    id:     a3f4d647-9538-4aff-9fd1-b845873c3fe9
    health: HEALTH_OK

  services:
    mon: 3 daemons, quorum b,c,a
    mgr: a(active)
    mds: myfs-1/1/1 up  {0=myfs-a=up:active}, 1 up:standby-replay
    osd: 6 osds: 6 up, 6 in
    rgw: 1 daemon active

  data:
    pools:   9 pools, 900 pgs
    objects: 67  objects, 11 KiB
    usage:   6.1 GiB used, 54 GiB / 60 GiB avail
    pgs:     900 active+clean

  io:
    client:   7.4 KiB/s rd, 681 B/s wr, 11 op/s rd, 4 op/s wr
    recovery: 164 B/s, 1 objects/s
</code></pre></div> </td></tr></table> </blockquote> <p>In the output above, note the following indications that the cluster is in a healthy state:</p> <ul> <li>Cluster health: The overall cluster status is <code>HEALTH_OK</code> and there are no warning or error status<br> messages displayed.</li> <li>Monitors (mon): All of the monitors are included in the <code>quorum</code> list.</li> <li>Manager (mgr): The Ceph manager is in the <code>active</code> state.</li> <li>OSDs (osd): All OSDs are <code>up</code> and <code>in</code>.</li> <li>Placement groups (pgs): All PGs are in the <code>active+clean</code> state.</li> <li>(If applicable) Ceph filesystem metadata server (mds): all MDSes are <code>active</code> for all filesystems</li> <li>(If applicable) Ceph object store RADOS gateways (rgw): all daemons are <code>active</code></li> </ul> <p>If your <code>ceph status</code> output has deviations from the general good health described above, there may<br> be an issue that needs to be investigated further. There are other commands you may run for more<br> details on the health of the system, such as <code>ceph osd status</code>. See the<br> <a href=https://docs.ceph.com/docs/master/rados/troubleshooting/ >Ceph troubleshooting docs</a> for help.</p> <p>Rook will prevent the upgrade of the Ceph daemons if the health is in a <code>HEALTH_ERR</code> state.<br> If you desired to proceed with the upgrade anyway, you will need to set either<br> <code>skipUpgradeChecks: true</code> or <code>continueUpgradeAfterChecksEvenIfNotHealthy: true</code> as described in the<br> <a href=ceph-cluster-crd.md#cluster-settings>cluster CR settings</a>.</p> <h3 id=container-versions><strong>Container Versions</strong><a class=headerlink href=#container-versions title="Permanent link">&para;</a></h3> <p>The container version running in a specific pod in the Rook cluster can be verified in its pod spec<br> output. For example for the monitor pod <code>mon-b</code>, we can verify the container version it is running<br> with the below commands:</p> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code><span class=nv>POD_NAME</span><span class=o>=</span><span class=k>$(</span>kubectl -n <span class=nv>$ROOK_CLUSTER_NAMESPACE</span> get pod -o custom-columns<span class=o>=</span>name:.metadata.name --no-headers <span class=p>|</span> grep rook-ceph-mon-b<span class=k>)</span>
kubectl -n <span class=nv>$ROOK_CLUSTER_NAMESPACE</span> get pod <span class=si>${</span><span class=nv>POD_NAME</span><span class=si>}</span> -o <span class=nv>jsonpath</span><span class=o>=</span><span class=s1>&#39;{.spec.containers[0].image}&#39;</span>
</code></pre></div> </td></tr></table> <p>The status and container versions for all Rook pods can be collected all at once with the following<br> commands:</p> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code>kubectl -n <span class=nv>$ROOK_OPERATOR_NAMESPACE</span> get pod -o <span class=nv>jsonpath</span><span class=o>=</span><span class=s1>&#39;{range .items[*]}{.metadata.name}{&quot;\n\t&quot;}{.status.phase}{&quot;\t\t&quot;}{.spec.containers[0].image}{&quot;\t&quot;}{.spec.initContainers[0]}{&quot;\n&quot;}{end}&#39;</span> <span class=o>&amp;&amp;</span> <span class=se>\</span>
kubectl -n <span class=nv>$ROOK_CLUSTER_NAMESPACE</span> get pod -o <span class=nv>jsonpath</span><span class=o>=</span><span class=s1>&#39;{range .items[*]}{.metadata.name}{&quot;\n\t&quot;}{.status.phase}{&quot;\t\t&quot;}{.spec.containers[0].image}{&quot;\t&quot;}{.spec.initContainers[0].image}{&quot;\n&quot;}{end}&#39;</span>
</code></pre></div> </td></tr></table> <p>The <code>rook-version</code> label exists on Ceph controller resources. For various resource controllers, a<br> summary of the resource controllers can be gained with the commands below. These will report the<br> requested, updated, and currently available replicas for various Rook-Ceph resources in addition to<br> the version of Rook for resources managed by the updated Rook-Ceph operator. Note that the operator<br> and toolbox deployments do not have a <code>rook-version</code> label set.</p> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code>kubectl -n <span class=nv>$ROOK_CLUSTER_NAMESPACE</span> get deployments -o <span class=nv>jsonpath</span><span class=o>=</span><span class=s1>&#39;{range .items[*]}{.metadata.name}{&quot;  \treq/upd/avl: &quot;}{.spec.replicas}{&quot;/&quot;}{.status.updatedReplicas}{&quot;/&quot;}{.status.readyReplicas}{&quot;  \trook-version=&quot;}{.metadata.labels.rook-version}{&quot;\n&quot;}{end}&#39;</span>

kubectl -n <span class=nv>$ROOK_CLUSTER_NAMESPACE</span> get <span class=nb>jobs</span> -o <span class=nv>jsonpath</span><span class=o>=</span><span class=s1>&#39;{range .items[*]}{.metadata.name}{&quot;  \tsucceeded: &quot;}{.status.succeeded}{&quot;      \trook-version=&quot;}{.metadata.labels.rook-version}{&quot;\n&quot;}{end}&#39;</span>
</code></pre></div> </td></tr></table> <h3 id=rook-volume-health><strong>Rook Volume Health</strong><a class=headerlink href=#rook-volume-health title="Permanent link">&para;</a></h3> <p>Any pod that is using a Rook volume should also remain healthy:</p> <ul> <li>The pod should be in the <code>Running</code> state with few, if any, restarts</li> <li>There should be no errors in its logs</li> <li>The pod should still be able to read and write to the attached Rook volume.</li> </ul> <h2 id=rook-operator-upgrade-process>Rook Operator Upgrade Process<a class=headerlink href=#rook-operator-upgrade-process title="Permanent link">&para;</a></h2> <p>In the examples given in this guide, we will be upgrading a live Rook cluster running <code>v1.8.8</code> to<br> the version <code>v1.9.0</code>. This upgrade should work from any official patch release of Rook v1.8 to any<br> official patch release of v1.9.</p> <p><strong>Rook releases from <code>master</code> are expressly unsupported.</strong> It is strongly recommended that you use<br> <a href=https://github.com/rook/rook/releases>official releases</a> of Rook. Unreleased versions from the<br> master branch are subject to changes and incompatibilities that will not be supported in the<br> official releases. Builds from the master branch can have functionality changed or removed at any<br> time without compatibility support and without prior notice.</p> <p>These methods should work for any number of Rook-Ceph clusters and Rook Operators as long as you<br> parameterize the environment correctly. Merely repeat these steps for each Rook-Ceph cluster<br> (<code>ROOK_CLUSTER_NAMESPACE</code>), and be sure to update the <code>ROOK_OPERATOR_NAMESPACE</code> parameter each time<br> if applicable.</p> <p>Let's get started!</p> <h3 id=1-update-common-resources-and-crds><strong>1. Update common resources and CRDs</strong><a class=headerlink href=#1-update-common-resources-and-crds title="Permanent link">&para;</a></h3> <blockquote> <p>Automatically updated if you are upgrading via the helm chart</p> </blockquote> <p>First apply updates to Rook-Ceph common resources. This includes modified privileges (RBAC) needed<br> by the Operator. Also update the Custom Resource Definitions (CRDs).</p> <p>Get the latest common resources manifests that contain the latest changes.<br> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code>git clone --single-branch --depth<span class=o>=</span><span class=m>1</span> --branch v1.9.0 https://github.com/rook/rook.git
<span class=nb>cd</span> rook/deploy/examples
</code></pre></div> </td></tr></table></p> <p>If you have deployed the Rook Operator or the Ceph cluster into a different namespace than<br> <code>rook-ceph</code>, update the common resource manifests to use your <code>ROOK_OPERATOR_NAMESPACE</code> and<br> <code>ROOK_CLUSTER_NAMESPACE</code> using <code>sed</code>.<br> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code>sed -i.bak <span class=se>\</span>
    -e <span class=s2>&quot;s/\(.*\):.*# namespace:operator/\1: </span><span class=nv>$ROOK_OPERATOR_NAMESPACE</span><span class=s2> # namespace:operator/g&quot;</span> <span class=se>\</span>
    -e <span class=s2>&quot;s/\(.*\):.*# namespace:cluster/\1: </span><span class=nv>$ROOK_CLUSTER_NAMESPACE</span><span class=s2> # namespace:cluster/g&quot;</span> <span class=se>\</span>
  common.yaml
</code></pre></div> </td></tr></table></p> <p>Then apply the latest changes.<br> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code>kubectl apply -f common.yaml -f crds.yaml
</code></pre></div> </td></tr></table></p> <h4 id=updates-for-optional-resources><strong>Updates for optional resources</strong><a class=headerlink href=#updates-for-optional-resources title="Permanent link">&para;</a></h4> <h4 id=prometheus><strong>Prometheus</strong><a class=headerlink href=#prometheus title="Permanent link">&para;</a></h4> <p>If you have <a href=ceph-monitoring.md>Prometheus monitoring</a> enabled, follow the<br> step to upgrade the Prometheus RBAC resources as well.</p> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code>kubectl apply -f deploy/examples/monitoring/rbac.yaml
</code></pre></div> </td></tr></table> <p>Rook no longer deploys Prometheus rules from the operator.</p> <p>If you use the Helm chart <code>monitoring.enabled</code> value to deploy Prometheus rules, you may now<br> additionally use <code>monitoring.createPrometheusRules</code> to instruct Helm to deploy the rules. You may<br> alternately deploy the rules manually if you wish.</p> <p>To see the latest information about manually deploying rules, see the<br> <a href=ceph-monitoring.md#prometheus-alets>Prometheus monitoring docs</a>.</p> <h4 id=mds-liveness-and-startup-probes><strong>MDS liveness and startup probes</strong><a class=headerlink href=#mds-liveness-and-startup-probes title="Permanent link">&para;</a></h4> <p>If you configure MDS probes in the CephCluster resource, copy them to the<br> <a href=ceph-filesystem-crd.md#metadata-server-settings>CephFilesystem <code>metadataServer</code> settings</a> at this<br> point. Do not remove them from the CephCluster until after the Rook upgrade is fully complete.</p> <h3 id=2-update-ceph-csi-versions><strong>2. Update Ceph CSI versions</strong><a class=headerlink href=#2-update-ceph-csi-versions title="Permanent link">&para;</a></h3> <blockquote> <p>Automatically updated if you are upgrading via the helm chart</p> </blockquote> <p>If you have specified custom CSI images in the Rook-Ceph Operator deployment, we recommended you<br> update to use the latest Ceph-CSI drivers. See the <a href=#csi-version>CSI Version</a> section for more<br> details.</p> <blockquote> <p>Note: If using snapshots, refer to the <a href=ceph-csi-snapshot.md#upgrade-snapshot-api>Upgrade Snapshot API guide</a>.</p> </blockquote> <h3 id=3-update-the-rook-operator><strong>3. Update the Rook Operator</strong><a class=headerlink href=#3-update-the-rook-operator title="Permanent link">&para;</a></h3> <blockquote> <p>Automatically updated if you are upgrading via the helm chart</p> </blockquote> <p>The largest portion of the upgrade is triggered when the operator's image is updated to <code>v1.9.x</code>.<br> When the operator is updated, it will proceed to update all of the Ceph daemons.</p> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code>kubectl -n <span class=nv>$ROOK_OPERATOR_NAMESPACE</span> <span class=nb>set</span> image deploy/rook-ceph-operator rook-ceph-operator<span class=o>=</span>rook/ceph:v1.9.0
</code></pre></div> </td></tr></table> <h3 id=4-wait-for-the-upgrade-to-complete><strong>4. Wait for the upgrade to complete</strong><a class=headerlink href=#4-wait-for-the-upgrade-to-complete title="Permanent link">&para;</a></h3> <p>Watch now in amazement as the Ceph mons, mgrs, OSDs, rbd-mirrors, MDSes and RGWs are terminated and<br> replaced with updated versions in sequence. The cluster may be offline very briefly as mons update,<br> and the Ceph Filesystem may fall offline a few times while the MDSes are upgrading. This is normal.</p> <p>The versions of the components can be viewed as they are updated:</p> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code>watch --exec kubectl -n <span class=nv>$ROOK_CLUSTER_NAMESPACE</span> get deployments -l <span class=nv>rook_cluster</span><span class=o>=</span><span class=nv>$ROOK_CLUSTER_NAMESPACE</span> -o <span class=nv>jsonpath</span><span class=o>=</span><span class=s1>&#39;{range .items[*]}{.metadata.name}{&quot;  \treq/upd/avl: &quot;}{.spec.replicas}{&quot;/&quot;}{.status.updatedReplicas}{&quot;/&quot;}{.status.readyReplicas}{&quot;  \trook-version=&quot;}{.metadata.labels.rook-version}{&quot;\n&quot;}{end}&#39;</span>
</code></pre></div> </td></tr></table> <p>As an example, this cluster is midway through updating the OSDs. When all deployments report <code>1/1/1</code><br> availability and <code>rook-version=v1.9.0</code>, the Ceph cluster's core components are fully updated.</p> <blockquote> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span>
<span class=normal>5</span>
<span class=normal>6</span>
<span class=normal>7</span>
<span class=normal>8</span>
<span class=normal>9</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code>Every 2.0s: kubectl -n rook-ceph get deployment -o j...

rook-ceph-mgr-a         req/upd/avl: 1/1/1      rook-version=v1.9.0
rook-ceph-mon-a         req/upd/avl: 1/1/1      rook-version=v1.9.0
rook-ceph-mon-b         req/upd/avl: 1/1/1      rook-version=v1.9.0
rook-ceph-mon-c         req/upd/avl: 1/1/1      rook-version=v1.9.0
rook-ceph-osd-0         req/upd/avl: 1//        rook-version=v1.9.0
rook-ceph-osd-1         req/upd/avl: 1/1/1      rook-version=v1.8.8
rook-ceph-osd-2         req/upd/avl: 1/1/1      rook-version=v1.8.8
</code></pre></div> </td></tr></table> </blockquote> <p>An easy check to see if the upgrade is totally finished is to check that there is only one<br> <code>rook-version</code> reported across the cluster.</p> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span>
<span class=normal>5</span>
<span class=normal>6</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code><span class=gp># </span>kubectl -n <span class=nv>$ROOK_CLUSTER_NAMESPACE</span> get deployment -l <span class=nv>rook_cluster</span><span class=o>=</span><span class=nv>$ROOK_CLUSTER_NAMESPACE</span> -o <span class=nv>jsonpath</span><span class=o>=</span><span class=s1>&#39;{range .items[*]}{&quot;rook-version=&quot;}{.metadata.labels.rook-version}{&quot;\n&quot;}{end}&#39;</span> <span class=p>|</span> sort <span class=p>|</span> uniq
<span class=go>This cluster is not yet finished:</span>
<span class=go>  rook-version=v1.8.8</span>
<span class=go>  rook-version=v1.9.0</span>
<span class=go>This cluster is finished:</span>
<span class=go>  rook-version=v1.9.0</span>
</code></pre></div> </td></tr></table> <h3 id=5-verify-the-updated-cluster><strong>5. Verify the updated cluster</strong><a class=headerlink href=#5-verify-the-updated-cluster title="Permanent link">&para;</a></h3> <p>At this point, your Rook operator should be running version <code>rook/ceph:v1.9.0</code>.</p> <p>Verify the Ceph cluster's health using the <a href=#health-verification>health verification section</a>.</p> <h2 id=ceph-version-upgrades>Ceph Version Upgrades<a class=headerlink href=#ceph-version-upgrades title="Permanent link">&para;</a></h2> <p>Rook v1.9 supports the following Ceph versions:<br> - Ceph Quincy v17.2.0 or newer<br> - Ceph Pacific v16.2.0 or newer<br> - Ceph Octopus v15.2.0 or newer</p> <p>These are the only supported versions of Ceph. Rook v1.10 is planning to drop support for Ceph<br> Octopus (15.2.x), so please consider upgrading your Ceph cluster.</p> <blockquote> <p><strong>IMPORTANT: When an update is requested, the operator will check Ceph's status, if it is in <code>HEALTH_ERR</code> it will refuse to do the upgrade.</strong></p> </blockquote> <p>Rook is cautious when performing upgrades. When an upgrade is requested (the Ceph image has been<br> updated in the CR), Rook will go through all the daemons one by one and will individually perform<br> checks on them. It will make sure a particular daemon can be stopped before performing the upgrade.<br> Once the deployment has been updated, it checks if this is ok to continue. After each daemon is<br> updated we wait for things to settle (monitors to be in a quorum, PGs to be clean for OSDs, up for<br> MDSes, etc.), then only when the condition is met we move to the next daemon. We repeat this process<br> until all the daemons have been updated.</p> <p>We recommend updating to v16.2.7 or newer. If you require updating <strong>to v16.2.0-v16.2.6</strong>,<br> please see the <a href=https://rook.github.io/docs/rook/v1.8/ceph-upgrade.html#disable-bluestore_fsck_quick_fix_on_mount>v1.8 upgrade guide for a special upgrade consideration</a>.</p> <h3 id=rename-cephblockpool-device_health_metrics-pool-when-upgrading-to-quincy-v17><strong>Rename CephBlockPool device_health_metrics pool when upgrading to Quincy v17</strong><a class=headerlink href=#rename-cephblockpool-device_health_metrics-pool-when-upgrading-to-quincy-v17 title="Permanent link">&para;</a></h3> <p>In Ceph Quincy (v17), the <code>device_health_metrics</code> pool was renamed to <code>.mgr</code>. Ceph will perform this<br> migration automatically. If you do not use CephBlockPool to customize the configuration of the<br> <code>device_health_metrics</code> pool, you don't need to do anything further here.</p> <p>If you do use CephBlockPool to customize the configuration of the <code>device_health_metrics</code> pool, you<br> will need two extra steps after the Ceph upgrade is complete. Once upgrade is complete:<br> 1. Create a new CephBlockPool to configure the <code>.mgr</code> built-in pool. You can reference the example<br> <a href="https://github.com/rook/rook/blob/{{ branchName }}/deploy/examples/pool-builtin-mgr.yaml">builtin mgr pool</a>.<br> 2. Delete the old CephBlockPool that represents the <code>device_health_metrics</code> pool.</p> <h3 id=important-consideration-for-cephnfs-users><strong>Important consideration for CephNFS users</strong><a class=headerlink href=#important-consideration-for-cephnfs-users title="Permanent link">&para;</a></h3> <p>Ceph Quincy v17.2.0 has a potentially breaking regression with CephNFS. See the NFS documentation's<br> <a href=ceph-nfs-crd.md#ceph-v1720>known issue</a> for more detail.</p> <h3 id=ceph-images><strong>Ceph images</strong><a class=headerlink href=#ceph-images title="Permanent link">&para;</a></h3> <p>Official Ceph container images can be found on <a href="https://quay.io/repository/ceph/ceph?tab=tags">Quay</a>.<br> Prior to August 2021, official images were on docker.io. While those images will remain on Docker Hub, all new images are being pushed to Quay.</p> <p>These images are tagged in a few ways:</p> <ul> <li>The most explicit form of tags are full-ceph-version-and-build tags (e.g., <code>v16.2.7-20220216</code>).<br> These tags are recommended for production clusters, as there is no possibility for the cluster to<br> be heterogeneous with respect to the version of Ceph running in containers.</li> <li>Ceph major version tags (e.g., <code>v16</code>) are useful for development and test clusters so that the<br> latest version of Ceph is always available.</li> </ul> <p><strong>Ceph containers other than the official images from the registry above will not be supported.</strong></p> <h3 id=example-upgrade-to-ceph-pacific><strong>Example upgrade to Ceph Pacific</strong><a class=headerlink href=#example-upgrade-to-ceph-pacific title="Permanent link">&para;</a></h3> <h4 id=1-update-the-main-ceph-daemons><strong>1. Update the main Ceph daemons</strong><a class=headerlink href=#1-update-the-main-ceph-daemons title="Permanent link">&para;</a></h4> <p>The majority of the upgrade will be handled by the Rook operator. Begin the upgrade by changing the<br> Ceph image field in the cluster CRD (<code>spec.cephVersion.image</code>).</p> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code><span class=nv>NEW_CEPH_IMAGE</span><span class=o>=</span><span class=s1>&#39;quay.io/ceph/ceph:v16.2.7-20220216&#39;</span>
<span class=nv>CLUSTER_NAME</span><span class=o>=</span><span class=s2>&quot;</span><span class=nv>$ROOK_CLUSTER_NAMESPACE</span><span class=s2>&quot;</span>  <span class=c1># change if your cluster name is not the Rook namespace</span>
kubectl -n <span class=nv>$ROOK_CLUSTER_NAMESPACE</span> patch CephCluster <span class=nv>$CLUSTER_NAME</span> --type<span class=o>=</span>merge -p <span class=s2>&quot;{\&quot;spec\&quot;: {\&quot;cephVersion\&quot;: {\&quot;image\&quot;: \&quot;</span><span class=nv>$NEW_CEPH_IMAGE</span><span class=s2>\&quot;}}}&quot;</span>
</code></pre></div> </td></tr></table> <h4 id=2-wait-for-the-daemon-pod-updates-to-complete><strong>2. Wait for the daemon pod updates to complete</strong><a class=headerlink href=#2-wait-for-the-daemon-pod-updates-to-complete title="Permanent link">&para;</a></h4> <p>As with upgrading Rook, you must now wait for the upgrade to complete. Status can be determined in a<br> similar way to the Rook upgrade as well.</p> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code>watch --exec kubectl -n <span class=nv>$ROOK_CLUSTER_NAMESPACE</span> get deployments -l <span class=nv>rook_cluster</span><span class=o>=</span><span class=nv>$ROOK_CLUSTER_NAMESPACE</span> -o <span class=nv>jsonpath</span><span class=o>=</span><span class=s1>&#39;{range .items[*]}{.metadata.name}{&quot;  \treq/upd/avl: &quot;}{.spec.replicas}{&quot;/&quot;}{.status.updatedReplicas}{&quot;/&quot;}{.status.readyReplicas}{&quot;  \tceph-version=&quot;}{.metadata.labels.ceph-version}{&quot;\n&quot;}{end}&#39;</span>
</code></pre></div> </td></tr></table> <p>Determining when the Ceph has fully updated is rather simple.</p> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span>
<span class=normal>5</span>
<span class=normal>6</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code><span class=go>kubectl -n $ROOK_CLUSTER_NAMESPACE get deployment -l rook_cluster=$ROOK_CLUSTER_NAMESPACE -o jsonpath=&#39;{range .items[*]}{&quot;ceph-version=&quot;}{.metadata.labels.ceph-version}{&quot;\n&quot;}{end}&#39; | sort | uniq</span>
<span class=go>This cluster is not yet finished:</span>
<span class=go>    ceph-version=15.2.13-0</span>
<span class=go>    ceph-version=16.2.6-0</span>
<span class=go>This cluster is finished:</span>
<span class=go>    ceph-version=16.2.6-0</span>
</code></pre></div> </td></tr></table> <h4 id=3-verify-the-updated-cluster><strong>3. Verify the updated cluster</strong><a class=headerlink href=#3-verify-the-updated-cluster title="Permanent link">&para;</a></h4> <p>Verify the Ceph cluster's health using the <a href=#health-verification>health verification section</a>.</p> <h2 id=csi-version>CSI Version<a class=headerlink href=#csi-version title="Permanent link">&para;</a></h2> <p>If you have a cluster running with CSI drivers enabled and you want to configure Rook<br> to use non-default CSI images, the following settings will need to be applied for the desired<br> version of CSI.</p> <p>The operator configuration variables are found in the <code>rook-ceph-operator-config</code> ConfigMap.<br> These settings can also be specified as environment variables on the operator deployment, but<br> the env vars will be overridden if configmap values are specified.</p> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code><span class=go>kubectl -n $ROOK_OPERATOR_NAMESPACE edit configmap rook-ceph-operator-config</span>
</code></pre></div> </td></tr></table> <p>The default upstream images are included below, which you can change to your desired images.</p> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span>
<span class=normal>2</span>
<span class=normal>3</span>
<span class=normal>4</span>
<span class=normal>5</span>
<span class=normal>6</span>
<span class=normal>7</span>
<span class=normal>8</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code><span class=nt>ROOK_CSI_CEPH_IMAGE</span><span class=p>:</span><span class=w> </span><span class=s>&quot;quay.io/cephcsi/cephcsi:v3.6.1&quot;</span><span class=w></span>
<span class=nt>ROOK_CSI_REGISTRAR_IMAGE</span><span class=p>:</span><span class=w> </span><span class=s>&quot;k8s.gcr.io/sig-storage/csi-node-driver-registrar:v2.5.0&quot;</span><span class=w></span>
<span class=nt>ROOK_CSI_PROVISIONER_IMAGE</span><span class=p>:</span><span class=w> </span><span class=s>&quot;k8s.gcr.io/sig-storage/csi-provisioner:v3.1.0&quot;</span><span class=w></span>
<span class=nt>ROOK_CSI_ATTACHER_IMAGE</span><span class=p>:</span><span class=w> </span><span class=s>&quot;k8s.gcr.io/sig-storage/csi-attacher:v3.4.0&quot;</span><span class=w></span>
<span class=nt>ROOK_CSI_RESIZER_IMAGE</span><span class=p>:</span><span class=w> </span><span class=s>&quot;k8s.gcr.io/sig-storage/csi-resizer:v1.4.0&quot;</span><span class=w></span>
<span class=nt>ROOK_CSI_SNAPSHOTTER_IMAGE</span><span class=p>:</span><span class=w> </span><span class=s>&quot;k8s.gcr.io/sig-storage/csi-snapshotter:v5.0.1&quot;</span><span class=w></span>
<span class=nt>CSI_VOLUME_REPLICATION_IMAGE</span><span class=p>:</span><span class=w> </span><span class=s>&quot;quay.io/csiaddons/volumereplication-operator:v0.3.0&quot;</span><span class=w></span>
<span class=nt>ROOK_CSIADDONS_IMAGE</span><span class=p>:</span><span class=w> </span><span class=s>&quot;quay.io/csiaddons/k8s-sidecar:v0.2.1&quot;</span><span class=w></span>
</code></pre></div> </td></tr></table> <h3 id=use-default-images><strong>Use default images</strong><a class=headerlink href=#use-default-images title="Permanent link">&para;</a></h3> <p>If you would like Rook to use the inbuilt default upstream images, then you may simply remove all<br> variables matching <code>ROOK_CSI_*_IMAGE</code> from the above ConfigMap and/or the operator deployment.</p> <h3 id=verifying-updates><strong>Verifying updates</strong><a class=headerlink href=#verifying-updates title="Permanent link">&para;</a></h3> <p>You can use the below command to see the CSI images currently being used in the cluster. Note that<br> not all images (like <code>volumereplication-operator</code>) may be present in every cluster depending on<br> which CSI features are enabled.</p> <table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal>1</span></pre></div></td><td class=code><div class=highlight><pre><span></span><code><span class=go>kubectl --namespace rook-ceph get pod -o jsonpath=&#39;{range .items[*]}{range .spec.containers[*]}{.image}{&quot;\n&quot;}&#39; -l &#39;app in (csi-rbdplugin,csi-rbdplugin-provisioner,csi-cephfsplugin,csi-cephfsplugin-provisioner)&#39; | sort | uniq</span>
</code></pre></div> </td></tr></table> <p>The default images can also be found with each release in the <a href="https://github.com/rook/rook/blob/{{ branchName }}/deploy/examples/images.txt">images list</a></p> </article> <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script> </div> </div> <a href=# class="md-top md-top--hidden md-icon" data-md-component=top> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"/></svg> Back to top </a> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../../Prerequisites/prerequisites/ class="md-footer__link md-footer__link--prev" aria-label="Previous: Prerequisites" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Previous </span> Prerequisites </div> </div> </a> <a href=../../Usages-and-Examples/ceph-advanced-configuration/ class="md-footer__link md-footer__link--next" aria-label="Next: Advanced Configuration" rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Next </span> Advanced Configuration </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> <a href=/ class=logo> <img src=/images/rook-logo-small.svg alt=rook.io> </a> <p> &#169; Rook Authors 2022. Documentation distributed under <a href=https://creativecommons.org/licenses/by/4.0>CC-BY-4.0</a>. </p> <p> &#169; 2022 The Linux Foundation. All rights reserved. The Linux Foundation has registered trademarks and uses trademarks. For a list of trademarks of The Linux Foundation, please see our <a href=https://www.linuxfoundation.org/trademark-usage/ >Trademark Usage</a> page. </p> </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs Insiders </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["content.tabs.link", "instant", "navigation.tabs", "navigation.top", "navigation.tracking", "privacy", "search.highlight", "search.share", "search.suggest", "tabs"], "search": "../../assets/javascripts/workers/search.5c9dbbf3.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "version": {"default": "latest", "provider": "mike"}}</script> <script src=../../assets/javascripts/bundle.10bf1588.min.js></script> </body> </html>