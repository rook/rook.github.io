












































<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />

    
    <meta name="robots" content="noindex">
    

    <title>NFS Docs</title>

    <link rel="canonical" href="https://rook.io/docs/nfs/latest/quickstart.html">

    <link rel="icon" href="/favicon.ico" />
<link rel="icon" type="image/png" href="/images/favicon_16x16.png" sizes="16x16" />
<link rel="icon" type="image/png" href="/images/favicon_32x32.png" sizes="32x32" />
<link rel="icon" type="image/png" href="/images/favicon_48x48.png" sizes="48x48" />
<link rel="icon" type="image/png" href="/images/favicon_192x192.png" sizes="192x192" />


    <link href="//fonts.googleapis.com/css?family=Montserrat:500|Open+Sans:300,400,600" rel="stylesheet">
    
    <link rel="stylesheet" href="/css/main.css">
    
      <link rel="stylesheet" href="/css/docs.css" />
    
  </head>
  <body>
    <nav id="navigation" aria-label="Navigation">
  <div>
    <div class="logo">
      <a href="/"><img src="/images/rook-logo.svg"/></a>
    </div>
    <div
      class="hamburger-controls"
      onclick="if (document.body.classList.contains('menu-open')) { document.body.classList.remove('menu-open') } else { document.body.classList.add('menu-open') }; return false;">
      <span></span> <span></span> <span></span>
    </div>
    <ul class="links">
      <li class="dropdown">
        <a role="button" href="javascript:void(0)">Documentation</a>
        <div class="dropdown-content">
          <a href="/docs/rook/v1.9/">Ceph</a>
          <a href="/docs/cassandra/v1.7/">Cassandra</a>
          <a href="/docs/nfs/v1.7/">NFS</a>
        </div>
      <li class="dropdown">
        <a role="button" href="javascript:void(0)">Community</a>
        <div class="dropdown-content">
          <a href="//github.com/rook/rook">GitHub</a>
          <a href="//slack.rook.io/">Slack</a>
          <a href="//groups.google.com/forum/#!forum/rook-dev">Forum</a>
          <a href="//twitter.com/rook_io">Twitter</a>
        </div>
      </li>
      <li><a href="//blog.rook.io/">Blog</a></li>
      <li><a class="button small" href="/docs/rook/v1.9/quickstart.html">Get Started</a></li>
    </ul>
  </div>
</nav>

    <main id="content" aria-label="Content"><div>



















<section class="docs-header">
  <h1>NFS</h1>
  <div class="versions">
    <a role="button" href="javascript:void(0)">Rook NFS latest</a>
    <div class="versions-dropdown-content">
      
        <a href="/docs/nfs/v1.7/quickstart.html">Rook NFS v1.7</a>
      
        <a href="/docs/nfs/latest/quickstart.html" class="active">Rook NFS latest</a>
      
    </div>
    <img src="/images/arrow.svg" />
  </div>
</section>
<div class="page">
  <div class="docs-menu">
      <ul id="docs-ul"></ul>
  </div>
  <div class="docs-content">
    <div class="docs-actions">
      <a id="edit" href="https://github.com/rook/nfs/blob/master/Documentation/quickstart.md">Edit on GitHub</a>
    </div>
    
      <div class="alert master">
        <p><b>PLEASE NOTE:</b> This document applies to an <b>unreleased</b> version of Rook. It is strongly recommended that you only use official releases of Rook, as unreleased versions are subject to changes and incompatibilities that will not be supported in the official releases.</p>
      </div>
    
    <div class="docs-text">
      
<h1 id="network-filesystem-nfs-quickstart">Network Filesystem (NFS) Quickstart</h1>

<p><strong>The Rook NFS operator is <a href="https://github.com/rook/nfs#deprecated">deprecated</a></strong></p>

<p>Welcome to Rook! We hope you have a great experience installing the Rook <strong>cloud-native storage orchestrator</strong> platform
to enable highly available, durable storage in your Kubernetes cluster.</p>

<p>NFS allows remote hosts to mount filesystems over a network and interact with those filesystems as though they are mounted locally. This enables system administrators to consolidate resources onto centralized servers on the network.</p>

<p>If you have any questions along the way, please don’t hesitate to ask us in our <a href="https://rook-io.slack.com">Slack channel</a>. You can sign up for our Slack <a href="https://slack.rook.io">here</a>.</p>

<h2 id="prerequisites">Prerequisites</h2>

<ol>
  <li>A Kubernetes cluster (v1.16 or higher) is necessary to run the Rook NFS operator. To make sure you have a Kubernetes cluster that is ready for <code class="language-plaintext highlighter-rouge">Rook</code>, you can <a href="/docs/nfs/latest/k8s-pre-reqs.html">follow these instructions</a>.</li>
  <li>The desired volume to export needs to be attached to the NFS server pod via a <a href="https://kubernetes.io/docs/concepts/storage/persistent-volumes/#persistentvolumeclaims">PVC</a>.
Any type of PVC can be attached and exported, such as Host Path, AWS Elastic Block Store, GCP Persistent Disk, CephFS, Ceph RBD, etc.
The limitations of these volumes also apply while they are shared by NFS.
You can read further about the details and limitations of these volumes in the <a href="https://kubernetes.io/docs/concepts/storage/persistent-volumes/">Kubernetes docs</a>.</li>
  <li>NFS client packages must be installed on all nodes where Kubernetes might run pods with NFS mounted. Install <code class="language-plaintext highlighter-rouge">nfs-utils</code> on CentOS nodes or <code class="language-plaintext highlighter-rouge">nfs-common</code> on Ubuntu nodes.</li>
</ol>

<h2 id="deploy-nfs-operator">Deploy NFS Operator</h2>

<p>First deploy the Rook NFS operator using the following commands:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>git clone <span class="nt">--single-branch</span> <span class="nt">--branch</span> release-latest https://github.com/rook/nfs.git
<span class="go">cd nfs/cluster/examples/kubernetes/nfs
kubectl create -f crds.yaml
kubectl create -f operator.yaml
</span></code></pre></div></div>

<p>You can check if the operator is up and running with:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">kubectl -n rook-nfs-system get pod
</span></code></pre></div></div>

<blockquote>
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>NAME                                    READY   STATUS    RESTARTS   AGE
rook-nfs-operator-879f5bf8b-gnwht       1/1     Running   0          29m
</code></pre></div>  </div>
</blockquote>

<h2 id="deploy-nfs-admission-webhook-optional">Deploy NFS Admission Webhook (Optional)</h2>

<p>Admission webhooks are HTTP callbacks that receive admission requests to the API server. Two types of admission webhooks is validating admission webhook and mutating admission webhook. NFS Operator support validating admission webhook which validate the NFSServer object sent to the API server before stored in the etcd (persisted).</p>

<p>To enable admission webhook on NFS such as validating admission webhook, you need to do as following:</p>

<p>First, ensure that <code class="language-plaintext highlighter-rouge">cert-manager</code> is installed.  If it is not installed yet, you can install it as described in the <code class="language-plaintext highlighter-rouge">cert-manager</code> <a href="https://cert-manager.io/docs/installation/kubernetes/">installation</a> documentation. Alternatively, you can simply just run the single command below:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">kubectl apply --validate=false -f https://github.com/jetstack/cert-manager/releases/download/v0.15.1/cert-manager.yaml
</span></code></pre></div></div>

<p>This will easily get the latest version (<code class="language-plaintext highlighter-rouge">v0.15.1</code>) of <code class="language-plaintext highlighter-rouge">cert-manager</code>  installed. After that completes, make sure the cert-manager component deployed properly and is in the <code class="language-plaintext highlighter-rouge">Running</code> status:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">kubectl get -n cert-manager pod
</span></code></pre></div></div>

<blockquote>
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>NAME                                      READY   STATUS    RESTARTS   AGE
cert-manager-7747db9d88-jmw2f             1/1     Running   0          2m1s
cert-manager-cainjector-87c85c6ff-dhtl8   1/1     Running   0          2m1s
cert-manager-webhook-64dc9fff44-5g565     1/1     Running   0          2m1s
</code></pre></div>  </div>
</blockquote>

<p>Once <code class="language-plaintext highlighter-rouge">cert-manager</code> is running, you can now deploy the NFS webhook:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">kubectl create -f webhook.yaml
</span></code></pre></div></div>

<p>Verify the webhook is up and running:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">kubectl -n rook-nfs-system get pod
</span></code></pre></div></div>

<blockquote>
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>NAME                                    READY   STATUS    RESTARTS   AGE
rook-nfs-operator-78d86bf969-k7lqp      1/1     Running   0          102s
rook-nfs-webhook-74749cbd46-6jw2w       1/1     Running   0          102s
</code></pre></div>  </div>
</blockquote>

<h2 id="create-openshift-security-context-constraints-optional">Create Openshift Security Context Constraints (Optional)</h2>

<p>On OpenShift clusters, we will need to create some additional security context constraints.  If you are <strong>not</strong> running in OpenShift you can skip this and go to the <a href="#create-and-initialize-nfs-server">next section</a>.</p>

<p>To create the security context constraints for nfs-server pods, we can use the following yaml, which is also found in <code class="language-plaintext highlighter-rouge">scc.yaml</code> under <code class="language-plaintext highlighter-rouge">/cluster/examples/kubernetes/nfs</code>.</p>

<blockquote>
  <p><em>NOTE: Older versions of OpenShift may require <code class="language-plaintext highlighter-rouge">apiVersion: v1</code></em></p>
</blockquote>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">kind</span><span class="pi">:</span> <span class="s">SecurityContextConstraints</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">security.openshift.io/v1</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">rook-nfs</span>
<span class="na">allowHostDirVolumePlugin</span><span class="pi">:</span> <span class="no">true</span>
<span class="na">allowHostIPC</span><span class="pi">:</span> <span class="no">false</span>
<span class="na">allowHostNetwork</span><span class="pi">:</span> <span class="no">false</span>
<span class="na">allowHostPID</span><span class="pi">:</span> <span class="no">false</span>
<span class="na">allowHostPorts</span><span class="pi">:</span> <span class="no">false</span>
<span class="na">allowPrivilegedContainer</span><span class="pi">:</span> <span class="no">false</span>
<span class="na">allowedCapabilities</span><span class="pi">:</span>
<span class="pi">-</span> <span class="s">SYS_ADMIN</span>
<span class="pi">-</span> <span class="s">DAC_READ_SEARCH</span>
<span class="na">defaultAddCapabilities</span><span class="pi">:</span> <span class="no">null</span>
<span class="na">fsGroup</span><span class="pi">:</span>
  <span class="na">type</span><span class="pi">:</span> <span class="s">MustRunAs</span>
<span class="na">priority</span><span class="pi">:</span> <span class="no">null</span>
<span class="na">readOnlyRootFilesystem</span><span class="pi">:</span> <span class="no">false</span>
<span class="na">requiredDropCapabilities</span><span class="pi">:</span>
<span class="pi">-</span> <span class="s">KILL</span>
<span class="pi">-</span> <span class="s">MKNOD</span>
<span class="pi">-</span> <span class="s">SYS_CHROOT</span>
<span class="na">runAsUser</span><span class="pi">:</span>
  <span class="na">type</span><span class="pi">:</span> <span class="s">RunAsAny</span>
<span class="na">seLinuxContext</span><span class="pi">:</span>
  <span class="na">type</span><span class="pi">:</span> <span class="s">MustRunAs</span>
<span class="na">supplementalGroups</span><span class="pi">:</span>
  <span class="na">type</span><span class="pi">:</span> <span class="s">RunAsAny</span>
<span class="na">volumes</span><span class="pi">:</span>
<span class="pi">-</span> <span class="s">configMap</span>
<span class="pi">-</span> <span class="s">downwardAPI</span>
<span class="pi">-</span> <span class="s">emptyDir</span>
<span class="pi">-</span> <span class="s">persistentVolumeClaim</span>
<span class="pi">-</span> <span class="s">secret</span>
<span class="na">users</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">system:serviceaccount:rook-nfs:rook-nfs-server</span>
</code></pre></div></div>

<p>You can create scc with following command:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">oc create -f scc.yaml
</span></code></pre></div></div>

<h2 id="create-pod-security-policies-recommended">Create Pod Security Policies (Recommended)</h2>

<p>We recommend you to create Pod Security Policies as well</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">policy/v1beta1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">PodSecurityPolicy</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">rook-nfs-policy</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">privileged</span><span class="pi">:</span> <span class="no">true</span>
  <span class="na">fsGroup</span><span class="pi">:</span>
    <span class="na">rule</span><span class="pi">:</span> <span class="s">RunAsAny</span>
  <span class="na">allowedCapabilities</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">DAC_READ_SEARCH</span>
  <span class="pi">-</span> <span class="s">SYS_RESOURCE</span>
  <span class="na">runAsUser</span><span class="pi">:</span>
    <span class="na">rule</span><span class="pi">:</span> <span class="s">RunAsAny</span>
  <span class="na">seLinux</span><span class="pi">:</span>
    <span class="na">rule</span><span class="pi">:</span> <span class="s">RunAsAny</span>
  <span class="na">supplementalGroups</span><span class="pi">:</span>
    <span class="na">rule</span><span class="pi">:</span> <span class="s">RunAsAny</span>
  <span class="na">volumes</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">configMap</span>
  <span class="pi">-</span> <span class="s">downwardAPI</span>
  <span class="pi">-</span> <span class="s">emptyDir</span>
  <span class="pi">-</span> <span class="s">persistentVolumeClaim</span>
  <span class="pi">-</span> <span class="s">secret</span>
  <span class="pi">-</span> <span class="s">hostPath</span>
</code></pre></div></div>

<p>Save this file with name <code class="language-plaintext highlighter-rouge">psp.yaml</code> and create with following command:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">kubectl create -f psp.yaml
</span></code></pre></div></div>

<h2 id="create-and-initialize-nfs-server">Create and Initialize NFS Server</h2>

<p>Now that the operator is running, we can create an instance of a NFS server by creating an instance of the <code class="language-plaintext highlighter-rouge">nfsservers.nfs.rook.io</code> resource.
The various fields and options of the NFS server resource can be used to configure the server and its volumes to export.
Full details of the available configuration options can be found in the <a href="/docs/nfs/latest/nfs-crd.html">NFS CRD documentation</a>.</p>

<p>Before we create NFS Server we need to create <code class="language-plaintext highlighter-rouge">ServiceAccount</code> and <code class="language-plaintext highlighter-rouge">RBAC</code> rules</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Namespace</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span>  <span class="s">rook-nfs</span>
<span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">ServiceAccount</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">rook-nfs-server</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">rook-nfs</span>
<span class="nn">---</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">ClusterRole</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">rbac.authorization.k8s.io/v1</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">rook-nfs-provisioner-runner</span>
<span class="na">rules</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">apiGroups</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">"</span><span class="pi">]</span>
    <span class="na">resources</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">persistentvolumes"</span><span class="pi">]</span>
    <span class="na">verbs</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">get"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">list"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">watch"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">create"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">delete"</span><span class="pi">]</span>
  <span class="pi">-</span> <span class="na">apiGroups</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">"</span><span class="pi">]</span>
    <span class="na">resources</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">persistentvolumeclaims"</span><span class="pi">]</span>
    <span class="na">verbs</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">get"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">list"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">watch"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">update"</span><span class="pi">]</span>
  <span class="pi">-</span> <span class="na">apiGroups</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">storage.k8s.io"</span><span class="pi">]</span>
    <span class="na">resources</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">storageclasses"</span><span class="pi">]</span>
    <span class="na">verbs</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">get"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">list"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">watch"</span><span class="pi">]</span>
  <span class="pi">-</span> <span class="na">apiGroups</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">"</span><span class="pi">]</span>
    <span class="na">resources</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">events"</span><span class="pi">]</span>
    <span class="na">verbs</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">create"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">update"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">patch"</span><span class="pi">]</span>
  <span class="pi">-</span> <span class="na">apiGroups</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">"</span><span class="pi">]</span>
    <span class="na">resources</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">services"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">endpoints"</span><span class="pi">]</span>
    <span class="na">verbs</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">get"</span><span class="pi">]</span>
  <span class="pi">-</span> <span class="na">apiGroups</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">policy"</span><span class="pi">]</span>
    <span class="na">resources</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">podsecuritypolicies"</span><span class="pi">]</span>
    <span class="na">resourceNames</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">rook-nfs-policy"</span><span class="pi">]</span>
    <span class="na">verbs</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">use"</span><span class="pi">]</span>
  <span class="pi">-</span> <span class="na">apiGroups</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">"</span><span class="pi">]</span>
    <span class="na">resources</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">endpoints"</span><span class="pi">]</span>
    <span class="na">verbs</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">get"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">list"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">watch"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">create"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">update"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">patch"</span><span class="pi">]</span>
  <span class="pi">-</span> <span class="na">apiGroups</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">nfs.rook.io</span>
    <span class="na">resources</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s2">"</span><span class="s">*"</span>
    <span class="na">verbs</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s2">"</span><span class="s">*"</span>
<span class="nn">---</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">ClusterRoleBinding</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">rbac.authorization.k8s.io/v1</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">rook-nfs-provisioner-runner</span>
<span class="na">subjects</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">kind</span><span class="pi">:</span> <span class="s">ServiceAccount</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">rook-nfs-server</span>
     <span class="s"># replace with namespace where provisioner is deployed</span>
    <span class="na">namespace</span><span class="pi">:</span> <span class="s">rook-nfs</span>
<span class="na">roleRef</span><span class="pi">:</span>
  <span class="na">kind</span><span class="pi">:</span> <span class="s">ClusterRole</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">rook-nfs-provisioner-runner</span>
  <span class="na">apiGroup</span><span class="pi">:</span> <span class="s">rbac.authorization.k8s.io</span>
</code></pre></div></div>

<p>Save this file with name <code class="language-plaintext highlighter-rouge">rbac.yaml</code> and create with following command:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">kubectl create -f rbac.yaml
</span></code></pre></div></div>

<p>This guide has 3 main examples that demonstrate exporting volumes with a NFS server:</p>

<ol>
  <li><a href="#default-storageclass-example">Default StorageClass example</a></li>
  <li><a href="#xfs-storageclass-example">XFS StorageClass example</a></li>
  <li><a href="#rook-ceph-volume-example">Rook Ceph volume example</a></li>
</ol>

<h3 id="default-storageclass-example">Default StorageClass example</h3>

<p>This first example will walk through creating a NFS server instance that exports storage that is backed by the default <code class="language-plaintext highlighter-rouge">StorageClass</code> for the environment you happen to be running in.
In some environments, this could be a host path, in others it could be a cloud provider virtual disk.
Either way, this example requires a default <code class="language-plaintext highlighter-rouge">StorageClass</code> to exist.</p>

<p>Start by saving the below NFS CRD instance definition to a file called <code class="language-plaintext highlighter-rouge">nfs.yaml</code>:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">---</span>
<span class="c1"># A default storageclass must be present</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">PersistentVolumeClaim</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">nfs-default-claim</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">rook-nfs</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">accessModes</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">ReadWriteMany</span>
  <span class="na">resources</span><span class="pi">:</span>
    <span class="na">requests</span><span class="pi">:</span>
      <span class="na">storage</span><span class="pi">:</span> <span class="s">1Gi</span>
<span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">nfs.rook.io/v1alpha1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">NFSServer</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">rook-nfs</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">rook-nfs</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">replicas</span><span class="pi">:</span> <span class="m">1</span>
  <span class="na">exports</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">share1</span>
    <span class="na">server</span><span class="pi">:</span>
      <span class="na">accessMode</span><span class="pi">:</span> <span class="s">ReadWrite</span>
      <span class="na">squash</span><span class="pi">:</span> <span class="s2">"</span><span class="s">none"</span>
    <span class="c1"># A Persistent Volume Claim must be created before creating NFS CRD instance.</span>
    <span class="na">persistentVolumeClaim</span><span class="pi">:</span>
      <span class="na">claimName</span><span class="pi">:</span> <span class="s">nfs-default-claim</span>
  <span class="c1"># A key/value list of annotations</span>
  <span class="na">annotations</span><span class="pi">:</span>
    <span class="na">rook</span><span class="pi">:</span> <span class="s">nfs</span>
</code></pre></div></div>

<p>With the <code class="language-plaintext highlighter-rouge">nfs.yaml</code> file saved, now create the NFS server as shown:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">kubectl create -f nfs.yaml
</span></code></pre></div></div>

<h3 id="xfs-storageclass-example">XFS StorageClass example</h3>

<p>Rook NFS support disk quota through <code class="language-plaintext highlighter-rouge">xfs_quota</code>. So if you need specify disk quota for your volumes you can follow this example.</p>

<p>In this example, we will use an underlying volume mounted as <code class="language-plaintext highlighter-rouge">xfs</code> with <code class="language-plaintext highlighter-rouge">prjquota</code> option. Before you can create that underlying volume, you need to create <code class="language-plaintext highlighter-rouge">StorageClass</code> with <code class="language-plaintext highlighter-rouge">xfs</code> filesystem and <code class="language-plaintext highlighter-rouge">prjquota</code> mountOptions. Many distributed storage providers for Kubernetes support <code class="language-plaintext highlighter-rouge">xfs</code> filesystem. Typically by defining <code class="language-plaintext highlighter-rouge">fsType: xfs</code> or <code class="language-plaintext highlighter-rouge">fs: xfs</code> in storageClass parameters. But actually how to specify storage-class filesystem type is depend on the storage providers it self. You can see https://kubernetes.io/docs/concepts/storage/storage-classes/ for more details.</p>

<p>Here is example <code class="language-plaintext highlighter-rouge">StorageClass</code> for GCE PD and AWS EBS</p>

<ul>
  <li>GCE PD</li>
</ul>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">storage.k8s.io/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">StorageClass</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">standard-xfs</span>
<span class="na">parameters</span><span class="pi">:</span>
  <span class="na">type</span><span class="pi">:</span> <span class="s">pd-standard</span>
  <span class="na">fsType</span><span class="pi">:</span> <span class="s">xfs</span>
<span class="na">mountOptions</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">prjquota</span>
<span class="na">provisioner</span><span class="pi">:</span> <span class="s">kubernetes.io/gce-pd</span>
<span class="na">reclaimPolicy</span><span class="pi">:</span> <span class="s">Delete</span>
<span class="na">volumeBindingMode</span><span class="pi">:</span> <span class="s">Immediate</span>
<span class="na">allowVolumeExpansion</span><span class="pi">:</span> <span class="no">true</span>
</code></pre></div></div>

<ul>
  <li>AWS EBS</li>
</ul>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">storage.k8s.io/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">StorageClass</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">standard-xfs</span>
<span class="na">provisioner</span><span class="pi">:</span> <span class="s">kubernetes.io/aws-ebs</span>
<span class="na">parameters</span><span class="pi">:</span>
  <span class="na">type</span><span class="pi">:</span> <span class="s">io1</span>
  <span class="na">iopsPerGB</span><span class="pi">:</span> <span class="s2">"</span><span class="s">10"</span>
  <span class="na">fsType</span><span class="pi">:</span> <span class="s">xfs</span>
<span class="na">mountOptions</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">prjquota</span>
<span class="na">reclaimPolicy</span><span class="pi">:</span> <span class="s">Delete</span>
<span class="na">volumeBindingMode</span><span class="pi">:</span> <span class="s">Immediate</span>
</code></pre></div></div>

<p>Once you already have <code class="language-plaintext highlighter-rouge">StorageClass</code> with <code class="language-plaintext highlighter-rouge">xfs</code> filesystem and <code class="language-plaintext highlighter-rouge">prjquota</code> mountOptions you can create NFS server instance with the following example.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">---</span>
<span class="c1"># A storage class with name standard-xfs must be present.</span>
<span class="c1"># The storage class must be has xfs filesystem type  and prjquota mountOptions.</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">PersistentVolumeClaim</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">nfs-xfs-claim</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">rook-nfs</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">storageClassName</span><span class="pi">:</span> <span class="s2">"</span><span class="s">standard-xfs"</span>
  <span class="na">accessModes</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">ReadWriteOnce</span>
  <span class="na">resources</span><span class="pi">:</span>
    <span class="na">requests</span><span class="pi">:</span>
      <span class="na">storage</span><span class="pi">:</span> <span class="s">1Gi</span>
<span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">nfs.rook.io/v1alpha1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">NFSServer</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">rook-nfs</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">rook-nfs</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">replicas</span><span class="pi">:</span> <span class="m">1</span>
  <span class="na">exports</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">share1</span>
    <span class="na">server</span><span class="pi">:</span>
      <span class="na">accessMode</span><span class="pi">:</span> <span class="s">ReadWrite</span>
      <span class="na">squash</span><span class="pi">:</span> <span class="s2">"</span><span class="s">none"</span>
    <span class="c1"># A Persistent Volume Claim must be created before creating NFS CRD instance.</span>
    <span class="na">persistentVolumeClaim</span><span class="pi">:</span>
      <span class="na">claimName</span><span class="pi">:</span> <span class="s">nfs-xfs-claim</span>
  <span class="c1"># A key/value list of annotations</span>
  <span class="na">annotations</span><span class="pi">:</span>
    <span class="na">rook</span><span class="pi">:</span> <span class="s">nfs</span>
</code></pre></div></div>

<p>Save this PVC and NFS Server instance as <code class="language-plaintext highlighter-rouge">nfs-xfs.yaml</code> and create with following command.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">kubectl create -f nfs-xfs.yaml
</span></code></pre></div></div>

<h3 id="rook-ceph-volume-example">Rook Ceph volume example</h3>

<p>In this alternative example, we will use a different underlying volume as an export for the NFS server.
These steps will walk us through exporting a Ceph RBD block volume so that clients can access it across the network.</p>

<p>First, you have to <a href="ceph-quickstart.md">follow these instructions</a> to deploy a sample Rook Ceph cluster that can be attached to the NFS server pod for sharing.
After the Rook Ceph cluster is up and running, we can create proceed with creating the NFS server.</p>

<p>Save this PVC and NFS Server instance as <code class="language-plaintext highlighter-rouge">nfs-ceph.yaml</code>:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">---</span>
<span class="c1"># A rook ceph cluster must be running</span>
<span class="c1"># Create a rook ceph cluster using examples in rook/cluster/examples/kubernetes/ceph</span>
<span class="c1"># Refer to https://rook.io/docs/rook/latest/ceph-quickstart.html for a quick rook cluster setup</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">PersistentVolumeClaim</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">nfs-ceph-claim</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">rook-nfs</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">storageClassName</span><span class="pi">:</span> <span class="s">rook-ceph-block</span>
  <span class="na">accessModes</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">ReadWriteMany</span>
  <span class="na">resources</span><span class="pi">:</span>
    <span class="na">requests</span><span class="pi">:</span>
      <span class="na">storage</span><span class="pi">:</span> <span class="s">2Gi</span>
<span class="nn">---</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">nfs.rook.io/v1alpha1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">NFSServer</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">rook-nfs</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">rook-nfs</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">replicas</span><span class="pi">:</span> <span class="m">1</span>
  <span class="na">exports</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">share1</span>
    <span class="na">server</span><span class="pi">:</span>
      <span class="na">accessMode</span><span class="pi">:</span> <span class="s">ReadWrite</span>
      <span class="na">squash</span><span class="pi">:</span> <span class="s2">"</span><span class="s">none"</span>
    <span class="c1"># A Persistent Volume Claim must be created before creating NFS CRD instance.</span>
    <span class="c1"># Create a Ceph cluster for using this example</span>
    <span class="c1"># Create a ceph PVC after creating the rook ceph cluster using ceph-pvc.yaml</span>
    <span class="na">persistentVolumeClaim</span><span class="pi">:</span>
      <span class="na">claimName</span><span class="pi">:</span> <span class="s">nfs-ceph-claim</span>
  <span class="c1"># A key/value list of annotations</span>
  <span class="na">annotations</span><span class="pi">:</span>
    <span class="na">rook</span><span class="pi">:</span> <span class="s">nfs</span>
</code></pre></div></div>

<p>Create the NFS server instance that you saved in <code class="language-plaintext highlighter-rouge">nfs-ceph.yaml</code>:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">kubectl create -f nfs-ceph.yaml
</span></code></pre></div></div>

<h3 id="verify-nfs-server">Verify NFS Server</h3>

<p>We can verify that a Kubernetes object has been created that represents our new NFS server and its export with the command below.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">kubectl -n rook-nfs get nfsservers.nfs.rook.io
</span></code></pre></div></div>

<blockquote>
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>NAME       AGE   STATE
rook-nfs   32s   Running
</code></pre></div>  </div>
</blockquote>

<p>Verify that the NFS server pod is up and running:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">kubectl -n rook-nfs get pod -l app=rook-nfs
</span></code></pre></div></div>

<blockquote>
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>NAME         READY     STATUS    RESTARTS   AGE
rook-nfs-0   1/1       Running   0          2m
</code></pre></div>  </div>
</blockquote>

<p>If the NFS server pod is in the <code class="language-plaintext highlighter-rouge">Running</code> state, then we have successfully created an exported NFS share that clients can start to access over the network.</p>

<h2 id="accessing-the-export">Accessing the Export</h2>

<p>Since Rook version v1.0, Rook supports dynamic provisioning of NFS.
This example will be showing how dynamic provisioning feature can be used for nfs.</p>

<p>Once the NFS Operator and an instance of NFSServer is deployed. A storageclass similar to below example has to be created to dynamically provisioning volumes.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">storage.k8s.io/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">StorageClass</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">rook-nfs</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">rook-nfs-share1</span>
<span class="na">parameters</span><span class="pi">:</span>
  <span class="na">exportName</span><span class="pi">:</span> <span class="s">share1</span>
  <span class="na">nfsServerName</span><span class="pi">:</span> <span class="s">rook-nfs</span>
  <span class="na">nfsServerNamespace</span><span class="pi">:</span> <span class="s">rook-nfs</span>
<span class="na">provisioner</span><span class="pi">:</span> <span class="s">nfs.rook.io/rook-nfs-provisioner</span>
<span class="na">reclaimPolicy</span><span class="pi">:</span> <span class="s">Delete</span>
<span class="na">volumeBindingMode</span><span class="pi">:</span> <span class="s">Immediate</span>
</code></pre></div></div>

<p>You can save it as a file, eg: called <code class="language-plaintext highlighter-rouge">sc.yaml</code> Then create storageclass with following command.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">kubectl create -f sc.yaml
</span></code></pre></div></div>

<blockquote>
  <p><strong>NOTE</strong>: The StorageClass need to have the following 3 parameters passed.</p>

  <ol>
    <li><code class="language-plaintext highlighter-rouge">exportName</code>: It tells the provisioner which export to use for provisioning the volumes.</li>
    <li><code class="language-plaintext highlighter-rouge">nfsServerName</code>: It is the name of the NFSServer instance.</li>
    <li><code class="language-plaintext highlighter-rouge">nfsServerNamespace</code>: It is the namespace where the NFSServer instance is running.</li>
  </ol>
</blockquote>

<p>Once the above storageclass has been created, you can create a PV claim referencing the storageclass as shown in the example given below.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">PersistentVolumeClaim</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">rook-nfs-pv-claim</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">storageClassName</span><span class="pi">:</span> <span class="s2">"</span><span class="s">rook-nfs-share1"</span>
  <span class="na">accessModes</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">ReadWriteMany</span>
  <span class="na">resources</span><span class="pi">:</span>
    <span class="na">requests</span><span class="pi">:</span>
      <span class="na">storage</span><span class="pi">:</span> <span class="s">1Mi</span>
</code></pre></div></div>

<p>You can also save it as a file, eg: called <code class="language-plaintext highlighter-rouge">pvc.yaml</code> Then create PV claim with following command.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">kubectl create -f pvc.yaml
</span></code></pre></div></div>

<h2 id="consuming-the-export">Consuming the Export</h2>

<p>Now we can consume the PV that we just created by creating an example web server app that uses the above <code class="language-plaintext highlighter-rouge">PersistentVolumeClaim</code> to claim the exported volume.
There are 2 pods that comprise this example:</p>

<ol>
  <li>A web server pod that will read and display the contents of the NFS share</li>
  <li>A writer pod that will write random data to the NFS share so the website will continually update</li>
</ol>

<p>Start both the busybox pod (writer) and the web server from the <code class="language-plaintext highlighter-rouge">cluster/examples/kubernetes/nfs</code> folder:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">kubectl create -f busybox-rc.yaml
kubectl create -f web-rc.yaml
</span></code></pre></div></div>

<p>Let’s confirm that the expected busybox writer pod and web server pod are <strong>all</strong> up and in the <code class="language-plaintext highlighter-rouge">Running</code> state:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">kubectl get pod -l app=nfs-demo
</span></code></pre></div></div>

<p>In order to be able to reach the web server over the network, let’s create a service for it:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">kubectl create -f web-service.yaml
</span></code></pre></div></div>

<p>We can then use the busybox writer pod we launched before to check that nginx is serving the data appropriately.
In the below 1-liner command, we use <code class="language-plaintext highlighter-rouge">kubectl exec</code> to run a command in the busybox writer pod that uses <code class="language-plaintext highlighter-rouge">wget</code> to retrieve the web page that the web server pod is hosting. As the busybox writer pod continues to write a new timestamp, we should see the returned output also update every ~10 seconds or so.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span><span class="nb">echo</span><span class="p">;</span> kubectl <span class="nb">exec</span> <span class="si">$(</span>kubectl get pod <span class="nt">-l</span> <span class="nv">app</span><span class="o">=</span>nfs-demo,role<span class="o">=</span>busybox <span class="nt">-o</span> <span class="nv">jsonpath</span><span class="o">=</span><span class="s1">'{.items[0].metadata.name}'</span><span class="si">)</span> <span class="nt">--</span> wget <span class="nt">-qO-</span> http://<span class="si">$(</span>kubectl get services nfs-web <span class="nt">-o</span> <span class="nv">jsonpath</span><span class="o">=</span><span class="s1">'{.spec.clusterIP}'</span><span class="si">)</span><span class="p">;</span> <span class="nb">echo</span>
</code></pre></div></div>

<blockquote>
  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Thu Oct 22 19:28:55 UTC 2015
nfs-busybox-w3s4t
</code></pre></div>  </div>
</blockquote>

<h2 id="teardown">Teardown</h2>

<p>To clean up all resources associated with this walk-through, you can run the commands below.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">kubectl delete -f web-service.yaml
kubectl delete -f web-rc.yaml
kubectl delete -f busybox-rc.yaml
kubectl delete -f pvc.yaml
kubectl delete -f pv.yaml
kubectl delete -f nfs.yaml
kubectl delete -f nfs-xfs.yaml
kubectl delete -f nfs-ceph.yaml
kubectl delete -f rbac.yaml
kubectl delete -f psp.yaml
</span><span class="gp">kubectl delete -f scc.yaml #</span><span class="w"> </span><span class="k">if </span>deployed
<span class="go">kubectl delete -f operator.yaml
</span><span class="gp">kubectl delete -f webhook.yaml #</span><span class="w"> </span><span class="k">if </span>deployed
<span class="go">kubectl delete -f crds.yaml
</span></code></pre></div></div>

<h2 id="troubleshooting">Troubleshooting</h2>

<p>If the NFS server pod does not come up, the first step would be to examine the NFS operator’s logs:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">kubectl -n rook-nfs-system logs -l app=rook-nfs-operator
</span></code></pre></div></div>

    </div>
  </div>
</div>

<script>
  var menu = [];
  var BASE_PATH = "";

  function add(name, url, isChild, current) {
    var item = { name: name, url: url, current: current };
    var container = menu;
    if (isChild && menu.length > 0) {
      menu[menu.length-1].children = menu[menu.length-1].children || [];
      container = menu[menu.length-1].children;
      if (current) {
        menu[menu.length-1].childCurrent = true;
      }
    }
    container.push(item);
  }

  
    add(
      "Rook",
      "/docs/nfs/latest/",
      false,
      false
    );
  
    add(
      "Prerequisites",
      "/docs/nfs/latest/k8s-pre-reqs.html",
      false,
      false
    );
  
    add(
      "NFS Quickstart",
      "/docs/nfs/latest/quickstart.html",
      false,
      true
    );
  
    add(
      "NFS Server CRD",
      "/docs/nfs/latest/nfs-crd.html",
      false,
      false
    );
  
    add(
      "Common Issues",
      "/docs/nfs/latest/common-issues.html",
      false,
      false
    );
  
    add(
      "Contributing",
      "/docs/nfs/latest/development-flow.html",
      false,
      false
    );
  

  function getEntry(item) {
    var itemDom = document.createElement('li');

    if (item.current) {
      itemDom.innerHTML = item.name;
      itemDom.classList.add('current');
    } else {
      itemDom.innerHTML = '<a href="' + item.url + '">' + item.name + '</a>';
    }

    return itemDom;
  }

  // Flush css changes as explained in: https://stackoverflow.com/a/34726346
  // and more completely: https://stackoverflow.com/a/6956049
  function flushCss(element) {
    element.offsetHeight;
  }

  function addArrow(itemDom) {
    var MAIN_ITEM_HEIGHT = 24;
    var BOTTOM_PADDING = 20;
    var arrowDom = document.createElement('a');
    arrowDom.classList.add('arrow');
    arrowDom.innerHTML = '<img src="' + BASE_PATH + '/images/arrow.svg" />';
    arrowDom.onclick = function(itemDom) {
      return function () {
        // Calculated full height of the opened list
        var fullHeight = MAIN_ITEM_HEIGHT + BOTTOM_PADDING + itemDom.lastChild.clientHeight + 'px';

        itemDom.classList.toggle('open');

        if (itemDom.classList.contains('open')) {
          itemDom.style.height = fullHeight;
        } else {
          // If the list height is auto we have to set it to fullHeight
          // without tranistion before we shrink it to collapsed height
          if (itemDom.style.height === 'auto') {
            itemDom.style.transition = 'none';
            itemDom.style.height = fullHeight;
            flushCss(itemDom);
            itemDom.style.transition = '';
          }
          itemDom.style.height = MAIN_ITEM_HEIGHT + 'px';
        }

        return false;
      };
    }(itemDom);
    itemDom.appendChild(arrowDom);

    if ((item.current && item.children) || item.childCurrent) {
      itemDom.classList.add('open');
      itemDom.style.height = 'auto';
    } else {
      itemDom.style.height = MAIN_ITEM_HEIGHT + 'px';
    }
  }

  var menuDom = document.getElementById('docs-ul');
  for (var i = 0; i < menu.length; i++) {
    var item = menu[i];
    var itemDom = getEntry(item);

    if (item.childCurrent) {
      itemDom.classList.add('childCurrent');
    }

    if (item.children) {
      addArrow(itemDom);
      itemDom.classList.add('children');
      var children = document.createElement('ul');
      for (var j = 0; j < item.children.length; j++) {
        children.appendChild(getEntry(item.children[j]));
      }
      itemDom.appendChild(children);
    }
    menuDom.appendChild(itemDom);
  }
</script>
</div></main>
    <footer id="footer" aria-label="Footer">
  <div class="top">
    <a href="//www.cncf.io">
      <img
        class="cncf"
        src="/images/cncf.png"
        srcset="/images/cncf@2x.png 2x, /images/cncf@3x.png 3x" />
    </a>
    <p>We are a Cloud Native Computing Foundation graduated project.</p>
  </div>
  <div class="middle">
    <div class="grid-center">
      <div class="col_sm-12">
        <span>Getting Started</span>
        <a href="//github.com/rook/rook">GitHub</a>
        <a href="/docs/rook/v1.9/">Documentation</a>
        <a href="//github.com/rook/rook/blob/master/CONTRIBUTING.md#how-to-contribute">How to Contribute</a>
      </div>
      <div class="col_sm-12">
        <span>Community</span>
        <a href="//slack.rook.io/">Slack</a>
        <a href="//twitter.com/rook_io">Twitter</a>
        <a href="//groups.google.com/forum/#!forum/rook-dev">Forum</a>
        <a href="//blog.rook.io/">Blog</a>
      </div>
      <div class="col_sm-12">
        <span>Contact</span>
        <a href="mailto:cncf-rook-info@lists.cncf.io">Email</a>
        <a href="//github.com/rook/rook/issues">Feature request</a>
      </div>
      <div class="col_sm-12">
        <span>Top Contributors</span>
        <a href="//cloudical.io/">Cloudical</a>
        <a href="//cybozu.com">Cybozu, Inc</a>
        <a href="//www.redhat.com">Red Hat</a>
        <a href="//www.suse.com/">SUSE</a>
        <a href="//upbound.io">Upbound</a>
      </div>
    </div>
  </div>
  <div class="bottom">
    <div class="grid-center">
      <div class="col-8">
        <a class="logo" href="/">
          <img src="/images/rook-logo-small.svg" alt="rook.io" />
        </a>
        <p>
          &#169; Rook Authors 2022. Documentation distributed under
          <a href="https://creativecommons.org/licenses/by/4.0">CC-BY-4.0</a>.
        </p>
        <p>
          &#169; 2022 The Linux Foundation. All rights reserved. The Linux Foundation has
          registered trademarks and uses trademarks. For a list of trademarks of The Linux Foundation, please see our
          <a href="https://www.linuxfoundation.org/trademark-usage/">Trademark Usage</a> page.
        </p>
      </div>
    </div>
  </div>
</footer>


  <script src="/js/anchor.js"></script>
  <script>
    anchors.options = {
      placement: 'right',
      icon: '#',
    }

    document.addEventListener('DOMContentLoaded', function(event) {
      anchors.add('.docs-text h1, .docs-text h2, .docs-text h3, .docs-text h4, .docs-text h5, .docs-text h6');
    });
  </script>




    
  </body>
</html>
